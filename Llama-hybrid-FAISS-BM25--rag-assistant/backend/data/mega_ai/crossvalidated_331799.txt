[site]: crossvalidated
[post_id]: 331799
[parent_id]: 
[tags]: 
Propensity Score Matching - Multiple observations in control group

I am quite new to propensity score matching and have the following issue in my data. I have two groups (Treatment vs control) this could be for eg. two types of loyalty program at a retail store. In my case, individuals are presented with an option to join one of two programs and then their shopping expenditure per visit is tracked. Since individuals select one of the two programs, there exists a form of selection bias in my data. I was looking at Propensity score matching (psm) with replacement to model: a) Whether individual joins Treatment program (=1, and therefore whether individual joins control program =0). b) Compute the weights. c) Use the weights obtained from psm in the model for expenditure per visit. Now, the issue that I face is that individuals in either group can visit the store multiple times. I do not want to use average expenditure per visit or treat my data as a panel data. How should the weights be computed from step (b) be divided among multiple observations in this case? For example, suppose individual A,B and C are matched with individual D and the corresponding weights are computed (A,B,C in treatment vs D in control or vice versa). Suppose the weight for individual D = X . Now suppose A, B and C make only one trip whereas individual D makes multiple trips. Should the weight that is computed for individual D (=X) be divided among the three observations for D i.e. should the weight of each visit for D = X/3? Or should all three observations for D be allotted a weight of X? Or some other solution for that matter. I would appreciate it if anyone could point me to some resources (Literature from statistics etc.) which talks about a similar issue. I am using the MatchIt package in R to implement the model. Any help in dealing with the problem in R will be appreciated. I found some discussion links related to this issue: a) Propensity score matching with panel data - Matching with panel data (not my case) b) https://www.statalist.org/forums/forum/general-stata-discussion/general/590352-propensity-score-matching-on-hospital-data-with-multiple-observations-per-person - Please let me know if any part of the question is unclear. Thank you in advance. EDIT Brief Description of the data The dataset contains information on individual spend (in dollars) on shopping during every visit at a retail store. Individuals can select to be a part of Program 1 or Program 2 which are the two available loyalty program (Program 1 existed before, whereas Program 2 was a newly introduced program, hence I call them Control and Treatment here). The dataset contains information on about 7000 unique individuals and roughly with roughly 4500 in the Treatment group and about 2500 in the control group. All together, I have information on about 10000 store visits during a period of 3 days with some individuals making repeat purchases (500 individuals in the control group accounting for 3500 store visits). The primary dependent variable is the shopping expenditure (in dollars) every visit - continuous variable and the independent variable includes demographic and socio-economic factors like income, household size etc (about 20 variables in total). Here I am not interested in examining purchase incidence or timing and I would not like to remove observations.
