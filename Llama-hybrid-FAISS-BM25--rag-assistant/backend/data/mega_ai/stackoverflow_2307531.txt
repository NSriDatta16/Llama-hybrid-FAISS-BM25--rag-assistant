[site]: stackoverflow
[post_id]: 2307531
[parent_id]: 
[tags]: 
Error parsing IP header

I have a small function that tries to print the fragment offset of an IP header. ParseIpHeader(unsigned char *packet, int len) { struct ethhdr *ethernet_header; struct iphdr *ip_header; /* First Check if the packet contains an IP header using the Ethernet header */ ethernet_header = (struct ethhdr *)packet; if(ntohs(ethernet_header->h_proto) == ETH_P_IP) { /* The IP header is after the Ethernet header */ if(len >= (sizeof(struct ethhdr) + sizeof(struct iphdr))) { ip_header = (struct iphdr*)(packet + sizeof(struct ethhdr)); /* print the Source and Destination IP address */ //printf("Dest IP address: %s\n", inet_ntoa(ip_header->daddr)); //printf("Source IP address: %s\n", inet_ntoa(ip_header->saddr)); printf("protocol %d\n", ip_header->protocol); printf("Fragment off is %d\n", ntohs(ip_header->frag_off)); } } My packets are TCP (the ip_header->protocol is always 6. the problem is that the frag_off is always 16384. I am sending a lot of data, why the frag_off is always constant? Thanks.
