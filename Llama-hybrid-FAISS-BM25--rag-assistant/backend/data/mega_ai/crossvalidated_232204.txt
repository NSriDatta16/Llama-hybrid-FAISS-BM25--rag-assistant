[site]: crossvalidated
[post_id]: 232204
[parent_id]: 
[tags]: 
Calculating prediction interval on differentiated VAR(2)

I want to calculate the $l$ step ahead prediction interval of an VAR(2) on three series. Theses series are differentiated once before estimation of the VAR(2) model. I use the functions of the MTS package in R . The 'problem' is that the VAR function of the MTS package cannot be use with the forecast function. Hence, I can't verify my calculation. I'd like to receive a review of my work. I use Tsay (2014), Multivariate Time Series Analysis with R and Financial Applications Cryer and Chan (2008), Time Series Analysis with Applications In R as book references. For univariate time series, using the forecast package, I was able to reproduce the prediction interval of an ARIMA(1,1,0). As I expected the multivariate case logic to have similarity with the univariate case, here are some elements for the univariate case. Recall that for ARMA or ARIMA models, we have (Cryer and Chan (2008)) $\text{Var}(e_t(l))=\sigma_e^2 \sum_{j=0}^{l-1}{\psi_j^2}$ for $l \ge 1$ with $\psi_0=1$. $\sigma_e^2$ is the variance of the residuals and the $\psi$ values are the coefficients of the MA($\infty$) representation. For an AR(1), for the differentiated serie, we have $\psi_j = \phi^j, j \ge0$, with $\phi$ the autoregression coefficient of lag 1. For an ARI(1,1), i.e ARIMA(1,1,0), for the original serie, we have $\psi = \frac{1-\phi^{j+1}}{1-\phi}, j \ge0$. Here is a MWE for the ARI(1,1) case with the values of the upper limits (95% level) being reproduce. library(forecast) set.seed(1234) nsim Here is my reasoning for a VAR(2) model with the help of Tsay (2014). Let $\boldsymbol{z_t} = \{ z_{1t} , z_{2t}, z_{3t}\}'$, the three series of interest ($k=3$), differentiated once ($d=1$). The VAR(2) model is represented as $\boldsymbol{z_t = \phi_0 + \phi_1 z_{t-1} + \phi_2 z_{t-2} + \epsilon_t}$ (eq. 1) by taking the expectation, we get $\boldsymbol{\mu = \phi_0 + \phi_1 \mu + \phi_2 \mu + 0}$ (eq. 2) since the series are stationnary. From there, we can rearrange the last equation $\boldsymbol{ \{I_k - \phi_1 - \phi_2\}\mu = \phi_0}$ (eq. 3) to have the mean-adjusted model by plugging (eq. 3) into (eq. 1) : $\boldsymbol{z_t = \{I_k - \phi_1 - \phi_2\}\mu + \phi_1 z_{t-1} + \phi_2 z_{t-2} + \epsilon_t}$ $\boldsymbol{z_t = I_k \mu - \phi_1 \mu - \phi_2 \mu + \phi_1 z_{t-1} + \phi_2 z_{t-2} + \epsilon_t}$ $\boldsymbol{z_t - \mu = \phi_1 (z_{t-1}- \mu) + \phi_2 (z_{t-2}- \mu) + \epsilon_t}$ $\boldsymbol{\bar{z}_t = \phi_1 \bar{z}_{t-1} + \phi_2 \bar{z}_{t-2} + \epsilon_t}$ (eq. 4) From there, let's get the MA($\infty$) representation. (eq. 4) can be written as $\boldsymbol{(I_k - \phi_1 B - \phi_2 B^2) \bar{z}_t = \epsilon_t}$ or $\boldsymbol{ \bar{z}_t = (I_k - \phi_1 B - \phi_2 B^2)^{-1}\epsilon_t}$ whereas the MA representation is $\boldsymbol{ \bar{z}_t = \psi(B)\epsilon_t}$. To go short, let's just say that the $\psi$ can be compute as $\boldsymbol{\psi_1 = \phi_1}$ $\boldsymbol{\psi_\nu = \phi_1\psi_{\nu-1} + \phi_2\psi_{\nu-2}}$, for $\nu \ge 2$ More generally : $\boldsymbol{\psi_i} = \sum^{min(i,p)}_{j=1}{\boldsymbol{\phi_j\psi_{i-j}}}$, $i=1,2,...$ (eq. 5) (Tsay (2014), p.44) From Tsay (2014), p.84, equation (2.74), we have $\text{Cov}(e_h(l)) = \Sigma_\epsilon + \sum_{i=1}^{l-1}{\psi_i \Sigma_\epsilon \psi_i^{'}}$ (eq.6) with $h$ be the forecast origin. All of this work was directly on the differentiated series. See the similarity with the univariate case $\text{Var}(e_t(l))=\sigma_e^2 \sum_{j=0}^{l-1}{\psi_j^2}=\sigma_e^2 + \sum_{j=1}^{l-1}{\psi_j * \sigma_e^2 * \psi_j}$ since $\psi_0 = 1$. For the original series (without differentiation), I would think (eq. 6) too apply, just like in the univariate case. The $\psi_i$ matrices have dimension 3x3. The main difference is the calculation of the $\psi$. Let $\boldsymbol{Z_t} = \{ Z_{1t} , Z_{2t}, Z_{3t}\}'$, the orignal three series of interest ($k=3$). The model can be represented as $\boldsymbol{Z_t - Z_{t-1} = \phi_0 + \phi_1 (Z_{t-1}-Z_{t-2}) + \phi_2 (Z_{t-2}-Z_{t-3}) + \epsilon_t}$ $\boldsymbol{Z_t = \phi_0 + Z_{t-1} + \phi_1 (Z_{t-1}-Z_{t-2}) + \phi_2 (Z_{t-2}-Z_{t-3}) + \epsilon_t}$ $\boldsymbol{Z_t = \phi_0 + (1 + \phi_1) Z_{t-1} + (\phi_2 - \phi_1) Z_{t-2} + (-\phi_2) Z_{t-3} + \epsilon_t}$ We can repeat the mean-adjustement procedure to get $\boldsymbol{(I_k - \phi_1^{'} B - \phi_2^{'} B^2 - \phi_3^{'} B^3) \bar{Z}_t = \epsilon_t}$ where $\phi_1^{'} = 1+\phi_1$, $ \phi_2^{'} = \phi_2 - \phi_1$ and $\phi_3^{'} = -\phi_2$, Thereafter, to compute my prediction interval on my original series, I would use (eq. 5) then (eq. 6). Is it right? EDIT 2017-04-17 : We can't repeat the mean-adjustement procedure on $Z$ to get the MA representation (and the $\psi$ weights), since by using the expectation of the $Z$ we would use the assumption of time-invariant mean, while we are working on nonstationnary series. I am not able to find an elegant way to get the $\psi$ weights due to the presence of a constant term $\phi_0$. Still, by repeatedly replacing the $Z_{t-i}$ term by the model to end up with only $\epsilon_{t-i}$ (up to $t-5$), I was able to recognize the pattern of (eq. 5) for the original series, with the use of $\phi_1^{'} = 1+\phi_1$, $ \phi_2^{'} = \phi_2 - \phi_1$ and $\phi_3^{'} = -\phi_2$. The constant term only add up linearly as a trend and doesn't impact the uncertainty, hence it doesn't change (eq 6) which could be use. I feel more confident that this is appropriate approach. The $\phi_1^{'} = 1+\phi_1$ if $\phi_1 \gt 0$ bothers me, but I seem to remember that confidence interval of nonstationnary serie do not converge, so it would be normal.
