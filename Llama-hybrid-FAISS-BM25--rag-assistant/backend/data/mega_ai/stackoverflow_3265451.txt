[site]: stackoverflow
[post_id]: 3265451
[parent_id]: 
[tags]: 
Exporting a MFC Dialog from a DLL

21st July: Updated, see bottom In VC++ 2005 I have 2 projects. Firstly, a MFC DLL project (not an extension DLL) which has a simple dialog: TestDlg.h #pragma once #include "afxwin.h" #include "resource.h" // CTestDlg dialog namespace Dialogs { class __declspec(dllexport) CTestDlg : public CDialog { DECLARE_DYNAMIC(CTestDlg ) public: CTestDlg (CWnd* pParent = NULL); // standard constructor virtual ~CTestDlg (); // Dialog Data enum { IDD = IDD_TEST_DLG }; } } Then I have a Win32 console app, with MFC libraries, that does: TestApp.cpp #include "stdafx.h" #include "TestApp.h" #include #ifdef _DEBUG #define new DEBUG_NEW #endif CWinApp theApp; using namespace std; int _tmain(int argc, TCHAR* argv[], TCHAR* envp[]) { int nRetCode = 0; // initialize MFC and print and error on failure if (!AfxWinInit(::GetModuleHandle(NULL), NULL, ::GetCommandLine(), 0)) { // TODO: change error code to suit your needs _tprintf(_T("Fatal Error: MFC initialization failed\n")); nRetCode = 1; } else { Dialogs::CTestDlg dlg; dlg.DoModal(); } return nRetCode; } It builds and runs up, but no dialog appears. Stepping into DoModal()... dlgcore.cpp INT_PTR CDialog::DoModal() { // can be constructed with a resource template or InitModalIndirect ASSERT(m_lpszTemplateName != NULL || m_hDialogTemplate != NULL || m_lpDialogTemplate != NULL); // load resource as necessary LPCDLGTEMPLATE lpDialogTemplate = m_lpDialogTemplate; HGLOBAL hDialogTemplate = m_hDialogTemplate; HINSTANCE hInst = AfxGetResourceHandle(); if (m_lpszTemplateName != NULL) { hInst = AfxFindResourceHandle(m_lpszTemplateName, RT_DIALOG); HRSRC hResource = ::FindResource(hInst, m_lpszTemplateName, RT_DIALOG); hDialogTemplate = LoadResource(hInst, hResource); } if (hDialogTemplate != NULL) lpDialogTemplate = (LPCDLGTEMPLATE)LockResource(hDialogTemplate); // return -1 in case of failure to load the dialog template resource if (lpDialogTemplate == NULL) return -1; ... more stuff For whatever reason it seems it can't load the resource, returning -1 at the end of the copied section. I've looked at a few articles on CodeGuru, etc, and not seen anything obvious. Is my class not being exported/imported right? Or is it a resource problem? Or is the problem that I'm trying to display it from a console (MFC) app? 21st July Update I created an overridden DoModal as so: INT_PTR CTestDlg::DoModal() { AFX_MANAGE_STATE(AfxGetStaticModuleState( )); return CDialog::DoModal(); } This seems to work although should I be overriding a different method to get the functionality more generic?
