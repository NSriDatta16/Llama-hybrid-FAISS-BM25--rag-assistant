[site]: stackoverflow
[post_id]: 607226
[parent_id]: 
[tags]: 
How can I tell if an index contains a column of type varchar(max)?

I'm working on my MSSQL index defragmentation script. Certain kinds of indexes can be rebuilt online, and other kinds can't. For clustered indexes, it's easy enough to see if the table contains any LOB columns, but for a non-clustered index I need to specifically know if there is any LOB columns covered by that specific index. I used to be able to do this by looking at the alloc_unit_type_desc in dm_db_index_physical_stats, but this doesn't work for columns of type varchar(max) and xml. This isn't for my database, so I don't want to get into a discussion over whether or not the index is appropriate, let's just accept that it exists and that I'd like the script to be able to handle this situation. Does anyone know what kind of SQL I can write to check for this? Assume I have all the relevant object ids and object names in scalar variables.
