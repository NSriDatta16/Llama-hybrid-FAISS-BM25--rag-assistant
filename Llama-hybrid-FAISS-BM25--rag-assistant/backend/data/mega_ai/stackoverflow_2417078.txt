[site]: stackoverflow
[post_id]: 2417078
[parent_id]: 
[tags]: 
Writing a simple webserver in Ruby

I want to create an extremely simple web server for development purposes in Ruby (no, donâ€™t want to use ready solutions). Here is the code: #!/usr/bin/ruby require 'socket' server = TCPServer.new('127.0.0.1', 8080) while connection = server.accept headers = [] length = 0 while line = connection.gets headers The idea is to run this script from the command line, providing another script, which will get the request on its standard input, and gives back the complete response on its standard output. So far so good, but this turns out to be really fragile, as it breaks on the second request with the error: /usr/bin/serve:24:in `write': Broken pipe (Errno::EPIPE) from /usr/bin/serve:24:in `print' from /usr/bin/serve:24 from /usr/bin/serve:23:in `popen' from /usr/bin/serve:23 Any idea how to improve the above code to be sufficient for easy use? Versions: Ubuntu 9.10 (2.6.31-20-generic), Ruby 1.8.7 (2009-06-12 patchlevel 174) [i486-linux]
