[site]: crossvalidated
[post_id]: 602027
[parent_id]: 
[tags]: 
Reparametrization of an EBM in the latent space

In [Xiao et al., 2020] , the authors propose a reparametrization of their exponentially-tilted generative model from the data space to the latent space. The model is defined as: \begin{equation} h_{\phi, \theta}(x) = \frac{1}{Z_{\phi, \theta}} \int p_{\phi}(x, z)e^{-E_{\theta}(x)} dz = \frac{p_{\phi}(x)e^{-E_{\theta}(x)}}{Z_{\phi, \theta}} \end{equation} where $Z_{\phi, \theta} = \int p_{\phi}(x) e^{-E_{\theta}(x)} dx$ is a normalizing constant, and $p_{\phi}(x)$ is a probabilisitc generative model (e.g. VAE). $p_{\phi}(x)$ has a decoder component $G_{\phi}$ s.t.: \begin{equation} z \sim p(z), \; \; x = G_{\phi}(z) \end{equation} where $z$ is a latent variable with a simple prior distribution $p(z)$ . Then the authors propose to reparametrize the EBM using latent variable $z$ as shown below: \begin{equation} p_{\phi, \theta}(z) = \frac{p(z)e^{-E_{\theta}(G_{\phi}(z))}}{Z_{\phi, \theta}} \end{equation} Here is my attempt at deriving the reparametrization: \begin{align} h_{\phi, \theta}(x) &= \frac{p_{\phi}(x)e^{-E_{\theta}(x)}}{\int p_{\phi}(x)e^{-E_{\theta}(x)} dx} \\\\ &= \frac{p_{\phi}(G_{\phi}(z))e^{-E_{\theta}(G_{\phi}(z))}}{\int p_{\phi}(G_{\phi}(z))\det{\begin{vmatrix}\frac{dG_{\phi}(z)}{dz} \end{vmatrix}}e^{-E_{\theta}(G_{\phi}(z))} dz} \\\\ &= \frac{p_{\phi}(G_{\phi}(z))e^{-E_{\theta}(G_{\phi}(z))}}{\int p(z)e^{-E_{\theta}(G_{\phi}(z))}dz} \\\\ &= \frac{p_{\phi}(G_{\phi}(z))e^{-E_{\theta}(G_{\phi}(z))}}{Z_{\phi, \theta}} \end{align} Moving from the first to the second line uses the theorem of change of variable in a multivariate integral: \begin{equation} \int p_{\phi}(x)e^{-E_{\theta}(x)}dx = \int p_{\phi}(G_{\phi}(z)) \det{\begin{vmatrix}\frac{dG_{\phi}(z)}{dz}\end{vmatrix}} e^{-E_{\theta}(G_{\phi}(z))} dz \end{equation} Moving from the second to the third line requires the theorem of change of variables in a density function: \begin{equation} p(z) = p_{\phi}(G_{\phi}(z)) \det{\begin{vmatrix}\frac{dG_{\phi}(z)}{dz}\end{vmatrix}} \end{equation} I have two questions here: 1. How do I move from $h_{\phi, \theta}(x) = \frac{p_{\phi}(G_{\phi}(z))e^{-E_{\theta}(G_{\phi}(z))}}{Z_{\phi, \theta}}$ to $h_{\phi, \theta}(x) = \frac{p(z))e^{-E_{\theta}(G_{\phi}(z))}}{Z_{\phi, \theta}}$ ? 2. The change of variable theorems (both for multivariate integrals and density functions) require $G_{\phi}$ to be an invertible transformation from $Z$ to $X$ (domains of $z$ and $x$ respectively). This is not guaranteed for any generic probabilistic model, which is what the paper proposes for $p_{\phi}(x)$ . Am I missing something?
