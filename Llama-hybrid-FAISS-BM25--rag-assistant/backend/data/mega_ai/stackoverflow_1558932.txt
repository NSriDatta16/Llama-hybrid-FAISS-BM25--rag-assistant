[site]: stackoverflow
[post_id]: 1558932
[parent_id]: 
[tags]: 
WPF ListBox drag & drop interferes with ContextMenu?

I'm implementing drag & drop from a ListBox, but I'm seeing some strange behaviour with a ContextMenu elsewhere in the window. If you open the context menu and then start a drag from the ListBox, the context menu closes but won't open again until after you perform another drag. Does this make sense? Anybody got any ideas what might be going on? Button with context menu ... public partial class Window1 { private bool clickedOnSourceItem; public Window1() { InitializeComponent(); DataContext = new WindowViewModel(); } private void DropOnToDestination(object sender, DragEventArgs e) { var viewModel = (WindowViewModel)e.Data.GetData(typeof(WindowViewModel)); viewModel.CopySelectedItems(); } private void HandleLeftButtonDown(object sender, MouseButtonEventArgs e) { var sourceElement = (FrameworkElement)sender; var hitItem = sourceElement.InputHitTest(e.GetPosition(sourceElement)) as FrameworkElement; if(hitItem != null) { clickedOnSourceItem = true; } } private void HandleLeftButtonUp(object sender, MouseButtonEventArgs e) { clickedOnSourceItem = false; } private void HandleMouseMove(object sender, MouseEventArgs e) { if(clickedOnSourceItem) { var sourceItems = (FrameworkElement)sender; var viewModel = (WindowViewModel)DataContext; DragDrop.DoDragDrop(sourceItems, viewModel, DragDropEffects.Move); clickedOnSourceItem = false; } } }
