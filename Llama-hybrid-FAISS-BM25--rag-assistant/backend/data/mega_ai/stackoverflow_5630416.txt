[site]: stackoverflow
[post_id]: 5630416
[parent_id]: 5630321
[tags]: 
Ideally on the server you want to write the header (the size) and the data atomically, I'd do that using the scatter/gather calls writev() also if there is any chance multiple threads can write to the same socket concurrently you may want to use a mutex in the write call. writev() will also write all the data before returning (if you are using blocking I/O). On the client you may have to have a state machine that reads the length of the buffer then sits in a loop reading until all the data has been received, as large buffers will be fragmented and come in in various sized blocks.
