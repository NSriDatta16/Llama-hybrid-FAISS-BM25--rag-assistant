[site]: stackoverflow
[post_id]: 1256213
[parent_id]: 
[tags]: 
pywikipedia bot with https and http authentication

I'm having trouble getting my bot to login to a MediaWiki install on the intranet. I believe it is due to the http authentication protecting the wiki. Facts: The wiki root is: https://local.example.com/mywiki/ When visiting the wiki with a web browser, a popup comes up asking for enterprise credentials (I assume this is basic access authentication) This is what I have in my user-config.py: mylang = 'en' family = 'mywiki' usernames['mywiki']['en'] = u'Bot' authenticate['local.example.com'] = ('user', 'pass') This is what I have in mywiki_family.py: # -*- coding: utf-8 -*- import family, config # The Wikimedia family that is known as mywiki class Family(family.Family): def __init__(self): family.Family.__init__(self) self.name = 'mywiki' self.langs = { 'en' : 'local.example.com'} def scriptpath(self, code): return '/mywiki' def version(self, code): return '1.13.5' def isPublic(self): return False def hostname(self, code): return 'local.example.com' def protocol(self, code): return 'https' def path(self, code): return '/mywiki/index.php' When I execute login.py -v -v, I get this: urllib2.urlopen(urllib2.Request('https://local.example.com/w/index.php?title=Special:Userlogin&useskin=monobook&action=submit', wpSkipCookieCheck=1&wpPassword=XXXX&wpDomain=&wpRemember=1&wpLoginattempt=Aanmelden%20%26%20Inschrijven&wpName=Bot, {'Content-type': 'application/x-www-form-urlencoded', 'User-agent': 'PythonWikipediaBot/1.0'})): (Redundant traceback info here) urllib2.HTTPError: HTTP Error 401: Unauthorized (I'm not sure why it has 'local.example.com/w' instead of '/mywiki'.) I thought it might be trying to authenticate to example.com instead of example.com/wiki, so I changed the authenticate line to: authenticate['local.example.com/mywiki'] = ('user', 'pass') But then I get an HTTP 401.2 error back from IIS: You do not have permission to view this directory or page using the credentials that you supplied because your Web browser is sending a WWW-Authenticate header field that the Web server is not configured to accept. Any help on how to get this working would be appreciated. Update After fixing my family file, it now says: Getting information for site mywiki:en ('http error', 401, 'Unauthorized', ) WARNING: Could not open ' https://local.example.com/mywiki/index.php?title=Non-existing_page&action=edit&useskin=monobook '. Maybe the server or your connection is down. Retrying in 1 minutes... I looked at the HTTP headers on a plan urllib2.ulropen call and it's using WWW-Authenticate: Negotiate WWW-Authenticate: NTLM. I'm guessing urllib2 and thus pywikipedia don't support this? Update Added a tasty bounty for help in getting this to work. I can authenticate using python-ntlm. How do I integrate this into pywikipedia?
