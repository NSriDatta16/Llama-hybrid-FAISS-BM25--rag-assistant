[site]: stackoverflow
[post_id]: 802316
[parent_id]: 
[tags]: 
C++ - Detours WinSock Hooking

What I am trying to do is use the Detours library to hook into an applications WinSock2 send() and recv() functions (a packet logger). While it does work for the send() function, it does not, however, work for the recv() function. Here is my relevant code: #include #include #include #include #include #include #include #pragma comment( lib, "Ws2_32.lib" ) #pragma comment( lib, "detours.lib" ) #pragma comment( lib, "detoured.lib" ) #pragma comment( lib, "Mswsock.lib" ) std::ofstream Logger; std::string NowToString() { time_t rawtime; tm *timeinfo = new tm(); char buffer[32]; time( &rawtime ); localtime_s( timeinfo, &rawtime ); strftime( buffer, 32, "%m/%d/%Y %I:%M:%S %p", timeinfo ); delete timeinfo; return std::string( buffer ); } std::string TimeToString() { time_t rawtime; tm *timeinfo = new tm(); char buffer[32]; time( &rawtime ); localtime_s( timeinfo, &rawtime ); strftime( buffer, 32, "%I:%M:%S %p", timeinfo ); delete timeinfo; return std::string( buffer ); } void LogPacket( const char *buf, int len ) { Logger = 32 && c = 8 ) { ++fill; } for ( int j = 0; j = 32 && c Server (Length: " Client (Length: " Client (Length: " Client (Length: " 0 ) { Logger Any ideas? EDIT: So I've hooked recvfrom(), and WSARecvEx() as well, and it still doesn't log the outgoing packets! I've updated my code with my exact code.
