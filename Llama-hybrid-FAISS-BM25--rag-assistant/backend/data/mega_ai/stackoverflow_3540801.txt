[site]: stackoverflow
[post_id]: 3540801
[parent_id]: 
[tags]: 
FileSystemWatcher does not report changes in a locked file

I'm monitoring a folder using a FileSystemWatcher like this: watcher = new FileSystemWatcher(folder); watcher.NotifyFilter = NotifyFilters.Size; watcher.Changed += changedCallback; When I open a new file in notepad in that folder and save it, I get a notification. If I keep writing and then I save, I get a notification. If I close the file with saving it, I get a notification. Exactly what I wanted. However, it turns out that if I create a file in that folder and I set its sharing mode to FileShare.Read, and then I write to it, I will not get any notifications until the file is closed. Another workaround is to open the file (e.g. in Notepad), which apparently causes its state to be updated, and then my monitoring application gets the notification. Yet another workaround is a refresh I can do in Windows Explorer, which again causes the file state to be updated. Interestingly, if I look at Windows Explorer while I make the changes, I notice that: If the file is shared for reading & writing, its size will be updated immediately in Windows Explorer as soon as I save it. If the file is shared for reading only, its size will NOT be update immediately in Windows Explorer, unless I manually refresh the window. So it seems that my monitoring application shares the same behavior as Windows Explorer. I was thinking about running a thread that will just scan the files in the folder, but I'm wondering if there's anything more elegant to be done in this case. BTW, I'm using Win7 and I'm not sure that this problem happens on other Windows versions as well. Thanks! EDIT : Using ReadDirectoryChanges in C++ got me the same exact results. Implementing the thread I was talking about earlier didn't help as well. I'm wondering what is F5 in Windows Explorer actually doing, because it does cause the change to be reported.
