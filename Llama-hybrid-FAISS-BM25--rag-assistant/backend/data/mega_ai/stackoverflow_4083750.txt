[site]: stackoverflow
[post_id]: 4083750
[parent_id]: 4083644
[tags]: 
Delete any existing user/role relationships before creating new ones from the submitted checkboxes. You can also insert all the roles in a single MySQL statement if you set the checkbox values to the role_id's instead of the role_name's. Also, there's no reason for the users_in_roles table to duplicate the role_name column. Here's what I'd use (simplified pseudo-statements of course): // New data structure mysqli_query("DROP TABLE users_in_roles"); mysqli_query("CREATE TABLE users_in_roles ( user_id ..., role_id ....)"); .... // Build SQL fragments for multi-row INSERT. $a = array(); foreach($checked as $role_id) { $a[]= sprintf('(%d, %d)', $user_id, $role_id); } // Delete existing user/role relationships for the user. mysqli_query("DELETE FROM users_in_roles WHERE user_id = $user_id"); // Insert multiple rows in a single statement. mysqli_query( sprintf('INSERT INTO users_in_roles (user_id, role_id) VALUES %s', implode(', ', $a))); This method accomplishes the same thing - using only two sql statements. One downside: in the unlikely event that there's an error before/during the INSERT statement no roles will be assigned. You can executing DELETE and INSERT in a transaction.
