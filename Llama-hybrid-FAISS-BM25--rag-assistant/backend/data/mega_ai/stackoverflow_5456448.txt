[site]: stackoverflow
[post_id]: 5456448
[parent_id]: 
[tags]: 
Creating Data table from tabular report using Groovy

I've been lumbered with the job of converting a list report into tabular data, and for various reasons the only programmatic tool I have is groovy (i.e. no shell commands, no C, no perl). The data comes pre-summarised, in five columns, Grouping (e.g. company), Sub-grouping (e.g. Quarter), sub total, sub-group total, grand total (with the summary data tacked onto the first row of each group) : Big Co.\t2009 Q4\t29\t88\t308 \t2010 Q1\t38\t\t \t2010 Q4\t21\t\t Gargantua Inc.\t2009 Q4\t33\t139 \t2010 Q1\t31\t\t \t2010 Q2\t36\t\t \t2010 Q3\t39\t\t Mediocre Ltd.\t2009 Q4\t39\t81 \t2010 Q4\t42\t\t And the output needs to be something like: Group 2009 Q4 2010 Q1 2010 Q2 2010 Q3 2010 Q4 Subtotal Big Co 29 38 &nbsp; &nbsp; 38 308 Gargantua Inc 29 31 36 39 &nbsp; 139 Gargantua Inc 39 &nbsp; &nbsp; &nbsp; 42 81 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 308 I'd like to be able run some loops over the data; stick things into an associative array of associative arrays, building a complete key list as I go; then loop again to produce the output. I've taken a look at groovy, and the Map syntax has my completely thrown. Can anyone point me to some clearer examples of groovy Map iterations, so that I can at least get a toe in the water with this? Any help gratefully received. (In case anyone thinks this is just a fishing trip, I've kludged together a PHP version that does the trick - essentially I need to be able to translate this into groovy... ) $row) { $rowData = explode("\t", $row); if($rowData[0]) { $group = $rowData[0]; $group_names[$rowData[0]] = true; } if($rowData[1]) { $subgroup = $rowData[1]; $subgroup_names[$rowData[1]] = true; } $table[$group][$subgroup]['jobcount'] = $rowData[2]; if($rowData[3]) $totals[$group]['jobcount'] = $rowData[3]; if($rowData[4]) $totals['grandtotal'] = $rowData[4]; } $group_names = array_keys($group_names); asort($group_names); $subgroup_names = array_keys($subgroup_names); asort($subgroup_names); $result = array(); $result['header'] = " &nbsp; "; foreach ($subgroup_names as $subgroup) { $result['header'] .= " $subgroup "; } $result['header'] .= " Subtotals "; foreach ($group_names as $group) { $result[$group] = " $group "; foreach ($subgroup_names as $subgroup) { $value = isset($table[$group][$subgroup]['jobcount'])? $table[$group][$subgroup]['jobcount']: '&nbsp;'; $result[$group] .= " ".$value." "; } $result[$group] .= " ".$totals[$group]['jobcount']." "; } $result['footer'] = ""; foreach ($subgroup_names as $subgroup) { $result['footer'] .= " &nbsp; "; } $result['footer'] .= " Total "; $result['footer'] .= " ".$totals['grandtotal']." "; echo " ".join($result, " \n ")." "; ?>
