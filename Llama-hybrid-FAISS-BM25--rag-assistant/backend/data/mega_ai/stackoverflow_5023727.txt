[site]: stackoverflow
[post_id]: 5023727
[parent_id]: 5021178
[tags]: 
This is my simplified version of exporting csv file, add this code into csv_results_page(). Here used query, but can be other thing (like arrays, file listing, etc): /** * Export to cvs */ function _YOURMODULENAME_csv_export() { $delimiter = "\t"; // This is tab delimiter, can be other $temp = file_directory_temp(); $file = tempnam(realpath($temp), 'csv'); if (!$fp = fopen($file, 'a')) { drupal_set_message(t('The file for exported could not be created. Refer to the site administrator'), 'error'); return; } $title = "Some title for csv\n"; // you can remove it, if don't want title in csv $title .= implode($delimiter, array('Column name 1','Column name 2')). "\n"; // Add all columns titles here, it should mutch query result fields below fwrite($fp, $title); $query = 'WRITE HERE SOME CODE THAT SHOULD RESULT QUERY AND RETURN fields in order described in $title above'; $result = db_query($query); while ($data = db_fetch_array($result)) { $rows = implode($delimiter, $data); fwrite($fp, $rows."\n"); } fclose($fp); $header = array(); $header[] = 'Pragma: no-cache'; $header[] = 'Cache-Control: no-cache, must-revalidate'; $header[] = 'Content-Disposition: attachment; filename="exort_'.date('Ymd',time()).'.csv";'; // This is file name $header[] = 'Content-Type: text/x-comma-separated-values'; $header[] = 'Content-Length: '.filesize($file); $header[] = 'Connection: close'; file_transfer($file, $header); file_delete($file); return; }
