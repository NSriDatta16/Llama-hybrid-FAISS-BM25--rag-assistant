[site]: stackoverflow
[post_id]: 5379622
[parent_id]: 5379037
[tags]: 
An interesting question which has been asked -but not answered- before ( Setting Cookies via ESI:include, how? ). I don't think you can do it this way. With ESI-include, the ESI processor makes a separate request and replaces a part from the body, not the header. In order to make your preferred set-cookie behavior work correctly, the ESI specification should specify how to 'merge' all set-cookie headers. See chapter six of the ESI spec: http://www.w3.org/TR/esi-lang When an ESI template is processed, a separate request will need to be made for each include encountered. Implementations may use the original request's headers (e.g., Cookie, User-Agent, etc.) when doing so. Additionally, response headers from fragments (e.g., Set-Cookie, Server, Cache-Control, Last-Modified) may be ignored, and should not influence the assembled page. Could you try to convert your set-cookie header in a javascript set-cookie script? This could be included in the body...
