[site]: stackoverflow
[post_id]: 5407424
[parent_id]: 
[tags]: 
Call an old C++ function from .NET for non-primitive data type

I have an old C++ function that I must use in my .NET application. Every time I tried to call and cast the pointer back to the class, I receive an error indicating that I attempted to read or write into protected memory. Could someone help me to point me to the right direction please. Here's the codes: typedef struct { char szModel[32]; float fSpeed; float fData[20]; } CAR, far *LP_CAR; //Function prototype int FAR PASCAL Process(char szModel[32], LP_DATA pCar); And my .NET codes: [DllImport("Unmanaged.dll", CharSet = CharSet.Ansi)] public static extern int Process(string model, IntPtr data); //****** Implementation ********** public class ManagedClass { public string szModel = new string(new char[32]); public float fSpeed; public float[] fData = new float[20]; } ManagedClass aCar = new ManagedClass(); IntPtr ptr = Marshal.AllocHGlobal(Marshal.Sizeof(aCar)); Marshal.StructureToPtr(aCar, ptr, false); Process(aCar, ptr); ManagedClass model2 = (ManagedClass)Marshal.PtrToStructure(ptr, typeof(ManagedClass));
