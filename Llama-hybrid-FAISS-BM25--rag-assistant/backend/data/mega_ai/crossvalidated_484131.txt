[site]: crossvalidated
[post_id]: 484131
[parent_id]: 
[tags]: 
How to evaluate permutation tests in vegan when strata are are not balanced

I have a multivariate data set of 12 sites, and 4 plots per site, except one site which only has three plots. There two variables of interest: site_type , which is a property of a site, and ChaussB, which is a property of a plot. genedat We can ordinate these data to see how they disperse by site_type : library(vegan) set.seed(14) genNMDS If we were do to any sort of permutation test on this, there would be an issue of pseudoreplication, because the sample size (n=47 plots) is inappropriate here because site_type is a property of site (n=12). > envfit(genNMDS ~ site_type, data=genedat) ***FACTORS: Centroids: NMDS1 NMDS2 site_typeCTRL -0.1382 -0.0674 site_typeOSP -0.0227 -0.0366 site_typePMI 0.0761 0.0574 site_typeSPS 0.0910 0.0514 Goodness of fit: r2 Pr(>r) site_type 0.2294 0.009 ** --- Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 Permutation: free Number of permutations: 999 > adonis(genedat[,4:14] ~ site_type, data=genedat) Call: adonis(formula = genedat[, 4:14] ~ site_type, data = genedat) Permutation: free Number of permutations: 999 Terms added sequentially (first to last) Df SumsOfSqs MeanSqs F.Model R2 Pr(>F) site_type 3 0.33944 0.113148 3.8859 0.21329 0.003 ** Residuals 43 1.25205 0.029117 0.78671 Total 46 1.59149 1.00000 --- Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 We should really be considering sites as strata, and permuting entire sites, using the how() function in the permute package. plot(genNMDS, type = "n") points(genNMDS, display = "sites", col = colvec[genedat $site_type], pch=19) ordihull(genNMDS, groups=genedat$ site_num, col= colvec[c(2, 3, 4, 2, 4, 3, 1, 3, 2, 4, 1, 1)], draw="polygon") library(permute) h=with(genedat, how(within=Within(type="free"), plots=Plots(strata=site_num, type="free"))) But if we do so, as discussed in the permute::how() documentation and in this question we run into an error because we are missing a plot for one of the sites. > envfit(genNMDS ~ site_type, data=genedat, perm=h) Error in check(sn, control = control, quietly = quietly) : Design must be balanced if permuting 'strata'. > adonis(genedat[,4:14] ~ site_type, data=genedat, perm=h) Error in check(sn, control = control, quietly = quietly) : Design must be balanced if permuting 'strata'. Question 1: Why must the design be balanced? I suspect it must have something to do with the number of possible ways you can permute a 4-plot site into a 3-plot site, and therefore each site_type group has a slightly different power associated with it. But I would appreciate a more extensive explanation. Question 2: How can I assess the question of whether the site_types are significantly separating on either the ordination ( envfit ) or in the distance matrix ( adonis ) given the imbalance that precludes permuting by strata? One solution I came up with is the average all plot data by site, and then evaluate on a data set of n=12 (without the subsampling). library(dplyr) genedatagg % group_by(site_num, site_type) %>% summarize(across(is.numeric, mean)) set.seed(14) aggNMDS $site_type], pch=19) ordihull(aggNMDS, groups=genedatagg$ site_type,draw="polygon", col=colvec) > envfit(aggNMDS ~ site_type, data=genedatagg) ***FACTORS: Centroids: NMDS1 NMDS2 site_typeCTRL -0.1790 0.0570 site_typeOSP -0.0530 0.0283 site_typePMI 0.1426 -0.0394 site_typeSPS 0.0894 -0.0459 Goodness of fit: r2 Pr(>r) site_type 0.4593 0.143 Permutation: free Number of permutations: 999 > adonis(genedatagg[,4:14] ~ site_type, data=genedatagg) Call: adonis(formula = genedatagg[, 4:14] ~ site_type, data = genedatagg) Permutation: free Number of permutations: 999 Terms added sequentially (first to last) Df SumsOfSqs MeanSqs F.Model R2 Pr(>F) site_type 3 0.08214 0.027380 1.4614 0.35402 0.267 Residuals 8 0.14988 0.018735 0.64598 Total 11 0.23202 1.00000 But this is not optimal if I simultaneously want to test ChaussB as this variable is a property of a plot, not a site (we would lose power for this variable by aggregating). envfit(aggNMDS ~ site_type + ChaussB, data=genedatagg) adonis(genedatagg[,4:14] ~ site_type + ChaussB, data=genedatagg)
