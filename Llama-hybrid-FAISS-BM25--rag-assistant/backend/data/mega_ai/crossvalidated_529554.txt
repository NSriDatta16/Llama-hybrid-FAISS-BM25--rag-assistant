[site]: crossvalidated
[post_id]: 529554
[parent_id]: 
[tags]: 
How to compare conversion rates from AB test when users visit multiple times

I've been asked to compute the minimum sample size for an AB test that my company is conducting for a tweaked recommender system. We will choose two groups of users, one of which sees only the A version and one of which sees only the B version of their recommendations. We will compute conversion rate as the number of times users choose items from their recommendations divided by the number of times they view their recommendations. Many users won't view their recommendations at all during the test period while some users will view their recommendations dozens of times. Question: Should we calculate the overall conversion rate for each group and compare using a two-proportion Z-test? Or should we calculate the conversion rate for each user who viewed their recommendations at least once and compare the average of the individual conversion rates for each group using a two-sample t-test? I'm leaning toward the second option because it weights each user equally. Also, the first option would involve many observations that are not independent.
