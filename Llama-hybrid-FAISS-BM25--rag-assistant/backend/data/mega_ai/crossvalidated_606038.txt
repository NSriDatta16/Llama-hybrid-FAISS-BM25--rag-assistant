[site]: crossvalidated
[post_id]: 606038
[parent_id]: 605850
[tags]: 
Depending on your goal in modeling, don't underestimate the ability of a Cox or other survival regression to handle "wild" unadjusted survival curves. Your example doesn't seem that "wild" to me. The approximately parallel shift in survival curves along the time axis (based on "Melanoma" data from the R MASS package ) might indicate an accelerated failure time model in preference to a proportional hazards model, but for many purposes regression models can work very well. For attempts at causal inference in observational studies, however, you do need to account properly for the covariates whose values differ between treatment groups. Inverse Probability Weighting is a way to do that. Austin and Stuart discuss this for binary treatments. @Noah outlines how to extend this to multiple treatments , with a reference for further study . In outline, inverse probability weighting is as simple as the name sounds. Say that you are comparing treatment versus control in an observational study. You develop a model of the probability of having received the treatment as a function of the covariates for which you want to control. Use your favorite binary model for this, say logistic regression. Then calculate weights as follows (Austin and Stuart, Section 2.2): Each subjectâ€™s weight is equal to the inverse of the probability of receiving the treatment that the subject received. Plug those values into the weights argument of the survfit() function. That way, you have re-weighted your sample in a way that tries to get two treatment groups with similar covariate distributions. That helps estimate the "average treatment effect" (ATE) that would be seen if all received the treatment. Different weights described by Austin and Stuart can help estimate the "average treatment effect on the treated" (ATT). That might be taken as an answer to your question. Yes, you can do all that in base R. But you probably shouldn't. @Noah explains , in a long answer that deserves detailed study: A problem with this is that there is almost no hope in correctly modeling the treatment process to obtain propensity scores, and some evidence that even correctly modeling it parametrically is inefficient. More advanced modeling of probabilities than logistic regression, or alternate ways of achieving covariate balance, are preferred. There are well-vetted packages that can accomplish this. The WeightIt package in R provides an interface to best practices. For this type of work, take advantage of the accumulated understanding developed over years of study and argument among practitioners. "Don't try this at home" unless you have an experienced guide or have engaged in extensive study.
