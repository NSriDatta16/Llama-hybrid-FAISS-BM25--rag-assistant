[site]: stackoverflow
[post_id]: 4447576
[parent_id]: 4447369
[tags]: 
Do you really need a temp table? ALTER PROCEDURE [dbo].[GetAllTopCategories] @prewin7 bit AS /*SELECT * INTO #tmp FROM dbo.fnGetCategories(@prewin7)*/ SELECT c.RootCategoryId CategoryId, c.CategoryName + ' [' + CAST(g.DiagnosticCount AS nvarchar(max)) + ']' CategoryName, @prewin7 as PreWin7 FROM ( SELECT c.RootCategoryId CategoryId, SUM(c.DiagnosticCount) DiagnosticCount FROM (select * FROM dbo.fnGetCategories(@prewin7)) c GROUP BY c.RootCategoryId ) g INNER JOIN (select * FROM dbo.fnGetCategories(@prewin7)) c ON c.CategoryId = g.CategoryId ORDER BY c.CategoryName
