[site]: crossvalidated
[post_id]: 632558
[parent_id]: 
[tags]: 
Coefficient covariance matrix of inverse probability weighted regression

I am interested in computing an estimate $\hat\Sigma_\hat\beta$ of the asymptotic covariance matrix of the parameter estimates $\hat\beta$ in a regression of $Y$ on $\{X, Z\}$ , weighted by weighs $\hat\omega$ and estimated using weighed (quasi-)maximum likelihood. The weights themselves are computed as $\hat\omega=f_\omega(\hat p, Z)$ , where $\hat p$ are predictions from a regression of binary $Z$ on $X$ and $f_\omega$ is a function of the predictions $\hat p$ and $Z$ . This latter regression has estimated coefficients $\hat\alpha$ with estimated covariance matrix $\hat\Sigma_\hat\alpha$ . The challenge is in accounting for the estimation of $\hat\alpha$ in computing the uncertainty for $\hat\beta$ To be specific, let's say I fit a logistic regression model of $Z$ on $X$ , which yields coefficients $\hat\alpha$ and covariance matrix $\hat\Sigma_\hat\alpha$ . I generate predictions $\hat p$ as $\hat p_i= g^{-1}(X_i\hat\alpha)$ where $g^{-1}$ is the inverse logit function. I compute weights as $\hat\omega_i=\frac{Z_i}{\hat p_i} + \frac{1-Z_i}{1-\hat p_i}$ . I then fit a weighted logistic regression of $Y$ on $\{X,Z\}$ to estimate coefficients $\hat\beta$ . (This method is known as inverse probability weighted regression adjustment [IPWRA] and is described in the Stata documentation.) My interest is in a valid estimate of the covariance matrix of $\hat\beta$ , $\hat\Sigma_\hat\beta$ . Note that I am not interested in the treatment effect estimate (e.g., just the coefficient on $Z$ ; I want the full model covriance matrix.) One approach is to use a robust (sandwich) standard error, treating $\hat\omega$ as fixed and known (i.e., not estimated). Although this can yield a conservative covariance estimate, in some cases (depending on $f_\omega$ ) it can be anti-conservative. A second approach is to bootstrap the whole thing: in each bootstrap sample, fit the first model, generate predictions and weights, and fit the second model. That works and is valid, but I am interested in an analytic expression. A third option is to use M-estimation (generalized estimating equations), in which the two models are stacked and estimated simultaneously. This is the usual approach for deriving the expressions for effect estimates when using propensity score weighting (e.g., in Stata ). My question is about whether it is possible to avoid stacking by simply adjusting the covariance matrix of the $Y$ model using the covariance matrix of the $Z$ model and, if so, how to do that. I think the delta method can be used in cases like these, but I'm not sure how to use it to carry forward uncertainty. I know linearization methods can be used, but again I don't know how to apply them to this situation. Guidance and code would be greatly appreciated.
