[site]: stackoverflow
[post_id]: 4425313
[parent_id]: 4425191
[tags]: 
The problem isn't in the fragment you show; it is somewhere in the code you don't show. So, you need to build your example from the ground up - showing the structure declarations, the memory management and copying you do for the structures.
