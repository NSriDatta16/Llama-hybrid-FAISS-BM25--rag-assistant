[site]: stackoverflow
[post_id]: 5449910
[parent_id]: 
[tags]: 
Needing help with analyzing HTTP form

To train myself in php and HTML forms I decided to make a little web application which gathers data from another website, but displays it for a mobile device. For this exercise I chose the site of the bus company in my region: http://delijn.be/en/index.htm . I analyzed the site and found the form named "form1", which sends data to the website: http://reisinfo.delijn.be/reisinfo/RouteplannerHomeBeperktServlet?taal=en via the POST method. I started writing the php code and found on the internet that you can send POST fields with cURL. So I did. Unfortunately it's not working. I get the error page of the site. So I guess some fields must be missing, but I've checked everything and I can't find another field. And in this way I end up here again, asking for help. The web application is hosted on my home server and can also be downloaded there. I would very much appreciate it if someone could help me with this problem, ief2 PS: Some parts of the code are written Dutch, so here are some translations: Gemeente = Town/City Plaats = Location Nummer = Number Datum = Date Dag = Day Maand = Month Jaar = Year Uur = Hour Aankomst = Arrival Vertrek = Departure Berekenen = Calculate PPS: The download link apparently does not work, however I have no problems downloading it, so here are some code fragments: index.php De Lijn Mobile Vertrek: Gemeente: Straat: Nummer: Aankomst: Gemeente: Straat: Nummer: Datum: Aankomst Vertrek Dag: day; ?>"> Maand: month; ?>"> Jaar: year; ?>"> Tijdstip: hour; ?>"> : minutes; ?>"> calculateRoute.php De Lijn Mobile - Berekeningen "; $gemeente = $_POST["vertrekGemeente"]; $straat = $_POST["vertrekStraat"]; $nummer = $_POST["vertrekNummer"]; $vertrekPlaats = new Plaats($gemeente, $straat, $nummer); $gemeente = $_POST["aankomstGemeente"]; $straat = $_POST["aankomstStraat"]; $nummer = $_POST["aankomstNummer"]; $aankomstPlaats = new Plaats($gemeente, $straat, $nummer); $datumType = $_POST["datumType"]; $dag = $_POST["datumDag"]; $maand = $_POST["datumMaand"]; $jaar = $_POST["datumJaar"]; $uur = $_POST["datumUur"]; $min = $_POST["datumMinuten"]; $datum = Date::withDate($jaar, $maand, $dag, $uur, $min); $datum->month = $maand; echo "Searching... "; searchDeLijn($vertrekPlaats, $aankomstPlaats, $datumType, $datum); ?> DeLijn.php minutes; $myMins -= ($myMins % 5); $postFields = array( "form1:vertrekGemeenteInput" => $dep->gemeente, "form1:vertrekStraatInput" => $dep->straat, "form1:vertrekNrInput" => $dep->nummer, "form1:aankomstGemeenteInput" => $ar->gemeente, "form1:aankomstStraatInput" => $ar->straat, "form1:aankomstNrInput" => $ar->nummer, "form1:vertrekkenOfAankomenRadio" => $vertrekkenOfAankomen, "form1:dagCombo" => (string)(int)$date->day, "form1:maandCombo" => (string)(int)$date->month, "form1:jaarCombo" => $date->year, "form1:uurCombo" => (string)(int)$date->hour, "form1:minutenCombo" => (string)$myMins); print_r($postFields); // do the curl $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, 'http://reisinfo.delijn.be/reisinfo/RouteplannerHomeBeperktServlet?taal=nl'); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $contents = curl_exec($ch); curl_close($ch); if($contents == false) { return null; } echo $contents; $myRouteObjects = extractRoutesFromXMLData($contents); return $myRouteObjects; } // ==== Returns array of Route objects or null function extractRoutesFromXMLData($dataString) { $tableBody = getResultsTableBody($dataString); if($tableBody != null) { return null; } $tableRows = getTableRowsOfTableBody($tableBody); if($tableRows != null) { return null; } // put them in an array $myArray = array(); $count = $tableRows->length; for($i = 0; $i item(0); $myArray[] = $aNode; } return $myArray; } // ==== Returns XMLDocument or null function getResultsTableBody($dataString) { // Get table element $status = preg_match('/ .*? /is', $docString, $matches); if($status == 0) { return null; } $tableElement = $matches[0]; // Extract body $status = preg_match('/ .*? /is', $tableElement, $matches); if($status == 0) { return null; } $doc = new DOMDocument(); $doc->loadXML($matches[0]); return $doc; } // ==== Retunrs XMLNodeList or null function getTableRowsOfTableBody($xmlDoc) { $xpath = new DOMXPath($domDoc); $xpathres = $xpath->evaluate("//tbody[0]/tr"); if($xpathres == false) { return null; } return $xpathres; } ?> Date.php , Plaats.php and Route.php all contain classes to encapsulate a date, a location and a possible route, respectively.
