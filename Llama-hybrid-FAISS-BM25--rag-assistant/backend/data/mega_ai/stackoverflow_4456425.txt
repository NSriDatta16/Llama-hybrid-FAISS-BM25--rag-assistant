[site]: stackoverflow
[post_id]: 4456425
[parent_id]: 3915709
[tags]: 
Something like this was discussed on the TeX SE a while back and one answer used a package catchfilebetweentags . This doesn't solve your problem directly, but perhaps you can use that to feed the fragment you want to \lstlistings , perhaps again with a temporary file.
