[site]: stackoverflow
[post_id]: 539653
[parent_id]: 539431
[tags]: 
The biggest hurdle with a pure T-SQL solution is the string concatenation. This little T-SQL solution that I whipped up should do the trick and run fast. It would probably be good to encapsulate this into a UDF though. CREATE TABLE #Order ( orderId INT PRIMARY KEY,[xmlData] NVARCHAR(512) ) GO CREATE TABLE #OrderLines ( orderId INT, orderLine INT,[xmlData] NVARCHAR(512),CONSTRAINT [pk_OrderLines] PRIMARY KEY CLUSTERED (orderId, orderLine) ) GO INSERT INTO #Order SELECT 1, ' ' INSERT INTO #OrderLines SELECT 1, 1, ' ' UNION ALL SELECT 1, 2, ' ' -- -- Pivot Order lines into one string value -- DECLARE @OrderLines NVARCHAR(MAX) SET @OrderLines = '' SELECT @OrderLines = COALESCE(@OrderLines, ' ','') + [xmlData] from #OrderLines WHERE orderId = 1 -- -- Join document fragments together into variable. -- DECLARE @XMLDOC NVARCHAR(MAX) SET @XMLDOC = '' SELECT @XMLDOC = COALESCE(@XMLDOC, ' ','') + a.C1 FROM ( SELECT ' ' AS C1 UNION ALL SELECT [xmlData] FROM #Order WHERE orderId = 1 UNION ALL SELECT ' ' UNION ALL SELECT @OrderLines UNION ALL SELECT ' ' UNION ALL SELECT ' ' UNION ALL SELECT ' ' ) a SELECT @XMLDOC -- OUTPUT RESULT
