[site]: stackoverflow
[post_id]: 5338681
[parent_id]: 
[tags]: 
obtaing the GUID for an EntityReference using Plugins in DynamicsCRM

This question is in relation to a Plugin which I am now creating for Dynamics CRM 2011. I have an entity which has 5 attributes. 1 of these attributes is a Lookup to another entity. What I am trying to do with my Plugin is to retreive the Guid of the Lookup entity. Simple, right? But no, It is giving me trouble, I have tried dozens of ways using EntityReference to obtain the guid but cannot. I have tried creating a preImage which failed too. Here is a snippet of the CODE. Entity entity = (Entity)context.InputParameters["Target"]; if (entity.LogicalName == "new_producttaxrate") { if (entity.Attributes.Contains("new_product")) { EntityReference ownerLookup = (EntityReference)entity.Attributes["new_product"]; productName = ownerLookup.Name; Guid productId = ownerLookup.Id; } } also came up with this if (entity.Attributes.Contains("new_producttaxrateid")) { Guid myGuid = (Guid)entity.Attributes["new_producttaxrateid"]; EntityReference ownerLookup = new EntityReference("new_product", myGuid); pid = ownerLookup.Id; } I keep getting this error Unhandled Exception: System.ServiceModel.FaultException`1[[Microsoft.Xrm.Sdk.OrganizationServiceFault, Microsoft.Xrm.Sdk, Version=5.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]]: Condition for attribute 'new_producttaxrate.new_product': expected argument(s) of type 'System.Guid' but received 'System.DBNull'.Detail: -2147220989 CallStack at Microsoft.Crm.Extensibility.VersionedPluginProxyStepBase.Execute(PipelineExecutionContext context) at Microsoft.Crm.Extensibility.Pipeline.Execute(PipelineExecutionContext context) at Microsoft.Crm.Extensibility.MessageProcessor.Execute(PipelineExecutionContext context) at Microsoft.Crm.Extensibility.InternalMessageDispatcher.Execute(PipelineExecutionContext context) at Microsoft.Crm.Extensibility.ExternalMessageDispatcher.ExecuteInternal(IInProcessOrganizationServiceFactory serviceFactory, IPlatformMessageDispatcherFactory dispatcherFactory, String messageName, String requestName, Int32 primaryObjectTypeCode, Int32 secondaryObjectTypeCode, ParameterCollection fields, CorrelationToken correlationToken, CallerOriginToken originToken, UserAuth userAuth, Guid callerId, Guid transactionContextId, Int32 invocationSource, Nullable`1 requestId, Version endpointVersion) at Microsoft.Crm.Extensibility.OrganizationSdkServiceInternal.ExecuteRequest(OrganizationRequest request, CorrelationToken correlationToken, CallerOriginToken callerOriginToken, WebServiceType serviceType) at Microsoft.Crm.Extensibility.OrganizationSdkServiceInternal.Execute(OrganizationRequest request, CorrelationToken correlationToken, CallerOriginToken callerOriginToken, WebServiceType serviceType) Condition for attribute 'new_producttaxrate.new_product': expected argument(s) of type 'System.Guid' but received 'System.DBNull'. 2011-03-17T13:21:04.6999035Z [VATPlugin2: VATPlugin2.TaxRateValidation] [4b0b7f5c-9950-e011-849d-000c292be099: VATPlugin2.TaxRateValidation: Create of new_producttaxrate]
