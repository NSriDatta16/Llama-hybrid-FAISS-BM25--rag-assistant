[site]: stackoverflow
[post_id]: 1847641
[parent_id]: 
[tags]: 
Trying to use accepts_nested_attributes_for and has_and_belongs_to_many but the join table is not being populated

I am learning RoR and trying to use accepts_nested_attributes_for and has_and_belongs_to_many to submit information that would traditionally be two forms. I have read on some sites they are compatible, some sites they aren't compatible, and some sites don't know. As reference, I am using Rails 2.3.4. I tried modeling my solution from the Ryan's Scraps tutorial on nested models From what I have tried to debug, it seems that I have two problems but I am not sure why. When I submit a form with nested models, only part of the nested model information is posted. I only get the first field, not the "n" others the user may have selected Of the single field that gets posted, there aren't any rows inserted into the join table that I created for the HABTM relationship. Here is a piece of code and the corresponding logs for my insertion attempt: Attorney Model: class Attorney proc { |a| a['name'].blank? } end Association Model: class Association "Please enter an association name." end Attorneys Controller: def new @attorney = Attorney.new @attorney.associations.build respond_to do |format| format.html # new.html.erb format.xml { render :xml => @attorney } end end def create @attorney = Attorney.new(params[:attorney]) respond_to do |format| if @attorney.save flash[:notice] = 'Attorney was successfully created.' format.html { redirect_to(@attorney) } format.xml { render :xml => @attorney, :status => :created, :location => @attorney } else format.html { render :action => "new" } format.xml { render :xml => @attorney.errors, :status => :unprocessable_entity } end end end Attorney's New View: {:multipart => true}) do |f| %> 70, :rows => 20 %> 'shared/membership' %> Membership Partial: true) %> Attorney Helper Link: def add_association_link(name) link_to_function name do |page| page.insert_html :bottom, :associations, :partial => 'shared/membership', :object => AssociationsAttorneys.new end end Join Table Migration: class CreateAssociationsAttorneys false t.references :association, :null => false t.timestamps end end def self.down drop_table :associations_attorneys end end Log capture: Processing AttorneysController#new (for 127.0.0.1 at 2009-12-04 08:16:19) [GET] Rendering template within layouts/default Rendering attorneys/new [4;35;1mMemberType Load (0.4ms)[0m [0mSELECT * FROM "member_types" [0m [4;36;1mOfficeLocation Load (18.6ms)[0m [0;1mSELECT * FROM "office_locations" [0m [4;35;1mAssociation Load (0.6ms)[0m [0mSELECT * FROM "associations" [0m Rendered shared/_membership (3.5ms) [4;36;1mCACHE (0.0ms)[0m [0;1mSELECT * FROM "associations" [0m Rendered shared/_membership (1.5ms) Rendered shared/_nav (0.6ms) Rendered shared/_footer (0.1ms) Completed in 149ms (View: 114, DB: 20) | 200 OK [http://localhost/attorneys/new] Processing ApplicationController#index (for 127.0.0.1 at 2009-12-04 08:16:19) [GET] Processing AttorneysController#create (for 127.0.0.1 at 2009-12-04 08:16:57) [POST] Parameters: {"commit"=>"Create", "authenticity_token"=>"Jh7aMCcOY7jUu/D1YtiCswg2n6iwqnS98VnVn46psp0=", "associations"=>{"association_id"=>"3"}, "attorney"=>{"birthstate"=>"Alabama", "office_location_id"=>"1", "birthdate"=>"December 3, 2009", "birthcity"=>"Test", "middlename"=>"Test", "lastname"=>"Testing", "image_temp"=>"", "member_type_id"=>"2", "firstname"=>"Test", "bio"=>"testing testing testing", "suffix"=>"", "email"=>"testing@test.com"}} [4;35;1mAttorney Load (15.6ms)[0m [0mSELECT "attorneys".id FROM "attorneys" WHERE ("attorneys"."email" = 'testing@test.com') LIMIT 1[0m [4;36;1mAttorney Create (0.8ms)[0m [0;1mINSERT INTO "attorneys" ("birthstate", "created_at", "birthdate", "office_location_id", "birthcity", "updated_at", "middlename", "lastname", "firstname", "member_type_id", "suffix", "bio", "image", "email") VALUES('Alabama', '2009-12-04 15:16:57', 'December 3, 2009', 1, 'Test', '2009-12-04 15:16:57', 'Test', 'Testing', 'Test', 2, '', 'testing testing testing', NULL, 'testing@test.com')[0m Redirected to http://localhost:3000/attorneys/11 Completed in 150ms (DB: 16) | 302 Found [http://localhost/attorneys] I can see that associations"=>{"association_id"=>"3"} it is only getting the last of the multiple associations that I had for the particular person and it isn't creating any entries into the join table. Where might my code have gone wrong?
