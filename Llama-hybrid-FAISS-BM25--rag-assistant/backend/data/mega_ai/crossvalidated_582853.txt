[site]: crossvalidated
[post_id]: 582853
[parent_id]: 
[tags]: 
Comparing proportions from overlapping samples with a complex survey design

I am trying to test whether there has been a statistically significant increase in the prevalence of a condition between two years of a complex survey using R. The samples are partly overlapping meaning that there is a longitudinal sample of participants (paired subsample) as well as people only participating in year 1 or only participating in year 2 (unpaired subsamples). Cross-sectional sampling weights are provided for each year. Longitudinal sampling weights may be available. I have identified three potential approaches, outlined below, but I'm unsure about their statistical validity. Sample dataset Made up data used in the examples below. data Approach 1 – Using bootstrap resampling Bootstrap resampling can be carried out using the “withreplicates” function in the “survey” package. Here is my attempt using the sample dataset above. library("survey") yr1data $id, val = data$ val_yr1, wt = data$wt_yr1)) yr1des $id, val = data$ val_yr2, wt = data$wt_yr2)) yr2des The absolute difference in percentages can be obtained from: resultyr1 $mean - resultyr2$ mean I generated a 95% confidence interval around the estimate using the bootstrap replicates as follows: quantile(resultyr1[["replicates"]] - resultyr2[["replicates"]], 0.025) quantile(resultyr1[["replicates"]] - resultyr2[["replicates"]], 0.975) For the p-value my guess would be to use a z-test as follows: z_score $mean - resultyr2$ mean) / sqrt(var(resultyr1[["replicates"]]) + var(resultyr2[["replicates"]])) pnorm(z_score) Does this approach seem correct/appropriate given percentages and partly overlapping samples are involved? Approach 2 – Using Prof. Bland’s method Prof. Bland suggested carrying out separate tests for the paired and unpaired subsamples and then taking a weighted combination of the two based on their variance ( https://www-users.york.ac.uk/~mb55/overlap.pdf ). This approach looks promising but I am not sure if it can be combined with complex survey methods since the sample needs to be divided into both paired (longitudinal) and unpaired samples. What survey weights should be used for the paired sample? Thoughts: Longitudinal weights may be available. If no longitudinal weights are provided would it be appropriate to use an average of the two cross-sectional weights i.e. (wt_yr1 + wt_yr2)/2? What survey weights should be used for the unpaired samples? Thoughts: Are the two sets of cross-sectional weights (i.e. wt_yr1 & wt_yr2) still appropriate when the longitudinal subsample of participants has been removed? How best would the variance be calculated in the paired and unpaired subsamples before combining them? Thoughts: For calculating the variance of the paired and unpaired subsamples it could be generated using Prof. Bland’s equations and relative survey-weighted counts (i.e. survey-weighted proportion * samples size). Alternatively, maybe the variance could be generated using bootstrap resampling as in Approach 1 above. Approach 3 – using method proposed by Derrick et al. (“Partiallyoverlapping” package) The package “Partiallyoverlapping” created by Derrick et al. can be used to compare means and proportions between two partly overlapping samples. Is there any way of combining this approach with the sampling weights? Thoughts: There are two methods for data entry available in this package. # Method 1 for a single stacked dataset. library("Partiallyoverlapping") Prop.test(data $val_yr1, data$ val_yr2, stacked=TRUE, conf.level=.95) # Method 2 for separate datasets. library("Partiallyoverlapping") paired $subsample=="Both"), ] yr1only subsample=="yr1only"), ] yr2only $subsample=="yr2only"), ] Prop.test(yr1only$ val_yr1, yr2only $val_yr2, paired$ val_yr1, paired$val_yr2, stacked = FALSE, conf.level=.95)
