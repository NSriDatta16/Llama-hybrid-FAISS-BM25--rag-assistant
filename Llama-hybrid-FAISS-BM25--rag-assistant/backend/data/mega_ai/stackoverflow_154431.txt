[site]: stackoverflow
[post_id]: 154431
[parent_id]: 25499
[tags]: 
I used this recently: #include #import "msado15.dll" no_namespace rename("EOF", "EndOfFile") #include void CMyDlg::OnBnClickedButton1() { if ( FAILED(::CoInitialize(NULL)) ) return; _RecordsetPtr pRs = NULL; //use your connection string here _bstr_t strCnn(_T("Provider=SQLNCLI;Server=.\\SQLExpress;AttachDBFilename=C:\\Program Files\\Microsoft SQL Server\\MSSQL.1\\MSSQL\\Data\\db\\db.mdf;Database=mydb;Trusted_Connection=Yes;MARS Connection=true")); _bstr_t a_Select(_T("select * from Table")); try { pRs.CreateInstance(__uuidof(Recordset)); pRs->Open(a_Select.AllocSysString(), strCnn.AllocSysString(), adOpenStatic, adLockReadOnly, adCmdText); //obtain entire restult as comma separated text: CString text((LPCWSTR)pRs->GetString(adClipString, -1, _T(","), _T(""), _T("NULL"))); //iterate thru recordset: long count = pRs->GetRecordCount(); COleVariant var; CString strColumn1; CString column1(_T("column1_name")); for(int i = 1; i GetFields()->GetItem(column1.AllocSysString())->GetValue(); strColumn1 = (LPCTSTR)_bstr_t(var); } } catch(_com_error& e) { CString err((LPCTSTR)(e.Description())); MessageBox(err, _T("error"), MB_OK); _asm nop; // } // Clean up objects before exit. if (pRs) if (pRs->State == adStateOpen) pRs->Close(); ::CoUninitialize(); }
