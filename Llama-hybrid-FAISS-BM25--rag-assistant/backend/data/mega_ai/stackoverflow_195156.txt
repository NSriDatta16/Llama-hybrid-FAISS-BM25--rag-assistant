[site]: stackoverflow
[post_id]: 195156
[parent_id]: 195149
[tags]: 
Where is this user JavaScript code coming from? There is not much you can do about a user embedding code into your page and then calling it from their browser (see Greasemonkey ). It's just something browsers do. However, if you store the script in a database, then retrieve it and eval() it, then you can clean up the script before it is run. Examples of code that removes all window. and document. references: eval( unsafeUserScript .replace(/\/\/.+\n|\/\*.*\*\/, '') // Clear all comments .replace(/\s(window|document)\s*[\;\)\.]/, '') // Removes window. Or window; or window) ) This tries to prevent the following from being executed (not tested): window.location = 'http://example.com'; var w = window; There are a lot of limitations you would have to apply to the unsafe user script. Unfortunately, there isn't any 'sandbox container' available for JavaScript.
