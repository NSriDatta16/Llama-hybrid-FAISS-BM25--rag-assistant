[site]: stackoverflow
[post_id]: 3208345
[parent_id]: 88399
[tags]: 
I liked FraGGod's version, except for two things: (1) It doesn't check whether the buffer is already read-only with (interactive "*") , and (2) it fails on the last line of the buffer if that last line is empty (as you cannot kill the line in that case), leaving your buffer read-only. I made the following changes to resolve that: (defun duplicate-line () "Clone line at cursor, leaving the latter intact." (interactive "*") (save-excursion ;; The last line of the buffer cannot be killed ;; if it is empty. Instead, simply add a new line. (if (and (eobp) (bolp)) (newline) ;; Otherwise kill the whole line, and yank it back. (let ((kill-read-only-ok t) deactivate-mark) (toggle-read-only 1) (kill-whole-line) (toggle-read-only 0) (yank)))))
