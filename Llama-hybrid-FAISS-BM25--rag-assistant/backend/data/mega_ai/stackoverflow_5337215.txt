[site]: stackoverflow
[post_id]: 5337215
[parent_id]: 
[tags]: 
How to optimize this "Time apart" SQL query?

I would like to have an easy way to run queries like the following query on my time series data: "What are the most typical events to take place within seven days of eachother"? I could do this by utilizing SQL and a Java program, by looking at each row and run a query, which looks up all events seven days earlier or later, but this is not very elegant and performance will be horrible. I also got help from JNK and Milen A. Radev to write the following SQL. My problem is that when I tested this on 23 million rows, it ran for two hours and stopped because my RamDisk (where I run the PostgreSQL database) was full. Do you have any idea how I could optimize such a query? SELECT a.eventID, b.eventID, COUNT(*) FROM table a INNER JOIN table b ON a.eventID <> b.eventID WHERE aBS(EXTRACT(EPOCH FROM (a.thetimeanddate - b.thetimeanddate)))
