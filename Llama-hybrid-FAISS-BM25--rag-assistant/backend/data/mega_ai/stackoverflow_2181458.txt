[site]: stackoverflow
[post_id]: 2181458
[parent_id]: 
[tags]: 
What am I doing wrong here, having issues with XSLT using C#

Please take a look at the following code, as I get the error at this line: xslt.Transform(mydoc.CreateReader(), writer); Error: Step into: Stepping over non-user code 'System.Xml.Linq.XNode.CreateReader' A first chance exception of type 'System.NullReferenceException' occurred in System.Data.SqlXml.dll ((System.NullReferenceException)(ex)) PromotionsDataContext db = new PromotionsDataContext(); //XmlDocument myxml; XElement Categories = new XElement("Promotions", from b in db.GetPromotions() select new XElement("Promotion", new XElement("Category", b.CategoryName), new XElement("Client", b.ClientName), new XElement("Title", b.Title))); XDocument mydoc = new XDocument(); mydoc.Add(Categories); try { XDocument newTree = new XDocument(); XmlWriterSettings settings = new XmlWriterSettings(); settings.OmitXmlDeclaration = true; settings.ConformanceLevel = ConformanceLevel.Fragment; settings.CloseOutput = false; //using (XmlWriter writer = newTree.CreateWriter()) using (XmlWriter writer = XmlWriter.Create(newTree.CreateWriter(), settings)) { // Load the style sheet. XslCompiledTransform xslt = new XslCompiledTransform(); xslt.Load(XmlReader.Create(new FileStream(@"C:\1\TransList.xslt", System.IO.FileMode.Open))); // Execute the transform and output the results to a writer. xslt.Transform(mydoc.CreateReader(), writer); } Console.WriteLine(newTree); } catch (Exception ex) { Console.Write(ex); } Here is the XSLT: The error: System.NullReferenceException: Object reference not set to an instance of an object. at System.Xml.Xsl.Runtime.XmlMergeSequenceWriter.StartTree(XPathNodeType rootType, IXmlNamespaceResolver nsResolver, XmlNameTable nameTable) at System.Xml.Xsl.Runtime.XmlQueryOutput.StartTree(XPathNodeType rootType) at System.Xml.Xsl.Runtime.XmlQueryOutput.WriteStartRoot() at Root(XmlQueryRuntime {urn:schemas-microsoft-com:xslt-debug}runtime) at Execute(XmlQueryRuntime {urn:schemas-microsoft-com:xslt-debug}runtime) at System.Xml.Xsl.XmlILCommand.Execute(Object defaultDocument, XmlResolver dataSources, XsltArgumentList argumentList, XmlWriter writer, Boolean closeWriter) at System.Xml.Xsl.XmlILCommand.Execute(XmlReader contextDocument, XmlResolver dataSources, XsltArgumentList argumentList, XmlWriter results) at System.Xml.Xsl.XslCompiledTransform.Transform(XmlReader input, XsltArgumentList arguments, XmlWriter results) at Promo.Page_Load(Object sender, EventArgs e) in c:\1\promo.ascx.cs:line 144 Now if I do this it works: StringWriter sw = new StringWriter(); xslt.Transform(mydoc.CreateReader(),null, sw); What am I doing wrong with the XmlWriter? Value of xdoc right before crash: Arts &amp; Entertainment Client1 Get your Free 2 Arts &amp; Entertainment Client1 Get your Free 4 Arts &amp; Entertainment client1 Get your Free 5 Community &amp; Neighborhood Client2 Get your Free 1 Education Client3 Get Your Free 3
