[site]: crossvalidated
[post_id]: 624731
[parent_id]: 624666
[tags]: 
Shapley values are pretty flexible given the way they are computed. The most straightforward way is to use the 'brute force'/traditional Shapley value regression approach. That is, I am not aware of SHAP-like variants (i.e., that make approximations to Shapley values) that allow for grouping features in the literature outside of summing the individual values by group (which will not produce the same result as grouping them in estimation unless the features are completely uncorrelated). In traditional Shapley value regression, you can group the features together where they are included or excluded from the coalition together. An example, implemented in R, is shown below using the modeldata::ames data. domir::domir( Sale_Price ~ Half_Bath + Full_Bath + First_Flr_SF + Second_Flr_SF + Garage_Type + Garage_Finish, \(fml) { set.seed(8232023) randomForest::randomForest(fml, data = modeldata::ames) |> predict() |> yardstick::rsq_trad_vec(modeldata::ames$Sale_Price, estimate = _) }, .set = list(Bath = ~ Half_Bath + Full_Bath, SQFT = ~ First_Flr_SF + Second_Flr_SF, Garage = ~ Garage_Type + Garage_Finish), .cdl = FALSE, .cpt = FALSE) ) Here variables related to number of bathrooms, house square footage, and details about the garage are grouped such that they are included or excluded jointly in the computations much like the situation you describe seeking to evaluate. The result of this function is: Overall Value: 0.7671851 General Dominance Values: General Dominance Standardized Ranks Bath 0.1626241 0.2119750 3 SQFT 0.4169509 0.5434815 1 Garage 0.1876101 0.2445435 2 The {domir} package is a 'Dominance Analysis' function but the 'General Dominance Values' it produces are Shapley values and can be used as such. As can be seen, the groups of factors produce an exact decomposition of the $R^2$ for the overall model as was sought in the original post.
