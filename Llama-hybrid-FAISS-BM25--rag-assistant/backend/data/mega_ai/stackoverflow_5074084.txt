[site]: stackoverflow
[post_id]: 5074084
[parent_id]: 
[tags]: 
Getting a file via CURL Posting Data

I have a web service which you post data to and it returns you a txt.gz file. I'm trying to use cURL to post up the information, however I'm not sure how to be ready and handle the file which comes back at me to download. I'm getting a successful response; but the file is 0 KB, and obviously isn't downloading. Any help would be greatly appreciated! Here is currently what I'm doing: $url = 'http://www.mywonderfulurl.com'; $fields = array('id'=>'123'); $fields_string = 'id=123'; $useragent="Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1"; $ch = curl_init(); // set user agent curl_setopt($ch, CURLOPT_USERAGENT, $useragent); //set the url, number of POST vars, POST data curl_setopt($ch,CURLOPT_URL,$url); curl_setopt($ch,CURLOPT_POST,count($fields)); curl_setopt($ch,CURLOPT_POSTFIELDS,$fields_string); curl_setopt($ch, CURLOPT_TIMEOUT, 250); curl_setopt($ch, CURLOPT_FILE, 'download.txt.gz'); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); if (file_put_contents('download.txt.gz', curl_exec($ch)) === false) { // Handle unable to write to file error. echo('you failed'); exit; } echo curl_getinfo( $ch, CURLINFO_HTTP_CODE ); //close connection curl_close($ch);
