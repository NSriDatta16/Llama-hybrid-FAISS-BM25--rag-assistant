[site]: stackoverflow
[post_id]: 2166442
[parent_id]: 2166426
[tags]: 
JavaScript scoping isn't quite like standard scoping. It looks like you're actually losing your scope because of nested functions. Try giving this article a read: http://www.robertsosinski.com/2009/04/28/binding-scope-in-javascript/
