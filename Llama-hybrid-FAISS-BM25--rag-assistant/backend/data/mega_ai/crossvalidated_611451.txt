[site]: crossvalidated
[post_id]: 611451
[parent_id]: 
[tags]: 
How to model a combination of measurement error and missing data in R and Stan

The data Consider some simulated data: x There are four treatments ( t ) that vary in their linear response ( y ) to x ( b1 to b4 ) but do not vary in their intercept ( a ). Each response observation comes with measurement error ( sd ). This can be visualised for clarity, with point-ranges indicating measurement error: require(ggplot2) ggplot(df) + geom_pointrange(aes(x = x, y = y, ymin = y - sd, ymax = y + sd)) + facet_grid(~t) + geom_hline(aes(yintercept = 0)) + theme_minimal() Further consider an additional variable m which is causing missing data according to a predictable pattern: m Whenever y crosses a given threshold (in this case 0), data become unavailable. So we have a combination of measurement error and non-random missing data. The model My preferred method of statistical inference is Bayesian and I am using the ulam function of the rethinking package , which essentially acts as an R interface to Stan. The case of measurement error described above is fairly standard but the missing data case is peculiar and referred to as missing not at random . On page 515 of the second edition of his book Statistical rethinking , Richard McElreath describes this case: This type of missingness, in which the variable causes its own missing values, is the worst. Unless you know the mechanism that produces the missingness [...], there is little hope. And if you do you [sic] know the mechanism, even then it might be hopeless. Sometimes measurement is all we have. We have to do it better. This is pretty disheartening but I nonetheless tried implementing a combined measurement error and missing data model, assuming data are missing at random. ulam automatically imputes missing observations in the response variable, assuming that they are missing at random, so I simply wrote a measurement error model and left ulam to do the missing data imputation. l Missing observations in ym are imputed fine but the model doesn't know what to do with their accompanying missing observations in sdm . Here is the error message: Found 40 NA values in ym and attempting imputation. Found 40 NA values in sdm. Not sure what to do with these, and they might precent the model from running. Compiling Stan program... Error: Variable 'sdm' has NA values. A complete cases version of the same model runs fine: l Questions Is it possible to implement a combined Bayesian measurement error and missing data model in ulam or another R interface to Stan? In the specific case of non-random missing data, is it possible to specify that imputed values ought to be below or above a certain threshold? Is there a way to model a combination of measurement error and missing data in both the explanatory and response variables? I would appreciate a worked example with code, preferably R implemented in ulam but Stan is also welcome.
