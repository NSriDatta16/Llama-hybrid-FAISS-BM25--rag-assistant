[site]: stackoverflow
[post_id]: 3079525
[parent_id]: 
[tags]: 
RegOpenKeyEx return ERROR_SUCCESS but it shouldn't (windows 7)

I've got a problem about RegOpenKeyEx, the code: #include #include #include #pragma comment (lib, "Advapi32.lib") int main () { TCHAR *keyName = _T("SOFTWARE\\foobar2000\\capabilities"); HKEY key = NULL; if (RegOpenKeyEx(HKEY_LOCAL_MACHINE, keyName, 0, KEY_ALL_ACCESS, &key) != ERROR_SUCCESS) { printf("open key failed!\n"); return -1; } else { printf("open key success!\n"); } TCHAR *value = _T("123"); if (RegSetValueEx(key, _T("xxx"), 0, REG_SZ, (const BYTE *)value, sizeof(TCHAR) * (_tcslen(value) + 1)) != ERROR_SUCCESS) { printf("set value failed!\n"); } RegCloseKey(key); return 0; } Save the code in such as reg.cpp, and in command mode: cl reg.cpp and I got reg.exe, run it: D:\tmp>reg.exe open key success! But the value hasn't been written in the registry. Another strange thing is that if I use the visual studio to create a CLI project, and paste the code into main(), the RegOpenKeyEx() will return false. The platform is windows 7, and UAC is enabled.
