[site]: stackoverflow
[post_id]: 1310777
[parent_id]: 
[tags]: 
Set Fan Speed on Windows in C++

I have this copied code from Example: Calling a Provider Method , it modified it now should it change CPU fan speed: #define _WIN32_DCOM #include using namespace std; #include #include # pragma comment(lib, "wbemuuid.lib") int main(int iArgCnt, char ** argv) { if(IsDebuggerPresent())cout ConnectServer( _bstr_t(L"ROOT\\CIMV2"), NULL, NULL, 0, NULL, 0, 0, &pSvc ); if (FAILED(hres)) { cout Release(); CoUninitialize(); return 1; // Program has failed. } cout Release(); pLoc->Release(); CoUninitialize(); return 1; // Program has failed. } // Step 6: -------------------------------------------------- // Use the IWbemServices pointer to make requests of WMI ---- BSTR MethodName = SysAllocString(L"SetSpeed"); BSTR ClassName = SysAllocString(L"CIM_Fan"); IWbemClassObject* pClass = NULL; hres = pSvc->GetObject(ClassName, 0, NULL, &pClass, NULL); IWbemClassObject* pInParamsDefinition = NULL; hres = pClass->GetMethod(MethodName, 0, &pInParamsDefinition, NULL); IWbemClassObject* pClassInstance = NULL; hres = pInParamsDefinition->SpawnInstance(0, &pClassInstance); // Create the values for the in parameters VARIANT varCommand; varCommand.vt = VT_BSTR; varCommand.bstrVal = L"10"; // Store the value for the in parameters hres = pClassInstance->Put(L"CommandLine", 0, &varCommand, 0); wprintf(L"The command is: %s\n", V_BSTR(&varCommand)); // Execute Method IWbemClassObject* pOutParams = NULL; hres = pSvc->ExecMethod(ClassName, MethodName, 0, NULL, pClassInstance, &pOutParams, NULL); if (FAILED(hres)) { cout Release(); pInParamsDefinition->Release(); // pOutParams->Release(); pSvc->Release(); pLoc->Release(); CoUninitialize(); } catch(...){ cout Get(_bstr_t(L"ReturnValue"), 0, &varReturnValue, NULL, 0); // Clean up //-------------------------- VariantClear(&varCommand); VariantClear(&varReturnValue); SysFreeString(ClassName); SysFreeString(MethodName); pClass->Release(); pInParamsDefinition->Release(); pOutParams->Release(); pLoc->Release(); pSvc->Release(); CoUninitialize(); system("pause"); return 0; } When I run this, it not work. What I should change?
