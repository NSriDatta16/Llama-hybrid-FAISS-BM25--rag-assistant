[site]: crossvalidated
[post_id]: 377310
[parent_id]: 
[tags]: 
How to fit a robust step function to a time series?

I have a somewhat noisy time series that hovers around different levels. For example, the following data: I have the solid line data available, and I would like to obtain an estimate for the dashed line. It should be piecewise constant. What algorithms are appropriate to try out here? My ideas so far hover around 0-degree P-splines (but how to find out where to place the knots?) or structural break models. A regression tree is the best idea I currently have, but ideally I would be looking for a method that takes into account the fact that the two levels at y=250 are at equal y-values. If I understand correctly, a regression tree would split these two intervals into two different groups, each with a different mean. The R code that generated it is this: set.seed(20181118) true_fct = stepfun(c(100, 200, 250), c(200, 250, 300, 250)) x = 1:400 y = true_fct(x) + rt(length(x), df=1) plot(x, y, type="l") lines(x, true_fct(x), lty=2, lwd=3)
