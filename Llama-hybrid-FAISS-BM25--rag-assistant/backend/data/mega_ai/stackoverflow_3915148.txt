[site]: stackoverflow
[post_id]: 3915148
[parent_id]: 
[tags]: 
How to get data for an entity (for example customer) from eav_attribute table to be shown in Customer Grid for admin

I have extended Magento’s customer information form to store an additional attribute for customer. Lets call it ‘customer_referrer_id’. I have a role ‘referrer ‘ who has access to customer grid and order grid only. But, I want to restrict a referrer to see only those customers in the grid who have the customer_referrer_id set as the referrer’s id who has logged in. Similarly for orders, the logged in referrer shall be able to see only those orders made by customers who have customer_referrer_id = loggedin_referrer_id. I already know how to override a module and that I have to mainly override Adminhtml/Block/Customer/Grid::_prepareCollection and Adminhtml/Block/Sales/Order/Grid::_prepareCollection I am using Magento 1.4.1.1 This is my module declaration file in app/etc/modules/Myproject_Adminhtml true local And my modules config.xml in local/Myproject/Adminhtml/etc/ is as follows: 1.0.0 Myproject_Adminhtml_Block_Sales_Order_Grid Myproject_Adminhtml_Block_Customer_Grid And class Myproject_Adminhtml_Block_Customer_Grid extends Mage_Adminhtml_Block_Customer_Grid { protected function _prepareCollection() { $collection = Mage::getResourceModel('customer/customer_collection') ->addNameToSelect() ->addAttributeToSelect('email') ->addAttributeToSelect('created_at') ->addAttributeToSelect('group_id') ->joinAttribute('billing_postcode', 'customer_address/postcode', 'default_billing', null, 'left') ->joinAttribute('billing_city', 'customer_address/city', 'default_billing', null, 'left') ->joinAttribute('billing_telephone', 'customer_address/telephone', 'default_billing', null, 'left') ->joinAttribute('billing_region', 'customer_address/region', 'default_billing', null, 'left') ->joinAttribute('billing_country_id', 'customer_address/country_id', 'default_billing', null, 'left'); $this->setCollection($collection); $referrer_id = Mage::getSingleton('admin/session')->getUser()->getId(); Mage::log('Logged in admin has id: ' . $referrer_id); return parent::_prepareCollection(); } }
