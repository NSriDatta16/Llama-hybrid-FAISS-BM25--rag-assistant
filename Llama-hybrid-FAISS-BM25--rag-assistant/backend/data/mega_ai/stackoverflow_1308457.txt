[site]: stackoverflow
[post_id]: 1308457
[parent_id]: 1293071
[tags]: 
This does the trick, with one caveat: The caveat is that using for-each or apply-templates inside a variable returns a result tree fragment. Unless you're going to copy it to the output, there's next to nothing you can do with a result tree fragment; to use it in an XPath expression, you have to convert it to a node set. That conversion requires an extension function, which may or may not be available in Java (this example uses Microsoft's XSLT processor).
