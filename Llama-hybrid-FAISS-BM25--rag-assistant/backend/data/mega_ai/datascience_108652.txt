[site]: datascience
[post_id]: 108652
[parent_id]: 108646
[tags]: 
This is more of a programming question than a data science question and would therefore be better suited for stackoverflow, but the following is already quite close to what you're looking for: ( df .merge(df.reset_index(), how="left", left_on=["rcr", "msg"], right_on=["sdr", "msg"], suffixes=("", "_")) .groupby(["sdr", "rcr", "msg"])["index"] # concatenate indices, only use unique indices and sort them first .agg(lambda x: ", ".join([str(i) for i in sorted(set(x)) if i != 0])) .reset_index() ) sdr rcr msg index 0 A B msg_a 7.0, 10.0 1 A B msg_b 11.0 2 A B msg_c nan 3 A C msg_a 6.0 4 A C msg_b 8.0 5 A C msg_c 9.0 6 B A msg_a 3.0 7 B A msg_b 1.0, 4.0 8 C A msg_a 3.0 9 C A msg_b 1.0, 4.0 10 C A msg_c 2.0, 5.0
