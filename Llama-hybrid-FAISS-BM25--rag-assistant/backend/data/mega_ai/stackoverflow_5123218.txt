[site]: stackoverflow
[post_id]: 5123218
[parent_id]: 5119948
[tags]: 
// Returns IsUPXCompressed - Modified for Delphi 2010 function IsUPXCompressed( const Filename: TFileName ): Boolean; var i: integer; pBaseAddress: PByte; pDosHeader: PImageDosHeader; pNtHeaders: PImageNtHeaders; hFile: Cardinal; hFileMap: Cardinal; pSectionHeader: PImageSectionHeader; dwOffset: Cardinal; SectName: AnsiString; begin Result := False; hFile := CreateFile( PChar( Filename ), GENERIC_READ, FILE_SHARE_READ, nil, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0 ); if ( hFile = INVALID_HANDLE_VALUE ) then Exit; hFileMap := CreateFileMapping( hFile, nil, PAGE_READONLY or SEC_IMAGE, 0, 0, nil ); if ( hFileMap = 0 ) then begin CloseHandle( hFile ); Exit; end; pBaseAddress := MapViewOfFile( hFileMap, FILE_MAP_READ, 0, 0, 0 ); if ( pBaseAddress = nil ) then begin CloseHandle( hFileMap ); CloseHandle( hFile ); Exit; end; dwOffset := Cardinal( pBaseAddress ); pDosHeader := PImageDosHeader( pBaseAddress ); pNtHeaders := PImageNtHeaders( dwOffset + Cardinal( pDosHeader._lfanew ) ); pSectionHeader := pImageSectionHeader( Cardinal( pNtHeaders ) + SizeOf( TImageNtHeaders ) ); for i := 0 to pNtHeaders.FileHeader.NumberOfSections - 1 do begin SetString( SectName, PAnsiChar( @pSectionHeader.name ), SizeOf( pSectionHeader.name ) ); if Pos( 'UPX', SectName ) > 0 then begin Result := True; exit; end; Inc( pSectionHeader ); end; end; Thanks Rob for the pointers.
