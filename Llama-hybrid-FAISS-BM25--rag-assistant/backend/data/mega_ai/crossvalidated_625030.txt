[site]: crossvalidated
[post_id]: 625030
[parent_id]: 
[tags]: 
Calculate posterior distribution and full conditional of a HMM

Set up a Bayesian analysis of an hidden Markov model and calculate the posterior distribution and the full conditionals, given this assumptions: The state space of the hidden process has size m $Z_t|X_t,\{\mu_i\}_{i=1}^m \sim N(\mu_{X_t},\frac{1}{\tau})$ with $\tau$ equals for all the states of the hidden process $X_t|X_{t-1}, P \sim Discr(P_{X_{t-1},1},...,P_{X_{t-1},m})$ $X_0 \sim Discr(1/m,...,1/m)$ $\mu_i \sim N(0,100)$ for all $i\in \{1,...,m\}$ $\tau \sim \Gamma(0.1,0.1)$ $P_{i1},...,P_{im}\sim Dirichlet(1,...,1)$ I know that the posterior is given by $$\pi(\mu_1,...,\mu_m,\tau,P_{ij},X|Z)\propto\pi(Z|X,\mu_1,...,\mu_m,\tau)\pi(X|P)\pi(\mu_1,...,\mu_m)\pi(\tau)\pi(P_{ij})$$ Substituting we have (with $\overset{\rightarrow}{\theta} = (\mu_1,...,\mu_m,\tau,P_{ij})$ ) $$\pi(\overset{\rightarrow}{\theta},X|Z)\propto\prod_{t=1}^n e^{-\frac{\tau}{2}(Z_t-\mu_{X_t})^2} P_{X_{t-1}X_t} \prod_{i=1}^m e^{-\frac{1}{2}\frac{(\mu_i)^2}{100}}\prod_{i,j=1}^{m}P_{ij}^{1-1}\prod_{?}^{?}\tau^{-0.9}e^{-0.1\tau}$$ The problems i have are: i dont know what index to use on the product of the gamma kernel i dont know how to reorder all the terms in the posterior because of the different indexes of the products (i.e. putting together the two normal's kernels with different indexes on the product). EDIT 1: Given that $\tau$ doesn't need a product over indexes and that the first product can be splitted i get the following posterior: $$\pi(\overset{\rightarrow}{\theta},X|Z)\propto\tau^{-0.9}e^{-0.1\tau}\prod_{t=1}^n e^{-\frac{\tau}{2}(Z_t-\mu_{X_t})^2} P_{X_{t-1}X_t} \prod_{k=1}^m e^{-\frac{1}{2}\frac{(\mu_k)^2}{100}}\prod_{i,j=1}^{m}P_{ij}^{1-1}$$ $$\propto\tau^{-0.9}e^{-0.1\tau}\tau^{\frac{n}{2}}e^{-\frac{\tau}{2}\sum_{t=1}^{n}(Z_t-\mu_{X_t})^2}\prod_{k=1}^{m}e^{-\frac{1}{200}\mu_k^2}\prod_{i,j=1}^m P_{ij}^{n_{ij}}$$ $$\propto \prod_{k=1}^{m}\tau^{\frac{n}{2}-0.9}e^{-0.1\tau-\frac{1}{200}\mu_k^2-\frac{\tau}{2}\sum_{t:X_t=k}(Z_t-\mu_{k})^2}\prod_{i,j=1}^m P_{ij}^{n_{ij}}$$ with $n_{ij}=\sum_{t=1}^{n}\mathbb{1}(X_{t-1}=i)\mathbb{1}(X_t=j)$ Now, hoping everything is right, i can calculate the full condionals (where $\cdot$ |ee for semplicity represents the conditional distribution of a parameter given everything else ): $P_{i1},...,P_{im}|ee\sim Dirichlet(n_{i1}+1,...,n_{im}+1)$ $\tau|ee\sim\Gamma(\frac{n}{2}+0.1,0.1+\frac{1}{2}\sum_{t:X_t=k}(Z_t-\mu_k)^2)$ For the full conditionals of $\mu_i$ i reconstruct a normal distribution by completing the square on the exponent, so: $$\pi(\mu_i|ee)\propto\prod_{k=1}^{m}exp\{-\frac{1}{200}\mu_k^2-\frac{\tau}{2}\sum_{t:X_t=k}(Z_t-\mu_{k})^2\}$$ $$\propto\prod_{k=1}^{m}exp\{-\frac{1}{200}\mu_k^2-\frac{\tau}{2}\sum_{t:X_t=k}(Z_t^2+\mu_{k}^2-2Z_t\mu_{k})\}$$ $$\propto\prod_{k=1}^{m}exp\{-\frac{1}{200}\mu_k^2-\frac{\tau}{2}n_k\mu_k^2 +\tau n_{z_k}\mu_k\}$$ $$\propto \prod_{k=1}^{m}exp\{(-\frac{1}{200}-\frac{\tau}{2}n_k)(\mu_k^2-2\mu_k(\frac{\tau n_{Z_k}}{1/100+\tau n_k})+(\frac{\tau n_{Z_k}}{1/100+\tau n_k})^2)\}$$ $$\propto \prod_{k=1}^{m}exp\{-\frac{1}{2}\frac{(\mu_k-\frac{\tau n_{Z_k}}{1/100+\tau n_k})^2}{1/100+\tau n_k}\}$$ with $n_{i}=\sum_{t=1}^{n}\mathbb{1}(X_{t}=i)$ and $n_{Z_k}=\sum_{t=1}^{n}Z_{t}$ so i get: $\mu_i|ee\sim N(\frac{\tau n_{Z_k}}{1/100+\tau n_k},\frac{1}{1/100+\tau n_k})$ $X_0|ee\sim Discr(P_{1,x_1},...,P_{m,x_1})$ $X_t|ee\sim Discr(P_{X_{t-1},1}P_{1,x_{t+1}}\sqrt{\tau}e^{-\frac{\tau}{2}(Z_t-\mu_1)^2},...,P_{X_{t-1},m}P_{m,x_{t+1}}\sqrt{\tau}e^{-\frac{\tau}{2}(Z_t-\mu_m)^2})$ $X_n|ee\sim Discr(P_{X_{n-1},1}\sqrt{\tau}e^{-\frac{\tau}{2}(Z_t-\mu_1)^2},...,P_{X_{n-1},m}\sqrt{\tau}e^{-\frac{\tau}{2}(Z_t-\mu_m)^2})$ Now, the problems i have are: I'm not sure about the full conditional of $\tau$ (i have the index k inside the distribution and i think no index should appears in that distribution) I'm not sure that the full conditional of $\mu_i$ is correct
