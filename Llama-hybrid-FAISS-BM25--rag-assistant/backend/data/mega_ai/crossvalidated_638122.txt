[site]: crossvalidated
[post_id]: 638122
[parent_id]: 636862
[tags]: 
My interpretation of your question is how the calculation of the score function is related to diffusion models. A possible derivation therefore involves employing Tweedie's formula, defined as $\mathbb{E} \lbrack \mu_{x} \vert x \rbrack \: = \: x \: + \: \Sigma_{x} \cdot \nabla_{x} \log p(x_{t})$ For a Gaussian variable $x \sim \mathcal{N}(x; \mu_{x}, \Sigma_{x})$ , the equation relates the expected value of the conditional distribution of an exponential family to its mean plus a correction term comprising the score function. Also recall the formulation of the diffusion kernel for each individual step is given by $q(x_{t} \vert x_{t-1}) \: = \mathcal{N} \big( \: \sqrt{\smash[b]{\alpha_t}} \cdot x_{t-1} , \: (1 \: - \: \alpha_t) \cdot \mathcal{I} \: \big)$ Plugging into the equation the distributional parameters, and solving for $x_{0}$ $x_{0} \: = \: \frac {x_{t} \: + \: \big( 1 \: - \: \smash[b]{\bar{\alpha_{t}}} \big) \cdot \nabla_{x_{t}} \log p(x_{t} \big)} { \sqrt{\smash[b]{\bar{\alpha_{t}}}} }$ The main computational challenge is the KL-divergence term derived in a previous explanation $D_{KL} \big( \: q( x_{t-1} \vert x_{t}, x_{0}) \: \big\Vert \: p_{\theta}(x_{t-1} \vert x_{t} ) \: \big) \: = \frac {1} {2 \sigma_{q}^2 (t)} \Big\lbrack \: \big\Vert \: \mu_{\theta} \: - \: \mu_{q} \: \big\Vert_{2}^2 \: \Big\rbrack$ where we can show $\mu_{q}(x_{t}, x_{0}) \: = \: \frac { \sqrt{\smash[b]{\alpha_{t}}} (1 \: - \: \bar{\alpha_{t-1}}) \cdot x_{t} \: + \: \sqrt{\smash[b]{\bar{\alpha_{t-1}}}}(1 \: - \: \alpha_{t}) \cdot x_{0} } {1 \: - \: \bar{\alpha_{t}}}$ $\mu_{\theta}(x_{t}, t) \: = \: \frac { \sqrt{\smash[b]{\alpha_{t}}} (1 \: - \: \bar{\alpha_{t-1}}) \cdot x_{t} \: + \: \sqrt{\smash[b]{\bar{\alpha_{t-1}}}}(1 \: - \: \alpha_{t}) \cdot \hat{x}_{\theta}(x_{t}, t) } {1 \: - \: \bar{\alpha_{t}}}$ Incorporating the result into the definition of $\mu_{q}(x_{t}, x_{0})$ , and with a similar analysis for $u_{\theta}(x_{t}, t)$ , gives the information required to expand the equation $D_{KL} \big( \: q( x_{t-1} \vert x_{t}, x_{0}) \: \big\Vert \: p_{\theta}(x_{t-1} \vert x_{t} ) \: \big) \: = \: \frac {1} {2\sigma_{q_{t}}^2} \cdot \frac {(1-\alpha_{t})^2} {\alpha_{t}} \: \Big\lbrack \: \big\Vert \: s_{\theta}(x_{t}, t) \: - \: \nabla_{x_{t}} \: \log p(x_{t}) \: \big\Vert_{2}^2 \: \Big\rbrack$ The following excerpts are taken from my book on variational inference. Learn more on the topic by visiting https://www.thevariationalbook.com/
