[site]: stackoverflow
[post_id]: 1934274
[parent_id]: 
[tags]: 
Delete with confirmation and redirect on success

Here's the behavior I'm looking for: User selects a record from an index view, which redirects to that record's detail view. User clicks a link to delete the currently displayed record. A modal dialog asks for confirmation of the delete. User presses the Confirm button. The associated controller action method is executed, which is supposed to delete the record. User is returned to the index view, where the deleted record is no longer displayed. I am using ASP.NET MVC 1.0 as the primary framework, the dialog component from the jQuery UI, and LINQ-to-SQL to handle database interaction. Steps one through four execute just fine. Step five, however, retrieves the record, but doesn't delete it. Step six executes, but the record is still displayed in the list. Here is the code for the delete link: | Here is the code for the onclick handler: function deletePackage(packageID) { createDialogContent(); // The HTML for the dialog content is set in this method $.getJSON('/Spectrum/Package/DetailsJSON/' + packageID, function(json) { $('p.message').html('Delete ' + json.Description + ' ?'); }); $('div.confirm').attr('title', 'Delete Package'); $('div.confirm').dialog({ draggable: false, modal: true, overlay: { backgroundColor: '#000', opacity: 0.5 }, resizable: false, buttons: { 'Confirm': function() { $(this).dialog('destroy').remove(); $.post('/Spectrum/Package/Delete/' + packageID); // The next line used to be: $.get('/Spectrum/Package/Index'); window.location.href = '/Spectrum/Package/Index'; }, Cancel: function() { $(this).dialog('destroy').remove(); } } }); } Here is the code for the delete controller method: [AcceptVerbs(HttpVerbs.Post)] public ActionResult Delete(int id) { Package package = RepositoryManager.Package().GetPackage(id); PackageDeleteViewModel viewModel = new PackageDeleteViewModel { Package_ID = package.Package_ID }; RepositoryManager.Package().PackageDelete(viewModel); // see code below return new EmptyResult(); } Finally, here is the repository method for the delete: public void PackageDelete(PackageDeleteViewModel data) { Package package = RepositoryManager.Package().GetPackage(data.Package_ID); if (package.BrokerageOrderPackages.Count == 0 && package.ManagementOrderPackages.Count == 0 && package.Seeds.Count == 0) { db.Packages.DeleteOnSubmit(package); // This branch is being executed db.SubmitChanges(); } else { throw new RulesException("Package cannot be deleted.", "PackageDelete"); } } I don't think I'm pushing the envelope here or getting too fancy. One area of concern: In the Confirm button handler of the onclick method, the first version would delete the record successfully, but not redirect to the Index view. With the current version, the delete fails silently, but the redirection occurs. Firefox/Firebug reported 200's for the Index GET in both situations. The behavior is similar in both Firefox and IE.
