[site]: crossvalidated
[post_id]: 182766
[parent_id]: 142252
[tags]: 
The chance that balls $i$ and $k$, $i\ne k$, enter the same bin $j$ is $p_{ij}p_{kj}$ because these balls are thrown independently. Since they cannot collide in more than one distinct bin, and a collision must occur in some bin, the chance that these balls collide anywhere is the sum over bins of their chances of collision: $$\Pr(i\text{ and }k\text{ collide}) = \sum_{j=1}^m p_{ij}p_{kj}.$$ This chance also is the expected number of collisions of balls $i$ and $k$. Summing over all distinct balls gives the expected total number of collisions $N$ (because expectation is linear): $$\mathbb{E}(N) = \sum_{1\le i\lt k \le n} \sum_{j=1}^m p_{ij}p_{kj}.$$ This can be written in matrix form in terms of the matrix $\mathbb{P} = (p_{ij})$ and the constant $n$-vector $\mathbf{1} = (1,1,\ldots, 1)^\prime$ as $$\mathbb{E}(N) = \frac{1}{2}\left(\mathbf{1}^\prime \mathbb{P}\mathbb{P}^\prime\mathbf{1} - Tr(\mathbb{P}\mathbb{P}^\prime)\right).$$ Simulations support the correctness of this result. For instance, the following R code simulates $10,000$ throws of $n=5$ balls into $m=8$ bins using randomly generated probabilities $p_{ij}$. (Note the implementation of the formula for $\mathbb{E}(N)$: it takes just two simple lines at the end where q and then the answer f are calculated.) Its output is Mean SE Formula Z 1.3489 0.0113 1.3487 0.0200 This states that the formula for $\mathbb{E}(N)$ is $1.3487$, whereas the average number of collisions observed is $1.3489\pm 0.0113$, which is just $Z=0.02$ standard errors away from the formula (indicating very close agreement). Similarly close agreement is obtained when varying either $n$ or $m$. # # Generate a random transition matrix. # n
