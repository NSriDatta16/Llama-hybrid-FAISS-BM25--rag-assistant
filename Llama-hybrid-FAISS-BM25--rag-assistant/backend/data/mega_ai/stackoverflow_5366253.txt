[site]: stackoverflow
[post_id]: 5366253
[parent_id]: 
[tags]: 
Uploadify, Flash Sessions, and Rails 2.3.8

I'm using Uploadify 2.1.4, and rails 2.3.8. I'm trying to apply the FlashSessionCookieMiddleware fix that is supposed to maintain session information during the uploadify's flash-based request. I've applied this fix after reading some of these guides: Flash uploaders, Rails, cookie based sessions and CSRF: Rack Middleware to the rescue! Uploadify on Rails with Paperclip However, my session information is still not being carried over. Here's a look at my app configuration: # config/environment.rb config.load_paths += %W( #{RAILS_ROOT}/config/middleware ) ... # config/middleware/flash_session_cookie_middleware.rb require 'rack/utils' class FlashSessionCookieMiddleware def initialize(app, session_key = '_session_id') @app = app @session_key = session_key end def call(env) if env['HTTP_USER_AGENT'] =~ /^(Adobe|Shockwave) Flash/ params = ::Rack::Utils.parse_query(env['QUERY_STRING']) env['HTTP_COOKIE'] = [ @session_key, params[@session_key] ].join('=').freeze unless params[@session_key].nil? end @app.call(env) end end ActionController::Dispatcher.middleware.insert_before(ActionController::Base.session_store, FlashSessionCookieMiddleware, ActionController::Base.session_options[:key]) ... // My Uploadify JS 'fileDataName' : 'file', 'queueID' : 'fileQueue', 'auto' : true, 'multi' : true, 'method' : 'get', 'scriptData' : { session_key: ' '} My middleware code is loading properly, Here's what rake middleware displays: use Rack::Lock use ActionController::Failsafe use FlashSessionCookieMiddleware, "_my_app_session" use ActiveRecord::ConnectionAdapters::ConnectionManagement use ActiveRecord::QueryCache use ActiveRecord::SessionStore, # use ActionController::ParamsParser use Rack::MethodOverride use Rack::Head use ActionController::StringCoercion run ActionController::Dispatcher.new Then, I try to test out if the last request has valid session/cookie info: # In Controller logger.info "Session: #{session.inspect}" Which prints only an empty hash in log/development.log: Session: {} [Sniff] Can anyone see what I'm doing wrong?
