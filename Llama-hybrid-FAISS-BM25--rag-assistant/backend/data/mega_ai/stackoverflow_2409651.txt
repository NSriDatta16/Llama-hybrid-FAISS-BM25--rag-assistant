[site]: stackoverflow
[post_id]: 2409651
[parent_id]: 2409597
[tags]: 
This might work better using the subquery as a table: SELECT p.idproduct, p.name, p.tax, s.price, (s.price * (1 + p.tax/100)) as price_with_tax FROM product p INNER JOIN (SELECT idproduct, price FROM product_storage WHERE quantity > 0) s ON p.idproduct = s.idproduct INNER JOIN (SELECT idproduct, MIN(added) min FROM product_storage GROUP BY idproduct) f ON s.idproduct = f.idproduct AND s.added = f.min Edit: Updated because tax is in the other table, so I had to move that calculation's location. Edit 2: OK, changed things around again to try to filter the product_storage table properly.
