[site]: stackoverflow
[post_id]: 1562523
[parent_id]: 
[tags]: 
Creating a download link for .jpg file using PHP

This one should be easy, I think. I have a paginated image gallery, and under each image is a small link that says "Download Comp". This should allow people to quickly download the .jpg file (with a PHP generated watermark) to their computer. Now, I know I can just link straight to the .jpg file, but that requires the user to have the image open in a new window, right click, Save As..., etc. Instead, I want the "Download Comp" link to initiate the download of the file immediately. PHP.net seemed to suggest using readfile(), so each "Download Comp" link is being echoed as "?download=true&g={$gallery}&i={$image}". Then at the top of the page I catch to see if the $_GET['download'] var isset, and if so, I run the following code: if(isset($_GET['download'])) { $gallery = $_GET['g']; $image = $_GET['i']; $file = "../watermark.php?src={$gallery}/images/{$image}"; header('Content-Description: File Transfer'); header('Content-Type: application/jpeg'); header('Content-Disposition: attachment; filename='.basename($file)); header('Content-Transfer-Encoding: binary'); header('Expires: 0'); header('Cache-Control: public'); header('Pragma: public'); header('Content-Length: ' . filesize($file)); ob_clean(); flush(); readfile($file); } The link takes a lonnnnnnnnng time, and then it brings up a dialog prompt asking you to Open or Save the file, but once you Save and try to open it, it says the file is corrupt and can't be opened. Any ideas?
