[site]: stackoverflow
[post_id]: 5002209
[parent_id]: 
[tags]: 
Looping a Word macro over many list paragraphs causes memory issue

I'm hitting problem with a reasonably straightforward vba macro for Microsoft Word which is designed to get around some issues we're seeing with list indentation when we create PDFs versions from the Word doc. The macro basically loops through each list in the document, and for each list paragraph associated with the list, it is setting the list template's bullet and text position to match what's applied at the paragraph level (code needs to be used with Word 2000 so not using list styles). When dealing with large documents (60+ lists, ~350 list paragraphs), the macro runs through fine first time, but second time dies half way through with a "This method or property is not available because there is a memory or disk problem". I've gone down the usual route of unsetting any object references used during the loop, so I can't see what might be holding on to the memory. The code is quite simple and consists of a single procedure, currently stored in ThisDocument: Option Explicit Sub test2() Dim i As Integer, n As Integer Dim curList As List, curPar As Paragraph, templ As ListTemplate Dim gapSize As Double, level As Integer Application.ScreenUpdating = False Application.Options.Pagination = False For i = 1 To Lists.Count Set curList = Lists(i) For n = 1 To curList.ListParagraphs.Count Set curPar = curList.ListParagraphs(n) Set templ = curPar.Range.ListFormat.ListTemplate level = curPar.Range.ListFormat.ListLevelNumber gapSize = templ.ListLevels(level).TextPosition - templ.ListLevels(level).NumberPosition templ.ListLevels(level).NumberPosition = curPar.LeftIndent - gapSize templ.ListLevels(level).TextPosition = curPar.LeftIndent templ.ListLevels(level).TabPosition = curPar.TabStops.After(curPar.LeftIndent - gapSize).position Set templ = Nothing Set curPar = Nothing Next n UndoClear Set curList = Nothing Next i Application.ScreenUpdating = True Application.Options.Pagination = True End Sub
