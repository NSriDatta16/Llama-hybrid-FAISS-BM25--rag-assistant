[site]: crossvalidated
[post_id]: 96297
[parent_id]: 
[tags]: 
Loess through quantiles

I have the following data points: The thin blue line is the aggregated average for each level of X (ages), the thicker blue line is a Loess fit with R. Now I have two questions regarding this Loess function: The number of data points per level of X is quite low at the boundaries of X. Does the Loess takes this into account? Or in other words, can I give weights to X categories depending on the number of data points? On the graph, you can see the dashed line is the 5% quantile. How would you draw a fit through these quantiles? Is there a way I can still take all of the data points into account? And if not, there will be a even less data at the boundaries of X, so I am afraid question 1 is even more important. UPDATE: Apparently, there is an R package for this, being quantreg. I have however difficulties finding the optimal parameters for non parametric regression, ref the image below. Does anybody have a better idea how to model this? The green plot in the middle is the average with classic LOESS, the other curves are the 95, 75, 25 and 5 % quantile modeled with the package.
