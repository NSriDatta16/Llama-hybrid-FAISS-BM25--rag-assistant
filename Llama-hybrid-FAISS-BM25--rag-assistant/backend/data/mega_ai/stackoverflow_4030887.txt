[site]: stackoverflow
[post_id]: 4030887
[parent_id]: 
[tags]: 
Magento discount coupon code created on fly but not working properly

Here is my code which create the coupon code on the fly: $productId = (int) $this->getRequest()->getParam('id'); $discountprice=$_POST['product']['discountprice']; $model = Mage::getModel('salesrule/rule'); $couponCode=generateUniqueId(8); $model->setName($couponCode); $model->setCouponCode($couponCode); $model->setDescription('Discount coupon for Surger.'); $model->setUsesPerCoupon(1); $model->setUsesPerCustomer(1); $model->setCustomerGroupIds('0,1'); $model->setIsActive(1); // $model->setConditionsSerialized('a:6:{s:4:\"type\";s:32:\"salesrule/rule_condition_combine\";s:9:\"attribute\";N;s:8:\"operator\";N;s:5:\"value\";s:1:\"1\";s:18:\"is_value_processed\";N;s:10:\"aggregator\";s:3:\"all\";}'); //$model->setActionsSerialized('a:6:{s:4:\"type\";s:40:\"salesrule/rule_condition_product_combine\";s:9:\"attribute\";N;s:8:\"operator\";N;s:5:\"value\";s:1:\"1\";s:18:\"is_value_processed\";N;s:10:\"aggregator\";s:3:\"all\";}'); $model->setStopRulesProcessing(0); $model->setIsAdvanced(1); $model->setProductIds($productId); $model->setSortOrder(1); $model->setSimpleAction('by_percent'); $model->setDiscountAmount($discountprice); $model->setDiscountStep(0); $model->setSimpleFreeShipping(0); $model->setTimesUsed(0); $model->setIsRss(0); $model->setWebsiteIds('1'); $model->save(); but when I checkout particular product the discount apply automatically, my requirement is the discount must be apply after I enter the code in the Discount Codes box, also when I enter the code in Discount Codes it shows the code is not valid... Please help anyone. I am also trying my best to solve this; if I find any solution I'll put here.
