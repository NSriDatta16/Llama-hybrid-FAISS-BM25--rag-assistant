[site]: stackoverflow
[post_id]: 2182374
[parent_id]: 
[tags]: 
how to add new field to mechanize form (ruby/mechanize)

there is a public class method to add field to mechanize form I tried .. #login_form.field.new('auth_login','Login') #login_form.field.new('auth_login','Login') and both gives me an error undefined method "new" for # (NoMethodError) I tried login_form.field.new('auth_login','Login') which gives me an error mechanize-0.9.3/lib/www/mechanize/page.rb:13 n `meta': undefined method `search' for nil:NilClass (NoMethodError) but at the time I submit the form. The field does not exist in html source. I want to add it so POST query sent by my script will contain auth_username=myusername&auth_password=mypassword&auth_login=Login So far it sends only auth_username=radek&auth_password=mypassword which might be why I cannot get logged in. Just my thought. The script looks like require 'rubygems' require 'mechanize' require 'logger' agent = WWW::Mechanize.new {|a| a.log = Logger.new("loginYOTA.log") } agent.follow_meta_refresh = true #Mechanize does not follow meta refreshes by default, we need to set that option. page = agent.get("http://www.somedomain.com/login?auth_successurl=http://www.somedomain.com/forum/yota?baz_r=1") login_form = page.form_with(:method => 'POST') puts login_form.buttons.inspect puts page.forms.inspect #STDIN.gets login_form.fields.each { |f| puts "#{f.name} : #{f.value}" } login_form['auth_username'] = 'radeks' login_form['auth_password'] = 'TestPass01' #login_form['auth_login'] = 'Login' #login_form.field.new('auth_login','Login') #login_form.field.new('auth_login','Login') #login_form.fields.each { |f| puts "#{f.name} : #{f.value}" } #STDIN.gets page = agent.submit login_form #Display welcome message if logged in puts page.parser.xpath("/html/body/div/div/div/table/tr/td[2]/div/strong").xpath('text()').to_s.strip puts puts page.parser.xpath("/html/body/div/div/div/table/tr/td[2]/div").xpath('text()').to_s.strip output = File.open("login.html", "w") {|f| f.write(page.parser.to_html) } The .inspect of the form looks like [# # } {radiobuttons} {checkboxes} {file_uploads} {buttons # }> ]
