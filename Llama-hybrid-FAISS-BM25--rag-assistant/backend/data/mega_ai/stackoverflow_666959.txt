[site]: stackoverflow
[post_id]: 666959
[parent_id]: 641896
[tags]: 
There are at least two problems with your code as posted: You're calling CoInitialize in DllMain. You're creating a COM object in DllMain. It wouldn't surprise me if you're doing something in CreateImageLists() which you also shouldn't be doing in DllMain. Also, the reason that your crash was "fixed" by not using the smart pointer is because now you're not actually releasing the object anymore. Your code is broken, and not releasing the reference isn't a valid way to fix anything. I would suggest that you read, and then re-read, the documentation for DllMain paying particular attention to the things you should never do within your implementation of the function. As you'll see right up front: Warning There are serious limits on what you can do in a DLL entry point. To provide more complex initialization, create an initialization routine for the DLL. You can require applications to call the initialization routine before calling any other routines in the DLL. I suspect once you read it, and fix your code to create the COM object at a valid time, and release it at a valid time, your shell extension will stop crashing.
