[site]: crossvalidated
[post_id]: 303473
[parent_id]: 303469
[tags]: 
So if I understand correctly, you want to find subsets of stocks which are highly correlated with each other, and then track the averages within each group? One way to identify such clusters is to build the correlation matrix (as you did), then pick some cutoff which you want the within-cluster pairwise correlation to be greater than (say $0.8$). Use this cutoff to convert your correlation matrix $C$ to a binary matrix $B$ where: $$ B_{ij} = \left\{ \begin{array}{ll} 1 & \mbox{if } C_{ij} \geq \text{cutoff} \\ 0 & \mbox{if } C_{ij} You can then identify highly-correlated subsets of stocks by treating this binary matrix as the adjacency matrix of a graph, and partitioning it into its maximal cliques . If you are using R or Python, then you can use the igraph package to perform this clique partitioning. UPDATE: You could also find the clusters from $C$ directly using the similarity-based approaches described here
