[site]: stackoverflow
[post_id]: 4504623
[parent_id]: 
[tags]: 
TCP IOCP won't receive after acceptex

I'm trying to write an IOCP server. Basically, I have it accepting new connections. For the purpose of my testing, I'm running and connecting to 127.0.0.1. I create the pseudo socket prior to calling AcceptEx(). Once a connection is accepted, the new pseudo socket is used for communication. This new socket is associated with an io completion port [CreateIoCompletionPort], I then assign it a few options, [SO_EXCLUSIVEADDRUSE] and [SO_CONDITIONAL_ACCEPT], and then I call WSARecv() to accept incoming data. The problem is that once my remote connection connects to the server, it sends data, but that data is never received. I'm wondering if someone could offer some ideas as to why it's not receiving data? Perhaps my logic is flawed? I stepped through my code several times. no errors are recorded. EDIT: Fixed the wording. I create the socket before AcceptEx() call. Basic logic in my code: // Create socket, associate with IOCP WSASocket(af, type, proto, lpProtoInfo, g, dwFlags); HANDLE hIOCP = GetPool()->GetQueueHandle(); CreateIoCompletionPort(hSource, hIOCP, 0, 0) != NULL; // Server bind and listen bind(m_shSocket, pAddr, nAddrLen); listen(m_shSocket, nBacklog); // Creation of the pseudo socket SOCKET s = ::WSASocket(m_iSocketAf, m_iSocketType, m_iSocketProto, m_pWpi, m_SocketGroup, m_dwSocketFlags); DWORD dwBytes; BOOL bRet = m_fnAcceptEx(m_shSocket, s, chOutput, 0, sizeof(SOCKADDR_STORAGE) + 16, sizeof(SOCKADDR_STORAGE) + 16, &dwBytes, m_pcbAccept); // ... New Connection comes in, it's accepted ... // Associate new pseudo socket with IOCP HANDLE hNewIOCP = GetPool()->GetQueueHandle(); CreateIoCompletionPort((HANDLE) s, hNewIOCP , 0, 0) != NULL; // ... Remote socket sends ... // ... Remote socket and Pseudo socket call WSARecv ... // ... Pseudo socket does not receive ... NOTE: I tried sending from the pseudo socket to the remote socket, same problem as sending data in the reverse way.
