[site]: stackoverflow
[post_id]: 1435712
[parent_id]: 1435329
[tags]: 
If you make use of a simple tokenizer, it's much easier to manage this sort of thing. One approach is to create a single regular expression that can capture your entire grammar, but this might prove to be problematic. An alternative is to split up the document into sections that need to be rewritten, and sections that should be skipped, which is likely the easier approach here. Here's a simple framework you can extend as required: def wiki_subst(string) buffer = string.dup result = '' while (m = buffer.match(/ .*? /i)) result but not me replace me too but not me either and me" puts wiki_subst(example) { |s| s.upcase } # => REPLACE ME but not me REPLACE ME TOO but not me either AND ME
