[site]: stackoverflow
[post_id]: 3942833
[parent_id]: 
[tags]: 
NServiceBus Host that Subscribes to his own Published Messages

Used Version of NServiceBus: 2.0.0.1145 Question: Is it possible to configure a NServiceBus Host in such a way that, it consumes (subcribes to) his own published messages? Answer: It seems possible, but in the following Configuration it gives me a Transaction deadlocked Exception while trying to insert Subscriptions into the SubscriptionStorage. It happens when you use DbSubscriptionStorage and more than 1 "NumberOfWorkerThreads". Error: Could not execute command: INSERT INTO Subscription (SubscriberEndpoint, MessageType) VALUES (@p0, @p1) System.Data.SqlClinet.SqlException: Transaction was deadlocked on lock resources with another process and has been chosen as the deadlock victim. Rerun the transaction. After that NServiceBus tries to disconnect but fails because there is a transaction still in progress and throws an UnhandledException. How to reproduce: Here is my App.Config: My Bus-Configuration: var bus = Configure.With() .Log4Net() .StructureMapBuilder(container) .XmlSerializer() .MsmqTransport() .IsTransactional(true) .PurgeOnStartup(false) .DBSubcriptionStorage(subscriptionDbProperties, true) .Sagas() .NHibernateSagaPersister(sagaDbProperties, true) .UnicastBus() .ImpersonateSender(false) .LoadMessageHandlers(First .Then ()) .CreateBus() .Start(); and here are my dbProperties for both the subscription and the saga db: connection.provider NHibernate.Connection.DriverConnectionProvider connection.driver_class NHibernate.Driver.SqlClientDriver dialect NHibernate.Dialect.MsSql2005Dialect Everything works fine as long as i don't increase the NumberOfWorkerThreads above 1. Everything higher than that and it will throw the above stated errors. I hope i haven't forgotten anything. Thanks for your help in advance.
