[site]: crossvalidated
[post_id]: 604292
[parent_id]: 604036
[tags]: 
For a Cox model, the statistical principle to keep in mind is how the model incorporates covariate values. At each event time, the model examines the covariate values in place at that event time for the individual with the event against the values at that event time for all individuals still at risk. There is no incorporation of prior exposure history into the model unless you construct a predictor that includes a measure of exposure history. The way you are thinking about the association of the drug with outcome thus determines how to present the drug information to the software. You have to make sure that the software knows, for all event times, your intended measure of drug exposure for all those still at risk. That determines how you need to structure your data set. So the big question is what your intended measure of drug exposure should be. As you can't know whether the participants actually took the drug as prescribed, you will probably have to assume that all the prescribed drug was taken except for time periods that end in death or other terminal event. The case of id 659 that you show suggests that the net dose per day could be less than prescribed, as packs providing 33.3 or 16.7 days of drug lasted much longer than those periods, based on the intervals between refills. Should you divide the DDD_pack value by the number of days until the next refill, at least for time intervals that don't end in death? What's the best way to estimate drug exposure for time periods that end in death? That choice will be vey important and runs a risk of substantial bias if you just divide the last DDD_pack value by the number of days until death. Should there be some smoother average of drug exposure, or some measure of cumulative exposure? Those considerations aren't strictly statistical. They need to be based on understanding of the subject matter. Discuss these issues with colleagues who are familiar with the details of the data and the underlying biomedical question you are addressing. Once you decide on a measure of estimated drug exposure that makes sense on that basis, then make sure that the values of your measure are available to the software, at each event time in the data set, for all individuals still at risk at that event time. That's typically done by the startTime , stopTime , event structure in the counting-process data format.
