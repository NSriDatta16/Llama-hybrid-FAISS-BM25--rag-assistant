[site]: stackoverflow
[post_id]: 3380461
[parent_id]: 3379786
[tags]: 
If I understand you correctly, you are trying to heuristically extract URLs from HTML files, from both attributes (e.g. "href") and text. You want it to work with malformed HTML You want it to work with malformed URLs; e.g. URLs containing spaces You don't want it to make any mistakes; e.g. your example. I put it to you that your requirements are impossible. For example, what should be extracted from the following text: Go to the URL http://example.com/ this and that. And if that doesn't work, I recommend that you go read the http specification. Is "this and that" supposed to be part of the URL, or not? And how is your software supposed to figure this out? And what if the author of the document meant the opposite to what your heuristic says? And what about "http specification" ... which is clearly NOT a URL. And here's another, slightly more subtle example: First, go to the URL http://example.com/index.html. Then click on the "login" link. Should your software extract " http://example.com/index.html ." or " http://example.com/index.html "? According to the URL specification, both are valid URLs. Your software would probably strip off the final "." because it is most likely to be punctuation, but it might be wrong. My advice: Don't think you can do a better job than an existing permissive HTML parser. Where you are coming from, the chances that you can are close to zero. Don't think that your software won't make mistakes. 100% accuracy requires that your software can read the mind of the person who created the file. (And arguably, even that is not sufficient.) Pay attention to the context in which URLs appear. You need to use different heuristics to extract URLs from HTML attributes and text. Pay attention to exactly what is, and what is not a legal URL. Fully read and understand all relevant parts of the HTML and URL/URI specifications. While it is kind of OK to make mistakes with malformed documents, it would be unforgivable to fail to extract well-formed URLs from attributes of well-formed HTML documents.
