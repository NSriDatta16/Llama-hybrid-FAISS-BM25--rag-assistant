[site]: stackoverflow
[post_id]: 4852109
[parent_id]: 
[tags]: 
hibernate criteria putting a contains / does not contain restriction on a set of elements

Hi I'm trying to migrate my old sql based query framework to be Hibernate Criteria based, currently I'm using Hibernate version 3.2. and mysql v 5.0.54 My question is I want to write a criteria that returns all the Beans that do not have a value in a contained set of elements. A summary of the hibernate config file for the bean is: ... The class file is something like: public class Agent { ... public Set getAgentOptions() { return agentOptions; } public void setAgentOptions(Set _agentOptions) { this.agentOptions = _agentOptions; } public enum Option { WEB_SITE_SYNDICATE ("web-site-syndicate"), RECEIVE_PREMIUM_ENQUIRIES ("receive-premium-enquiries"), DO_NOT_SYNDICATE_ADS_TO_THIRD_PARTIES ("do-not-syndicate-ads-to-third-parties") } } I would like to retrieve all the agents who do not have the Option "DO_NOT_SYNDICATE_ADS_TO_THIRD_PARTIES" in their agentOptions the sql that I was using for this previously was something like: SELECT agt.id FROM agent agt WHERE agt.id NOT IN ( SELECT sub_agt.id FROM agent sub_agt JOIN agent_options AS agt_options ON agt_options.agt_id = sub_agt.id WHERE agt_options.identifier = 'do_not_syndicate_ads_to_third_parties' ) I've tried this: ... Criteria crit = getHibernateSession().createCriteria(Agent.class); crit.addRestriction(Restriction.not(Restriction.in("agentOptions", noSyndicatedAds))); ... Which spits out bad sql I've also tried this using aliases: ... crit.createAlias("agentOptions", "agentOption"); crit.add(Restrictions.not(Restrictions.in("agentOption", options))); ... Which throws an exception: org.hibernate.MappingException: collection was not an association: Agent.agentOptions Finally I decided to try a brute sql Criterion: ... crit.add(Restrictions.sqlRestriction(" {alias}.id not in " + "(select agt_sub.id " + "from agent agt_sub " + "join agent_options as agent_options_sub on agent_options_sub.agt_id = agt_sub.id " + "where agent_options_sub.identifier in (?)) ", Agent.Option.DO_NOT_SYNDICATE_ADS_TO_THIRD_PARTIES.getIdentifier(), new org.hibernate.type.StringType() )); ... Which worked but seems a little bit ugly. Does anyone know if there is a way using the std Criteria API without having to resort to sql. Any help or suggestions would be very welcome. Even if they require upgrading to a more recent version of Hibernate. Cheers Simon
