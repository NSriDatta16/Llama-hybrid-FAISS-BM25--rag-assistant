[site]: stackoverflow
[post_id]: 2316598
[parent_id]: 
[tags]: 
dropdownlist jquery ddl.change() seems to fire before change takes place

I have three cascaded drop down lists. ddlIllnessType, ddlIllnessSubType and ddlInfectiousAgent Initially, only ddlIllnessType is showing. On change, ddlIllnessSubType is filled with json data and made visible. So far, so good. Next, when the user selects a value from ddlIllnessSubType, a similar procedure runs for ddlInfectiousAgent in the ddlIllnessSutType change event handler. However, in the following code, $(this).val() always comes up as 'undefined', even though the user has chosen an existing value: $("#ddlIllnessSubType").change(function() { var selection = $(this).val(); // go and get Json based on the value of selection. // Doesn't work cos selection == 'undefined' var url = "/IllnessDetail/CascadedDdlInfectiousAgent/" + selection; getJSON(url, function(data) {...}); ... }); Why is selection == 'undefined'?????! Thanks in advance Andrew PS: The full jQuery and the HTML are as follows: The full jQuery code is: $('document').ready(function() { var pEst = $("#pEncephalitisSubType"); var pIa = $("#pInfectiousAgent"); var ddlEst = $("#IdEncephalitisSubType"); var ddlIa = $("#IdInfectiousAgent"); $('#SubTypeContainer').hide(); pEst.hide(); pIa.hide(); // debugger $('select').each(function() { $(this).val(""); //alert($(this).val()); }); // Change Event Handler $("#IdEncephalitisType").change(function() { var selection = $(this).val(); pEst.fadeOut('slow'); pIa.fadeOut('slow'); ddlEst.val(""); ddlIa.val(""); if (selection == 0) { $('#SubTypeContainer').fadeOut('slow'); } else { var url = "/Members/IllnessDetail/CascadedDdlSubType/" + selection; AjaxEncephalitisSubTypes(url); } }); // Change Event Handler $("#IdEncephalitisSubType").change(function() { var selection = $(this).val(); debugger pIa.fadeOut('slow'); ddlIa.val(""); if (selection != "") { if (($("#IdEncephalitisType").val() == 1) && ((selection == 1) || (selection == 2))) { var url = "/Members/IllnessDetail/CascadedDdlInfectiousAgent/" + selection; AjaxInfectiousAgents(url); } } }); function AjaxEncephalitisSubTypes(url) { $('#SubTypeContainer').fadeOut('slow'); $.getJSON(url, null, function(json) { ddlEst.empty(); ddlIa.empty(); PrependDdlDefaults(ddlEst); var i = 0; $.each(json, function(index, optionData) { ddlEst.append(" " + optionData.Name + " "); i++; }); $('#SubTypeContainer').fadeIn('slow'); ddlEst.val(""); pEst.fadeIn('slow'); }); } function AjaxInfectiousAgents(url) { $('#SubTypeContainer').fadeOut('slow'); $.getJSON(url, null, function(data) { var i = 0; ddlIa.empty(); PrependDdlDefaults(ddlIa); $.each(data, function(index, optionData) { ddlIa.append( " " + optionData.Name + " "); i++; }); }); ddlIa.val(""); $('#SubTypeContainer').fadeIn('slow'); pIa.fadeIn('slow'); } function PrependDdlDefaults(ddl) { ddl.prepend( " " + " --- Please choose... --- " + " "); } }); The Illness According to your input, different drop down lists will appear, specialised to only show the options that apply. Type Of Encephalitis: Extra Information regarding the Illness: Sub Type of Encephalitis: Infectious Agent: The controller doesn't need to be shown, as the json delivered is correct. As in I've tested it and what gets rendered is correct.
