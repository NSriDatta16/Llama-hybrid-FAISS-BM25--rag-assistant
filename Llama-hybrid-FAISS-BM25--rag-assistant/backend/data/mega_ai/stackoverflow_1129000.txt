[site]: stackoverflow
[post_id]: 1129000
[parent_id]: 
[tags]: 
What does a working example of dealing with packet fragmentation in C# look like when using the Begin* End* method?

After enough playing with asynchronous socket programming I noticed that the server was receiving chunked payloads (ie: more than one complete payload sitting in the same buffer). So I came up with the following: if (bytes_to_read > 0) { while (bytes_to_read > 0) // Get payload size as int. // Get payload in byte format. // Do something with payload. // Decrease the amount of bytes to read. } // Wait for more data. } And then I noticed packet fragmentation (ie: what I thought were complete payloads chunked together wasn't always so) which changed the previous code to something like: if (bytes_to_read > 0) { while (bytes_to_read > 0) { // Get payload size as int. // Check if the payload size is less than or equal to the amount of bytes left to read. if (payload_size 0) { // Wait for more data where we left off. *** } else { // Something awful happened. } } *** I don't even know how to go about this and would like to see code for it. I had an idea that it involved copying the in-completed payload to the beginning of the buffer and then picking up from there. The pseudo code I included is based on the Begin* End* method I am using (I'm aware that I should be using the *Async set of methods found here -> http://msdn.microsoft.com/en-us/library/system.net.sockets.socketasynceventargs.aspx I am seeking the answers to 2 questions--namely: Is this approach correct or am I missing something? What does a working example of dealing with packet fragmentation in C# look like? EDIT: I'm using raw sockets. Thanks in advance for all your help. EDIT: John Saunders and Greg Hewgill have brought up the point of treating data as a stream but that does not provide me with a concrete example of how to deal with the last chunked payload sometimes being fragmented. EDIT: I have read Jon Skeet's answer here which is basically along the same lines as the other answers I have seen but it doesn't help me much as I already get what I have to do but not how to do it. EDIT: To elaborate on what I mean by fragmentation, consider the following the receive buffers: 224TEST3foo3bar 224TEST3foo3bar224TEST3foo3bar 224TEST3foo3bar224TEST3foo 3bar224TEST3foo3bar EDIT: I found this and this which lead me here . Vadym Stetsiak has cleared nearly everything up (his was one of the answers I was looking for).
