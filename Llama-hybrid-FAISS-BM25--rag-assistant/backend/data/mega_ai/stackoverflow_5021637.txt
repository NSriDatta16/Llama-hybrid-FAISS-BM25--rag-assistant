[site]: stackoverflow
[post_id]: 5021637
[parent_id]: 5020851
[tags]: 
I would suggest an entirely different approach. (F)CKEditor can already do what you want. Just try to add a table in the middle of a paragraph. It will close the inline tag stack, add the table, and reopen the stack again. I suggest that, instead of having your users write {widget}, you write an (F)CKEditor plugin that adds the widgets for you. You can take a look at the code for the table button (or any other block-level element) to see how (F)CKEditor inserts them. There are two things you can do when a user hits the "widget" button. Eitther you insert some custom tag such as , or you insert a HTML tag that you can recognise later on, like . With some extra elbow grease you can even make this fancier by actually loading the widget itself, wrapped in such tags. That way, the user would see exactly the same in the editor window as when it was stored. When the editor saves to the server, simply empty the tags wrapping the widget to get rid of it. Example workflow (cursor marked by | sign): User types text: foo bar| baz User hits "widget" button: foo bar ... contents of "foo" widget ... |baz When saving, drop the widget contents: foo bar baz When displaying the saved contents, parse for div tags with a "widget" class and dynamically fill it: foo bar ... contents of "foo" widget ... baz
