[site]: crossvalidated
[post_id]: 507765
[parent_id]: 
[tags]: 
spikes in training CNN using Adam

I have an instability issue when training CNN on high dimensional data. I train Unet-3D model ( https://arxiv.org/pdf/1505.04597.pdf ) with batch normalization layer before each convolution layer. My data dimensions are (46,46,5,77) meaning set of 3D voxels for each feature estimating target of (48,48,5). I use tensorflow with keras API (tf version 2.3) I train with default learning rate(LR) of Adam and it happens quite randomly. I reduce the learning rate after about 600 epochs of no higher change than 1e-4 in validation loss. Even using quite lower LR it still occurs. I monitor the metrics using tensorboard callbacks. my model summary: Model: "functional_1" __________________________________________________________________________________________________ Layer (type) Output Shape Param # Connected to ================================================================================================== input_1 (InputLayer) [(None, 46, 46, 5, 7 0 __________________________________________________________________________________________________ zero_padding3d (ZeroPadding3D) (None, 48, 48, 5, 77 0 input_1[0][0] __________________________________________________________________________________________________ conv_encoder00 (Conv3D) (None, 48, 48, 5, 90 187200 zero_padding3d[0][0] __________________________________________________________________________________________________ batch_normalization_encoder00 ( (None, 48, 48, 5, 90 360 conv_encoder00[0][0] __________________________________________________________________________________________________ leakyrelu_encoder00 (LeakyReLU) (None, 48, 48, 5, 90 0 batch_normalization_encoder00[0][ __________________________________________________________________________________________________ conv_encoder01 (Conv3D) (None, 48, 48, 5, 90 218790 leakyrelu_encoder00[0][0] __________________________________________________________________________________________________ batch_normalization_encoder01 ( (None, 48, 48, 5, 90 360 conv_encoder01[0][0] __________________________________________________________________________________________________ leakyrelu_encoder01 (LeakyReLU) (None, 48, 48, 5, 90 0 batch_normalization_encoder01[0][ __________________________________________________________________________________________________ max_pool_encoder00 (MaxPooling3 (None, 24, 24, 5, 90 0 leakyrelu_encoder01[0][0] __________________________________________________________________________________________________ conv_encoder10 (Conv3D) (None, 24, 24, 5, 45 109395 max_pool_encoder00[0][0] __________________________________________________________________________________________________ batch_normalization_encoder10 ( (None, 24, 24, 5, 45 180 conv_encoder10[0][0] __________________________________________________________________________________________________ leakyrelu_encoder10 (LeakyReLU) (None, 24, 24, 5, 45 0 batch_normalization_encoder10[0][ __________________________________________________________________________________________________ conv_encoder11 (Conv3D) (None, 24, 24, 5, 45 54720 leakyrelu_encoder10[0][0] __________________________________________________________________________________________________ batch_normalization_encoder11 ( (None, 24, 24, 5, 45 180 conv_encoder11[0][0] __________________________________________________________________________________________________ leakyrelu_encoder11 (LeakyReLU) (None, 24, 24, 5, 45 0 batch_normalization_encoder11[0][ __________________________________________________________________________________________________ max_pool_encoder10 (MaxPooling3 (None, 12, 12, 5, 45 0 leakyrelu_encoder11[0][0] __________________________________________________________________________________________________ conv_encoder20 (Conv3D) (None, 12, 12, 5, 15 18240 max_pool_encoder10[0][0] __________________________________________________________________________________________________ batch_normalization_encoder20 ( (None, 12, 12, 5, 15 60 conv_encoder20[0][0] __________________________________________________________________________________________________ leakyrelu_encoder20 (LeakyReLU) (None, 12, 12, 5, 15 0 batch_normalization_encoder20[0][ __________________________________________________________________________________________________ conv_encoder21 (Conv3D) (None, 12, 12, 5, 15 6090 leakyrelu_encoder20[0][0] __________________________________________________________________________________________________ batch_normalization_encoder21 ( (None, 12, 12, 5, 15 60 conv_encoder21[0][0] __________________________________________________________________________________________________ leakyrelu_encoder21 (LeakyReLU) (None, 12, 12, 5, 15 0 batch_normalization_encoder21[0][ __________________________________________________________________________________________________ dropout_encoder (Dropout) (None, 12, 12, 5, 15 0 leakyrelu_encoder21[0][0] __________________________________________________________________________________________________ up_conv_decoder00 (Conv3DTransp (None, 24, 24, 5, 45 18270 dropout_encoder[0][0] __________________________________________________________________________________________________ batch_normalization_decoder00 ( (None, 24, 24, 5, 45 180 up_conv_decoder00[0][0] __________________________________________________________________________________________________ leakyrelu_decoder00 (LeakyReLU) (None, 24, 24, 5, 45 0 batch_normalization_decoder00[0][ __________________________________________________________________________________________________ concatenate (Concatenate) (None, 24, 24, 5, 90 0 leakyrelu_encoder11[0][0] leakyrelu_decoder00[0][0] __________________________________________________________________________________________________ conv_decoder01 (Conv3D) (None, 24, 24, 5, 45 109395 concatenate[0][0] __________________________________________________________________________________________________ batch_normalization_decoder01 ( (None, 24, 24, 5, 45 180 conv_decoder01[0][0] __________________________________________________________________________________________________ leakyrelu_decoder01 (LeakyReLU) (None, 24, 24, 5, 45 0 batch_normalization_decoder01[0][ __________________________________________________________________________________________________ conv_decoder02 (Conv3D) (None, 24, 24, 5, 45 54720 leakyrelu_decoder01[0][0] __________________________________________________________________________________________________ batch_normalization_decoder02 ( (None, 24, 24, 5, 45 180 conv_decoder02[0][0] __________________________________________________________________________________________________ leakyrelu_decoder02 (LeakyReLU) (None, 24, 24, 5, 45 0 batch_normalization_decoder02[0][ __________________________________________________________________________________________________ up_conv_decoder10 (Conv3DTransp (None, 48, 48, 5, 90 109440 leakyrelu_decoder02[0][0] __________________________________________________________________________________________________ batch_normalization_decoder10 ( (None, 48, 48, 5, 90 360 up_conv_decoder10[0][0] __________________________________________________________________________________________________ leakyrelu_decoder10 (LeakyReLU) (None, 48, 48, 5, 90 0 batch_normalization_decoder10[0][ __________________________________________________________________________________________________ concatenate_1 (Concatenate) (None, 48, 48, 5, 18 0 leakyrelu_encoder01[0][0] leakyrelu_decoder10[0][0] __________________________________________________________________________________________________ conv_decoder11 (Conv3D) (None, 48, 48, 5, 90 437490 concatenate_1[0][0] __________________________________________________________________________________________________ batch_normalization_decoder11 ( (None, 48, 48, 5, 90 360 conv_decoder11[0][0] __________________________________________________________________________________________________ leakyrelu_decoder11 (LeakyReLU) (None, 48, 48, 5, 90 0 batch_normalization_decoder11[0][ __________________________________________________________________________________________________ conv_decoder12 (Conv3D) (None, 48, 48, 5, 90 218790 leakyrelu_decoder11[0][0] __________________________________________________________________________________________________ batch_normalization_decoder12 ( (None, 48, 48, 5, 90 360 conv_decoder12[0][0] __________________________________________________________________________________________________ leakyrelu_decoder12 (LeakyReLU) (None, 48, 48, 5, 90 0 batch_normalization_decoder12[0][ __________________________________________________________________________________________________ conv_decoder20 (Conv3D) (None, 48, 48, 5, 45 109395 leakyrelu_decoder12[0][0] __________________________________________________________________________________________________ conv_decoder21 (Conv3D) (None, 48, 48, 5, 1) 1216 conv_decoder20[0][0] __________________________________________________________________________________________________ conv_decoder22 (Conv3D) (None, 48, 48, 5, 1) 28 conv_decoder21[0][0] __________________________________________________________________________________________________ leakyrelu_decoder20 (LeakyReLU) (None, 48, 48, 5, 1) 0 conv_decoder22[0][0] ================================================================================================== Total params: 1,655,999 Trainable params: 1,654,589 Non-trainable params: 1,410 __________________________________________________________________________________________________ example of loss second example of loss third example of loss
