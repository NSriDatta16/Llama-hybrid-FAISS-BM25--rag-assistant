[site]: stackoverflow
[post_id]: 4069739
[parent_id]: 4066931
[tags]: 
Your first loop is this: my @associationsToRemove = (); foreach my $association ($agentConf->GetAssociations()) { if ( grep {$_ eq $association->Name()} @agentConfAssociationDeletionsList) { print "pushing " . $association->Name() . "\n"; push(@associationsToRemove, $association); } } which is equivalent to this: my @associationsToRemove = (); my @associations = $agentConf->GetAssociations(); foreach my $association (@associations) { if ( grep {$_ eq $association->Name()} @agentConfAssociationDeletionsList) { print "pushing " . $association->Name() . "\n"; push(@associationsToRemove, $association); } } So, GetAssociations() is called before the first iteration of the loop. There is no "don't delete while iterating pitfall" here, that pitfall generally comes up inside each based loops and C-style for loops. The problem is probably something inside the RemoveAssocition() method. Another possibility is that the $association objects returned from GetAssociations() aren't fully copied when they're passed back: the $association objects could still be internal data from $agentConf . This could be a hidden "don't delete while iterating" pitfall, hard to say without knowing the implementation of $agentConf or even what its interface is. Also, you're missing a sigil on agentConf in your second loop but that's probably just a typo.
