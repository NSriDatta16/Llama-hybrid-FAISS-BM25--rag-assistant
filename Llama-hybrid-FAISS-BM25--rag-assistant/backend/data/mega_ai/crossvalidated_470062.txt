[site]: crossvalidated
[post_id]: 470062
[parent_id]: 469639
[tags]: 
Let's look at this for a single binary predictor, coded A and B, since that's hard enough. The hazard ratio $e^\beta$ , the ratio of the hazard in group A to the hazard in group B, solves this equation. It's the partial likelihood score equation, but it's written to look like the logrank test. The weight function $w(t)$ is what it is in the logrank test; basically an effective sample size at time $t$ . $$0=\int_0^\infty w(t)\left(\frac{d\bar N_A(t)}{\bar Y_A(t)}-e^\beta\frac{d\bar N_B(t)}{\bar Y_B(t)}\right)$$ I'm using counting-process notation here: $\bar N(t)$ is the number of deaths up to and including time $t$ , $d\bar N$ is the number at time $t$ , $\bar Y(t)$ is the number at risk at time $t$ , and the integral is just a sum. In traditional notation where $d$ is deaths and $r$ is number at risk it would look something like $$0=\sum_{t} w(t)\left( \frac{d_t(A)}{r_t(A)}-e^\beta\frac{d_t(B)}{r_t(B)}\right)$$ The two fractions are the increments of the cumulative hazard in each group, estimating the hazard at each time, so the equation says if you multiply the hazard in group $B$ by $e^\beta$ , the average difference in hazard over time between will be zero. Or, another way, $$e^\beta=\frac{ \int_0^\infty w(t)\frac{d\bar N_A(t)}{\bar Y_A(t)} }{ \int_0^\infty w(t)\frac{d\bar N_B(t)}{\bar Y_B(t)} }$$ So $e^\beta$ isn't an average ratio of hazards so much as a ratio of average hazards: the averaging happens before the ratioing. I don't know of any source where this is explicitly written down: I worked it out from the logrank test and partial score formulas in Fleming & Harrington Counting Processes and Survival Analysis while teaching from that book. When you have more complicated models than just comparing groups, the details will get messy fairly quickly. The main point still holds, that at least some of the averaging happens before the ratioing. While I'm here and because it's my hobbyhorse I will go into $w(t)$ a bit for the binary case. Because $w(t)$ depends on the number at risk in both groups, the numerator of this fraction will change if you swap out group $B$ for a different group $C$ (in addition to the denominator, which obviously changes). The way this turns out, if you fit separate Cox models to the hazard ratio for A vs B (and it's $>1$ ) and the hazard ratio for $B$ vs $C$ (and it's $>1$ ) and the hazard ratio for $A$ vs $C$ , it will not necessarily be $>1$ : non-transitivity. That can only happen if the hazard ratio crosses 1 over time in at least two of the comparisons, but we are already talking about non-proportional hazards.
