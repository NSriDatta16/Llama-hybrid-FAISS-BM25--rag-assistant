[site]: crossvalidated
[post_id]: 470224
[parent_id]: 470215
[tags]: 
You can see your first transition is wrong because the right-hand side is a function of $A$ and $Z$ and the left-hand side is a function only of $Z$ . That suggests the second equality is where the problem happens, and it is. In $E[ E[x|A] |Z]$ , the inner random variable is a function of $A$ , and the outer expectation gives you the expected value of that function of $A$ conditional on $Z$ , which is a function only of $Z$ , with $A$ smoothed out by averaging. In fact, the equation $$E[E[x\mid A,Z] \mid Z] = E[x\mid Z]$$ is just another case of the smoothing rule (law of total expectation, tower rule). Wikipedia covers it here Your second transition is wrong, so that's why you don't understand how to make it. As a counterexample, suppose $A$ , $X$ , and $Z$ are all independent, and $P(A) . Because of independence, $$E[E[x|A,Z]|Z]=E[x|A, Z]=E[x],$$ but $$E[x|A, Z]\Pr[A|Z]= E[x]P(A),$$ which is smaller than $E[x].$ The equation in the image (which wasn't there when I first answered the question) makes it clearer what the issue is. They have $$E[E[x|A,Z]|Z]=\sum_{A_i} E[x|A, Z]P[A_i|Z]$$ What they mean by this is that $A_i$ are the possible value of $A$ . In the original source they say The summation is over all events Ai in the set A of M mutually exclusive and exhaustive association events. Without $Z$ it would look like $$E[E[x|A]]=\sum_{A_i} E[x|A]P[A_i]$$ which is just the law of total expectation applied to the mutually exclusive and exhaustive events $A_i$ They have the same thing, only with everything conditioned on $Z$ .
