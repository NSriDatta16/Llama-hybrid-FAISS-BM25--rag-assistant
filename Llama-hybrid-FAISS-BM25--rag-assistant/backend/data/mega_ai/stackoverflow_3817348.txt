[site]: stackoverflow
[post_id]: 3817348
[parent_id]: 3816569
[tags]: 
The problem is that the code you inherited was written with the mindset "I'll determine the unique set myself" instead of the "let's leverage the framework to do it for me". I would something like this (pseudocode) instead: map(key, value): ad_id = .. // extract from value user_id = ... // extract from value collect(ad_id & user_id , unused dummy value) reduce(ad_id & user_id , unused dummy value): output (ad_id , 1); // one unique userid. map(ad_id , 1): --> identity mapper! collect(ad_id , 1 ) reduce(ad_id , set of a lot of '1's): summarize ; output (ad_id , unique_user_ids);
