[site]: stackoverflow
[post_id]: 5729952
[parent_id]: 
[tags]: 
iOS OpenGL Shader doen't work on actual device

I've got a working GLSL shader that runs on the PC using a OpenGL ES simulator and in the iOS simulator. When I run it on a real iPad (running iOS v4.2) it doesn't render. The shader compiles and links but I am getting the following error from glValidateProgram: Fragment program failed to compile with current context state Vertex program failed to compile with current context state Here is the GLSL code: GLbyte vShaderStr[] = "uniform mat4 ES_MVP; \n" "uniform vec4 ES_LightVector; \n" "uniform mat4 ES_InvWorld; \n" "attribute vec4 vPosition; \n" "attribute vec2 vTexture0; \n" "attribute vec4 vNormal; \n" "attribute vec4 vTangent; \n" "varying vec2 iTexture; \n" // "varying vec4 iNormal; \n" "varying vec3 iLightDir; \n" "void main() \n" "{ \n" " gl_Position = ES_MVP * vPosition; \n" " iTexture = vTexture0; \n" //" iNormal = vNormal; \n" " vec3 bitan = cross(vNormal.xyz,vTangent.xyz); \n" " bitan = bitan * vTangent.w; \n" " vec3 fakeLight = (ES_InvWorld * ES_LightVector).xyz; \n" " iLightDir.x = dot(vTangent.xyz,fakeLight); \n" " iLightDir.y = dot(bitan,fakeLight); \n" " iLightDir.z = dot(vNormal.xyz,fakeLight); \n" "} \n"; GLbyte fShaderStr[] = "precision mediump float; \n" "varying vec2 iTexture; \n" // "varying vec4 iNormal; \n" "varying vec3 iLightDir; \n" "uniform sampler2D ES_Sampler0; \n" "uniform sampler2D ES_Sampler1; \n" "void main() \n" "{ \n" " vec3 norm = texture2D( ES_Sampler1, iTexture).rgb * 2.0 - 1.1; \n" " vec4 diff = texture2D( ES_Sampler0, iTexture ).rgba; \n" " float nl = clamp(dot(norm,iLightDir),0.2, 1.0); \n" " gl_FragColor = vec4(diff.rgb * nl,diff.a); \n" "}
