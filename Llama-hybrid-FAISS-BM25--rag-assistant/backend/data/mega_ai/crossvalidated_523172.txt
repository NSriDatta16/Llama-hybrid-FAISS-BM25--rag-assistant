[site]: crossvalidated
[post_id]: 523172
[parent_id]: 
[tags]: 
average marginal effect AME vs. average partial effect APE

Say I have a binary logistic regression model: model1 : logit = b0 + b1 *age + b2 *gender_f + b3 *race_f with age being continuous and race_f and gender_f being two-level factors. The margins function in R (or equivalently the margins command in Stata ) can be used to estimate AME's for the three IV's. There also exists a so called APE, which for "age" can be obtained, following Mood (Logistic regression: why we cannot do what we think we can do, and what we can do about it, 2009), by averaging the marginal effects of age, dydx_age = b1 * p * (1-p), across the distribution of other variables at different given values of age; here p denotes the predicted probability of a person. I'm stuck with how to calculate this APE measure. Roughly, I can think of two ways. Select all people with age=20 in my dataset, and calculate the average dydx_age value for this subset. With "margins", the "at" option can be used, as in R 's: margins(model1, at=list(age=20)) . Stata has a similar option. This at= option actually constructs a new dataset, equal to the original data, except for age=20 now for ALL respondents in the new dataset. Then, for each person in this new dataset p is calculated (based on age=20, and gender and race as observed) and then the average of all dydx_age values is obtained. This average is another way I can think of, to calculate the APE. I would never have considered this way of calculating APE, had I not read about at= in T. Leeker's manual of margins and in R. Williams's paper on Stata 's margins. Not many texts could I find in which AME and APE are clearly contrasted, only the one mentioned by Carina Mood. Wooldridge discusses APE but reading this text is not simple, at least for me. On some internet pages the terms AME and APE seem to be used as synonyms, improperly given Mood's explanation. As to the at= option, more in general, I would like to find an explanation of when to use this instead of working with subgroups. Reading the many examples about using margins in Stata or R , it seems so "obvious" to use at=, that the subgroups options seems " wrong" anyway. Is this indeed wrong, or "stupid"? The fictitious data, as generated by at=, seems "wrong" to, in the sense of not leading to a random sample of 20 year old people from the population. Thanks for any help or reference!! After receiving a response from Tom, about an explanation of what an average partial effect is by Kjetil B. Halvorsen, see: What are average partial effects? I added the following: I happened to read this explanation just before posting my question. As you will have noticed, the two terms are used as synonyms there. In https://cran.r-project.org/web/packages/margins/vignettes/Introduction.html the two terms are also used but with a different meaning: AME refers (in case of logit link) to the linear predictor scale, whereas APE is reserved for the response scale. This is quite different from the way AME is mostly used (e.g. in R. Williams's Stata paper) namely to express change on the response scale. But apart from this, the explanation you pointed to is much in line with Wooldridge's text, as far as I can see. Also, it seems to suggest (but correct me please if I'm wrong) that calculating the average partial effect APE boils down to taking the average of the derivative (dydx_age in R 's margins terms) over the SUBGROUP in the original sample with age=20, or age=21, 22 etc. Or to put it differently: APE is AME calculated over a subgroup. In Stata this would mean using option "over=" And this is definitely NOT the same as using at=. In Richard Williams's text, "at" is used as the more or less "obvious" way to go, if you want to compare the effect of e.g. race across different ages. But now I believe that this is less obvious than I first thought. In case of an experiment and a completely balanced dataset, I guess the two methods of calculating APE for age=20 would lead to the same estimate (though probably different std. errors). But given that the data in Richard Williams's examples are observational (I think) wouldn't it be at least equally plausible to use method 1 described above? B.t.w., using margins in R would not produce a std. error for the average dydx_age at age=20 obtained for the subgroup method; only for the at=list(age=20) method, there would be a std. error. I'm not sure if Stata produces a std. error for a subgroup when using over=. Further, the cplot(.., what="effect") function in R produces at= like results. As far as I can see now, it would be nice if cplot could also generate subgroup results (which of course can easily be generated, knowing that the dydx_age etc. columns are available in a data frame, made by margins).
