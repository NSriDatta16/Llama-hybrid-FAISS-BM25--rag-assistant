[site]: stackoverflow
[post_id]: 1217878
[parent_id]: 1207335
[tags]: 
I found the following code working for me now def document if @document.nil? && response @document = if document_encoding Nokogiri::HTML(response.body.force_encoding(document_encoding).encode('utf-8'),nil, 'utf-8') else Nokogiri::HTML(response.body) end end @document end def document_encoding return @document_encoding if @document_encoding response.type_params.each_pair do |k,v| @document_encoding = v.upcase if k =~ /charset/i end unless @document_encoding #document.css("meta[http-equiv=Content-Type]").each do |n| # attr = n.get_attribute("content") # @document_encoding = attr.slice(/charset=[a-z1-9\-_]+/i).split("=")[1].upcase if attr #end @document_encoding = response.body =~ / ]*HTTP-EQUIV=["']Content-Type["'][^>]*content=["'](.*)["']/i && $1 =~ /charset=(.+)/i && $1.upcase end @document_encoding end
