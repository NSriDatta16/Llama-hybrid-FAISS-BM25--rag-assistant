[site]: crossvalidated
[post_id]: 338611
[parent_id]: 
[tags]: 
How to compute a non linear mix model with links between the parameters and their variance in R?

I'm working on a biological problem where we want to modelize the impact of a treatment and a chemical modification on the measured quantity of a molecule (peptides). We will note $x_{ijk}$ the measure of this quantity, where $i\in\{1,2\}$ is the treatment, $j\in\{1,2\}$ is the chemical modification and $k\in[|1,n_k|]$ are the replicates. Let $\Pi = \{ (\alpha_j)_j,(b_{ij})_{ij},(\sigma_i)_i,\sigma\} $ be the set of parameters (both random and fixed) we want to estimate. I want to compute the following mixed non-linear model : (M1) : $\forall i,j,k : \left\{ \begin{array}{ll} x_{ijk} = \mu + g(\Pi) + \alpha_j + b_{ij} + \theta_{ik} + \epsilon_{ijk} \\ b_{1j} = 0 ,& \theta_{ij} \sim \mathcal{N}(0,\sigma_i)\\ \alpha_1 = 0, & \epsilon_{ijk} \sim \mathcal{N}(0,\sigma) \end{array} \right. $ And $g$ is defined thanks to a biological equation as : $g : \Pi \rightarrow \left\{ \begin{array}{lcl} e^{0.5\times log^2(2)\times(\sigma_2^2-\sigma_1^2)}\times\frac{1+2^{b_{22}}}{1+2^{b_{21}}} & if & i = 2 \\ 0 & if & i = 1 \end{array} \right.$ To make it more understandable : $\alpha_j$ is the common effect of the chemical modification, $b_{ij}$ is the effect of the chemical modification in each treatment, $\theta_{ik}$ is the random effect (due to the replicates) in each treatment and $\epsilon_{ijk}$ is the residual error. The term $g(\Pi)$ can be seen as the effect of the treatment or a constraint between the parameters. My question is : How can I compute the parameters and the variance in R (basically i want to estimate $\Pi$)? I tried to use the packages nlme and saemix but they do not seems to provide solutions for non-linear mixed models when, in the model, there are links between the parameters of the model and their variance. Is there a solution in with a bayesian approach? NB : I am not interested in a solution with an unspecified $g$ function but as i'm not really sure that this constraint is enough to have a unique solution i'll probably have to change a bit the $g$ function so solutions with tricky substitution will not help me a lot. Others view of the problem (bonus) I tried to formulate (M1) as a ill posed linear mixed model (ill posed because there is not a unique solution) plus a non linear constraint between my parameters (to reduce the number of solutions) : Here we change a little bit $\Pi$ and $g$ to $\Pi'$ and $g'$ defined as : $\Pi'= \{ (c_i)_i,(\alpha_j)_j,(b_{ij})_{ij},(\sigma_i)_i,\sigma\}$, we add a $c_i$ the effect of the treatment. $g' : \Pi' \rightarrow c_2 - e^{0.5\times log^2(2)\times(\sigma_2^2-\sigma_1^2)}\times\frac{1+2^{b_{22}}}{1+2^{b_{21}}} $ is g but view as a constraint between the parameters. Then we can rewrite (M1) as : (M2) : $\forall i,j,k : \left\{ \begin{array}{ll} x_{ijk} = \mu + c_i + \alpha_j + b_{ij} + \theta_{ik} + \epsilon_{ijk} \\ b_{1j} = 0 ,& \theta_{ij} \sim \mathcal{N}(0,\sigma_i)\\ \alpha_1 = 0, & \epsilon_{ijk} \sim \mathcal{N}(0,\sigma)\\ c_1=0 & g'(\Pi') = 0 \end{array} \right. $ The first three lines of (M2) is the linear mixed model and the last line is the constraint. This problem seems to be a problem of optimization with constraints but with random terms. Is there some package in R to solve those type of problems. I tried to look at solutions like a lasso model where my penality is $g'$ but I didn't found any R package which allows to do those type of resolution. Thank a lot, if anyone have an idea or some papers/books I can read it would help me a lot!
