[site]: stackoverflow
[post_id]: 4602678
[parent_id]: 
[tags]: 
Serving .docx files through Php

I'm having issues when attempting to serve a .docx file using Php. When uploading the file I detect the file mime type and upload the file using the file with the correct extension based on the mime type; e.g. below: application/msword - doc application/vnd.openxmlformats-officedocument.wordprocessingml.document - docx When attempting to serve the files for download, I do the reverse in detecting the extension and serving based on the mime type e.g. public static function fileMimeType($extention) { if(!is_null($extention)) { switch($extention) { case 'txt': return 'text/plain'; break; case 'odt': return 'application/vnd.oasis.opendocument.text'; break; case 'doc': return 'application/msword'; break; case 'docx': return 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'; break; case 'jpg': return 'image/jpeg'; break; case 'png': return 'image/png'; break; case 'pdf': return 'application/pdf'; break; default: break; } } } All files appear to download correctly and open fine but when attempting to open a docx file, Word (on multiple files) throws a error stating the file is corrupt. Any ideas would be great, thanks. Edit #1 try { $file = new Booking_Document((int)$get_data['bookingDocument']); header('Content-Type: ' . Booking_Document::fileMimeType($file->getDocumentType())); header('Content-Disposition: attachment; filename=' . $file); header('Expires: 0'); header('Cache-Control: must-revalidate, post-check=0, pre-check=0'); header('Pragma: public'); echo readfile(Zend_Registry::get(static::$_uploadDir).$this->_id); } catch (Exception $e) { View_Helpers_FlashMessages::addMessage(array('message' => $e->getMessage(), 'type' => 'error')); } exit; FIXED Prior to calling readfile() I added ob_clean() and flush() which appears to have fixed the problem.
