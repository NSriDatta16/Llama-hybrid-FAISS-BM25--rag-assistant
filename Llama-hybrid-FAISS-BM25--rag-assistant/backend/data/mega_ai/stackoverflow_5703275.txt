[site]: stackoverflow
[post_id]: 5703275
[parent_id]: 5700667
[tags]: 
Well, it seems I have found the problem. The functionality as described above works manually executing it in the administrator interface. The code as enclosed above I only got to work by changing a core file of Magento. If you change line 103 of Mage_Sales_Model_Service_Order from continue; to $qty = 0; the functionality works. In short, this is what happens. With continue the second row item isn't added to the invoice which the invoice makes thinks the curren item is the last item of the whole order and therefore needs to invoice the complete outstanding amount. In my case the invoice I did want to invoice and the row I didn't want to invoice. I've submitted it as issue on the Magento issue list.
