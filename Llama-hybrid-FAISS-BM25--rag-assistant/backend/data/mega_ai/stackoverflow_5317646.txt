[site]: stackoverflow
[post_id]: 5317646
[parent_id]: 
[tags]: 
mySQL "Too many connections" error influenced by number of mongrel instances?

Recently I have started getting mySQL "too many connection" errors at times of high traffic. My rails app runs on a mongrel cluster with 2 instances on a shared host. Some recent changes that might be driving it: Traffic to my site has increased. I am now averaging about 4K pages a day. Database size has increased. My largest table has ~ 100K rows. Some associations could return several hundred instances in the worst case, though most are far less. I have added some features that increased the number and size of database calls in some actions. I have done a code review to reduce database calls, optimize SQL queries, add missing indexes, and use :include for eager loading. However, many of my methods still make 5-10 separate SQL calls. Most of my actions have a response time of around 100ms, but one of my most common actions averages 300-400ms, and some actions randomly peak at over 1000ms. The logs are of little help, as the errors seem to occur randomly, or at least the pattern does not appear related to the actions being called or data being accessed. Could I alleviate the error by adding additional mongrel instances? Or are the mySQL connections limited by the server, and thus unrelated to the number of processes I divide my traffic across? Is this most likely a problem with my coding, or should I be pressing my host for more capacity/less load on the shared server?
