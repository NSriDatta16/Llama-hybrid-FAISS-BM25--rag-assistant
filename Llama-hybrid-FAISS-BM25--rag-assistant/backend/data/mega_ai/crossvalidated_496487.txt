[site]: crossvalidated
[post_id]: 496487
[parent_id]: 
[tags]: 
Detect spans of consecutive values with average over certain limit

I have weekly data for volume of product ordered by any customer. I want to identify the longest span of consecutive weeks such that the average of that span is >= 33,000 (approximate; up to -2000 under would be okay too). There can be multiple distinct spans. Spans must be at least 4 weeks long . A dummy dataset is given below in r . The expected output for this dataset is span 17-32 and span 45-48 as highlighted by the green line. Span 1-2 is not good as it's not at least 4 weeks long. I need to do thousands of datasets and was wondering if there's a good algorithm to help with this. I feel hierarchical clustering or DBSCAN might be useful here but I couldn't get the right results. set.seed(1) df $vol, names.arg = df$ week)
