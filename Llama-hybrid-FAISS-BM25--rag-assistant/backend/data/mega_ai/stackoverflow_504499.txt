[site]: stackoverflow
[post_id]: 504499
[parent_id]: 
[tags]: 
What's a simple ParentAdapter implementation look like?

I'm trying to write a ParentAdapter implementation; I'm interested in providing design-time support for some WPF controls I'm writing and this is how you manage custom logic for reparenting items to different container controls. I started small, with the notion of creating a StackPanel -derived class that would only allow Button elements to be parented at design-time (yes, I'm aware the panel itself needs code to support this as well.) I started with what I figured would be the simplest the ParentAdapter could be: using System; using System.Windows; using System.Windows.Controls; using Microsoft.Windows.Design.Interaction; using Microsoft.Windows.Design.Model; namespace ControlLibrary.Design { internal class SimplePanelParentAdapter : ParentAdapter { public override bool CanParent(ModelItem parent, Type childType) { return (childType == typeof(Button)); } // moves the child item into the target panel; in this case a SimplePanel public override void Parent(ModelItem newParent, ModelItem child) { using (ModelEditingScope undoContext = newParent.BeginEdit()) { // is this correct? //child.Content.SetValue("I'm in a custom panel!"); SimplePanel pnl = newParent.GetCurrentValue() as SimplePanel; pnl.Children.Add(child.GetCurrentValue() as UIElement); undoContext.Complete(); } } public override void RemoveParent(ModelItem currentParent, ModelItem newParent, ModelItem child) { // No special things need to be done, right? child.Content.SetValue("I was in a custom panel."); } } } When I work with this at design-time, as soon as I drag a button over my custom panel, a NullReferenceException is thrown from deep within the VS code. My code is not throwing the exception, because I can step all the way through my method; the call stack indicates that code in Microsoft.Windows.Design.Developer.dll is throwing the exception. Obviously I'm doing something incorrectly, but the documentation provides no examples and my search-fu seems to indicate that either no one is trying this or anyone who is trying it isn't talking about it. Does anyone have suggestions?
