[site]: crossvalidated
[post_id]: 103849
[parent_id]: 
[tags]: 
Computing inverse probability weights -- conditional (multivariate) density estimation?

The general version: I need to estimate $f(A | X)$ where $A$ and $X$ are continuous and multivariate. I'd rather do it nonparametrically because I don't have a good functional form in mind and $\hat{f}(A | X)$ needs to be something like unbiased. I wanted to use a conditional kernel density estimator, but I realized I would need to quantize $X$ first. Then I had the idea to estimate $\hat{f}(A , X)$ and $\hat{f}(X)$ from the data and use that to compute $\hat{f}(A | X)$, or maybe I read it somewhere and don't remember where. Is there a reason this procedure wouldn't be valid? Is there a better or more honest approach than kernel density? Also, is there an issue with estimating population densities from sample densities nonparametrically? The data is survey data, and I have survey weights; should I incorporate them somehow? The case-specific version: It's probably worth mentioning that I'm going to use these estimates for inverse probability-of-treatment weights in a marginal structural model, as in Robins (2000) ( ungated PDF ). I observe a sequence of "treatments" $\{a_t\}_{t=0}^{4}$ and a sequence of time-varying confounders $\{x_t\}_{t=0}^{4}$ with respect to some outcome $\tilde{y}$ that occurs at $t=T+1$. I've hypothesized a simple parametric causal relationship, $E[\tilde{Y} | \vec{a}]=\beta'\vec{a}$, but since there's a time-varying confounder $\beta$ is a biased estimate of the "average treatment effect," and the confounder can't be added as a regressor because it's on the causal path and that will also bias $\beta$. Fortunately Doc Robins figured out that I can get unbiased/unconfounded and reasonably efficient estimates if I re-weight my observations by: $$ w_i = \prod_{s=0}^{4} \frac{ f(a_s | a_{s My question: That sequence of weights is really what I need an estimate for. Robins recommends logistic regression. But $a_t$ lies in $[0,\infty)^7$, is measured on $\{0,\dots\}^{7}$, and for all practical purposes lies in a finite subset thereof. $x_t$ lies in a closed interval, but only because it's really the mean of a few variables, each measured on a finite subset of $\{0,\dots,12\}$. So I had a few ideas: Estimate $f(a_t, a_{s Estimate $f(a_t | a_{s Estimate $f(x_{t-1}|a_t,a_{s Something actually coherent and honest in propagating uncertainty, that I obviously haven't thought of. Bayes? I do know Stan and JAGS, but MCMC will probably explode my computer (I don't want to deal with EC2). I haven't found any hints in the literature, since multivariate treatments are rare in causal modeling. What should I do? Bonus points: how do you feel about the notation $a_{s
