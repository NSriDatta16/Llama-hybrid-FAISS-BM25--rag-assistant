[site]: crossvalidated
[post_id]: 59161
[parent_id]: 
[tags]: 
Causal models in pymc3

I'm trying to fit a causal model. Participants in a task are trained on the model then asked for their belief in all the joints over the variables (e.g., what are the chances of observing an item with cause_1 and effect present and cause_2 absent?) I want to infer people's beliefs in the strengths of two causes, as well as various other beliefs (background causes of the effect, likelihood of the causes, etc.). This is a very simplistic model to get my toes wet. My specification is as follows: # Common effect model with 2 causes (c1 and c2) causing an effect e. # Causes combine using a 'noisy or' rule: two causes independently bring about the effect with probability m. # r is the likelihood of the causes. # bg is the probability of the effect coming about without a cause. ncauses = 2 nvars = ncauses + 1 joints = np.array([[c1, c2, e] for c1 in [0, 1] for c2 in [0, 1] for e in [0, 1]]) resps = (np.array([10.0, 1.0, 3.0, 10.0, 4.0, 10.0, 4.0, 11.0])-1)/10 # converting from their 11-point scale. def noisy_or(r, m, bg): pc = switch(joints[:,:-1], r, 1-r) pe_absent = (1-bg) * prod(1-r*m) pe = switch(joints[:,-1], 1-pe_absent, pe_absent) return prod(pc, axis=1) * pe def beta_recoded(name, ratio, confidence, **kwargs): beta = confidence / (ratio+1) alpha = confidence - beta return Beta(name, alpha=alpha, beta=beta, **kwargs) with Model() as model: r = Beta('r', alpha=1, beta=1, shape=(1, ncauses)) m = Beta('m', alpha=1, beta=1, shape=(1, ncauses)) bg = Beta('bg', alpha=1, beta=1) pjoints = noisy_or(r, m, bg) ratings = beta_recoded('ratings', pjoints, 5, observed=resps) With this setup, find_MAP chokes. Did I do things reasonably? One of the weird things is that when calculating the probability of each of the joints, there's a sort of if-then structure (if var is absent, we want 1-p, else p) which I turned into abs(is_absent-p), I wasn't sure what was the most elegant way to do that. EDIT: this has been fixed using switch. EDIT: pymc3 appears to require the development version of Theano in git.
