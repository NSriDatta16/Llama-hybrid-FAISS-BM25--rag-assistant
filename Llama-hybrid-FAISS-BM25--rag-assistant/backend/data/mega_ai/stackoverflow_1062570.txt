[site]: stackoverflow
[post_id]: 1062570
[parent_id]: 1059514
[tags]: 
Your problem is that when you do: then you do it in the context of the or you are currently handling. This means that position() will tell you the position of those elements . It cannot magically know that you are interested in the position of the first that matches the current one. And this means you must iterate all s much the same way you do it to calculate the attribute @id : Note the use of to make sure that the variable eventually contains only one value, even though you are looking through all of them. For larger documents, you could introduce another key: and use that as a drop-in replacement for all the comparatively inefficient " //ORGANISATION " expressions, e.g. instead of: use:
