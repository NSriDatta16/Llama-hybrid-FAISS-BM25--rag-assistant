[site]: stackoverflow
[post_id]: 4210548
[parent_id]: 
[tags]: 
qt: QTreeView - limit drag and drop to only happen within a particlar grandparent (ancestor)

I have a QTreeView in which I have implemented drag and drop to allow the re-ordering of items. GIven the following example of a tree: Food Anything marked as draggable may be dragged. Anything marked as parentable may have a draggable item as a child. Anything marked fixed is, well, fixed. My question is, how would I go about limiting the dropping of an item to stay within a particular parent? For example, I could drag 'bloodOrange' and make it a child of 'apple' or 'orange' (or even just change its ordinal position inside of 'Fruit'), but I should not be able to make it a child of carrots or lettuce etc. I've managed to correctly code the flags for everything except the part that limits a drop operation to stay within a particular parent. I just don't know how to capture the currently dragged QModelIndex (from which I can determine parent, grandparent, etc.) Thanks! Here is my code for the flags method in case it helps: Note: I refer to the top level children as Nodes (i.e. 'Food'), the next level as Groups (i.e. 'Fruit'), and the final two levels (i.e. lettuce and icebergLettuce) are both Params. #--------------------------------------------------------------------------- def flags(self, index): """ Returns whether or not the current item is editable/selectable/etc. """ if not index.isValid(): return QtCore.Qt.ItemIsEnabled #by default, you can't do anything enabled = QtCore.Qt.NoItemFlags selectable = QtCore.Qt.NoItemFlags editable = QtCore.Qt.NoItemFlags draggable = QtCore.Qt.NoItemFlags droppable = QtCore.Qt.NoItemFlags #get a pointer to the referenced object item = index.internalPointer() #only 'valid' cells may be manipulated ('valid' is defined by the obj) if item.column_is_valid(index.column()): #all valid cells are selectable and enabled selectable = QtCore.Qt.ItemIsSelectable enabled = QtCore.Qt.ItemIsEnabled #column 0 cells may occasionally be dragged and dropped if index.column() == 0: #drag/drop is only possible if it is a param... if item.get_obj_type() == 'param': #...and then only child-less params may be dragged... if item.get_child_count() == 0: draggable = QtCore.Qt.ItemIsDragEnabled #...and only params with a group as parent may be dropped on if item.get_parent().get_obj_type() == "group": droppable = QtCore.Qt.ItemIsDropEnabled #all other valid columns > 0 may be edited (no drag or drop) else: editable = QtCore.Qt.ItemIsEditable #return our flags. return enabled | selectable| editable| draggable| droppable
