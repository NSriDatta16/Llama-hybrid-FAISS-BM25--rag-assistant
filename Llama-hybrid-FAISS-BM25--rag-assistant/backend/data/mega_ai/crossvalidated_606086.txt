[site]: crossvalidated
[post_id]: 606086
[parent_id]: 606076
[tags]: 
How could they possibly be different? The two sandwich estimators are estimators for different semiparametric models. The individual-observation one is for a model where observations are all independent. The aggregated one is for a model where groups are all independent. Those are different assumptions. Since this is all frequentist, the standard errors describe how $\hat\beta$ would vary in replicates of the data set, and while for any specific data set the $\hat\beta$ is the same in the two models, the set of replicate data sets you need to consider is different. If the mean model is correctly specified and also the observations really are independent, I think the two sandwich estimators are consistent for the same true variance. But if the mean model isn't correctly specified, it matters whether there's really just one observation per covariate pattern or many observations per covariate pattern. In ANOVA terms, the model with aggregated data has the interaction confounded with the residual error, and the model with individual observations doesn't. Another way of saying the same thing is to think about bootstraps. The sandwich estimator can be seen as an approximation to the bootstrap. The sandwich estimator in the offset model is approximating a bootstrap that resamples whole groups; the one in the individual model is approximating a bootstrap that resamples individual observations. We can verify that the grouping in the sandwich estimator is the issue, by using a clustered sandwich estimator on the individual-level data, thus assuming only cluster-level independence in both settings. The results are now the same (they aren't the same as either of the previous estimators, but they could be if I'd worked on choosing the same versions of the estimators: the offset_fit one differs from vcovHC(offset_fit, type="HC0") by a degrees-of-freedom factor of 1.14) > unit_data$cluster vcovCL(fit, cluster=as.numeric(unit_data$cluster)) (Intercept) treatmentB gb gc gd (Intercept) 1.91e-04 -9.85e-05 -1.42e-04 -1.44e-04 -1.41e-04 treatmentB -9.85e-05 1.99e-04 -1.70e-06 3.95e-06 -2.09e-06 gb -1.42e-04 -1.70e-06 4.06e-04 1.42e-04 1.42e-04 gc -1.44e-04 3.95e-06 1.42e-04 2.33e-04 1.42e-04 gd -1.41e-04 -2.09e-06 1.42e-04 1.42e-04 6.72e-04 > vcovCL(offset_fit, cluster=NULL) (Intercept) treatmentB gb gc gd (Intercept) 1.91e-04 -9.85e-05 -1.42e-04 -1.44e-04 -1.41e-04 treatmentB -9.85e-05 1.99e-04 -1.70e-06 3.95e-06 -2.09e-06 gb -1.42e-04 -1.70e-06 4.06e-04 1.42e-04 1.42e-04 gc -1.44e-04 3.95e-06 1.42e-04 2.33e-04 1.42e-04 gd -1.41e-04 -2.09e-06 1.42e-04 1.42e-04 6.72e-04 So the issue genuinely is about what units are independent, and it's not a coding error Who's right? The individual-observation model is definitely right, because it actually describes how the data were collected. So either they are both right, or the individual-level model is right and the aggregate model is wrong. I'm inclined to say that the aggregate model is wrong: that the hypothetical replicates it calculates the variance over are not the relevant set of hypothetical replicates. An improvement? The usual sandwich estimator estimates the variance of the score function using an empirical variance: it has to, the point is to not assume any distribution for $Y|X$ . In this setting, though, we have a distribution for the individual $Y$ ; they're Bernoulli. It wouldn't be unreasonable to calculate the variance assuming the mean model is correct; that's what we'd routinely do for Poisson regression or logistic regression. So it would be possible to work out an estimator for the middle of the sandwich (the variability matrix) that's based on the Bernoulli distribution of $Y$ , while keeping the usual estimator for the outside of the sandwich (the sensitivity matrix). In maximum likelihood estimation this is kind of pointless, because the sensitivity matrix is just the inverse of the variability matrix and the whole thing collapses back to the model-based estimate. For a binomial model and the working Poisson estimator it could make more sense. Further Research Is Needed.
