[site]: stackoverflow
[post_id]: 4250403
[parent_id]: 4250100
[tags]: 
This is some VB code we use, it provides enougth info for us to diagnose most problems. Only downside with emailing errors like this is when there is a major failure you can end up with thousands of messages in your mailbox :( Dim e As Exception If System.Web.HttpContext.Current.Request.IsLocal Then Exit Sub e = System.Web.HttpContext.Current.Server.GetLastError If e IsNot Nothing Then If TypeOf e Is HttpException Then Dim he As HttpException = DirectCast(e, HttpException) If he.GetHttpCode=404 Then System.Web.HttpContext.Current.Server.ClearError() Response.Redirect("/") Exit Sub End If End If MsgBody += "Exception: " & e.Message & vbCrLf & vbCrLf MsgBody += e.ToString & vbCrLf & vbCrLf & vbCrLf Else MsgBody += "Unknown Error" & vbCrLf & vbCrLf & vbCrLf End If If System.Web.HttpContext.Current.Request.Url Is Nothing Then MsgBody += "URL: ?" & vbCrLf & vbCrLf Else MsgBody += "URL: " & System.Web.HttpContext.Current.Request.Url.ToString & vbCrLf If System.Web.HttpContext.Current.Request.RawUrl IsNot Nothing Then MsgBody += System.Web.HttpContext.Current.Request.RawUrl & vbCrLf MsgBody += vbCrLf End If If System.Web.HttpContext.Current.Request.UrlReferrer Is Nothing Then MsgBody += "Referer: " & vbCrLf & vbCrLf Else MsgBody += "Referer: " & System.Web.HttpContext.Current.Request.UrlReferrer.ToString() & vbCrLf & vbCrLf End If If User IsNot Nothing Then MsgBody += "User: " & User.Identity.Name & vbCrLf MsgBody += "User-Agent: " & System.Web.HttpContext.Current.Request.UserAgent & vbCrLf MsgBody += "User-IP: " & System.Web.HttpContext.Current.Request.UserHostAddress & vbCrLf MsgBody += "Server: " & System.Environment.MachineName & vbCrLf MsgBody += vbCrLf & "RequestType: " & System.Web.HttpContext.Current.Request.RequestType() & vbCrLf & vbCrLf ' dump request items ' QueryString, Form, Cookies, ServerVariables MsgBody += "Querystring Variables ================" & vbCrLf If Request.QueryString.Count > 0 Then For Each key As String In Request.QueryString.Keys MsgBody += key & " = " & Request.QueryString(key) & vbCrLf Next Else MsgBody += "(none)" & vbCrLf End If MsgBody += vbCrLf MsgBody += "Form Variables =======================" & vbCrLf If Request.Form.Count > 0 Then For Each key As String In Request.Form.Keys MsgBody += key & " = " & Request.Form(key) & vbCrLf Next Else MsgBody += "(none)" & vbCrLf End If MsgBody += vbCrLf MsgBody += "Cookies ==============================" & vbCrLf If Request.Cookies.Count > 0 Then For Each key As String In Request.Cookies.Keys MsgBody += key & " = " & Request.Cookies(key).Value & vbCrLf Next Else MsgBody += "(none)" & vbCrLf End If MsgBody += vbCrLf MsgBody += "ServerVariables ======================" & vbCrLf If Request.ServerVariables.Count > 0 Then For Each key As String In Request.ServerVariables.Keys MsgBody += key & " = " & Request.ServerVariables(key) & vbCrLf Next Else MsgBody += "(none)" & vbCrLf End If MsgBody += vbCrLf ' we send MsgBody via email using the System.Net.Mail.MailMessage & System.Net.Mail.SmtpClient classes ' we've handled the error System.Web.HttpContext.Current.Server.ClearError() ' depending on the error we redirect to our homepage /default.aspx unless that is the faulting page then redirect to static /error.html
