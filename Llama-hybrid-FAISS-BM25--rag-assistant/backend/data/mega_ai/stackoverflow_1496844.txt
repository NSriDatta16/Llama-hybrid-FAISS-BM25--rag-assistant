[site]: stackoverflow
[post_id]: 1496844
[parent_id]: 
[tags]: 
how can i get get the MACaddress of all the NICs on my PC using WMI

HI all, I am trying to modify the code provided by MS try to access the the Network Adapter Configuration I am getting null pointer exception in it when i try to access the Mac Address or IPAddress property im using VC++ 2005. check for the // exception here: vtProp is returned as NULL line where am getting the exception. #define _WIN32_DCOM #include "stdafx.h" #include using namespace std; #include #include # pragma comment(lib, "wbemuuid.lib") #pragma comment(lib, "comsuppw.lib") int _tmain(int argc, _TCHAR* argv[]) { HRESULT hres; // Step 1: -------------------------------------------------- // Initialize COM. ------------------------------------------ hres = CoInitializeEx(0, COINIT_MULTITHREADED); if (FAILED(hres)) { cout ConnectServer( _bstr_t(L"ROOT\\CIMV2"), // Object path of WMI namespace NULL, // User name. NULL = current user NULL, // User password. NULL = current 0, // Locale. NULL indicates current NULL, // Security flags. 0, // Authority (e.g. Kerberos) 0, // Context object &pSvc // pointer to IWbemServices proxy ); if (FAILED(hres)) { cout Release(); CoUninitialize(); return 1; // Program has failed. } cout Release(); pLoc->Release(); CoUninitialize(); return 1; // Program has failed. } // Step 6: -------------------------------------------------- // Use the IWbemServices pointer to make requests of WMI ---- // For example, get the name of the operating system IEnumWbemClassObject* pEnumerator = NULL; hres = pSvc->ExecQuery( bstr_t("WQL"), bstr_t("SELECT * FROM Win32_NetworkAdapterConfiguration"), WBEM_FLAG_FORWARD_ONLY | WBEM_FLAG_RETURN_IMMEDIATELY, NULL, &pEnumerator); if (FAILED(hres)) { cout Release(); pLoc->Release(); CoUninitialize(); return 1; // Program has failed. } // Step 7: ------------------------------------------------- // Get the data from the query in step 6 ------------------- IWbemClassObject *pclsObj; ULONG uReturn = 0; while (pEnumerator) { HRESULT hr = pEnumerator->Next(WBEM_INFINITE, 1, &pclsObj, &uReturn); if(0 == uReturn) { break; } VARIANT vtProp; // Get the value of the Name property //hr = pclsObj->Get(L"Caption", 0, &vtProp, 0, 0); // wcout Release(); hr = pclsObj->Get(L"MACAddress", 0, &vtProp, 0, 0); // exception here: vtProp is returned as NULL wcout Release(); } // Cleanup // ======== pSvc->Release(); pLoc->Release(); pEnumerator->Release(); // pclsObj->Release(); CoUninitialize(); return 0; // Program successfully completed. } what is wrong in the code?? Abdul khaliq
