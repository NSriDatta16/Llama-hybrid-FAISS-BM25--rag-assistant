[site]: stackoverflow
[post_id]: 905052
[parent_id]: 
[tags]: 
ClassFormatError using JMockit with EMMA

I am trying to use EMMA to measure coverage of some JUnit tests that use JMockit. But when I try to run the JMockit tests after instrumenting with EMMA, about a quarter of the tests fail with the following error: com.logstorage.engine.sensor.SensorManagerTest.setUpBeforeClass(SensorManagerTest.java:98) java.lang.ClassFormatError at sun.instrument.InstrumentationImpl.redefineClasses0(Native Method) at sun.instrument.InstrumentationImpl.redefineClasses(InstrumentationImpl.java:150) at mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:152) at mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:139) at mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:73) at mockit.Mockit.setUpMock(Mockit.java:235) at com.myapp.MyTest.setUpBeforeClass(MyTest.java:98) I can't see any pattern as to which tests fail and which don't. I guess this is just a bug in JMockit, but does anybody know a workaround? I found a very similar question called "Getting ClassFormatError with EMMA?" but the solution doesn't work for me (I'm not using any reentrant=true mock methods). Any other ideas? Thanks in advance.
