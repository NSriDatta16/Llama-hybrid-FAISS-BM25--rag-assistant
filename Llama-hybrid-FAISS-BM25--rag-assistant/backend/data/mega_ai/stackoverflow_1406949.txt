[site]: stackoverflow
[post_id]: 1406949
[parent_id]: 1394197
[tags]: 
To ensure the routine works on both 32 and 64 bit systems, you need to do a little extra checking. In cases like these, I use reflector to have a look at how the framework implements the pinvokes. In particular, have a look at System.Windows.Forms.SafeNativeMethods and System.Windows.Forms.UnSafeNativeMethods. Below is the code I use which takes advantage of extension methods. 'See: System.Windows.Forms.SafeNativeMethods.SetWindowPos _ Private Function SetWindowPos(ByVal hWnd As HandleRef, ByVal hWndInsertAfter As HandleRef, ByVal x As Integer, ByVal y As Integer, ByVal cx As Integer, ByVal cy As Integer, ByVal flags As Integer) As Boolean End Function 'See: System.Windows.Forms.UnSafeNativeMethods.GetWindowLong* _ Private Function GetWindowLong32(ByVal hWnd As HandleRef, ByVal nIndex As Integer) As IntPtr End Function _ Private Function GetWindowLongPtr64(ByVal hWnd As HandleRef, ByVal nIndex As Integer) As IntPtr End Function Private Function GetWindowLong(ByVal hWnd As HandleRef, ByVal nIndex As Integer) As IntPtr If (IntPtr.Size = 4) Then Return GetWindowLong32(hWnd, nIndex) End If Return GetWindowLongPtr64(hWnd, nIndex) End Function 'See: System.Windows.Forms.UnSafeNativeMethods.SetWindowLong* _ Private Function SetWindowLongPtr32(ByVal hWnd As HandleRef, ByVal nIndex As Integer, ByVal dwNewLong As HandleRef) As IntPtr End Function _ Private Function SetWindowLongPtr64(ByVal hWnd As HandleRef, ByVal nIndex As Integer, ByVal dwNewLong As HandleRef) As IntPtr End Function Private Function SetWindowLong(ByVal hWnd As HandleRef, ByVal nIndex As Integer, ByVal dwNewLong As HandleRef) As IntPtr If (IntPtr.Size = 4) Then Return SetWindowLongPtr32(hWnd, nIndex, dwNewLong) End If Return SetWindowLongPtr64(hWnd, nIndex, dwNewLong) End Function 'See: System.Windows.Forms.Control.SetWindowStyle Private Sub SetWindowStyle(ByVal form As Form, ByVal flag As Integer, ByVal value As Boolean) Dim windowLong As Integer = CInt(CLng(GetWindowLong(New HandleRef(form, form.Handle), -16))) Dim ip As IntPtr If value Then ip = New IntPtr(windowLong Or flag) Else ip = New IntPtr(windowLong And Not flag) End If SetWindowLong(New HandleRef(form, form.Handle), -16, New HandleRef(Nothing, ip)) End Sub _ Public Sub ShowCaption(ByVal form As Form) SetWindowStyle(form, &H400000, True) ApplyStyleChanges(form) End Sub _ Public Sub HideCaption(ByVal form As Form) SetWindowStyle(form, &H400000, False) ApplyStyleChanges(form) End Sub _ Public Function ApplyStyleChanges(ByVal form As Form) As Boolean Return SetWindowPos(New HandleRef(form, form.Handle), NullHandleRef, 0, 0, 0, 0, &H37) End Function
