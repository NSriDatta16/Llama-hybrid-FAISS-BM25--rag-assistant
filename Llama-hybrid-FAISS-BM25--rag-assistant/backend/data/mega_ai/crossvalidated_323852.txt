[site]: crossvalidated
[post_id]: 323852
[parent_id]: 
[tags]: 
Standartized residuals of generalized nonlinear least square model (gnls) with R 'by Hand'

I want to fit a nonlinear model by using generalized least squares regression with the function gnls of the package nlme of R. Thereby, the residuals of the fit show heteroscedasticity and autocorrelation, why I want to include, e.g., the varPower() variance structure and the corAR1() correlation structure in the regression. For model diagnostics I would like to plot the fitted values against the standardized residuals. As far as I see, there is no standard routine available for the gnls function to produce this plot or to calculate the standardized residuals automatically. This is why I try to do it manually. In contrast, for the gls function, the plot fitted values against standardized residuals is available. Because of this I produced an example with the gls function and try to calculate the standardized residuals manually, which actually doesn't work. For calculating the standardized residuals I used the following method which works for linear models, but not for the gls with the varPower() variance structure. \begin{align} r_i &= \frac{e_i}{\sqrt{MSE(1-h_{ii})}} \\[5pt] h_{ii} &= \frac{1}{n} + \frac{(x_i - \bar x)^2}{SS_x} \end{align} Here is an example dataset with heteroscedasticity and a fitted gls : x_gls I get the diagnostics plot with fitted values against standardized residuals by: plot(fit_gls1) a similar plot I get by manually calculating the standardized residuals resid_gls1 = fit_gls1$residuals mse_gls1 = fit_gls1$sigma**2 n_gls1 = length(x_gls) leverage_gls1 = 1/n*(x_gls-mean(x_gls))**2/(sum(x_gls-mean(x_gls)**2)) standres_gls1 = resid_gls1/(sqrt(mse_gls1*(1-leverage_gls1)) plot(fit_gls1$fitted, standres_gls1) If I now use the varPower() variance structure for gls model, I am not able to reproduce the standardized residuals: fit_gls2 = gls(y_gls~x_gls, weights=varPower(form=~x_gls)) plot(fit_gls2) Standardized residuals calculated manually with the same procedure like before look quite different: resid_gls2 = fit_gls2$residuals mse_gls2 = fit_gls2$sigma**2 n_gls2 = length(x_gls) leverage_gls2 = 1/n*(x_gls-mean(x_gls))**2/(sum(x_gls-mean(x_gls)**2)) standres_gls2 = resid_gls2/(sqrt(mse_gls2*(1-leverage_gls2))) plot(fit_gls2$fitted, standres_gls2) So how can I calculate the standardized residuals manually? I need to calculate them for a gnls model, where there exist no automated diagnostic plots (at least as far as I know...). I think I need to incorporate the varPower() variance structure, but how? And what about if I also want to incorporate a corAR1() correlation structure?
