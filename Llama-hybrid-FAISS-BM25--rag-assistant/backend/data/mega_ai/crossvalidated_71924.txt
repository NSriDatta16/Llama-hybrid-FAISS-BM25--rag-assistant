[site]: crossvalidated
[post_id]: 71924
[parent_id]: 
[tags]: 
Replicating bgtest from lmtest

Cross-posted from SO. I am trying to replicate the results of bgtest from the lmtest R package. I am using the following dataset: rs month r20 1 2.365042 1952m3 4.33 2 2.317500 1952m4 4.23 3 2.350833 1952m5 4.36 4 2.451833 1952m6 4.57 5 2.466167 1952m7 4.36 6 2.468417 1952m8 4.11 7 2.485583 1952m9 4.20 8 2.415125 1952m10 4.19 9 2.389875 1952m11 4.15 10 2.418167 1952m12 4.22 11 2.396042 1953m1 4.13 12 2.401042 1953m2 4.10 13 2.400833 1953m3 4.04 14 2.383500 1953m4 3.94 15 2.366708 1953m5 3.95 16 2.365625 1953m6 4.02 17 2.348583 1953m7 3.98 18 2.334375 1953m8 3.94 19 2.133542 1953m9 3.78 20 2.097375 1953m10 3.80 21 2.097708 1953m11 3.78 22 2.130583 1953m12 3.83 23 2.096000 1954m1 3.79 24 2.064042 1954m2 3.79 25 2.115083 1954m3 3.76 26 2.047333 1954m4 3.71 27 1.713875 1954m5 3.65 28 1.606167 1954m6 3.61 29 1.561667 1954m7 3.35 30 1.613292 1954m8 3.36 31 1.621083 1954m9 3.35 32 1.587667 1954m10 3.35 33 1.637792 1954m11 3.38 34 1.865917 1954m12 3.51 35 2.356417 1955m1 3.64 36 3.810000 1955m2 3.85 37 3.797000 1955m3 3.83 38 3.906000 1955m4 4.15 39 3.937000 1955m5 4.21 40 3.969000 1955m6 4.33 41 3.971000 1955m7 4.47 42 4.005000 1955m8 4.84 43 4.072000 1955m9 4.68 44 4.071000 1955m10 4.50 45 4.104000 1955m11 4.64 46 4.072000 1955m12 4.70 47 4.071000 1956m1 4.84 48 5.218000 1956m2 4.87 49 5.165000 1956m3 5.02 50 5.008000 1956m4 4.85 51 4.955000 1956m5 5.12 52 5.136000 1956m6 5.25 53 4.977000 1956m7 5.27 54 4.027000 1956m8 5.20 55 5.091000 1956m9 5.35 56 4.991000 1956m10 5.33 57 5.020000 1956m11 5.50 58 4.858000 1956m12 5.29 59 4.553000 1957m1 4.91 60 4.148000 1957m2 4.93 61 4.099000 1957m3 5.08 62 3.914000 1957m4 5.11 63 3.921000 1957m5 5.43 64 3.854000 1957m6 5.55 65 3.845000 1957m7 5.60 66 4.121000 1957m8 5.75 67 6.605000 1957m9 5.98 68 6.603000 1957m10 5.84 69 6.459000 1957m11 5.89 70 6.375000 1957m12 5.81 71 6.127000 1958m1 5.66 72 6.014000 1958m2 5.65 73 5.523000 1958m3 5.64 74 5.179000 1958m4 5.45 75 4.816000 1958m5 5.46 76 4.294000 1958m6 5.45 77 4.159000 1958m7 5.46 78 3.760000 1958m8 5.49 79 3.625000 1958m9 5.36 80 3.584000 1958m10 5.35 81 3.305000 1958m11 5.36 82 3.152000 1958m12 5.36 83 3.107000 1959m1 5.20 84 3.276000 1959m2 5.20 85 3.287000 1959m3 5.24 86 3.283000 1959m4 5.22 87 3.382000 1959m5 5.28 88 3.452000 1959m6 5.18 89 3.484000 1959m7 5.13 90 3.488000 1959m8 5.21 91 3.472000 1959m9 5.33 92 3.386000 1959m10 5.06 93 3.400000 1959m11 5.04 94 3.687000 1959m12 5.21 95 4.538000 1960m1 5.34 96 4.554000 1960m2 5.43 97 4.621000 1960m3 5.53 98 4.652000 1960m4 5.59 99 4.556000 1960m5 5.62 100 5.681000 1960m6 5.92 101 5.546000 1960m7 5.97 102 5.588000 1960m8 5.95 103 5.565000 1960m9 5.97 104 5.090000 1960m10 5.97 105 4.639000 1960m11 5.97 106 4.349000 1960m12 6.01 107 4.165000 1961m1 6.01 108 4.399000 1961m2 6.04 109 4.485000 1961m3 6.05 110 4.407000 1961m4 6.01 111 4.436000 1961m5 6.08 112 4.537000 1961m6 6.33 113 6.688000 1961m7 6.52 114 6.700000 1961m8 6.63 115 6.552000 1961m9 6.65 116 5.727000 1961m10 6.33 117 5.389000 1961m11 6.34 118 5.403000 1961m12 6.41 119 5.242000 1962m1 6.35 120 5.531000 1962m2 6.26 121 4.405000 1962m3 6.25 122 4.052000 1962m4 6.24 123 3.816000 1962m5 6.25 124 3.921000 1962m6 6.24 125 3.887000 1962m7 5.98 126 3.752000 1962m8 5.77 127 3.635000 1962m9 5.27 128 3.858000 1962m10 5.37 129 3.689000 1962m11 5.42 130 3.717000 1962m12 5.36 131 3.491000 1963m1 5.54 132 3.426000 1963m2 5.74 133 3.756000 1963m3 5.69 134 3.709000 1963m4 5.50 135 3.635000 1963m5 5.31 136 3.702000 1963m6 5.28 137 3.761000 1963m7 5.20 138 3.723000 1963m8 5.22 139 3.674000 1963m9 5.21 140 3.745000 1963m10 5.26 141 3.739000 1963m11 5.51 142 3.721000 1963m12 5.63 143 3.758000 1964m1 5.64 144 4.307000 1964m2 5.85 145 4.302000 1964m3 5.76 146 4.302000 1964m4 5.93 147 4.384000 1964m5 5.90 148 4.464000 1964m6 5.97 149 4.654000 1964m7 6.02 150 4.656000 1964m8 6.00 151 4.703000 1964m9 6.00 152 4.698000 1964m10 6.06 153 6.630000 1964m11 6.23 154 6.627000 1964m12 6.41 155 6.543000 1965m1 6.41 156 6.442000 1965m2 6.43 157 6.549000 1965m3 6.53 158 6.375000 1965m4 6.61 159 6.364000 1965m5 6.76 160 5.542000 1965m6 6.78 161 5.630000 1965m7 6.80 162 5.559000 1965m8 6.65 163 5.559000 1965m9 6.35 164 5.440000 1965m10 6.37 165 5.395000 1965m11 6.40 166 5.521000 1965m12 6.59 167 5.483000 1966m1 6.52 168 5.620000 1966m2 6.61 169 5.604000 1966m3 6.77 170 5.638000 1966m4 6.78 171 5.659000 1966m5 6.82 172 5.728000 1966m6 7.03 173 6.679000 1966m7 7.29 174 6.726000 1966m8 7.41 175 6.747000 1966m9 7.29 176 6.513000 1966m10 6.96 177 6.738000 1966m11 6.97 178 6.527000 1966m12 6.78 179 6.080000 1967m1 6.58 180 6.035000 1967m2 6.49 181 5.495000 1967m3 6.50 182 5.412000 1967m4 6.46 183 5.248000 1967m5 6.65 184 5.275000 1967m6 6.86 185 5.345000 1967m7 6.92 186 5.291000 1967m8 6.90 187 5.475000 1967m9 6.98 188 5.726000 1967m10 7.00 189 7.553000 1967m11 7.22 190 7.484000 1967m12 7.20 191 7.520000 1968m1 7.28 192 7.374000 1968m2 7.28 193 7.108000 1968m3 7.29 194 7.080000 1968m4 7.34 195 7.241000 1968m5 7.50 196 7.242000 1968m6 7.87 197 7.059000 1968m7 7.63 198 6.945000 1968m8 7.63 199 6.577000 1968m9 7.64 200 6.493000 1968m10 7.70 201 6.789000 1968m11 7.93 202 6.777000 1968m12 8.17 203 6.728000 1969m1 8.47 204 7.711000 1969m2 8.61 205 7.782000 1969m3 8.81 206 7.798000 1969m4 8.90 207 7.850000 1969m5 9.46 208 7.880000 1969m6 9.31 209 7.830000 1969m7 9.19 210 7.790000 1969m8 9.49 211 7.811000 1969m9 9.21 212 7.743000 1969m10 8.95 213 7.738000 1969m11 9.29 214 7.650000 1969m12 9.04 215 7.550000 1970m1 9.03 216 7.600000 1970m2 8.79 217 7.270000 1970m3 8.75 218 6.940000 1970m4 8.94 219 6.190000 1970m5 9.40 220 6.870000 1970m6 9.58 221 6.850000 1970m7 9.33 222 6.820000 1970m8 9.19 223 6.820000 1970m9 9.28 224 6.810000 1970m10 9.15 225 6.810000 1970m11 9.51 226 6.820000 1970m12 9.62 227 6.790000 1971m1 9.51 228 6.750000 1971m2 9.35 229 6.660000 1971m3 9.07 230 5.920000 1971m4 9.07 231 5.650000 1971m5 9.03 232 5.590000 1971m6 9.08 233 5.570000 1971m7 9.22 234 5.750000 1971m8 8.96 235 4.830000 1971m9 8.50 236 4.630000 1971m10 8.51 237 4.480000 1971m11 7.79 238 4.360000 1971m12 8.10 239 4.360000 1972m1 7.93 240 4.370000 1972m2 7.90 241 4.340000 1972m3 8.16 242 4.300000 1972m4 8.26 243 4.270000 1972m5 8.60 244 5.210000 1972m6 9.32 245 5.600000 1972m7 9.23 246 5.790000 1972m8 9.36 247 6.440000 1972m9 9.54 248 6.740000 1972m10 9.46 249 6.880000 1972m11 9.45 250 7.760000 1972m12 9.62 251 8.210000 1973m1 9.56 252 8.080000 1973m2 9.65 253 8.070000 1973m3 10.01 254 7.670000 1973m4 9.93 255 7.330000 1973m5 10.02 256 7.060000 1973m6 10.15 257 8.270000 1973m7 10.60 258 10.910000 1973m8 11.30 259 10.970000 1973m9 11.55 260 10.770000 1973m10 11.28 261 11.730000 1973m11 12.00 262 12.460000 1973m12 12.50 263 12.090000 1974m1 12.89 264 11.920000 1974m2 13.50 265 11.950000 1974m3 13.68 266 11.520000 1974m4 14.21 267 11.360000 1974m5 13.80 268 11.230000 1974m6 14.38 269 11.200000 1974m7 14.88 270 11.240000 1974m8 15.29 271 11.060000 1974m9 14.95 272 10.930000 1974m10 15.68 273 10.980000 1974m11 16.75 274 10.990000 1974m12 17.18 275 10.590000 1975m1 16.02 276 9.880000 1975m2 14.58 277 9.500000 1975m3 13.43 278 9.260000 1975m4 13.89 279 9.470000 1975m5 14.53 280 9.430000 1975m6 14.41 281 9.710000 1975m7 13.93 282 10.430000 1975m8 13.87 283 10.360000 1975m9 13.79 284 11.420000 1975m10 14.66 285 11.100000 1975m11 14.81 286 10.820000 1975m12 14.79 287 9.990000 1976m1 13.79 288 8.760000 1976m2 13.46 289 8.460000 1976m3 13.88 290 9.060000 1976m4 13.77 291 10.440000 1976m5 13.59 292 10.960000 1976m6 14.09 293 10.870000 1976m7 14.16 294 10.880000 1976m8 14.33 295 12.050000 1976m9 14.79 296 14.000000 1976m10 16.03 297 14.140000 1976m11 15.79 298 13.780000 1976m12 15.48 299 12.730000 1977m1 14.48 300 11.020000 1977m2 13.93 301 9.920000 1977m3 13.25 302 8.240000 1977m4 13.05 303 7.400000 1977m5 12.69 304 7.450000 1977m6 13.26 305 7.430000 1977m7 13.62 306 6.540000 1977m8 13.12 307 5.680000 1977m9 11.88 308 4.530000 1977m10 10.98 309 4.960000 1977m11 11.28 310 6.370000 1977m12 11.16 311 5.810000 1978m1 11.06 312 5.960000 1978m2 11.75 313 5.930000 1978m3 11.72 314 6.730000 1978m4 12.39 315 8.400000 1978m5 12.72 316 9.170000 1978m6 12.79 317 9.220000 1978m7 12.72 318 8.900000 1978m8 12.55 319 8.980000 1978m9 12.64 320 9.860000 1978m10 12.91 321 11.510000 1978m11 13.16 322 11.570000 1978m12 13.22 323 11.860000 1979m1 13.68 324 12.630000 1979m2 13.94 325 11.350000 1979m3 12.35 326 11.320000 1979m4 11.68 327 11.350000 1979m5 11.94 328 12.570000 1979m6 12.69 329 13.320000 1979m7 12.25 330 13.320000 1979m8 12.30 331 13.380000 1979m9 12.60 332 13.380000 1979m10 13.16 333 15.330000 1979m11 14.54 334 15.900000 1979m12 14.72 335 15.790000 1980m1 14.17 336 16.140000 1980m2 14.45 337 16.180000 1980m3 14.70 338 16.170000 1980m4 14.27 339 16.090000 1980m5 14.01 340 15.800000 1980m6 13.78 341 14.550000 1980m7 13.07 342 14.860000 1980m8 13.58 343 14.400000 1980m9 13.38 344 14.290000 1980m10 13.12 345 13.950000 1980m11 13.22 346 13.070000 1980m12 13.67 347 12.820000 1981m1 13.96 348 12.090000 1981m2 13.89 349 11.530000 1981m3 13.68 350 11.330000 1981m4 13.64 351 11.350000 1981m5 14.31 352 12.090000 1981m6 14.57 353 13.150000 1981m7 15.14 354 13.420000 1981m8 15.09 355 13.960000 1981m9 15.59 356 15.550000 1981m10 15.95 357 14.080000 1981m11 15.44 358 14.510000 1981m12 15.65 359 14.160000 1982m1 15.58 360 13.300000 1982m2 14.74 361 12.480000 1982m3 13.72 362 12.890000 1982m4 13.96 363 12.530000 1982m5 13.69 364 12.230000 1982m6 13.56 365 11.280000 1982m7 13.20 366 10.080000 1982m8 12.23 367 9.910000 1982m9 11.40 368 8.910000 1982m10 10.50 369 9.220000 1982m11 10.64 370 9.960000 1982m12 11.34 371 10.590000 1983m1 11.60 372 10.740000 1983m2 11.50 373 10.470000 1983m3 10.97 374 9.840000 1983m4 10.56 375 9.700000 1983m5 10.65 376 9.470000 1983m6 10.39 377 9.370000 1983m7 10.95 378 9.340000 1983m8 11.07 379 9.160000 1983m9 10.67 380 8.840000 1983m10 10.61 381 8.840000 1983m11 10.29 382 8.870000 1983m12 10.35 383 8.870000 1984m1 10.28 384 8.850000 1984m2 10.42 385 8.430000 1984m3 10.23 386 8.380000 1984m4 10.40 387 8.820000 1984m5 10.93 388 8.860000 1984m6 11.15 389 10.970000 1984m7 11.67 390 10.210000 1984m8 10.98 391 10.020000 1984m9 10.78 392 9.850000 1984m10 10.69 393 9.230000 1984m11 10.32 394 9.100000 1984m12 10.46 395 10.550000 1985m1 10.96 396 12.690000 1985m2 11.06 397 12.930000 1985m3 10.90 398 11.930000 1985m4 10.68 399 11.940000 1985m5 10.88 400 11.890000 1985m6 10.70 401 11.390000 1985m7 10.44 402 10.960000 1985m8 10.37 403 11.060000 1985m9 10.39 404 11.050000 1985m10 10.22 405 11.110000 1985m11 10.37 406 11.150000 1985m12 10.45 407 11.980000 1986m1 10.80 408 12.020000 1986m2 10.40 409 11.060000 1986m3 9.39 410 9.990000 1986m4 8.76 411 9.700000 1986m5 9.00 412 9.320000 1986m6 9.23 413 9.450000 1986m7 9.37 414 9.390000 1986m8 9.41 415 9.610000 1986m9 9.97 416 10.250000 1986m10 10.62 417 10.630000 1986m11 10.80 418 10.660000 1986m12 10.69 419 10.520000 1987m1 10.09 420 10.290000 1987m2 9.83 421 9.350000 1987m3 9.16 422 9.430000 1987m4 9.12 423 8.460000 1987m5 8.82 424 8.540000 1987m6 8.90 425 8.840000 1987m7 9.23 426 9.790000 1987m8 9.20 427 9.690000 1987m9 9.98 428 9.450000 1987m10 9.88 429 8.430000 1987m11 9.20 430 8.190000 1987m12 9.57 431 8.370000 1988m1 9.57 432 8.790000 1988m2 9.38 433 8.270000 1988m3 9.12 434 7.740000 1988m4 9.12 435 7.540000 1988m5 9.27 436 8.880000 1988m6 9.32 437 10.050000 1988m7 9.51 438 11.130000 1988m8 9.47 439 11.530000 1988m9 9.60 440 11.540000 1988m10 9.23 441 12.070000 1988m11 9.30 442 12.540000 1988m12 9.46 443 12.450000 1989m1 9.35 444 12.390000 1989m2 9.15 445 12.410000 1989m3 9.26 446 12.470000 1989m4 9.52 447 12.540000 1989m5 9.52 448 13.590000 1989m6 9.88 449 13.290000 1989m7 9.53 450 13.320000 1989m8 9.37 451 13.440000 1989m9 9.62 452 14.460000 1989m10 9.81 453 14.450000 1989m11 9.99 454 14.500000 1989m12 9.96 455 14.500000 1990m1 10.28 456 14.450000 1990m2 10.72 457 14.570000 1990m3 11.46 458 14.590000 1990m4 11.77 459 14.500000 1990m5 11.49 460 14.380000 1990m6 11.01 461 14.320000 1990m7 11.03 462 14.310000 1990m8 11.41 463 14.260000 1990m9 11.32 464 13.370000 1990m10 11.12 465 12.920000 1990m11 10.94 466 12.960000 1990m12 10.40 467 13.000000 1991m1 10.22 468 12.390000 1991m2 9.89 469 11.640000 1991m3 10.06 470 11.250000 1991m4 9.99 471 10.840000 1991m5 10.15 472 10.720000 1991m6 10.34 473 10.520000 1991m7 10.10 474 10.200000 1991m8 9.89 475 9.660000 1991m9 9.54 476 9.860000 1991m10 9.62 477 9.980000 1991m11 9.68 478 10.100000 1991m12 9.56 479 9.970000 1992m1 9.34 480 9.800000 1992m2 9.21 481 10.100000 1992m3 9.54 482 9.970000 1992m4 9.33 483 9.430000 1992m5 8.99 484 9.420000 1992m6 9.02 485 9.430000 1992m7 8.90 486 9.650000 1992m8 9.13 487 9.160000 1992m9 9.12 488 7.470000 1992m10 9.24 489 6.490000 1992m11 8.84 490 6.390000 1992m12 8.84 491 6.050000 1993m1 8.92 492 5.370000 1993m2 8.63 493 5.380000 1993m3 8.33 494 5.330000 1993m4 8.39 495 5.300000 1993m5 8.60 496 5.190000 1993m6 8.39 497 5.130000 1993m7 7.96 498 5.060000 1993m8 7.39 499 5.170000 1993m9 7.18 500 5.150000 1993m10 7.09 501 4.950000 1993m11 7.06 502 4.870000 1993m12 6.46 503 4.890000 1994m1 6.41 504 4.760000 1994m2 6.83 505 4.830000 1994m3 7.47 506 4.880000 1994m4 7.83 507 4.810000 1994m5 8.24 508 4.880000 1994m6 8.55 509 5.090000 1994m7 8.41 510 5.340000 1994m8 8.52 511 5.390000 1994m9 8.72 512 5.440000 1994m10 8.63 513 5.630000 1994m11 8.53 514 5.870000 1994m12 8.44 515 5.930000 1995m1 8.61 516 6.160000 1995m2 8.52 517 6.090000 1995m3 8.50 518 6.300000 1995m4 8.39 519 6.200000 1995m5 8.18 520 6.370000 1995m6 8.16 521 6.620000 1995m7 8.36 522 6.590000 1995m8 8.24 523 6.520000 1995m9 8.09 524 6.530000 1995m10 8.34 525 6.380000 1995m11 8.01 526 6.220000 1995m12 7.94 which is saved as ukrates.csv . Here is the code to attempt to reproduce the bgtest module. rm(list = ls()) library(zoo) library(lmtest) library(dynlm) # read in the data dfUK = read.csv('./data/ukrates.csv', header = TRUE) summary(dfUK) # run the time series regression zooUK = zoo(dfUK[, c('rs', 'r20')], order.by = as.yearmon(dfUK$month, '%Ym%m')) zooUKAug = merge(zooUK, 'drs' = diff(zooUK$rs, 1), 'ldr20' = lag(diff(zooUK$r20, 1), -1)) lmUK2 = dynlm(drs ~ ldr20, data = zooUKAug) # Breusch-Godfrey regression zooUKBG = merge(zooUKAug, 'resid' = resid(lmUK2)) lmBG = dynlm(as.formula(paste('resid', '~', attr(lmUK2$terms, 'term.labels'), ' + L(resid, 1)')), data = zooUKBG) # BG test using lmtest package bgtest(lmUK2, order = 1, type = 'Chisq') # 14.5614 # attempt to recreate BG-test length(lmBG$residuals)* sum(lmBG$fitted^2)/sum(lmBG$residuals^2) This is based on the following code for computing the chi-squared statistic directly from the bgtest function code: > bgtest function (formula, order = 1, order.by = NULL, type = c("Chisq", "F"), data = list(), fill = 0) { dname I am wondering why I am getting the different results.
