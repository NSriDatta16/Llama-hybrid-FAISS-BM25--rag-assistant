[site]: stackoverflow
[post_id]: 4809515
[parent_id]: 4809145
[tags]: 
I would start by organizing each URL by host, then you iterating over each host and image, downloading as you go. Something like this: require 'uri' # Organize URLs by host. by_host = {} urls.each do |x| # Assume 'urls' is an Array of String URLs. begin uri = URI.parse(x) by_host[uri.host] = [] unless by_host[uri.host] by_host[uri.host] Of course, you'll need more error checking and you'll probably want to organize by host/port instead of just hostname, but the above example should demonstrate the idea, in general, especially the use of the URI class in Ruby. As for saving into directories, you'll want to either ensure that the full path to each uri.path exists or create it before trying to open the output file.
