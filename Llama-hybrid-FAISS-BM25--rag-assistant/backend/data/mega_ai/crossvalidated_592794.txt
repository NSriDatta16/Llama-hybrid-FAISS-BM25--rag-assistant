[site]: crossvalidated
[post_id]: 592794
[parent_id]: 
[tags]: 
Reconciling the survey adjusted AIC for multiple regression models in the R survey package version 4.1-1

I am unable to reconcile the new survey adjusted AIC calculation (dAIC) used for multiple regression in version 4.1-1 of the survey package on CRAN for modelling data with complex survey weights. I have reached out to the author, Thomas Lumley, but haven't received a response. The survey design adjusted dAIC is given in the paper of Lumley and Scott (2015) $$ d\text{AIC} = -2n \widehat \ell (\widehat{\boldsymbol \theta}) + 2 p \widehat{\overline \delta} $$ In the most recent version of survey , the dAIC is computed for Multiple regression directly. I have derived the equations from the accompanying paper but cannot determine why there are two extra operations done in the survey package. Why is the final result divided by $\widehat \sigma^2$ in https://github.com/cran/survey/blob/9addea4be893748c60974732b01ef7a393019217/R/dAIC.R#L121 ? This affects the estimates of the AIC, $\overline \delta$ and the design adjusted effective df. Why are the intercept elements removed from the covariance matrices that are used to estimate $\overline \delta$ in lines https://github.com/cran/survey/blob/9addea4be893748c60974732b01ef7a393019217/R/dAIC.R#L100-L103 ? Derivation of result for Multiple regression model Assuming $\boldsymbol\theta = (\beta_0, \beta_1, \ldots,\beta_p, \sigma^2)^T = (\boldsymbol{\beta}^T, \sigma^2)^T$ with the model $$ \boldsymbol{y} = \boldsymbol{X} \boldsymbol{\beta} + \boldsymbol\varepsilon \qquad \text{where}\qquad \boldsymbol\varepsilon \sim \mathcal N(\boldsymbol 0, \sigma^2 I) $$ or for a single observation $$ y_i = \boldsymbol x_i^T \boldsymbol \beta + \varepsilon_i $$ which has likelihood $$ f_{\boldsymbol\theta} (y|\boldsymbol x) = \frac{1}{\sqrt{2\pi \sigma^2}} \exp \left\{ - \frac{(y - \boldsymbol x^T \boldsymbol\beta)^2}{2\sigma^2} \right\}. $$ Then the weighted log-likelihood is $$ \widehat \ell(\boldsymbol \theta) = \frac{1}{N} \sum_{i \in s} w_i \ell_i(\boldsymbol \theta) $$ where the weights in the paper are scaled so that $N = \sum_{i \in s}w_i$ and the log-likelihood is $\ell_i(\boldsymbol \theta) = \log f_{\boldsymbol\theta} (y_i|\boldsymbol x_i)$ . For convenience, define the diagonal matrix $\boldsymbol W = \text{diag}(w_i)$ . Then this leads to, $$ \sum_{i \in s} w_i \ell_i(\boldsymbol \theta) = - \frac{N}{2} \log(2\pi) - \frac{N}{2} \log(\sigma^2) - \frac{\boldsymbol \varepsilon^T \boldsymbol W \boldsymbol \varepsilon}{2\sigma^2}, $$ with score vector $$ \widehat{\boldsymbol U} = \frac{\partial \widehat \ell (\boldsymbol\theta)}{\partial \boldsymbol \theta} = \begin{pmatrix} \frac{1}{\sigma^2} \boldsymbol X^T \boldsymbol W \boldsymbol \varepsilon \\ - \frac{N}{2\sigma^2} + \frac{\boldsymbol \varepsilon^T \boldsymbol W \boldsymbol \varepsilon}{2 (\sigma^2)^2}\end{pmatrix} $$ Solving $\widehat{\boldsymbol U} = \boldsymbol 0$ gives the expected estimates $\widehat{\boldsymbol \beta} = (\boldsymbol X^T \boldsymbol W \boldsymbol X)^{-1} \boldsymbol X^T \boldsymbol W \boldsymbol Y$ and $\widehat \sigma^2 = \frac{1}{N}(\boldsymbol Y - \boldsymbol X \widehat{\boldsymbol \beta})^T \boldsymbol W (\boldsymbol Y - \boldsymbol X \widehat{\boldsymbol \beta})$ In the survey package the weights are further chosen such that $w_i \mapsto \frac{w_i}{\overline w} \Rightarrow N = n$ which has the consequence that $-2n\widehat \ell(\widehat{\boldsymbol \theta}) =\sum_{i \in s} w_i \ell_i(\boldsymbol \theta)= N + N \log(2\pi) + N \log(\widehat \sigma^2)$ which validates minus2ellhat on https://github.com/cran/survey/blob/9addea4be893748c60974732b01ef7a393019217/R/dAIC.R#L96:w However, the final line in that function divides minus2ellhat (and the other terms) by sigmahat2 . Why? The design adjusted penalty also has the step of removing the intercept. The penalty term of the dAIC is, $2 p \widehat{\overline \delta}$ where $p$ is the number of parameters in the model and $\widehat{\overline{\delta}}$ denotes the average design affect. The average design effect is defined $\overline \delta = tr(\boldsymbol \Delta)/p$ where $\boldsymbol \Delta = \boldsymbol{\mathcal I}(\boldsymbol \theta) \boldsymbol V(\boldsymbol \theta)$ is known as the design effect, the ratio of covariance matrices with and without sampling weights ( $\boldsymbol{\mathcal I}(\boldsymbol \theta)$ is the Fisher information matrix for the unweighted model and $\boldsymbol V(\boldsymbol \theta)$ being the asymptotic covariance matrix of the parameter estimates in the weighted model). The Fisher information is defined $$ \boldsymbol{\mathcal I}(\boldsymbol \theta) = \begin{pmatrix} \frac{1}{\sigma^2} \boldsymbol X^T\boldsymbol X & \boldsymbol 0\\ \boldsymbol 0^T & \frac{n}{2(\sigma^2)^2}\end{pmatrix} $$ The design effect of the slope parameters are extracted from the two appropriate covariance matrices fitted using svyglm but there is a step where the intercept components are removed https://github.com/cran/survey/blob/9addea4be893748c60974732b01ef7a393019217/R/dAIC.R#L100-L103 . If the null model is the intercept model itself, this will cause an error since the matrices in this step will be empty and cannot be inverted. The other calculations seem correct and the design effect of the $\sigma^2$ component is estimated correctly using the second moment of the score vector assuming the survey weighted probabilities and using the Fisher information above in the unweighted case. References [1] Lumley, T., and A. Scott. “AIC and BIC for Modeling with Complex Survey Data.” Journal of Survey Statistics and Methodology 3, no. 1 (2015): 1–18. https://doi.org/10.1093/jssam/smu021 .
