[site]: stackoverflow
[post_id]: 3601251
[parent_id]: 3598222
[tags]: 
As already mentioned, you have two problems with your stylesheet fragment: ussing an undeclare variable reference ( xsl:variable name="sum" select="$sum + $amt" ), and loosing the variable scope outside the xsl:when . If you want to declare a variable with value deppending on some conditions, then the answer from Ledhund is the right choise: use xsl:choose inside variable's content template. Also, if the terms of sum are node sets, you could use this expression: sum($A|$B[$cty='LOHNSTD']|$C[$cty='REGPAY']) Or $A + $B[$cty='LOHNSTD'] + $C[$cty='REGPAY'] If you are trying to chance the value of an already declared variable, then you should refactor your transformation because that's not posible in any declarative paradigm as XSLT.
