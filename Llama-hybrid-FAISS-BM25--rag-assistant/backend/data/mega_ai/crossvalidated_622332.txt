[site]: crossvalidated
[post_id]: 622332
[parent_id]: 
[tags]: 
Do the weights of IPTW have to sum up to the population size?

I'm new to Inverse Probability of Treatment Weighting and trying to understand the mechanism. From several practical guides I understood, that the weights should add up to the population size for treated and untreated samples (e.g., here or here ). Now I have a dataset with unbalanced treatment data and non-normal distributed confounders, which looks something like this: N = 10000 confounder = np.random.pareto(5, N) treatment = np.random.logistic(0.05,confounder, N) treatment = np.where(treatment > 0.5, 1,0) y = 0.5 * treatment + 0.1 * confounder df = pd.DataFrame( { 'y' : y, 'treatment' : treatment, 'confounder' : confounder, } ) when I now calculate the propensity scores with logistic regression and weight the samples, they don't sum up to the population size t = df["treatment"] X = df[["confounder"]] pipe = Pipeline([ ('scaler', StandardScaler()), ( 'logistic_classifier', LogisticRegression( class_weight='balanced', C=1, max_iter=100, warm_start=True, random_state=42 ) ) ]) pipe.fit(X, t) df['proba'] = pipe.predict_proba(X)[:, 1] weight_t = 1/df[df["treatment"]==1]["proba"] weight_nt = 1/(1-df[df["treatment"]==0]["proba"]) print("Original Sample Size", df.shape[0]) print("Treated Population Sample Size", sum(weight_t)) print("Untreated Population Sample Size", sum(weight_nt)) ---------- Original Sample Size 10000 Treated Population Sample Size 1999.821396311078 Untreated Population Sample Size 46710878272.35123 I have the feeling, that I'm doing something wrong with the calculation of the propensity scores but I don't understand what is wrong. The class_weight='balanced' option should correct for the unbalanced treatment variable.
