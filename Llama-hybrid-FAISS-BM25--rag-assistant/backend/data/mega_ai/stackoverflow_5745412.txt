[site]: stackoverflow
[post_id]: 5745412
[parent_id]: 
[tags]: 
Varnish purge configuration causing startup errors

I'm having a problem with the purge configuration in Varnish. I have a purge URL configured as below, but on attempting to start the service I get an error, also below. If I comment out this piece of config, the service starts without issue. Does anyone have any ideas where I'm going wrong? Cheers. sub vcl_recv { #purge all if (req.request == "PURGE") { if (!client.ip ~ purge) { error 405 "Not allowed."; } if (req.url ~ "varnish/index/purgeall/key/#Fj1nzljh") { purge_hash( ".*" ); } } The error message on start reads: user@ubuntu:/var/www$ sudo service varnish start * Starting HTTP accelerator varnishd [fail] storage_file: filename: /var/lib/varnish/ubuntu/varnish_storage.bin size 1024 MB. Message from VCC-compiler: Expected an action, 'if', '{' or '}' (input Line 18 Pos 7) purge_hash( ".*" ); ------##########--------- Running VCC-compiler failed, exit 1 VCL compilation failed mark@ubuntu:/var/www$ sudo service varnish start * Starting HTTP accelerator varnishd [fail] storage_file: filename: /var/lib/varnish/ubuntu/varnish_storage.bin size 1024 MB. Message from VCC-compiler: Expected an action, 'if', '{' or '}' (input Line 18 Pos 7) purge_hash( ".*" );
