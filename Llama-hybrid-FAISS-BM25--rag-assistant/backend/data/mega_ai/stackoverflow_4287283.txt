[site]: stackoverflow
[post_id]: 4287283
[parent_id]: 4272897
[tags]: 
OK, I found a solution: look at the user_agent field of the http request. For google-analytics queries it's "Mediapartners-Google", for facebook-connect it is "facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)". And here is how to implement this in Ruby on Rails.
