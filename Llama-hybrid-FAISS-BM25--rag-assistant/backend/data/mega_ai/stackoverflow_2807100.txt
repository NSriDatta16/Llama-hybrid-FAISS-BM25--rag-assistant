[site]: stackoverflow
[post_id]: 2807100
[parent_id]: 2804612
[tags]: 
For HTML to be valid XML including &nbsp; the document should have a DOCTYPE defining the entity. Adding something resembling ]> at the beginning of the document might do it. But this likely needs to be done to the actual source document, or prepended to it in the stream used for parsing it into the DOM. If you post some code showing how the document referenced in your line transformer.transform(new DOMSource(document), result); is produced, I might conceivably be able to help more explicitly.
