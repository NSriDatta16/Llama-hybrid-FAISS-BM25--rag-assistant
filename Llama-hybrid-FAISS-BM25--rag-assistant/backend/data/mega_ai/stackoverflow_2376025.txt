[site]: stackoverflow
[post_id]: 2376025
[parent_id]: 2375985
[tags]: 
You don't want to use htmlentities right away, I would use that on the data at the last point before you store it. One of the problems you'll run into is people don't always encode their entities properly anyway. Not everyone uses â„¢ they just copy the trademark in. If you put some logic in to try and grab whatever they put in and encode it properly you may be better off. For Example: $patterns = array(); $patterns[0] = '/&mdash;/'; $patterns[1] = '/&nsbsp;/'; $patterns[2] = '/&reg;/'; $replacements = array(); $replacements[2] = '&151;'; $replacements[1] = '&160;'; $replacements[0] = '&174;'; $ourhtml = preg_replace($patterns, $replacements, $html); You could find all the "gotcha" characters like dashes and single quotes, apostrophes etc and encode them by hand, as well as use a set standard to the entities (text or numeric). You could also use regular expressions to do the same thing, and would probably be a more elegant solution. But my suggestion would be to take some time filtering out what you don't want by hand, and then you know your data will be prepared exactly how you like.
