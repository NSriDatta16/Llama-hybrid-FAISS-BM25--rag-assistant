[site]: crossvalidated
[post_id]: 460447
[parent_id]: 459285
[tags]: 
If I understand correctly, here's your "problem before" : There are $n$ rooms in the building, rooms are indexed by, say, $j=1:n$ , each room has one unit, and each unit has $n_i$ recordings, recordings are indexd by $i=1:n_j$ . You want to group the recordings by unit and build a hierarchical model on it. And your "problem after" is: There are $n$ rooms in the building, rooms are indexed by $j=1:n$ , each room has $m_j$ units(in your case $m_j\le 2$ , but it doesn't matter). Units in a room are indexed by $k=1:m_j$ , the $k$ th unit in room $j$ has $n_{jk}$ recordings, recordings are indexd by $i=1:n_{jk}$ . You want to group the recordings by unit and room , and build a hierarchical model on it. Your "problem before" is a basic Bayesian linear regression model with linear Gaussian observations and Gaussian priors. To simplify the representation, let's assume the recordings are already centered, and use $\Sigma$ to replace $\Sigma_w$ . The CPDs will be: $$ x_{ji} \sim N(z_{ji}w_j,\sigma^2), i=1:n_j, j=1:n \\ w_j \sim N(0,\Sigma), j=1:n $$ In your equations there's no prior distribution specified for $\sigma^2$ and $\Sigma$ , so it's not really a "hierarchical model". In order to make it hierarchical, let's extend it with two prior distributions, say using inverse Gamma for $\sigma^2$ and inverse Wishart for $\Sigma$ , the extended CPDs will be: $$ x_{ji} \sim N(z_{ji}w_j,\sigma^2), i=1:n_j, j=1:n \\ w_{j} \sim N(0,\Sigma), j=1:n \\ \Sigma \sim InvWishart(v,S) \\ \sigma^2 \sim InvGamma(a,b) $$ With the hierarchical representation in mind, the CPDs for the "problem after" will be: $$ x_{jki} \sim N(z_{jki}w_{jk},\sigma^2),i=1:n_{jk}, k=1:m_j j=1:n\\ w_{jk} \sim N(0,\Sigma_j), k=1:m_j,j=1:n \\ \Sigma_j \sim InvWishart(v,S) ,j=1:n\\ \sigma^2 \sim InvGamma(a,b) $$ The Markov blanket s for the hidden random variables ( $w,\Sigma,\sigma^2$ ) can be easily derived from the CPDs, Gibbs sampling will be a natural solution. Here's an [article] shows how to run Gibbs sampling on a hierarchical Bayesian linear regression model in R . It's slightly different from your model but it provides all the materials you need to build one. Good luck!
