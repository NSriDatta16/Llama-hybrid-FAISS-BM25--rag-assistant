[site]: stackoverflow
[post_id]: 5567071
[parent_id]: 
[tags]: 
Non-continuous line numbering with Sweave and listings

I'm writing a report in LaTeX, embedding several R scripts, which are reported in non-contiguous Sweave chunks. I found some pretty useful comments on Stackoverflow on how to customize Sweave and the listings package to highlight code and numbering lines. I modified the original sweave.sty package as follows, to take advantage of listings while avoiding to burden my LaTeX documents with too many settings. Basically, I'm having trouble with the line numbering options. As configured, (firstnumber=last), the lines are numbered progressively across the document. If I set firstnumber=auto , the numbering restarts from 1 at each chunk of R code. \RequirePackage[T1]{fontenc} \RequirePackage{graphicx,ae,fancyvrb} \IfFileExists{upquote.sty}{\RequirePackage{upquote}}{} \setkeys{Gin}{width=0.8\textwidth} \DefineVerbatimEnvironment{Scode}{Verbatim}{fontshape=sl, fontsize=\small} \newenvironment{Schunk}{}{} \usepackage{listings} \newcommand{\indexfonction}[1]{\index{#1@\texttt{#1}}} \usepackage[usenames,dvipsnames]{color} \definecolor{gris90}{gray}{0.95} \lstdefinelanguage{Renhanced}[]{R}{% sensitive,% morecomment=[l]\#,% morestring=[d][\color{RoyalPurple}]",% morestring=[d][\color{RoyalPurple}]', alsoletter={.\%_}, alsoother={:_\$}} \lstset{language=Renhanced,extendedchars=false, basicstyle=\small\ttfamily, columns=flexible, commentstyle=\textsl, numbers=left, numberstyle=\small \ttfamily, keywordstyle=\mdseries, showstringspaces=false, index=[1][keywords], indexstyle=\indexfonction} \lstnewenvironment{Sinput}[1][]{ \lstset{% language={Renhanced}, basicstyle=\small \ttfamily, columns=flexible, frame=single, backgroundcolor=\color{gris90}, numbers=left, numberstyle=\small \ttfamily, firstnumber=last, #1 } }{} \lstnewenvironment{Soutput}[1][]{ \lstset{% language={Renhanced}, basicstyle=\small \ttfamily, columns=flexible, numbers=right, numberstyle=\tiny, firstnumber=last, #1 } }{} I would like to find an intermediate solution, where the numbering progresses across different chunks of the same script, but restarts form 1 at the beginning of a different script (possibly by specifying it manually). The trouble is, I think, that I cannot specify manually the name of the listings, because Sweave does it in the background. Suggestions are welcome!
