[site]: stackoverflow
[post_id]: 5401789
[parent_id]: 
[tags]: 
ws-security and nusoap not working

for a project I need to contact another companies webservice. They have made it on Soap, and it's all detailed etc. I found out the variables and types and what method etc. They also stated that I should use WS-security with pwd and username in the headers. So I made this with nusoap: require_once('../lib/nusoap.php'); $client = new nusoap_client("http://webservice.client.com/cir.asmx?WSDL", 'wsdl'); $err = $client->getError(); if ($err) { echo ' Constructor error ' . $err . ' '; } $client->soap_defencoding = 'UTF-8'; $result = $client->call('GetLastUpdate'); // Check for a fault if ($client->fault) { echo ' Fault '; print_r($result); echo ' '; } else { // Check for errors $err = $client->getError(); if ($err) { // Display the error echo ' Error ' . $err . ' '; } else { // Display the result echo ' Result '; print_r($result); echo ' '; } } echo ' Request ' . htmlspecialchars($client->request, ENT_QUOTES) . ' '; echo ' Response ' . htmlspecialchars($client->response, ENT_QUOTES) . ' '; echo ' Debug ' . htmlspecialchars($client->debug_str, ENT_QUOTES) . ' '; then I added: $client->setCredentials('******','*******','basic'); which didn't work, so I looked up the ws-security style and added the following instead: $auth=' ******** ******* '.base64_encode(pack('H*',$nonce)).' '.time().' '; $client->setHeaders($auth); Which didn't work either...they give the same error....this is what it returns: Fault Array ( [faultcode] => q0:Security [faultstring] => Header http://schemas.xmlsoap.org/ws/2004/08/addressing:Action for ultimate recipient is required but not present in the message. [faultactor] => http://webservice.client.com/cir.asmx ) Request POST /cir.asmx HTTP/1.0 Host: webservice.client.com User-Agent: NuSOAP/0.9.5 (1.123) Content-Type: text/xml; charset=UTF-8 SOAPAction: "http://www.client.com/namespaces/cir01/GetLastUpdate" Content-Length: 967 ******* ******** 1300862463 Response HTTP/1.1 500 Internal Server Error Connection: close Date: Wed, 23 Mar 2011 06:39:57 GMT Server: Microsoft-IIS/6.0 X-Powered-By: ASP.NET X-AspNet-Version: 2.0.50727 Cache-Control: private Content-Type: text/xml; charset=utf-8 Content-Length: 1421 http://schemas.xmlsoap.org/ws/2004/08/addressing/fault urn:uuid:b8c93511-b6e6-4247-9ab5-65bd4a6aa286 urn:uuid:6dfa917b-3163-4ae9-bd84-0855b7a1329e http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous 2011-03-23T06:39:57Z 2011-03-23T06:44:57Z q0:Security Header http://schemas.xmlsoap.org/ws/2004/08/addressing:Action for ultimate recipient is required but not present in the message. http://webservice.client.com/cir.asmx
