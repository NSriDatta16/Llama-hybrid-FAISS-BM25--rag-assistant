[site]: crossvalidated
[post_id]: 379319
[parent_id]: 
[tags]: 
How is Test MSE being calculated here?

I'm reading Andrew Ng's CS229 course notes on machine learning, and I'm at the part about Bias-Variance Tradeoff . Here, we're modeling our data as $y_i = f(x_i) + \epsilon_i$ where $\epsilon_i$ are i.i.d. with $\mathbb{E}[\epsilon_i]=0$ and $\text{Var}[\epsilon_i] = \sigma^2$ . We learn a model $\hat{f}$ based off the training samples (and so this $\hat{f}(x)$ is actually a random variable for all $x$ in our test set). Now, they go on to calculate the Test MSE as follows: $$ \begin{aligned} \text{Test MSE} & = \mathbb{E}\left((y-\hat{f}(x))^2\right) \\ & = \mathbb{E}\left((\epsilon + f(x) - \hat{f}(x))^2\right) \\ & = \mathbb{E}\left(\epsilon^2\right) + \mathbb{E}\left((f(x) - \hat{f}(x))^2\right) \\ & = \sigma^2 + \left(\mathbb{E}(f(x) - \hat{f}(x))\right)^2 + \text{Var}(f(x) - \hat{f}(x)) \\ & = \sigma^2 + \left(\text{Bias}(\hat{f})\right)^2 + \text{Var}(\hat{f}) \end{aligned} $$ I don't really have any problem with the formulas above, I can go from one to the next. What I don't understand is what the expectation is being taken over in the first place. What exactly does $\mathbb{E}((y - \hat{f}(x))^2)$ mean? My intuition is telling me it's being taken over the training set $(x, y)\in\text{Test Set}$ , with samples being drawn uniformly, but this doesn't make a lot of sense to me because I thought the whole point is that $\hat{f}$ is a random variable over the samples $\epsilon_i$ , so shouldn't the expectation be over the $\epsilon_i$ 's? If so, then are $x$ and $y$ just an arbitrary sample from the test set? How is $\text{Var}(\epsilon) = \sigma^2$ , is $\epsilon$ our random variable here? I'm just so confused about how exactly each of these expectations is being calculated. I get the gist of it, and I have no problem with formulas involving the expectation (like the fact that $\mathbb{E}[\epsilon^2] = \text{Var}(\epsilon) + \mathbb{E}[\epsilon]^2 = \text{Var}(\epsilon)$ ), I just don't understand what these expectations are being taken with respect to.
