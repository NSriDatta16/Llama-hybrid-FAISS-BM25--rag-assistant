[site]: stackoverflow
[post_id]: 4651952
[parent_id]: 4647825
[tags]: 
select m.id as MailID , m.text as MailText , snd.PersonType as SenderType , snd.PersonID as SenderID , snd.Name as SenderName , snd.grade as SenderGrade , snd.hasStudCard as SenderHasStudCard , snd.age as SenderAge , snd.telephone as SenderTelephone , snd.department as SenderDepartment , rec.PersonType as ReceiverType , rec.PersonID as ReceiverID , rec.Name as ReceiverName , rec.grade as ReceiverGrade , rec.hasStudCard as ReceiverHasStudCard , rec.age as ReceiverAge , rec.telephone as ReceiverTelephone , rec.department as ReceiverDepartment from MAIL as m join ( select p.id , case when s.id is not null then 'Student' when t.id is not null then 'Teacher' when g.id is not null then 'Guest' end as PersonType , coalesce(s.id, t.id, g.ID) as PersonID , coalesce(s.Name, t.name, '') as Name , grade , hasStudCard , age , telephone , department from MN as p left join STUDENT as s on (s.id = p.studentFK and p.teacherFK is null and p.guestFK is null) left join TEACH as t on (t.id = p.teacherFK and p.studentFK is null and p.guestFK is null) left join GUEST as g on (g.id = p.guestFK and p.studentFK is null and p.teacherFK is null) ) as snd on snd.id = m.senderFK join ( select p.id , case when s.id is not null then 'Student' when t.id is not null then 'Teacher' when g.id is not null then 'Guest' end as PersonType , coalesce(s.id, t.id, g.ID) as PersonID , coalesce(s.Name, t.name, '') as Name , grade , hasStudCard , age , telephone , department from MN as p left join STUDENT as s on (s.id = p.studentFK and p.teacherFK is null and p.guestFK is null) left join TEACH as t on (t.id = p.teacherFK and p.studentFK is null and p.guestFK is null) left join GUEST as g on (g.id = p.guestFK and p.studentFK is null and p.teacherFK is null) ) as rec on rec.id = m.receiverFK ;
