[site]: stackoverflow
[post_id]: 4144780
[parent_id]: 
[tags]: 
Optimizing an SQL query with generated GROUP BY statement

I have this query: SELECT ROUND(AVG(temp)*multT + conT,2) as temp, FLOOR(timestamp/$secondInterval) as meh FROM sensor_locass LEFT JOIN sensor_data USING(sensor_id) WHERE sensor_id = '$id' AND project_id = '$project' GROUP BY meh ORDER BY timestamp ASC The purpose is to select data for drawing a graph, I use the average over a pixels worth of data to make the graph faithful to the data. So far optimization has included adding indexes, switching between MyISAM and InnoDB but no luck. Since the time interval changes with graph zoom and period of data collection I cannot make a seperate column for the GROUP BY statement, the query however is slow. Does anyone have ideas for optimizing this query or the table to make this grouping faster, I currently have an index on the timestamp , sensor_id and project_id columns, the timestamp index is not used however. When running explain extended with the query I get the following: 1 SIMPLE sensor_locass ref sensor_id_lookup,project_id_lookup sensor_id_lookup 4 const 2 100.00 Using where; Using temporary; Using filesort 1 SIMPLE sensor_data ref idsensor_lookup idsensor_lookup 4 webstech.sensor_locass.sensor_id 66857 100.00 The sensor_data table contains at the moment 2.7 million datapoints which is only a small fraction of the amount of data i will end up having to work with. Any helpful ideas, comments or solution would be most welcome EDIT table definitions: CREATE TABLE `sensor_data` ( `id` int(11) NOT NULL AUTO_INCREMENT, `gateway_id` int(11) NOT NULL, `timestamp` int(10) NOT NULL, `v1` int(11) NOT NULL, `v2` int(11) NOT NULL, `v3` int(11) NOT NULL, `sensor_id` int(11) NOT NULL, `temp` decimal(5,3) NOT NULL, `oxygen` decimal(5,3) NOT NULL, `batVol` decimal(4,3) NOT NULL, PRIMARY KEY (`id`), KEY `gateway_id` (`gateway_id`), KEY `time_lookup` (`timestamp`), KEY `idsensor_lookup` (`sensor_id`) ) ENGINE=MyISAM AUTO_INCREMENT=2741126 DEFAULT CHARSET=latin1 CREATE TABLE `sensor_locass` ( `id` int(11) NOT NULL AUTO_INCREMENT, `project_id` int(11) NOT NULL, `sensor_id` int(11) NOT NULL, `start` date NOT NULL, `end` date NOT NULL, `multT` decimal(6,3) NOT NULL, `conT` decimal(6,3) NOT NULL, `multO` decimal(6,3) NOT NULL, `conO` decimal(6,3) NOT NULL, `xpos` decimal(4,2) NOT NULL, `ypos` decimal(4,2) NOT NULL, `lat` decimal(9,6) NOT NULL, `lon` decimal(9,6) NOT NULL, `isRef` tinyint(1) NOT NULL, PRIMARY KEY (`id`), KEY `sensor_id_lookup` (`sensor_id`), KEY `project_id_lookup` (`project_id`) ) ENGINE=MyISAM AUTO_INCREMENT=238 DEFAULT CHARSET=latin1
