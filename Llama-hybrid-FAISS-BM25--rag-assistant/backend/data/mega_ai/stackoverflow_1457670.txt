[site]: stackoverflow
[post_id]: 1457670
[parent_id]: 1457491
[tags]: 
Take a look at WinPcap - it uses an NDIS driver to implement its packet filtering capabilities. This library can probably provide an excellent base for any packet inspection / firewall program you'd want to write, and it's open-source. From http://www.winpcap.org/docs/docs_40_2/html/group__internals.html : First, a capture system needs to bypass the operating systems's protocol stack in order to access the raw data transiting on the network. This requires a portion running inside the kernel of OS, interacting directly with the network interface drivers. This portion is very system dependent, and in our solution it is realized as a device driver, called Netgroup Packet Filter (NPF); we provide different versions of the driver for Windows 95, Windows 98, Windows ME, Windows NT 4, Windows 2000 and Windows XP. These drivers offer both basic features like packet capture and injection, as well as more advanced ones like a programmable filtering system and a monitoring engine. The first one can be used to restrict a capture session to a subset of the network traffic (e.g. it is possible to capture only the ftp traffic generated by a particular host), the second one provides a powerful but simple to use mechanism to obtain statistics on the traffic (e.g. it is possible to obtain the network load or the amount of data exchanged between two hosts).
