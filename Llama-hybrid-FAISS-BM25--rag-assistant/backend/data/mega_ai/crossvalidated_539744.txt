[site]: crossvalidated
[post_id]: 539744
[parent_id]: 
[tags]: 
Covariance kernel: understanding the term within groups and between groups terms of a two-way functional ANOVA

I was studying the paper "Multilevel Functional Principal Component Analysis" by Chong-Zhi Di et. al. To find the functional PCA for functional data with group factor, it is suggested to use the following additive model: $ X_{ij} (t) = \mu(t) + \eta_j(t) + Z_i(t) + W_{ij} (t) $ where $i$ is the index for the subject, and $j$ is the index of the subject's visit. Each subject may have many visits. It is claimed in the paper that the sample estimate of the total covariance kernel is: $ K_T(t_s, t_r) = \Sigma_{i,j} \left( (X_{ij}(t_s) - \mu(t_s) - \eta_j(t_s) (X_{ij}(t_r) - \mu(t_r) - \eta_j(t_r) \right) / (IJ) $ and the "between subjects" covariance kernel is: $K_B (t_s, t_r) = \Sigma_{i,j,j'\neq j} \left( (X_{ij}(t_s) - \mu(t_s) - \eta_j(t_s) (X_{ij'}(t_r) - \mu(t_r) - \eta_{j'}(t_r) \right) / (IJ(J-1)) $ The within subject covariance kernel is $K_T(t_s, t_r) - K_B(t_s,t_r)$ . However, I don't understand why $K_B(t_s, t_r)$ is called "between subjects" covariance. For me, the change is with index $j$ , so each term will reflect the covariance due to change in subject's visits, hence it should be "within-subject". What am I missing? Many thanks.
