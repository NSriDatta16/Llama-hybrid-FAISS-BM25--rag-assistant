[site]: crossvalidated
[post_id]: 617966
[parent_id]: 
[tags]: 
Modeling a Random Effect nested in another random effect in R using the mgcv Package

I have a dataset consisting of 1000 in-vitro fertilization (IVF) cycles from a total of 700 patients. Each cycle has several variables, including; the total number of follicles the patient had in that cycle, the total number of oocytes retrieved from those follicles in that cycle (oocyte count cannot be larger than follicle count as only 1 or 0 oocytes can be retrieved from one follicle), the hormone level of the patient for that cycle (Hormone), information about the cycle attempt number (CycleAttemptNo: first, second, third), patient number (PatientNo: unique for each of the 700 patients), cycle number (CycleNo: 1 to 1000). I want to model the success or failure of obtaining an oocyte from a follicle. To analyze this, I transformed the dataset using the pivot_longer() function from the tidyr package, with each follicle represented as a separate row. For example, if a cycle had 2 oocytes retrieved from 3 follicles, it would result in 3 rows: 2 rows indicating successful retrieval (Retrieved = 1) and 1 row indicating unsuccessful retrieval (Retrieved = 0). All three rows would have the same hormone levels as they belong to the same cycle. I would appreciate guidance on how to model the response variable (Retrieved) using a fixed effect (hormone level) and random variable (CycleNo) nested in another random variable (PatientNo) and a crossed random effect (CycleAttemptNo). I have attempted the following code: library(mgcv) gam_model I also have a related question. Since all observations in the long data derived from a single cycle possess the same CycleNo and, consequently, the same hormone levels, I am concerned that the random effect of CycleNo may absorb the variability in retrieval success explained by hormone levels, which is the aspect of interest to me. Is the above code correct for my modeling objective? I would appreciate any feedback or suggestions on improving the model. Thank you!"
