[site]: stackoverflow
[post_id]: 5163013
[parent_id]: 5160760
[tags]: 
I would do it this way : when this transformation is applied on the provided XML document: Main Section Here is some text that is a child of a main section. Some more text. When a section has subsections, it should not have loose paragraphs before the first sub section. Those loose paras should be placed inside a comment element. This is my subsection Text that is inside of the sub-section And some more sub section text. the wanted, correct result is produced: Main Section Here is some text that is a child of a main section. Some more text. When a section has subsections, it should not have loose paragraphs before the first sub section. Those loose paras should be placed inside a comment element. This is my subsection Text that is inside of the sub-section And some more sub section text. Explanation : The identity rule (template) copies every node "as-is". The overriding template for section that has preceding sibling(s) para wraps all such siblings with a comment element, then calls the identity transformation on itself. For convenience we define a key that matches all para elements preceding a section element with a given generate-id() . The para elements that have a following sibling section are excluded from the action of the identity rule by an overriding template, that simply does nothing. Finally, such para elements, when being output within the wrapper comment are processed in mode copy , which simply calls the identity rule to do the copying.
