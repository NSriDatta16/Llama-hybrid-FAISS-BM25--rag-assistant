[site]: stackoverflow
[post_id]: 3713255
[parent_id]: 3713064
[tags]: 
You should refactor your code so that the ftp commands are in functions and instead of copy/pasting those ftp commands everywhere, you have some flow like this: String[] directories = ftpGetListing("ftp://myurl.com/mainfolder/"); String[] agents = Crawler.CrawlerDbUtils.getAllAgentIDs(); String[] combinedDirectories = getElementsInBothArray(directories, agents); String[] serverOnlyDirectories = getElementsOnlyInFirstArray(directories, agents); String[] agentOnlyDirectories = getElementsOnlyInFirstArray(agents, directories); // step 1: delete all server only directories ftpDeleteDirectories("ftp://myurl.com/mainfolder/", serverOnlyDirectories); // step 2: create all agent only directories ftpCreateDirectories("ftp://myurl.com/mainfolder/", agentOnlyDirectories); // step 3: depricate all files foreach(String dir in combinedDirectories) { String ftpDir = "ftp://myurl.com/mainfolder/" + dir + "/"; String[] serverFiles = ftpGetListing(ftpDir); String[] agentFiles = Crawler.CrawlerDbUtils.getAllPictures(dir); String[] serverOnlyFiles = getElementsOnlyInFirstArray(serverFiles, agentFiles); foreach(String file in serverOnlyFiles) { ftpDeleteFile(ftpDir + file); } } Then you just have to implement really simple functions for ftpGetListing , ftpDeleteDirectories , ftpCreateDirectories , and ftpDeleteFile . Oh yeah and some simple array manipulation functions like: getElementsInBothArrays and getElementsOnlyInFitstArray .
