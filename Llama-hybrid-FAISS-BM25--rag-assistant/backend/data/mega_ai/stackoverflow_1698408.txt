[site]: stackoverflow
[post_id]: 1698408
[parent_id]: 
[tags]: 
Weighted average in T-SQL (like Excel's SUMPRODUCT)

I am looking for a way to derive a weighted average from two rows of data with the same number of columns, where the average is as follows (borrowing Excel notation): (A1*B1)+(A2*B2)+...+(An*Bn)/SUM(A1:An) The first part reflects the same functionality as Excel's SUMPRODUCT() function. My catch is that I need to dynamically specify which row gets averaged with weights, and which row the weights come from, and a date range. EDIT: This is easier than I thought, because Excel was making me think I required some kind of pivot. My solution so far is thus: select sum(baseSeries.Actual * weightSeries.Actual) / sum(weightSeries.Actual) from ( select RecordDate , Actual from CalcProductionRecords where KPI = 'Weighty' ) baseSeries inner join ( select RecordDate , Actual from CalcProductionRecords where KPI = 'Tons Milled' ) weightSeries on baseSeries.RecordDate = weightSeries.RecordDate
