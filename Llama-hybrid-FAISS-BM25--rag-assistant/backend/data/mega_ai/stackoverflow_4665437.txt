[site]: stackoverflow
[post_id]: 4665437
[parent_id]: 4660962
[tags]: 
I couldn't find a more elegant way to reassign all children, so I guess this will do. I think it gets what you're after, though. (NOTE: Code updated to reflect additional requirements in the comments.) $doc = new DOMDocument(); $doc->loadHTML($content); $x = new DOMXPath($doc); foreach($x->query('//div/ul/li') as $anchor) { $container = $doc->importNode(new DOMElement('div')); $container->setAttribute('class', 'container'); $next = $anchor->firstChild; while ($next !== NULL) { $curr = $next; $next = $curr->nextSibling; if (($curr->nodeName != 'h4') || ($curr->attributes === NULL) || ($curr->attributes->getNamedItem('class') === NULL) || !preg_match('#(^| )title( |$)#', $curr->attributes->getNamedItem('class')->nodeValue) ) { $container->appendChild($anchor->removeChild($curr)); } } $anchor->appendChild($container); } As for character encoding, I've been messing with it for a while and it's a tricky issue. The characters display correctly when you load with loadXML() but not with loadHTML() . There's a workaround in the comments , but it ain't pretty. Hopefully some of the user comments will help you can find a usable solution.
