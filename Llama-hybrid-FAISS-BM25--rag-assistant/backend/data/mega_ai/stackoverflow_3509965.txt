[site]: stackoverflow
[post_id]: 3509965
[parent_id]: 
[tags]: 
Connect to website and keep session?

I'm trying to connect to a website (source code below) that requires login and then browse it to download some files. I've managed to do this for another website using this code: public void initConnection(String _path, Map _parameters) throws IOException { String data = convertMapToParams(_parameters); // Send data URL url = new URL(host + "/" + _path); URLConnection conn = url.openConnection(); conn.setDoOutput(true); OutputStreamWriter wr = new OutputStreamWriter(conn.getOutputStream()); wr.write(data); wr.flush(); wr.close(); sessionCookie = conn.getHeaderField("Set-Cookie"); sessionCookie = sessionCookie.substring(0,sessionCookie.indexOf(";")); } public List getHtml(String _path, Map _parameters) throws IOException { String data = convertMapToParams(_parameters); URL url = new URL(host + "/" + _path); HttpURLConnection conn = (HttpURLConnection) url.openConnection(); conn.setDoOutput(true); conn.setRequestProperty("Cookie", sessionCookie); OutputStreamWriter wr = new OutputStreamWriter(conn.getOutputStream()); wr.write(data); wr.flush(); wr.close(); List list = new LinkedList (); BufferedReader rd = new BufferedReader(new InputStreamReader(conn.getInputStream())); String line; while ((line = rd.readLine()) != null) { list.add(line); } rd.close(); return list; } The problem is that on this website, when I do this: sessionCookie = conn.getHeaderField("Set-Cookie"); I get sessionCookie == "null", so I am not able to get any cookies to keep the session opened. And if I get the headers from the conn variable to check if there is any cookie field in there I get this (from IntelliJ IDEA debugger): [0] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2085}"null=[HTTP/1.1 200 OK]" [1] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2093}"X-AspNet-Version=[2.0.50727]" [2] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2102}"Date=[Wed, 18 Aug 2010 07:32:37 GMT]" [3] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2111}"Content-Length=[3686]" [4] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2120}"Content-Type=[text/html; charset=utf-8]" [5] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2129}"Server=[Microsoft-IIS/6.0]" [6] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2138}"X-Powered-By=[ASP.NET]" [7] = {java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntry@2147}"Cache-Control=[private]" But using Firefox add-on "HttpFox" to check if there are cookies, I discovered that there are: (Request-Line) POST /companias/entrada.aspx HTTP/1.1 User-Agent Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8 Accept text/html,application/xhtml+xml,application/xml;q=0.9,*/;q=0.8 Accept-Language es-es,es;q=0.8,en-us;q=0.5,en;q=0.3 Accept-Encoding gzip,deflate Accept-Charset ISO-8859-1,utf-8;q=0.7,*;q=0.7 Keep-Alive 115 Connection keep-alive Cookie __utma=235757843.1141928071.1280949246.1282083861.1282114987.11; __utmz=235757843.1280949246.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); __utmc=235757843 Content-Type application/x-www-form-urlencoded Content-Length 381 Another thing that confused me were these fields in the sourcecode "__VIEWSTATE", "__EVENTVALIDATION", "__EVENTTARGET","__LASTFOCUS" and "__EVENTARGUMENT". Because I've been searching for information about them and If I understood it right, you can use VIEWSTATE to control the session of the user but I don't know how it works. So, to put it short, on another website I used that simple "getheaderField("Set-Cookie")" to get the cookie and keep the session alive, but now I don't know if the website uses cookies or if it doesn't and also I don't know if cookies would be the way to go or if instead I have to use this VIEWSTATE field to do so. I am not very experienced with Java yet and less with connection things, I was recommended here to use Apache HttpClient for this things and I'm reading about it, but I have so many mixed things right now that I'd first need to know the way to go with this site. And finally, this is part of the source code from this website: Steps Peritaciones S.L. // Acceso Compañias Entrada Usuario: * Contraseña: * // // Thanks and I hope it's not too much code in one post :S P.D.: This websites belong to my job and I have authorized access to them, so it's not any hacking thing, I just want to automate the process and learn while I'm on it
