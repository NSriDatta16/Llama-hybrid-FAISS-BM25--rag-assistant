[site]: stackoverflow
[post_id]: 128246
[parent_id]: 126855
[tags]: 
If you're using SQL Server 2005 you don't need the sub query on the GROUP BY. You can use the new ROW_NUMBER and PARTION BY functionality. SELECT AVG(a.weight) FROM (select ROW_NUMBER() OVER(PARTITION BY dv.UserId ORDER BY Date desc) as ID, dv.weight from DoctorsVisit dv) a WHERE a.Id = 1 As someone else has mentioned though, this is the average weight across all the users who have VISITED the doctor. If you want the average weight across ALL of the users then anyone not visiting the doctor will give a misleading average.
