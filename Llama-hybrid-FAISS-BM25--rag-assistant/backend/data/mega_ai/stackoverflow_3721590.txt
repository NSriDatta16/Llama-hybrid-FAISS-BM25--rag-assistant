[site]: stackoverflow
[post_id]: 3721590
[parent_id]: 
[tags]: 
Entity framework 4 and sql filestream to read a file from db

I'm using ASP.NET 4, EF 4 and FILESTREAM in SQL 2008 to add/read files to the DB. I'm able to upload files just fine, but I'm not able to retrieve the files the way I want to. Here's what I'm doing - I have a grid which displays a list of files. Each line item is a file with a CommandName and CommandArgument set. The user clicks on any one of these files and I capture the event in the RowCommand event. At this point, I get the ID of the file and retrieve the byte[] from the DB. How do I display a standard download box for the user to Save or Cancel the download? I can write the stream to a temp file (using System.IO.File.WriteAllBytes) and then do a Server.Transfer to the temp file but I think it's an unnecessary step. Is there a way, I can read the bytes directly to memory, then set the ContentType/MimeType and allow the user to save the file? I understand that accessing the FILESTREAM file using T-SQL is slower than accessing the same using WIN32 API's (using a combination of the new SystemFile.PathName() & Impersonation) but EF4 makes working with SQL faster so I'm going that route. Here's the code - var file = db.Storage.Single(f => f.ID.Equals(fileID)); // fileID is set in CommandArgument // file.Contents has the byte []. // display a standard file download box. Thanks for any help!
