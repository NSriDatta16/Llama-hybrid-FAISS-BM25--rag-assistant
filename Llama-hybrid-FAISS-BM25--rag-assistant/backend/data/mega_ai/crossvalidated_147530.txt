[site]: crossvalidated
[post_id]: 147530
[parent_id]: 
[tags]: 
How can I compute cross-correlation and auto-correlation in R using pooled data?

I'm trying to perform a lagged linear regression on time series data sourced from ~10,000 hospital patients, for the purpose of estimating causal relationships between administration of a drug and a certain physiological response. For example: Do non-steroidal anti inflammatory drugs cause hypertension? Basically, the linear model I'm trying to fit is like this: This assumes a maximum of 30 lags. $y$ represents hypertension, $x$ is taking the drug, and $h$ is whether the patient is admitted or not (a covariate). My question is this : Given a unique time series for each patient (all truncated to the same length of 30 time points), how can I pool all of the time series data together to estimate things like the cross-correlation (e.g., using ccf ) and auto-correlation ( acf ) over the entire data set? If I were just trying to fit a linear model, this can be done relatively easily using something like the plm library, but I haven't been able to find anything similar for single functions. For reference, here is a very small example of what my data set looks like (note that I only retained 6 of the 30 total time points for each patient, for brevity): patient_id time nsaid hypertension admission 1 1 1 0.4427955 0.0000000 0.0000000 2 1 2 1.0000000 0.2097246 0.0000000 3 1 3 0.0000000 0.4916697 0.0000000 4 1 4 0.0000000 1.0000000 0.0000000 5 1 5 0.0000000 0.7902754 0.0000000 6 1 6 0.0000000 0.0000000 0.0000000 7 2 1 0.0000000 0.0000000 0.0000000 8 2 2 0.4104132 0.0000000 0.0000000 9 2 3 0.8236088 0.0000000 1.0000000 10 2 4 1.0000000 0.0000000 0.6994038 11 2 5 0.5895868 0.0000000 0.0000000 12 2 6 0.1763912 0.0000000 0.0000000
