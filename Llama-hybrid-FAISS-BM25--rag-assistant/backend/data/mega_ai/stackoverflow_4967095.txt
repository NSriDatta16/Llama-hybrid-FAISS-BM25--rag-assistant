[site]: stackoverflow
[post_id]: 4967095
[parent_id]: 
[tags]: 
C# - Predict file system events on folder delete

This is more a question about what's the best practice in implementing this. I have a FileSystemWatcher which should inform me about User's changes on files and folders. Also subdirs are watched. In the same directory my program does also sometimes changes. I don't want the FileSystemWatcher to detect events on these program changes. My first implementation was a list where I can add expected events. When I get a file system event I check the list and ignore it if it's there. This doesn't sound very robust but it seemed to work. Now I detected the real problem: D: is watched by the FileSystemWatcher . I have two folders like that: D:\folder1\folder2 Now I want to delete folder1 (with folder2 in it) with my application. So I put D:\folder1 in my delete list. Then I call something like Directory.Delete(@"D:\folder1", true) . Now I notice that folder1 can't be deleted (why ever) over an exception. I remove the delete entry from my list but folder2 was already deleted and I get his FileSystemEvent. So I get a FileSystem event for D:\folder1\folder2. My program thinks now the user has deleted this folder and is doing the wrong things. I had some ideas now: 1.) recursively delete the folder by deleting every file and every folder by it's own. With this I get for every subfolder and file an own list entry. I already implemented it but it is very very very slow. 2.) Maybe there is a better way to have clever filters in the FileSystemWatcher to make my list obsolete? 3.) Maybe it is possible to only delete a directory tree if it's possible to delete everything. So if it fails I still have everything and if not everything is deleted. This seems to be the most elegant solution for me but no idea if this is even possible? 4.) Is it possible to exclusively lock all files and folders by my software? If this this went ok it should be possible delete everything with one delete command or somehow like this? I'm also open for other additional solutions. Edit 1 to make it more clear: I only want to "see" user actions on a folder. If I manipulate things from my program in here I don't want to see this events. With my implementation I get events for subfolders if a folder is locked and can't be deleted. It's not so easy to explain in english because I'm no english native speaker ;). Edit 2: 5.) Maybe it is possible to filter in FileSystemWatcher all events from a defined process?
