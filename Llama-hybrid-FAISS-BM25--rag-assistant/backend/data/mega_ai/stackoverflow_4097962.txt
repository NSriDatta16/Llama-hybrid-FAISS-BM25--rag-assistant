[site]: stackoverflow
[post_id]: 4097962
[parent_id]: 4097202
[tags]: 
Another option is to use the windowing clause of analytic functions with my_data as ( select 1 as month, 'A' as product, 10 as sales from dual union all select 1 as month, 'B' as product, 12 as sales from dual union all select 1 as month, 'C' as product, 17 as sales from dual union all select 2 as month, 'A' as product, 21 as sales from dual union all select 3 as month, 'C' as product, 2 as sales from dual union all select 3 as month, 'B' as product, 21 as sales from dual union all select 4 as month, 'B' as product, 23 as sales from dual ) select month, product, sales, nvl(sum(sales) over (partition by product order by month range between 3 preceding and 1 preceding),0)/3 as average_sales from my_data order by month, product
