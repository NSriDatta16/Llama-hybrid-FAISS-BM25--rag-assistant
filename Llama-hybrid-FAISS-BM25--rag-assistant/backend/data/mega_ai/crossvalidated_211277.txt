[site]: crossvalidated
[post_id]: 211277
[parent_id]: 175287
[tags]: 
In a logit model, $$Pr[y = 1 \vert x, d] = p = \frac{\exp (\alpha + \beta \cdot x + \gamma \cdot d)}{1+\exp (\alpha + \beta \cdot x + \gamma \cdot d)}. $$ After some tedious calculus and simplification, the partial derivative of that with respect to a continuous variable $x$ becomes: $$ \frac{\partial Pr[y=1 \vert x]}{\partial x} = \beta \cdot p \cdot (1-p). $$ This tells you the change in probability from a 1 unit increase in $x$. Marginal effects of categorical/factor variables like $d$ (those prefixed with i. ) are calculated by using finite differences rather than derivatives. That is, Stata calculates $$Pr[y = 1 \vert x , d=1] - Pr[y = 1 \vert x , d=0].$$ Note that $p$ and its derivative/finite difference are both function of $x$ and $d$, so you can evaluate either of them at various possible values. You can use the mean of $x$, $\bar x$. That is the atmeans : marginal effect at the mean. This corresponds to the predicted probability and its derivative for the average person. You can also use each observation's own value of $x$ and then take the average over the estimation sample. That's the asobserved , the default, also called the average marginal effect. You can also use the median or any other representative value. You can even do combinations of all these. There is no consensus which one is better and frequently the choice does not matter very much. You just have to be explicit about which one you are using. However, there are some values that arguably don't make sense. For example, no one is half female and half male. For categorical or binary variables, it often makes sense to to use the base or modal value instead of the mean if you go the MEM/MER route. Here's some code that hopefully makes the differences clear: . sysuse auto, clear (1978 Automobile Data) . gen price2 = price/10000 . logit foreign price2 Iteration 0: log likelihood = -45.03321 Iteration 1: log likelihood = -44.947363 Iteration 2: log likelihood = -44.94724 Iteration 3: log likelihood = -44.94724 Logistic regression Number of obs = 74 LR chi2(1) = 0.17 Prob > chi2 = 0.6784 Log likelihood = -44.94724 Pseudo R2 = 0.0019 ------------------------------------------------------------------------------ foreign | Coef. Std. Err. z P>|z| [95% Conf. Interval] -------------+---------------------------------------------------------------- price2 | .3528042 .8436183 0.42 0.676 -1.300657 2.006266 _cons | -1.079792 .5878344 -1.84 0.066 -2.231927 .0723418 ------------------------------------------------------------------------------ Let's calculate average predictions at own values of price2 in 4 ways: . /* (1) compare predicted probabilities versus margins */ . predict phat_by_stata, pr . gen double phat_by_hand=exp(-1.079792+ .3528042*price2)/(1+exp(-1.079792+.3528042*price2)) . sum phat* Variable | Obs Mean Std. Dev. Min Max -------------+--------------------------------------------------------- phat_by_st~a | 74 .2972973 .0224245 .2761411 .3731745 phat_by_hand | 74 .2972974 .0224245 .2761412 .3731746 . margins Predictive margins Number of obs = 74 Model VCE : OIM Expression : Pr(foreign), predict() ------------------------------------------------------------------------------ | Delta-method | Margin Std. Err. z P>|z| [95% Conf. Interval] -------------+---------------------------------------------------------------- _cons | .2972973 .05307 5.60 0.000 .193282 .4013126 ------------------------------------------------------------------------------ . margins, asobserved Predictive margins Number of obs = 74 Model VCE : OIM Expression : Pr(foreign), predict() ------------------------------------------------------------------------------ | Delta-method | Margin Std. Err. z P>|z| [95% Conf. Interval] -------------+---------------------------------------------------------------- _cons | .2972973 .05307 5.60 0.000 .193282 .4013126 ------------------------------------------------------------------------------ As you can see, they all agree. Now let's calculate the additive marginal effects, which you can get by adding , dydx(x) to margins : . /* (2) marginal effects: the change in the probability from 10K increase in price */ . margins, dydx(price2) Average marginal effects Number of obs = 74 Model VCE : OIM Expression : Pr(foreign), predict() dy/dx w.r.t. : price2 ------------------------------------------------------------------------------ | Delta-method | dy/dx Std. Err. z P>|z| [95% Conf. Interval] -------------+---------------------------------------------------------------- price2 | .0735299 .1751266 0.42 0.675 -.2697119 .4167716 ------------------------------------------------------------------------------ . sum price2 Variable | Obs Mean Std. Dev. Min Max -------------+--------------------------------------------------------- price2 | 74 .6165257 .2949496 .3291 1.5906 . . di "phat with price2 of .6165257: " exp(-1.079792+ .3528042*.6165257)/(1+exp(-1.079792+.3528042*.6165257)) phat with price2 of .6165257: .29686339 . margins, at(price2==.6165257) Adjusted predictions Number of obs = 74 Model VCE : OIM Expression : Pr(foreign), predict() at : price2 = .6165257 ------------------------------------------------------------------------------ | Delta-method | Margin Std. Err. z P>|z| [95% Conf. Interval] -------------+---------------------------------------------------------------- _cons | .2968633 .0531901 5.58 0.000 .1926126 .401114 ------------------------------------------------------------------------------ . . di "marginal effect with price2 of .6165257: " 0.3528042*(exp(-1.079792+ .3528042*.6165257)/(1+exp(-1.079792+.352 > 8042*.6165257)))*(1-exp(-1.079792+ .3528042*.6165257)/(1+exp(-1.079792+.3528042*.6165257))) marginal effect with price2 of .6165257: .07364277 . margins, dydx(price2) at(price2==.6165257) Conditional marginal effects Number of obs = 74 Model VCE : OIM Expression : Pr(foreign), predict() dy/dx w.r.t. : price2 at : price2 = .6165257 ------------------------------------------------------------------------------ | Delta-method | dy/dx Std. Err. z P>|z| [95% Conf. Interval] -------------+---------------------------------------------------------------- price2 | .0736428 .1759676 0.42 0.676 -.2712474 .4185329 ------------------------------------------------------------------------------ . margins, dydx(price2) atmeans Conditional marginal effects Number of obs = 74 Model VCE : OIM Expression : Pr(foreign), predict() dy/dx w.r.t. : price2 at : price2 = .6165257 (mean) ------------------------------------------------------------------------------ | Delta-method | dy/dx Std. Err. z P>|z| [95% Conf. Interval] -------------+---------------------------------------------------------------- price2 | .0736428 .1759676 0.42 0.676 -.2712474 .4185329 ------------------------------------------------------------------------------ This means that a car is 7 percentage points more likely to be foreign when the price jumps by 10K from the average price. Further up, the average increase when the price jumps by 10K from own value is pretty similar. You can even mix the two (after fitting a model with more variables): margins, dydx(price2) at((means) _continuous (base) _factor (asobserved) weight mpg==22) Code For Above: sysuse auto, clear gen price2 = price/10000 logit foreign price2 /* (1) compare predicted probabilities versus margins */ predict phat_by_stata, pr gen double phat_by_hand=exp(-1.079792+ .3528042*price2)/(1+exp(-1.079792+.3528042*price2)) sum phat* margins margins, asobserved /* (2) marginal effects: the change in the probability from 1K increase in price */ margins, dydx(price2) margins, dydx(price2) asobserved sum price2 di "phat with price2 of .6165257: " exp(-1.079792+ .3528042*.6165257)/(1+exp(-1.079792+.3528042*.6165257)) margins, at(price2==.6165257) di "marginal effect with price2 of .6165257: " 0.3528042*(exp(-1.079792+ .3528042*.6165257)/(1+exp(-1.079792+.3528042*.6165257)))*(1-exp(-1.079792+ .3528042*.6165257)/(1+exp(-1.079792+.3528042*.6165257))) margins, dydx(price2) at(price2==.6165257) margins, dydx(price2) atmeans margins, dydx(price2)
