[site]: stackoverflow
[post_id]: 5183946
[parent_id]: 5183557
[tags]: 
CREATE TRIGGER [dbo].[TrgPurchasesDelete] ON [dbo].[Purchases] FOR DELETE AS BEGIN UPDATE [dbo].[Organizations] SET account_balance = account_balance + DLTD.ammount_to_refund FROM [dbo].[Organizations] ORGA INNER JOIN [dbo].[Students] STDT ON STDT.organization_id = ORGA.organization_id INNER JOIN DELETED DLTD ON DLTD.student_id = STDT.student_id WHERE DLTD.ammount_to_refund > 0 AND DLTD.time_of_purchase > DATEADD(DAY, -30, SYSDATE) END GO
