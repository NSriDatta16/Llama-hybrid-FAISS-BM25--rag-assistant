[site]: stackoverflow
[post_id]: 4137932
[parent_id]: 
[tags]: 
Windows Azure - Blob storage initialization - Authorization Error

Background : I have an Azure application with one web role which is an ASP.NET application (C#), which uses a charting application to display the results of a calculation. The charting application needs an XML file as input. In order to access this XML file (referenced in the JavaScript), I use XDocument and related classes to manipulate the file, then save it, chart control is loaded on page refresh. Error : When trying to operate (GetPermissions, Create, Create if doesn't exist, etc.) on the container object, I get the following error: Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature. I also tried creating the container in advance using SpaceBlock, this didn't seem to have to change the outcome. Code : Here is the function I am calling on Page_Load. The error occurs on the line in bold (GetPermissions): private void InitializeStorage() { if (storageInitialized) { return; } lock (gate) { if (storageInitialized) { return; } try { CloudStorageAccount.SetConfigurationSettingPublisher((configName, configSetter) => { configSetter(RoleEnvironment.GetConfigurationSettingValue(configName)); }); // read account configuration settings var storageAccount = CloudStorageAccount.FromConfigurationSetting("DataConnectionString"); // create blob container for images blobStorage = storageAccount.CreateCloudBlobClient(); CloudBlobContainer container = blobStorage.GetContainerReference("xml"); // configure container for public access **var permissions = container.GetPermissions();** permissions.PublicAccess = BlobContainerPublicAccessType.Container; container.SetPermissions(permissions); CloudBlob opcBlob = container.GetBlobReference("OptionPriceChart.xml"); opcBlob.DownloadToFile("opcLocal.xml"); } catch (WebException) { throw new WebException("Storage services initialization failure. " + "Check your storage account configuration settings. If running locally, " + "ensure that the Development Storage service is running."); } storageInitialized = true; } }
