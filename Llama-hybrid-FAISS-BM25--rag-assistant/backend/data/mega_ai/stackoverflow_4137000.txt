[site]: stackoverflow
[post_id]: 4137000
[parent_id]: 4110954
[tags]: 
I found out that what I was originally doing was working but I simply wasn't sending enough of the post information. I wrote a function to help me easily do this in the future as well. /** * @author: jeremysawesome - www.dnawebagency.com * @description: save_remote_file - Requires a url, a post array and a * filename. This function will send the post_array to the remote server * and retrieve the remote file. The retrieved remote file will be * saved to the filename specified by the filename parameter. * Note: This function should only be used when specific post information * must be submitted to the remote server before the file download * will begin. * For Example: http://www.carriersoftwaredata.com/Login.aspx?file=FHWA * @param: post_url - the url to send a post request to * @param: post_array - the post arguments to send to the remote server. * @param: filename - the name to save the retrieved remote file as **/ function save_remote_file($post_url, $post_array, $filename) { //get the url data $url_data = parse_url($post_url); $post_str = http_build_query($post_array); //build the headers to send to the form $headers = "POST $post_url HTTP/1.0\r\n"; $headers .= "Host: {$url_data['host']}\r\n"; $headers .= "User-Agent: Mozilla/4.5 [en]\r\n"; $headers .= "Content-Type: application/x-www-form-urlencoded\r\n"; $headers .= "Content-Length: ".strlen($post_str)."\r\n"; $headers .= "\r\n"; $headers .= $post_str."\r\n\r\n"; //create socket and download data $fp = @fsockopen($url_data['host'], 80, $errno, $errstr, 30); fputs($fp, $headers); $remote_file = stream_get_contents($fp); fclose($fp); //save data $saved_file = fopen($filename,'w') or die('Cannot Open File '. $filename); fwrite($saved_file, $remote_file); fclose($saved_file); }// save_remote_file For those that care - or need to do something similar in the future, here is the complete code (without the above function). '[USERNAME]', 'pass'=>'[PASSWORD]' ); //url for fhwa db file $fhwa_url = 'http://www.carriersoftwaredata.com/Login.aspx?file=FHWA'; //get the contents of the fhwa page $fhwa_login = file_get_contents($fhwa_url); //load contents of fhwa page into a DOMDocument object $fhwa_dom = new DOMDocument; if (!$fhwa_dom->loadhtml($fhwa_login)) { die('Could not Load html for FHWA Login page.'); } else { //create a post array to send back to the server - keys relate to the name of the input - this allows us to retrieve the randomly generated values of hidden inputs $fhwa_post_items = array( '__EVENTTARGET' => '', '__EVENTARGUMENT' => '', '__VIEWSTATE' => '', 'Email' => '', 'Password' => '', 'btnSubmit' => 'Submit', '__EVENTVALIDATION' => '', ); //create an xpath object $xpath = new DOMXpath($fhwa_dom); //iterate through the form1 form and find all inputs foreach($xpath->query('//form[@name="form1"]//input') as $input) { //get name and value of input $input_name = $input->getAttribute('name'); $input_value = $input->getAttribute('value'); //check if input name matches a key in the post array if(array_key_exists($input_name, $fhwa_post_items)) { //if the input name is Email or Password enter the defined email and password switch($input_name) { case 'Email': $input_value = $user_info['user']; break; case 'Password': $input_value = $user_info['pass']; break; }//switch //assign value to post array $fhwa_post[$input_name] = $input_value; }// if }// foreach //save the file - function shown above save_remote_file($fhwa_url, $fhwa_post, "my_data_folder/my_fhwa-db.zip"); }// if
