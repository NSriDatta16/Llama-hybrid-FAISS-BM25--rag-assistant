[site]: stackoverflow
[post_id]: 5328763
[parent_id]: 
[tags]: 
Magento - re-importing of products

I have a script that pulls in data from a 3rd party file. My import simply parses and inserts rows, which is working fine. The problem comes with images. When the import script runs, it first deletes all the current items and then the import begins, inserting all products and images into the gallery. On the first import, everything is fine, the images go in and I see them on the frontend no problem. The problem comes with everytime I then re-import these products, it doesn't seem to delete all images, as when the products re-import, I see, for example the 4 images correct, then then loads of blank rows, like images should be there, but can't be found. I don't want to see these blank lines, but I'm not sure why they are there. Could it be because the images for the product are already in the catalogue? I am really unsure what and why this is doing what it is. Thanks EDIT: My code is: require_once('app/Mage.php'); $app = Mage::app('default'); $product = Mage::getSingleton('catalog/product'); $txt_file = file_get_contents('test.txt'); $rows = explode("\n", $txt_file); array_shift($rows); foreach($rows as $row => $data) { //get row data $row_data = explode('^', $data); $info[$row]['uniqueid'] = $row_data[0]; $info[$row]['client'] = $row_data[1]; $info[$row]['make'] = $row_data[2]; $info[$row]['model'] = $row_data[3]; $info[$row]['adtext'] = $row_data[4]; //display images $row_images = explode(',', $info[$row]['picturereference']); foreach($row_images as $row_image) { $product->addImageToMediaGallery(Mage::getBaseDir('media') . DS . 'import/' . $row_image, array('image', 'small_image','thumbnail'), false, false); } $product->setStoreId(Mage::app()->getStore(true)->getWebsite()->getId()); $product->setWebsiteIds(array(Mage::app()->getStore(true)->getWebsite()->getId())); $product->setId($info[$row]['id']); $product->setSku(strtolower($info[$row]['make']).'-'.strtolower($info[$row]['model'])); $product->setName($info[$row]['make']); $product->setDescription($info[$row]['adtext']); try { $product->save(); echo "Saved"; } catch (Exception $ex) { echo " ".$ex." "; } } Is this because the addImageToMediaGallery is called on each iteration and adding all images to each product? Thanks
