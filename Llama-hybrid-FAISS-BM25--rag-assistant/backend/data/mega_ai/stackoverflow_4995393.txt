[site]: stackoverflow
[post_id]: 4995393
[parent_id]: 
[tags]: 
Tests using Webdriver with remote HTMLUnit having trouble logging into gmail

For some reason, after logging into a site like gmail, htmlunit is not working. It is not able to find html elements. The following is a very simple ruby script that shows the problem, note it assumes that webdriver server is running on the same machine running it: require 'rubygems' require 'watir-webdriver' require 'rspec/expectations' ## ## THE FOLLOWING TWO WAYS WORK # #browser = Watir::Browser.new(:remote, :url => "http://127.0.0.1:4444/wd/hub", :desired_capabilities => :firefox) #browser = Watir::Browser.new(:remote, :url => "http://127.0.0.1:4444/wd/hub", :desired_capabilities => :internet_explorer) ## ## THIS WAY FAILS ## capabilities = Selenium::WebDriver::Remote::Capabilities.htmlunit(:javascript_enabled => true) browser = Watir::Browser.new(:remote, :url => "http://127.0.0.1:4444/wd/hub", :desired_capabilities => capabilities) #Login to gmail browser.goto "http://gmail.com" browser.text_field(:id,'Email').set 'roberttestingstuff041' browser.text_field(:id,'Passwd').set 'k4238chsj55983w' browser.button(:id,'signIn').click sleep 5.0 #sleep shouldnt be needed, but just to be sure we are waiting long enough for log in to complete frame = browser.frame(:id,'canvas_frame') #It fails on the next line when using htmlunit frame.link(:text, 'Sign out').exist?.should == true frame.link(:text, 'Sign out').visible?.should == true frame.div(:id, 'guser').exist?.should == true frame.div(:text,'Compose mail').exist?.should == true Note that if I create the browser object using firefox or IE, this simple test works. It seems to get hung up on the redirects that happen during the login process. The site I am really trying to test follows a very similar pattern, so I set up this simplified example with gmail which seems to show the same problem. Can anyone help turn this into a passing test? Note that I can get a similar test to work using Celerity, which is also based on HTMLUnit, so I believe there should be some way to make this work? This is the error that shows in the webdriver server, clearly showing it failing to find the attribute: 12:31:16.321 INFO - WebDriver remote server: INFO: Executing: [find element: By.xpath: .//a[normalize-space()='Sign out' ] at URL: /session/1297704604365/element) 12:31:17.996 WARN - WebDriver remote server: WARN: org.openqa.selenium.NoSuchElementException: Unable to locate a node using .//a[normalize-space()='Sign out'] System info: os.name: 'Windows 7', os.arch: 'x86', os.version: '6.1', java.version: '1.6.0_21' Driver info: driver.version: EventFiringWebDriver at org.openqa.selenium.htmlunit.HtmlUnitDriver.findElementByXPath(HtmlUnitDriver.java:699) at org.openqa.selenium.By$6.findElement(By.java:205) at org.openqa.selenium.htmlunit.HtmlUnitDriver$4.call(HtmlUnitDriver.java:1133)
