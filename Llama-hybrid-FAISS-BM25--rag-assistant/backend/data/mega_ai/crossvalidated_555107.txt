[site]: crossvalidated
[post_id]: 555107
[parent_id]: 555073
[tags]: 
This can be accomplished by using analytics weights (aka aweights in Stata) in your analysis of the collapsed/aggregated data: analytic weights are inversely proportional to the variance of an observation; that is, the variance of the jth observation is assumed to be $\frac{\sigma^2}{w_j}$ , where $w_j$ are the weights. Typically, the observations represent averages, and the weights are the number of elements that gave rise to the average. For most Stata commands, the recorded scale of aweights is irrelevant; Stata internally rescales them to sum to N, the number of observations in your data, when it uses them. Here is a toy example: . sysuse auto, clear (1978 automobile data) . sum price Variable | Obs Mean Std. dev. Min Max -------------+--------------------------------------------------------- price | 74 6165.257 2949.496 3291 15906 . collapse (mean) price (count) w = price , by(foreign) . list, clean noobs foreign price w Domestic 6,072.4 52 Foreign 6,384.7 22 . sum price [aw=w] Variable | Obs Weight Mean Std. dev. Min Max -------------+----------------------------------------------------------------- price | 2 74 6165.257 201.8417 6072.423 6384.682 . sum price Variable | Obs Mean Std. dev. Min Max -------------+--------------------------------------------------------- price | 2 6228.552 220.8003 6072.423 6384.682
