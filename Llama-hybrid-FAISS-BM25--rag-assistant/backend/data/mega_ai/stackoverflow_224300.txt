[site]: stackoverflow
[post_id]: 224300
[parent_id]: 224162
[tags]: 
I bet your users like the flexibility of entering the formulas into Excel, so I'd suggest an approach like this:- Write something to allow them to enter formulas into your application using the type of operators that they actually will use with keywords for the different base prices. This can just be stored away as a string. Validate this using a white-list approach (could be fairly tricky, maybe you'll need to look up some stack-based parsing algorithms). You might allow: + - / * ( ) {numeric constants} {keywords for base prices}. Translate these formulas into something that your database can understand in the SELECT list. If the formulas that they enter are similar to what you can do in SQL this might not be too difficult. The keywords get turned into column names and everything else can be left alone. Then, you'll be able to SELECT back the data, averaging over the time periods, etc by plugging in the special formual and running it over your historic data and/or predictions. Step 2 has some tricks to it, but it would make everything else easy (and efficient).
