[site]: crossvalidated
[post_id]: 589283
[parent_id]: 
[tags]: 
How to estimate which user features predicts the treatment effect of an AB test

I have an AB test with a target variable ( Y ), M user features and N other features. The user features can be binary, multilevel or continuous. As an example, we can say that the target variable is the number of purchases following an email marketing campaign. The treatment is here "being sent an email" and the control is "not being sent and email". I want to study how the user features affect the treatment effect. I want to be able to say things like "the treatment had little or no effect for male customers above 50 years of age" or "the treatment had the greatest effect for young women with a history of buying kids' clothes". This is hypothesis generating so in the next AB test I may try to only send emails to young women buying kid's clothes. I have thought of two ways to study this (there are probably more!, but I can't see which one is better (or if either of them is any good). Please let me know which of the alternatives I should try and why. Thanks! Method 1: Develop a model ( M1 ) using control group data only that predicts the target variable, Y_hat , from the M user features and/or the N other features. The "other features" can be any causal data I find Calculate the treatment effect ( d ) as the actual - predicted target variable, i.e. d = Y-Y_hat Create a second model ( M2 ) predicting the treatment effect d for the subjects in the treatment group using the M + N features Study the variable importance of the M user features in M2 Method 2: Bin all features that are continuous and replace the original ones. We now have only discrete values For each combination of the ( M + N ) features, calculate the average target value for users in the treatment and control groups separately ( Yt and Yc ) For each combination of the ( M + N ) features, define the treatment effect ( d ) as the difference between the average treatment value in the treatment and control groups, i.e. d = Yt-Yc Create a model predicting d from the ( M + N ) features Study the model's variable importance of the M user features
