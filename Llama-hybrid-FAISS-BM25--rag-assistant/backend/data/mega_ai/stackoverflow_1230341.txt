[site]: stackoverflow
[post_id]: 1230341
[parent_id]: 1010296
[tags]: 
I am having this same problem too. I see the broken email when I run in TestNG with Spring and a whole bunch of application jars. When I run in a plain java main method, it works fine. Here are the class differences between when I run this code inside TestNG vs PSVM These are the mail classes that are absent when I run in TestNG: -com.sun.mail.smtp.SMTPTransport$Authenticator -com.sun.mail.smtp.SMTPTransport$DigestMD5Authenticator -com.sun.mail.smtp.SMTPTransport$LoginAuthenticator -com.sun.mail.smtp.SMTPTransport$PlainAuthenticator -com.sun.mail.util.FolderClosedIOException -com.sun.mail.util.MessageRemovedIOException -com.sun.mail.util.PropUtil -javax.mail.FolderClosedException -javax.mail.MessageRemovedException -javax.mail.Multipart -javax.mail.internet.ParameterList$MultiValue -javax.net.SocketFactory -javax.net.ssl.SSLException -javax.net.ssl.SSLPeerUnverifiedException -javax.net.ssl.SSLSocket This mail class is present in TestNG but not PSVM +javax.mail.internet.CachedDataHandler
