[site]: stackoverflow
[post_id]: 1656544
[parent_id]: 1654661
[tags]: 
Something I've seen implemented in the past: the increment value can't be expressed precisely in the fixed-point format, but it can be expressed as a fraction. (This is similar to the "keep track of an error value" solution.) Actually in this case the problem was slightly different, but conceptually similarâ€”the problem wasn't a fixed-point representation as such, but deriving a timer from a clock source that wasn't a perfect multiple. We had a hardware clock that ticks at 32,768 Hz (common for a watch crystal based low-power timer). We wanted a millisecond timer from it. The millisecond timer should increment every 32.768 hardware ticks. The first approximation is to increment every 33 hardware ticks, for a nominal 0.7% error. But, noting that 0.768 is 768/1000, or 96/125, you can do this: Keep a variable for "fractional" value. Start it on 0. wait for the hardware timer to count 32. While true: increment the millisecond timer. Add 96 to the "fractional" value. If the "fractional" value is >= 125, subtract 125 from it and wait for the hardware timer to count 33. Otherwise (the "fractional" value is There will be some short term "jitter" on the millisecond counter (32 vs 33 hardware ticks) but the long-term average will be 32.768 hardware ticks.
