[site]: stackoverflow
[post_id]: 5015969
[parent_id]: 
[tags]: 
ConstraintException when querying SQlite database with C#

I’m hoping somebody will be able to help with my SQLite database problem. I’m receiving a ConstraintException when querying my SQLite database with C#. The full exception message is “ Failed to enable constraints. One or more rows contain values violating non-null, unique, or foreign-key constraints. ” I originally built this database using access which worked fine, but for various reasons I had to recreate it using SQLite. To give a bit of background - this is a simple status scheduling program. Each Status has an associated Account and Schedule . I realise Statuses and Schedule is a 1:1 relationship and could be in the same table but to allow the program to develop further I have split them into two tables. See below for a cut down version of my table script (this is enough to recreate the problem). PRAGMA foreign_keys = ON; CREATE TABLE Accounts (ID INTEGER PRIMARY KEY AUTOINCREMENT, Name char(100)); CREATE TABLE Statuses (ID INTEGER PRIMARY KEY AUTOINCREMENT, AccountId INTEGER REFERENCES Accounts(ID) ON DELETE CASCADE, Text char(140)); CREATE TABLE Schedule (ID INTEGER PRIMARY KEY REFERENCES Statuses(ID) ON DELETE CASCADE, StartDate char(255), Frequency INT); I did not have any issues until I created two Statues and associated them to the same Account . Accounts ID Name 1 Fred Blogs Statuses ID AccountId Text 1 1 “Some text” 2 1 “Some more text” Schedule ID StartDate Frequency 1 16/02/2011 1 2 16/02/2011 1 The select statement I’m using which throws the exception is: SELECT Statuses.Id, Statuses.Text, Accounts.Id, Accounts.Name, Schedule.StartDate, Schedule.Frequency FROM [Statuses], [Accounts], [Schedule] WHERE Statuses.AccountId = Accounts.Id AND Statuses.Id = Schedule.Id If I run the same query, but remove the ‘ Accounts.Id ’ column the query works fine. See below for the C# code I’m using but I don’t think this is the problem public DataTable Query(string commandText) { SQLiteConnection sqliteCon = new SQLiteConnection(ConnectionString); SQLiteCommand sqliteCom = new SQLiteCommand(commandText, sqliteCon); DataTable sqliteResult = new DataTable("Query Result"); try { sqliteCon.Open(); sqliteResult.Load(sqliteCom.ExecuteReader()); } catch (Exception) { throw; } finally { sqliteCon.Close(); } return sqliteResult; } Any help will be appreciated. Thanks.
