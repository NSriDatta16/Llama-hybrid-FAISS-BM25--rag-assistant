[site]: stackoverflow
[post_id]: 3305061
[parent_id]: 3298218
[tags]: 
The best way to avoid this kind of issue is to upload to a temporary file, then rename it. That way there's no chance for a partial file appearing. As for why it happens every time, think about it. 400k page views per day == 4.6 requests per second average. Considering most sites I've ever seen have far more traffic over specific hours (during the day), I'd suspect that you're seeing upwards of 10 to 20 requests per second. at that rate, if the file write (because of the upload) takes longer than 0.05 seconds, the chance of a read while it's being written to rises sharply. So your choices (In order of most robust to least. You can always do multiple): Do the uploads after hours when traffic is (hopefully) lower... Use a FTP server that does the renaming bit for you. Manually rename the file when you upload the new one. (Important; Rename to overwrite the original. don't delete or move the original first)... Hack Smarty to ignore the new files with a timestamp less than about 10 to 30 seconds old (Simply call filemtime() to determine when it was last modified. Be sure to call clearstatcache() first so you don't get an old time)...
