[site]: stackoverflow
[post_id]: 3419466
[parent_id]: 
[tags]: 
iphone - main thread freezes for half a second... why?

I have an app that is drawing lines on a quartz context. The app starts drawing when the user move his finger across the screen. At the time TouchesMoved is fired, I save the quartz context to a PNG file (I know saving a file is slow... I have tried to do this to memory but app memory usage skyrocketed, so, I am trying to do it to disk). As the context is being saved to this, I do this on touches moved if (firstMove) // first movement after touchesbegan [NSThread detachNewThreadSelector:@selector(newThreadUNDO) toTarget:self withObject:nil]; firstMove = NO } and then I have - (void) newThreadUNDO { NSAutoreleasePool* p = [[NSAutoreleasePool alloc] init]; [NSThread setThreadPriority:0.1]; [NSThread sleepForTimeInterval:0.0]; [self performSelectorOnMainThread:@selector(copyUNDOcontext) withObject:nil waitUntilDone:NO]; [p release]; } and - (void) copyUNDOcontext { CGFloat w = board.image.size.width; CGFloat h = board.image.size.height; CGRect superRect = CGRectMake(0,0, w, h); CGSize size = CGSizeMake(w, h); UIGraphicsBeginImageContext(size); CGContextRef new = UIGraphicsGetCurrentContext(); // lineLayer is the layer context I need to save CGContextDrawLayerInRect(new, superRect, lineLayer); UIImage *imagem = UIGraphicsGetImageFromCurrentImageContext(); [self saveTempImage:imagem :@"UNDO.png"]; UIGraphicsEndImageContext(); } The problem is: as soon as the user starts moving, the new thread is fired, but even this new thread being with low priority the main thread still freezes for about half second (probably while the file is being saved). Why is that? How can I try to solve that? thanks.
