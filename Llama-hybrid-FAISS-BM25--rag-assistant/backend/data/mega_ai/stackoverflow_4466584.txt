[site]: stackoverflow
[post_id]: 4466584
[parent_id]: 
[tags]: 
Prevent partial-caching of web resources

I have a web page with a resource at a constantly changing address. For example, the web page might be at http_://www.mysite.com/?page=page1 and it might contain an image http_://www.mysite.com/?img=image999. Although both resources are on my site, I do not control the placement of particular images on particular pages. I set headers for long caching on pages as well as images. But in case the user agent only caches web pages and not images (or for example, user clears cache and the image gets cleared from cache), the user agent will retrieve the page from cache and make a request for /?img=image999. However, at this point, the image is no longer at /?image=image999 but instead at say, /?image=image998. Thus the image won't be displayed to the user. What is the solution to this problem? Here are the ones I could think of :- Disable caching of both web pages and images. Worst solution. Disable caching of web pages only. Better solution. Remember on the server-side that image998 was once at image999 and if a request comes in for /?image=image999, redirect/transfer it to /?image=image998. Best solution but a pain to implement. EDIT: In fact, I now realize this is impossible in my situation sadface My exact problem doesn't deal with images but with HTML5 videos. Specifically, on Google Chrome I notice that videos seem to be removed from the cache quite frequently even though I'm setting 1-year expiry dates on the cache. But I'm still interested in the solution for general resources regardless of Chrome's caching policies. EDIT: To confirm, I'm using "dont revalidate" + "expires in 1 year" caching on both the web page and the image. Thus if a UA requests the web page (page1) + image (image999) once, it wont hit the server for subsequent requests and all is good. The problem happens when the image drops out of the UA cache but the web page remains. In this situation, the UA will not request the server for the web page, but will request the server for the image (image999). However, in the meantime, the image has changed URLs (image999 -> image998) and the server will return a 404. The result is that the UA will not display the image. How do I prevent this?
