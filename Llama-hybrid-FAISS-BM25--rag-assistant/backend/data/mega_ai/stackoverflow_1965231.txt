[site]: stackoverflow
[post_id]: 1965231
[parent_id]: 
[tags]: 
PHP and AJAX problem?

When a user casts a vote the script updates my database but it wont display the following code below to tell the user its vote has been excepted. //This will output the movie id, new rating, new votes, and a message. echo " Vote cast and saved. n"; How can I fix this problem to get the above code to display when a user enters she or he's vote? Here is part of the code below I think is the problem. if(mysql_num_rows(mysql_query("SELECT * FROM `voters` WHERE `id`='".$id."' && `ip`='".$ip."'")) == 0) { //This will insert the information about the user, so they can't vote for the same movie again. mysql_query("INSERT INTO `voters`(`id`, `ip`) VALUES('".$id."', '".$ip."')"); //This will add one more vote and add the rating to the total rating. mysql_query("UPDATE `movies` SET `votes`=votes+1, `rating`=rating+".$vote_cast." WHERE `id`='".$id."'") or die(mysql_error()); //This will retrieve the newly updated data about the movie. $data = mysql_fetch_array(mysql_query("SELECT * FROM `movies` WHERE `id`='".$id."'")); //This will get the average rating and round it to one decimal place. $rating = round($data['rating']/$data['votes'], 1); $votes = $data['votes']; //This will change the output type to XML, instead of HTML. header('Content-Type: text/xml'); header('Pragma: no-cache'); //Required header in valid XML files echo ' '."n"; //This will output the movie id, new rating, new votes, and a message. echo " Vote cast and saved. n"; }else{ ////This will change the output type to XML, instead of HTML. header('Content-Type: text/xml'); header('Pragma: no-cache'); ////Required header in valid XML files echo ' '."n"; //This message will be shown if they have already voted, echo " You have already voted. n"; } } Okay maybe it's this part of my Ajax code below that is giving me the problem. function statechange_rate() { if (http.readyState == 4) { var xmlObj = http.responseXML; var html = xmlObj.getElementsByTagName('result').item(0).firstChild.data; var id = xmlObj.getElementsByTagName('result').item(0).getAttribute("id"); var votes = xmlObj.getElementsByTagName('result').item(0).getAttribute("votes"); var rating = xmlObj.getElementsByTagName('result').item(0).getAttribute("rating"); //Before, you may have noticed we set votes="-1" if they had already voted, this was just to provide an easy way to check the return of our script. if(votes != -1) { //This will inform the user about the vote they have cast. document.getElementsByName('output_' + id).item(0).innerHTML = " " + html; //This will set a delay to make that message go away in 5000 miliseconds (5 seconds). window.setTimeout("document.getElementsByName('output_" + id + "').item(0).innerHTML = '';", 5000); //This will update the rating on the page to the new one. document.getElementsByName('rating_' + id).item(0).innerHTML = rating; document.getElementsByName('votes_' + id).item(0).innerHTML = votes; }else{ document.getElementsByName('output_' + id).item(0).innerHTML = " " + html; window.setTimeout("document.getElementsByName('output_" + id + "').item(0).innerHTML = '';", 5000); } } }
