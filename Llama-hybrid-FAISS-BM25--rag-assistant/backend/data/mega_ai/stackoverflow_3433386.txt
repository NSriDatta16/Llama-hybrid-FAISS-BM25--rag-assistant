[site]: stackoverflow
[post_id]: 3433386
[parent_id]: 3433217
[tags]: 
From the code snippet provided it's obvious you're facing quite a severe case of intermingled responsibilities and copy paste coding from lack of factoring. Your edit function handles stuff on at least three different layers and for three distinct objects. The refactoring operations I would be likely to apply are extracting Validator classes for each of the different sets of data you're handling, Model classes likewise for interacting with the database in each case and Commands to bind the three together: accept data, pass it through validators, then interact with their respective Models to persist the data. The Models would then generate Change entries based on successful operations. If you're disinclined to take on such significant change right now, good first steps would be separating the different parts in your edit function into other, better partitioned functions and only worry about classes and polymorphism when you've tackled that first hurdle. To better understand why your code is broken and what you can do to mend it, I recommend reading something like Refactoring (by Martin Fowler) or perhaps The Pragmatic Programmer.
