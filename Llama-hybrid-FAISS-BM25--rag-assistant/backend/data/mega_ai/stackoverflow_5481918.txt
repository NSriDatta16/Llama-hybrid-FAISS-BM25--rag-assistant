[site]: stackoverflow
[post_id]: 5481918
[parent_id]: 5481761
[tags]: 
In my first response I didn't see that you wanted to retain line breaks, so here's a better version. It replaces br with an unlikely string %%br%% and then at the end replaces them with new line (\n). So if that string actually appears in the text, it will be replaced by a new line. You can change that to anything you like, just make it something that is unlikely to be encountered in the text. function removeMarkup(m) { var d = document.createElement('div'); d.innerHTML = m; var c = 0; // Make brString something that should never appear in the text // and has no special meaning in a RegExp var brString = '%%br%%' var re = new RegExp('\\s*' + brString + '\\s*','g'); function getTextWithReturns(node) { var tag = node.tagName && node.tagName.toLowerCase(); var nodes = node.childNodes; var type = node.nodeType; var s = ''; // Deal with br if (tag == 'br') { return brString; } if (nodes && nodes.length) { for (var i=0, iLen=nodes.length; i some text more text Here is a paragraph with some bold and italic text, plus a span and a line break break break about there. Here is another paragraph with some bold and italic text, plus plus a span and a line break here. Set value
