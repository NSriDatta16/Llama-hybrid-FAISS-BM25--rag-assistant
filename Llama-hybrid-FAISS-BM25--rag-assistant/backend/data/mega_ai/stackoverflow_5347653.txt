[site]: stackoverflow
[post_id]: 5347653
[parent_id]: 
[tags]: 
Filtering compass readings

I'm using compass heading to rotate an MKMapView. The rotation was a bit jerky so I'm trying to filter it like Google Maps on the iphone does (or appears to do some trickery). I'm trying to filter the reading from the iphone compass using a moving average formula but it fails on the crossover between 359 adn 0 becuase it starts to average backwards from 35x to 0 and causes the map to rotate backwards as it approaches north from the west. Any ideas what the best way is to filter this data so that it crosses from 359 back to zero and maintain the rolling average. Code is here: - (void)locationManager:(CLLocationManager *)manager didUpdateHeading:(CLHeading *)newHeading { static float xd=0; static float k = 0.22; // Moving average formula xd = k * xd + (1.0 - k) * newHeading.magneticHeading; NSLog(@"%0.2f : %0.2f", newHeading.magneticHeading, xd); [map setTransform:CGAffineTransformMakeRotation((-1 * xd * M_PI) /180)];} Thanks for any help
