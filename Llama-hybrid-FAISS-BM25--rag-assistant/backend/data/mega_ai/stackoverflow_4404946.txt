[site]: stackoverflow
[post_id]: 4404946
[parent_id]: 
[tags]: 
How to use AVCaptureSession to stream live preview video, then take a photo, then return to streaming

I have an application that creates its own live preview prior to taking a still photo. The app needs to run some processing on the image data and thus is not able to rely on AVCaptureVideoPreviewLayer. Getting the initial stream to work is going quite well, using Apple's example code. The problem comes when I try to switch to the higher quality image to take the snapshot. In response to a button press I attempt to reconfigure the session for taking a full resolution photo. I've tried many variations but here is my latest example (which still does not work): - (void)sessionSetupForPhoto { [session beginConfiguration]; session.sessionPreset = AVCaptureSessionPresetPhoto; AVCaptureStillImageOutput *output = [[[AVCaptureStillImageOutput alloc] init] autorelease]; for (AVCaptureOutput *output in [session outputs]) { [session removeOutput:output]; } if ([session canAddOutput:output]){ [session addOutput:output]; } else { NSLog(@"Not able to add an AVCaptureStillImageOutput"); } [session commitConfiguration]; } I am consistently getting an error message just after the commitConfiguration line that looks like this: (that is to say, I am getting an AVCaptureSessionRuntimeErrorNotification sent to my registered observer) Received an error: NSConcreteNotification 0x19d870 {name = AVCaptureSessionRuntimeErrorNotification; object = ; userInfo = { AVCaptureSessionErrorKey = "Error Domain=AVFoundationErrorDomain Code=-11800 \"The operation couldn\U2019t be completed. (AVFoundationErrorDomain error -11800.)\" UserInfo=0x19d810 {}"; The documentation in XCode ostensibly provides more information for the error number (-11800), "AVErrorUnknown - Reason for the error is unknown."; Previously I had also tried calls to stopRunning and startRunning, but no longer do that after watching WWDC Session 409, where it is discouraged. When I was stopping and starting, I was getting a different error message -11819, which corresponds to "AVErrorMediaServicesWereReset - The operation could not be completed because media services became unavailable.", which is much nicer than simply "unknown", but not necessarily any more helpful. It successfully adds the AVCaptureStillImageOutput (i.e., does NOT emit the log message). I am testing on an iPhone 3g (w/4.1) and iPhone 4. This call is happening in the main thread, which is also where my original AVCaptureSession setup took place. How can I avoid the error? How can I switch to the higher resolution to take the photo? Thank you!
