[site]: stackoverflow
[post_id]: 5113215
[parent_id]: 5111439
[tags]: 
Inspired by Martin Morgan's solution to a closely related question, here's a truly vectorized way to generate the P_ID using the cummax function. It becomes clear once you note that P_ID is closely related to the cumsum of !(r : set.seed(1) N = .5 # flip the coins that generated H_ID. z cbind(H_ID, P_ID) H_ID P_ID [1,] 1 1 [2,] 1 2 [3,] 2 1 [4,] 3 1 [5,] 3 2 [6,] 3 3 [7,] 3 4 [8,] 4 1 [9,] 5 1 [10,] 5 2 I haven't done detailed timing tests, but it's probably wicked fast, since these are all internal, vectorized functions
