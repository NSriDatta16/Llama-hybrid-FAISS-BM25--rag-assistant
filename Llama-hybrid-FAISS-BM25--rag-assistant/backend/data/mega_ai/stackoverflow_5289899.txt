[site]: stackoverflow
[post_id]: 5289899
[parent_id]: 
[tags]: 
Using Protovis with Dynamically Loaded Data via JQuery

I am dynamically loading some social network data into a web page that I want to visualise using protovis.(Actually, the data is loaded in in a two pass process - first a list of user names is grabbed from Twitter, then a list of social connections is grabbed from the Google Social API.) The protovis code seems to run inside an event loop, which means the data loading code needs to be outside this loop. How do I load the data into the page and parse it, before "switching on" the protovis event loop? At the moment, I think there's a race condition whereby protovis tries to visualise network data that hasn't been loaded and parsed yet? //getNet is where we get a list of Twitter usernames function getNet(){ url="http://search.twitter.com/search.json?q=jisc11&callback=?" $.getJSON(url,function(json){ users=[] uniqusers={} for (var u in json['results']) { uniqusers[json['results'][u]['from_user']]=1 } for (var uu in uniqusers) users.push(uu) getConnections(users) }) } //getConnections is where we find the connections between the users identified by the list of Twitter usernames function getConnections(users){ //Google social API limits lookup to 50 URLs; need to page this... if (users.length>50) users=users.slice(0,49) str='' for (var uic=0; uic // This code is taken directly from the protovis example var w = document.body.clientWidth, h = document.body.clientHeight, colors = pv.Colors.category19(); var vis = new pv.Panel() .width(w) .height(h) .fillStyle("white") .event("mousedown", pv.Behavior.pan()) .event("mousewheel", pv.Behavior.zoom()); var force = vis.add(pv.Layout.Force) .nodes(followers.nodes) .links(followers.links); force.link.add(pv.Line); force.node.add(pv.Dot) .size(function(d) (d.linkDegree + 4) * Math.pow(this.scale, -1.5)) .fillStyle(function(d) d.fix ? "brown" : colors(d.group)) .strokeStyle(function() this.fillStyle().darker()) .lineWidth(1) .title(function(d) d.nodeName) .event("mousedown", pv.Behavior.drag()) .event("drag", force) //comment out the next line to remove labels //.anchor("center").add(pv.Label).textAlign("center").text(function(n) n.nodeName) vis.render();
