[site]: crossvalidated
[post_id]: 538934
[parent_id]: 536009
[tags]: 
If the research needs to control the error of estimation for each state's estimate, then the sample sizes should be determined separately for each state. Here's an example showing that country level planning (which I also call "population-level" below) is insufficient. Consider a Country with 2 states. We want to estimate the Country average of a certain value. In State A the population size is 900,000 and the variance is 100. In State B the population size is 100,000 and the variance is 400. Suppose we want to estimate the Country average using a stratified sample with a bound on the error of estimation of 1. The allocation fractions are $$ a_1 = \frac{N_1\sigma_1}{N_1\sigma_1 + N_2\sigma_2} = 0.818\\ a_2 = \frac{N_2\sigma_2}{N_1\sigma_1 + N_2\sigma_2} = 0.182 $$ The approximate sample size required is $$ n = \frac{N_1^2\sigma_1^2/a_1 + N_2^2\sigma_2^2/a_2}{N^2(B/1.96)^2 + N_1\sigma_1^2 + N_2\sigma_2^2} = 465 $$ Giving strata sample sizes as $$ n_1 = 380\\ n_2 = 85 $$ But if we now estimate the bound on the error of estimation for State B, $$ 1.96\sqrt{\frac{\sigma^2}{n}}= 1.96\sqrt{\frac{400}{85}} = 4.25 $$ So even though taking a sample of 380 from State A and 85 from State B is enough to estimate the Country average with a bound on the error of estimation of 1, the estimate for State B's average is much less certain. In general, the population-level designs will allocate more power to strata that are larger and easier to estimate, which can leave strata that are smaller and more variable with larger errors. There may be allocation strategies to avoid this, but I don't know any to recommend. If both population-level and strata-level estimates are important, I'd suggest performing both sample size calculations and then for each strata use whichever sample size calculation was larger. I suppose you could try to update the population-level sample size calculations with the minimum estimated strata-level sample sizes, hopefully reducing the population-level calculated values, but that's going outside of standard methods.
