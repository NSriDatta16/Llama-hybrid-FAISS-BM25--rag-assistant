[site]: stackoverflow
[post_id]: 2257722
[parent_id]: 2235889
[tags]: 
if you want a list of property IDs, but only a single average price for all of them, life will be simpler if you do more than one query. this sounds like a good case for using a stored procedure. you could do it like this: pass location into the stored procedure and select from properties where the location matches insert the results into a temp table with propertyid, listingtime and avgprice (currently empty) select rows with a DATEDIFF of 10 days. if 0 results, select rows with a DATEDIFF of 30 days select AVG price from the temp table, filtering on 10 days if there is data. insert that value into each row of the table you may want to play with changing the order of items 1 and 3 to see which yields better performance.
