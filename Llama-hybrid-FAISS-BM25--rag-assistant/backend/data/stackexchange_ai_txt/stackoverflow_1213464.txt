[site]: stackoverflow
[post_id]: 1213464
[parent_id]: 
[tags]: 
PHP pfsockopen in a session

I'm making an MSN client in PHP. I have this code, which connects to a server and logs in to MSN: $server2 = explode(":", $xfr[3]); $socket2 = pfsockopen($server2[0], (int)$server2[1]); $_SESSION["socket"] = $socket; echo ' Connected to 2nd server. '; //Send MSNP version fputs($socket2, "VER 0 MSNP10 CVR0\r\n"); echo fread($socket2, 5000) . ' '; //Send user-agent fputs($socket2, "CVR 1 0x0409 php ".phpversion()." i386 MSNMSGR 7.0.0000 MSMSGS ".$_POST["username"]."\r\n"); echo fread($socket2, 5000) . ' '; //Send username fputs($socket2, "USR 2 TWN I ".$_POST["username"]."\r\n"); //Read USR $usr = fread($socket2, 5000); echo $usr . ' '; $usr = explode(" ", $usr);//This is for later usage. Now I need to use this socket in another page ( AJAX/status.php ). php.net says that the connection stays available. However, this is status.php (just ignore $_SESSION["cid"]), which is called via AJAX: Which should change the status. I get this error: Warning : fputs(): supplied argument is not a valid stream resource in C:\wamp\apps\msnphp\AJAX\status.php on line 3 Warning : Wrong parameter count for fread() in C:\wamp\apps\msnphp\AJAX\status.php on line 4 My socket is persistent, and it's id is saved in session variable $_SESSION["socket"]. I do not understand why it does not work. I use Windows XP Professional SP2 as server, with WAMP (Apache, MySQL and PHP) server. Can anyone help me? Thanks!
