[site]: crossvalidated
[post_id]: 464345
[parent_id]: 
[tags]: 
In A/B test, how to deal inconsistency between unit of experiment and unit of analysis in the experiment design?

In the experiment, the metrics we care about is clicks per page (#clicks / #pages). When performing the experiment, the unit of diversion we randomized on is "user" instead of "page". I'm confused about what unit of analysis I should use in the analysis for significance. If I use "page", I'm concerned that I would be violating one of the assumptions in hypothesis testing: the units should be independent. Since randomizing by "user" would mean some pages belong to the same user are correlated. If I use "user", that means I'm calculating clicks per page for each user, then take the average clicks per page on users. This way, I'm concerned that the average will not be weighted, i.e., a user that had 1 pageview and clicked (click per page: 100%) will be weighted the same as a user that had 100 pageviews and clicked once (click per page: 1%). In this example, the clicks per page averaged on user would be (100% +1%)/2 ~= 50%, but the weighted average click per page is (1+1)/(1+100) ~= 2%.
