[site]: stackoverflow
[post_id]: 4829955
[parent_id]: 4829738
[tags]: 
You would not need the loop at all. Assuming v , vnew and unchangeableflag are 1-d arrays with size*size entries, you can do v = v.reshape(size, size) vnew = vnew.reshape(size, size) unchangeableflag = unchangeableflag.reshape(size, size) average = v[1:-1, 2:] average += v[1:-1, :-2] average += v[2:, 1:-1] average += v[-2:, 1:-1] average /= 4.0 vnew[1:-1, 1:-1][unchangeableflag[1:-1, 1:-1] == 0] = average But what are you actually trying to achieve? This looks suspiciously like you could get away with some application of the discrete Laplacian. (Note that this assumes that v contains floating point numbers. If the dtype of `vÂ´ is sime integral type, you need a slight modification.)
