[site]: stackoverflow
[post_id]: 4443856
[parent_id]: 
[tags]: 
Getting correct screen mappings for arcball in opengl

I am trying to implement an arcball interface and it seems that after rotation of 90 degrees the model stops rotating in that specific direction, I suspect that there is a problem with mapping clicks on the screen to the arcball, but it could be wrong math and/or wrong transformations accumulation, any help would be appreciated, here is the relevant code for the problem, when operating on vectors the ^ operator represents cross product, and * operator represents inner product void mouseButton(int button,int state,int x,int y){ if(state==GLUT_DOWN){ GLdouble xx,yy,zz; GLdouble modelMatrix[16]; glGetDoublev(GL_MODELVIEW_MATRIX,modelMatrix); GLdouble projMatrix[16]; glGetDoublev(GL_PROJECTION_MATRIX,projMatrix); int viewport[4]; glGetIntegerv(GL_VIEWPORT,viewport); gluUnProject(x,height-y-1,0.755 ,modelMatrix,projMatrix,viewport,&xx,&yy,&zz); arcBall_begin(xx,yy); } } void mouseMotion(int x,int y){ GLdouble xx,yy,zz; GLdouble modelMatrix[16]; glGetDoublev(GL_MODELVIEW_MATRIX,modelMatrix); GLdouble projMatrix[16]; glGetDoublev(GL_PROJECTION_MATRIX,projMatrix); int viewport[4]; glGetIntegerv(GL_VIEWPORT,viewport); gluUnProject(x,height-y-1,0.755 ,modelMatrix,projMatrix,viewport,&xx,&yy,&zz); arcBall_drag(xx,yy); } void arcBall_begin(GLdouble x,GLdouble y){ if(sqrt((x*x)+(y*y))>radius) begin = vec(x,y,0); else begin = vec(x,y,sqrt((radius*radius)-(x*x)-(y*y))); begin = begin.unit(); glGetDoublev(GL_MODELVIEW_MATRIX,mm); } void arcBall_drag(GLdouble x,GLdouble y){ if(sqrt((x*x)+(y*y))>radius) end = vec(x,y,0); else end = vec(x,y,sqrt((radius*radius)-(x*x)-(y*y))); end = end.unit(); rotationAxis = begin^end; rotationAxis = rotationAxis.unit(); angle = -2*acos(begin*end); angle = angle * (float(180)/float(PI)); } float arcBall_rotate(){ if(angle!=0.0){ glLoadMatrixd(mm); glRotatef(angle,rotationAxis.x,rotationAxis.y,rotationAxis.z); angle = 0.0; } return angle; }
