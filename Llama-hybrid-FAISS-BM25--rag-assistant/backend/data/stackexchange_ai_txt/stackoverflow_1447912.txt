[site]: stackoverflow
[post_id]: 1447912
[parent_id]: 1431778
[tags]: 
You're having trouble doing what you want because Rails is designed not to allow you to have access to session information in your models. It's the classic separation of concerns with MVC. Models are meant to work independently of your other layers, and you'll be thankful they do when you start doing things with Rake or other system tasks where you won't have a session. The cattr_accessor :current_ip is a horrible approach. It's a hack and it should be apparent why. Yes, it may work, but it's the wrong approach to this problem. Since you're tracking "who" did "what" by their IP, the logical place for this to happen is in the controller layer. There are several approaches you can take, including using CacheSweepers as auditors, as outlined in the Rails Recipes book. CacheSweepers can observe models but also have access to all controller information. Using the ditry attributes in a rails model, you can see exactly what changed. @user = User.find_by_login "bphogan" @user.login = "Brian" @user.save @user.changed => ["login"] @user.changes => {"login"=>["bphogan", "brian"]} @user.login_was => "bphogan" Combine this with the session info you have and you have a pretty awesome auditor. Does that help?
