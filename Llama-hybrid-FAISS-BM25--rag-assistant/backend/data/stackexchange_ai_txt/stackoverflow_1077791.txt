[site]: stackoverflow
[post_id]: 1077791
[parent_id]: 
[tags]: 
What is the syntax for creating a queue subscriber in PL/SQL?

I'm trying to create a queue and a callback that triggers when a message is queued, but I can't get the callback to trigger. What am I doing wrong? I have a trigger that enqueues a message, and I can see it on the queue message table, and I can dequeue it by hand and process it, I just can't get the callback to fire on enqueue. BEGIN DBMS_AQADM.CREATE_QUEUE_TABLE ( queue_table => 'queue_message_table', queue_payload_type => 'queue_message_type', multiple_consumers => TRUE); DBMS_AQADM.CREATE_QUEUE ( queue_name => 'message_queue', queue_table => 'queue_message_table'); DBMS_AQADM.START_QUEUE (queue_name => 'message_queue'); END; CREATE OR REPLACE PROCEDURE queue_callback( context RAW, reginfo SYS.AQ$_REG_INFO, descr SYS.AQ$_DESCRIPTOR, payload RAW, payloadl NUMBER) AS queue_options DBMS_AQ.DEQUEUE_OPTIONS_T; message_properties DBMS_AQ.MESSAGE_PROPERTIES_T; my_message queue_message_type; ret varchar2(200); message_id RAW(16); BEGIN DBMS_OUTPUT.PUT_LINE('Callback'); queue_options.msgid := descr.msg_id; queue_options.consumer_name := descr.consumer_name; DBMS_AQ.DEQUEUE( queue_name => descr.queue_name, dequeue_options => queue_options, message_properties => message_properties, payload => my_message, msgid => message_id ); ret := handle_message(my_message); commit; END; BEGIN DBMS_AQADM.ADD_SUBSCRIBER (queue_name => 'message_queue', subscriber => SYS.AQ$_AGENT('queue_subscriber', 'message_queue',NULL)); DBMS_AQ.REGISTER ( SYS.AQ$_REG_INFO_LIST( SYS.AQ$_REG_INFO( 'MESSAGE_QUEUE:QUEUE_SUBSCRIBER', DBMS_AQ.NAMESPACE_AQ, 'plsql://QUEUE_CALLBACK', HEXTORAW('FF') ) ), 1 ); END;
