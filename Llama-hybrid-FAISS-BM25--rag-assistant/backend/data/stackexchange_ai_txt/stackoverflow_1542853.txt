[site]: stackoverflow
[post_id]: 1542853
[parent_id]: 
[tags]: 
WebClient upload file error

I am using VSTS 2008 + C# + .Net 3.5 + ASP.Net + IIS 7.0 to develop a console application at client side to upload a file, and at server side I receive this file using an aspx file. From client side, I always notice (from console output) the upload percetage of the file increase from 1% to 50%, then to 100% suddenly. Any ideas what is wrong? Here is my client side code, class Program { private static WebClient client = new WebClient(); private static ManualResetEvent uploadLock = new ManualResetEvent(false); private static void Upload() { try { Uri uri = new Uri("http://localhost/Default.aspx"); String filename = @"C:\test\1.dat"; client.Headers.Add("UserAgent", "TestAgent"); client.UploadProgressChanged += new UploadProgressChangedEventHandler(UploadProgressCallback); client.UploadFileCompleted += new UploadFileCompletedEventHandler(UploadFileCompleteCallback); client.UploadFileAsync(uri, "POST", filename); } catch (Exception e) { Console.WriteLine(e.StackTrace.ToString()); } } public static void UploadFileCompleteCallback(object sender, UploadFileCompletedEventArgs e) { Console.WriteLine("Completed! "); uploadLock.Set(); } private static void UploadProgressCallback(object sender, UploadProgressChangedEventArgs e) { Console.WriteLine (e.ProgressPercentage); } static void Main(string[] args) { Upload(); uploadLock.WaitOne(); return; } } Here is my server side code, protected void Page_Load(object sender, EventArgs e) { string agent = HttpContext.Current.Request.Headers["UserAgent"]; using (FileStream file = new FileStream(@"C:\Test\Agent.txt", FileMode.Append, FileAccess.Write)) { byte[] buf = Encoding.UTF8.GetBytes(agent); file.Write(buf, 0, buf.Length); } foreach (string f in Request.Files.AllKeys) { HttpPostedFile file = Request.Files[f]; file.SaveAs("C:\\Test\\UploadFile.dat"); } } thanks in advance, George
