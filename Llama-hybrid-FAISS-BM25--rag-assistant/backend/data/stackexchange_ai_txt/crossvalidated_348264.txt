[site]: crossvalidated
[post_id]: 348264
[parent_id]: 
[tags]: 
principal component analysis adjusting for confounder

Suppose I have a dataset of $n$ samples and $p$ variables ($V_1,V_2, ...,V_p$). The samples are from two groups ($G$) and $Z$ is a confounder. I would like to perform principal component analysis (PCA) controlling the $Z$. I did some search regarding how to control the confounder before PCA but didn't find much, although people asked about this, e.g. here . So I come up with following thought and I would like to validate if this is logically acceptable. In univariate analysis, if I would like to find out which variables in the $p$ variables are significantly correlated with the $G$ controlling the confounder $Z$, I can run $p$ linear regressions $V_i \sim g_iG + z_iZ$, and report the p value of $G$ ($g_i$ and $z_i$ is the regression coefficient for $i^{th}$ variable). Then, I regress out the $Z$ for each variable by $V_i-z_iZ$ and get a 'residual' matrix. Can I perform PCA on this residual matrix? I hope this residual matrix has all the confounder $Z$ regressed out. Is this logically correct?
