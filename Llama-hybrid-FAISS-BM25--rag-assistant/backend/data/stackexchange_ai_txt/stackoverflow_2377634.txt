[site]: stackoverflow
[post_id]: 2377634
[parent_id]: 
[tags]: 
JGroups eating memory

I currently have a problem with my jgroups configuration, causing thousands of messages getting stuck in the NAKACK.xmit_table. Actually all of them seem to end up in the xmit_table, and a another dump from a few hours later indicates that they never intend to leave either... This is the protocol stack configuration UDP(bind_addr=xxx.xxx.xxx.114; bind_interface=bond0; ip_mcast=true;ip_ttl=64; loopback=false; mcast_addr=228.1.2.80;mcast_port=45589; mcast_recv_buf_size=80000; mcast_send_buf_size=150000; ucast_recv_buf_size=80000; ucast_send_buf_size=150000): PING(num_initial_members=3;timeout=2000): MERGE2(max_interval=20000;min_interval=10000): FD_SOCK: FD(max_tries=5;shun=true;timeout=10000): VERIFY_SUSPECT(timeout=1500): pbcast.NAKACK(discard_delivered_msgs=true;gc_lag=50;retransmit_timeout=600,1200,2400,4800;use_mcast_xmit=true): pbcast.STABLE(desired_avg_gossip=20000;max_bytes=400000;stability_delay=1000):UNICAST(timeout=600,1200,2400): FRAG(frag_size=8192):pbcast.GMS(join_timeout=5000;print_local_addr=true;shun=true): pbcast.STATE_TRANSFER Startup message... 2010-03-01 23:40:05,358 INFO [org.jboss.cache.TreeCache] viewAccepted(): [xxx.xxx.xxx.35:51723|17] [xxx.xxx.xxx.35:51723, xxx.xxx.xxx.36:53088, xxx.xxx.xxx.115:32781, xxx.xxx.xxx.114:32934] 2010-03-01 23:40:05,363 INFO [org.jboss.cache.TreeCache] TreeCache local address is 10.35.191.114:32934 2010-03-01 23:40:05,393 INFO [org.jboss.cache.TreeCache] received the state (size=32768 bytes) 2010-03-01 23:40:05,509 INFO [org.jboss.cache.TreeCache] state was retrieved successfully (in 146 milliseconds) ... indicates that everything is fine so far. The logs, set to warn-level does not indicate that something is wrong except for the occational 2010-03-03 09:59:01,354 ERROR [org.jgroups.blocks.NotificationBus] exception=java.lang.IllegalArgumentException: java.lang.NullPointerException which I'm guessing is unrelated since it has been seen earlier without the memory memory issue. I have have been digging through two memory dumps from one of the machines to find oddities but nothing so far. Except for maybe some statistics from the different protocols UDP has num_bytes_sent 53617832 num_bytes_received 679220174 num_messages_sent 99524 num_messages_received 99522 while NAKACK has... num_bytes_sent 0 num_bytes_received 0 num_messages_sent 0 num_messages_received 0 ... and a huge xmit_table. Each machine has two JChannel instances, one for ehcache and one for TreeCache. A misconfiguration means that both of them share the same diagnositics mcast address, but this should not pose a problem unless I want to send diagnostics messages right? However they do of course have different mcast addresses for the messages. Please ask for clarifications, I have lots of information but I'm a bit uncertain about what is relevant at this point.
