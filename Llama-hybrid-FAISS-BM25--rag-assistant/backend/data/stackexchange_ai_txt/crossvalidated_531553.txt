[site]: crossvalidated
[post_id]: 531553
[parent_id]: 
[tags]: 
"The matrix is either rank-deficient or indefinite" error in fixed effects linear model (felm)

I estimate various felms in R, which worked fine until I added covariates from t(the year of the merger)-2. I estimate the effects of a merger on RD expenses in t till t+3, and have covariates of RD covariates t-3 till t-1, profit t-3 till t-1 and employees t-3 till t-1. I get this error when I try to run the model with the "common trend assumption" check which is merger_it_pre1 and the covariates from t-2. These are my steps: # Calculate quantiles (1e en 99e percentiles) pcts pcts[1] & RD_expenses This is all fine, but when i try to estimate the next model: # Dynamic model R&D intensity incl. covariates pre2 and incl. check on parallel pre-trends m9a pcts[1] & RD_expenses I get this warning and it brings an NA for merger_it_post2 (dummy for 2 years after the merger) Warning in chol.default(mat, pivot = TRUE, tol = tol) : the matrix is either rank-deficient or indefinite Warning in chol.default(mat, pivot = TRUE, tol = tol) : the matrix is either rank-deficient or indefinite Call: felm(formula = ihs(RD_expenses) ~ merger_it_pre1 + merger_it + merger_it_post1 + merger_it_post2 + merger_it_post3 + factor(year) + ihs(RDexp_pre2) + profit_pre2 + employees_pre2 | company | 0 | company, data = TandC, subset = RD_expenses > pcts[1] & RD_expenses |t|) merger_it_pre1 -7.498e-02 2.478e-01 -0.303 0.76236 merger_it 1.337e-01 1.895e-01 0.706 0.48066 merger_it_post1 1.562e-02 1.911e-01 0.082 0.93491 merger_it_post2 NA 0.000e+00 NA NA merger_it_post3 -4.973e-02 1.132e-01 -0.439 0.66070 factor(year)2013 -2.165e-02 3.848e-02 -0.563 0.57388 factor(year)2014 3.089e-02 4.753e-02 0.650 0.51609 factor(year)2015 1.017e-01 5.169e-02 1.967 0.04978 * factor(year)2016 1.197e-01 6.573e-02 1.821 0.06926 . factor(year)2017 1.290e-01 7.062e-02 1.827 0.06831 . factor(year)2018 1.876e-01 7.887e-02 2.379 0.01778 * factor(year)2019 2.364e-01 8.349e-02 2.831 0.00483 ** factor(year)2020 2.131e-01 8.506e-02 2.506 0.01255 * ihs(RDexp_pre2) 1.775e-03 2.249e-02 0.079 0.93710 profit_pre2 2.761e-03 9.382e-04 2.943 0.00341 ** employees_pre2 7.255e-06 9.110e-06 0.796 0.42621 --- Signif. codes: 0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 Residual standard error: 0.438 on 6036 degrees of freedom (1630 observations deleted due to missingness) Multiple R-squared(full model): 0.95 Adjusted R-squared: 0.9459 Multiple R-squared(proj model): 0.03345 Adjusted R-squared: -0.0447 F-statistic(full model, *iid*):234.9 on 488 and 6036 DF, p-value: I have the feeling it has something to do with multicollinearity or due to a too-small sample size, which is why I post it here. I can't figure it out myself, and hope there is someone that can help me! Here is a part of my sample: structure(list(company = c("ALLERGAN PUBLIC LIMITED COMPANY", "ALLERGAN PUBLIC LIMITED COMPANY", "ALLERGAN PUBLIC LIMITED COMPANY", "ALLERGAN PUBLIC LIMITED COMPANY", "ALLERGAN PUBLIC LIMITED COMPANY", "ALLERGAN PUBLIC LIMITED COMPANY", "ALLERGAN PUBLIC LIMITED COMPANY", "ALPINE ELECTRONICS, INC.", "ALPINE ELECTRONICS, INC.", "ALPINE ELECTRONICS, INC.", "ALPINE ELECTRONICS, INC.", "ALPINE ELECTRONICS, INC.", "ALPINE ELECTRONICS, INC.", "ALPS ALPINE CO.,LTD.", "ALPS ALPINE CO.,LTD.", "ALPS ALPINE CO.,LTD.", "ALPS ALPINE CO.,LTD.", "ALPS ALPINE CO.,LTD.", "ALPS ALPINE CO.,LTD.", "ANICURA STOCKHOLMS REGIONDJURSJUKHUS AB", "ANICURA STOCKHOLMS REGIONDJURSJUKHUS AB", "ANICURA STOCKHOLMS REGIONDJURSJUKHUS AB", "ANICURA STOCKHOLMS REGIONDJURSJUKHUS AB", "ANICURA STOCKHOLMS REGIONDJURSJUKHUS AB", "ANICURA STOCKHOLMS REGIONDJURSJUKHUS AB", "APOGEE ENTERPRISES INC", "APOGEE ENTERPRISES INC", "APOGEE ENTERPRISES INC", "APOGEE ENTERPRISES INC", "APOGEE ENTERPRISES INC"), year = c(2013L, 2014L, 2015L, 2016L, 2017L, 2018L, 2019L, 2015L, 2016L, 2017L, 2018L, 2019L, 2020L, 2015L, 2016L, 2017L, 2018L, 2019L, 2020L, 2015L, 2016L, 2017L, 2018L, 2019L, 2020L, 2015L, 2016L, 2017L, 2018L, 2019L), case_code = c("M.8193", "M.8193", "M.8193", "M.8193", "M.8193", "M.8193", "M.8193", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.8833", "M.9019", "M.9019", "M.9019", "M.9019", "M.9019", "M.9019", "M.9060", "M.9060", "M.9060", "M.9060", "M.9060"), merger = c(2016, 2016, 2016, 2016, 2016, 2016, 2016, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018), acquirer = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L), .Label = c("0", "1"), class = "factor"), country = c("IE", "IE", "IE", "IE", "IE", "IE", "IE", "JP", "JP", "JP", "JP", "JP", "JP", "JP", "JP", "JP", "JP", "JP", "JP", "SE", "SE", "SE", "SE", "SE", "SE", "US", "US", "US", "US", "US"), industry_firm = c(2120, 2120, 2120, 2120, 2120, 2120, 2120, 6420, 6420, 6420, 6420, 6420, 6420, 2611, 2611, 2611, 2611, 2611, 2611, 7500, 7500, 7500, 7500, 7500, 7500, 2314, 2314, 2314, 2314, 2314), industry_firm_2 = c(21, 21, 21, 21, 21, 21, 21, 64, 64, 64, 64, 64, 64, 26, 26, 26, 26, 26, 26, 75, 75, 75, 75, 75, 75, 23, 23, 23, 23, 23), industry_merger = c(4646, 4646, 4646, 4646, 4646, 4646, 4646, 453, 453, 453, 453, 453, 453, 453, 453, 453, 453, 453, 453, 1092, 1092, 1092, 1092, 1092, 1092, 262, 262, 262, 262, 262), industry_merger_2 = c(46, 46, 46, 46, 46, 46, 46, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 10, 10, 10, 10, 10, 10, 26, 26, 26, 26, 26), simpl_proc = structure(c(2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L), .Label = c("0", "1"), class = "factor"), commitments = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L), .Label = c("0", "1"), class = "factor"), cross_border = structure(c(2L, 2L, 2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L), .Label = c("0", "1"), class = "factor"), duration = c(25, 25, 25, 25, 25, 25, 25, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 149, 149, 149, 149, 149, 149, 35, 35, 35, 35, 35), employees = c(384, 432, 624, 334, 356, 338, 348, 1122, 1110, 1492, 1317, NA, NA, 39588, 42053, 42289, 41840, 40443, NA, 285, 372, 279, 367, 427, NA, 4614, 5511, 6700, 7000, 7200), profit_margin = c(-0.14684, -0.85298, -0.58792, -0.38872, -1.30312, -0.86866, -0.6363, -1.925, 0.567, 3.984, 4.01, NA, NA, 8.763, 6.572, 7.599, 4.838, 1.921, NA, 8.049, 6.641, 8.856, 7.592, 3.538, NA, 9.919, 11.019, 8.285, 4.182, 5.748), RD_expenses = c(8946.414554, 9977.75638, 43326.90616, 48870.14658, 35022.10866, 39584.25952, 32259.2173, 6303.95, 6812.46, 14993.39, 21925.5, NA, NA, 259971.9513, 269457.2012, 227757.0765, 263893.2745, 316285.6753, NA, 7053.5, 1722.05, 2131.71, NA, NA, NA, 7347.538084, 8115.501556, 11462.26181, 17081.29815, 15122.53385 ), sales = c(125844.3945, 111010.5704, 276862.329, 276455.8596, 265833.4972, 275762.3064, 286432.2966, 1260609.732, 1217111.106, 1094409.478, 2057945, NA, NA, 6036362.168, 6288047.037, 6560212.444, 6831502.438, 6806267.552, NA, 27113.77546, 29621.68519, 31647.16693, 33653.0387, 35262.84214, NA, 901165.4432, 1051743.523, 1085781.581, 1228659.528, 1263951.4), period = structure(c(1L, 2L, 3L, 4L, 5L, 6L, 7L, 1L, 2L, 3L, 4L, 5L, 6L, 1L, 2L, 3L, 4L, 5L, 6L, 1L, 2L, 3L, 4L, 5L, 6L, 1L, 2L, 3L, 4L, 5L), .Label = c("-3", "-2", "-1", "0", "1", "2", "3"), class = "factor"), merger_it = c(0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0), merger_it_pre1 = c(0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0), merger_it_post3 = c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), merger_it_post2 = c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0), merger_it_post1 = c(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1), RD_intensity = c(7.10910850621956, 8.98811378416267, 15.6492601635234, 17.6773777378817, 13.1744528168514, 14.3544852219875, 11.2624231565094, 0.500071500320608, 0.559723756230354, 1.36999818636439, 1.06540748173542, NA, NA, 4.30676530109749, 4.28522877794115, 3.47179422075435, 3.86288780389073, 4.6469768178164, NA, 26.0144516222235, 5.8134774877067, 6.73586360736525, NA, NA, NA, 0.815337310084728, 0.771623630526508, 1.05566920737809, 1.39023852912326, 1.19644899716872 ), age = c(36, 36, 36, 36, 36, 36, 36, 54, 54, 54, 54, 54, 54, 73, 73, 73, 73, 73, 73, 19, 19, 19, 19, 19, 19, 72, 72, 72, 72, 72), industry = c(46, 46, 46, 46, 46, 46, 46, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 10, 10, 10, 10, 10, 10, 26, 26, 26, 26, 26), treated = c("1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"), id = c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 4L, 4L, 4L, 4L, 4L, 4L, 5L, 5L, 5L, 5L, 5L), RDexp_pre1 = c(NA, 8946.414554, 9977.75638, 43326.90616, 48870.14658, 35022.10866, 39584.25952, NA, 6303.95, 6812.46, 14993.39, 21925.5, NA, NA, 259971.9513, 269457.2012, 227757.0765, 263893.2745, 316285.6753, NA, 7053.5, 1722.05, 2131.71, NA, NA, NA, 7347.538084, 8115.501556, 11462.26181, 17081.29815), profit_pre1 = c(NA, -0.14684, -0.85298, -0.58792, -0.38872, -1.30312, -0.86866, NA, -1.925, 0.567, 3.984, 4.01, NA, NA, 8.763, 6.572, 7.599, 4.838, 1.921, NA, 8.049, 6.641, 8.856, 7.592, 3.538, NA, 9.919, 11.019, 8.285, 4.182), RDint_pre1 = c(NA, 7.10910850621956, 8.98811378416267, 15.6492601635234, 17.6773777378817, 13.1744528168514, 14.3544852219875, NA, 0.500071500320608, 0.559723756230354, 1.36999818636439, 1.06540748173542, NA, NA, 4.30676530109749, 4.28522877794115, 3.47179422075435, 3.86288780389073, 4.6469768178164, NA, 26.0144516222235, 5.8134774877067, 6.73586360736525, NA, NA, NA, 0.815337310084728, 0.771623630526508, 1.05566920737809, 1.39023852912326), employees_pre1 = c(NA, 384, 432, 624, 334, 356, 338, NA, 1122, 1110, 1492, 1317, NA, NA, 39588, 42053, 42289, 41840, 40443, NA, 285, 372, 279, 367, 427, NA, 4614, 5511, 6700, 7000), RDexp_pre2 = c(NA, NA, 8946.414554, 9977.75638, 43326.90616, 48870.14658, 35022.10866, NA, NA, 6303.95, 6812.46, 14993.39, 21925.5, NA, NA, 259971.9513, 269457.2012, 227757.0765, 263893.2745, NA, NA, 7053.5, 1722.05, 2131.71, NA, NA, NA, 7347.538084, 8115.501556, 11462.26181), profit_pre2 = c(NA, NA, -0.14684, -0.85298, -0.58792, -0.38872, -1.30312, NA, NA, -1.925, 0.567, 3.984, 4.01, NA, NA, 8.763, 6.572, 7.599, 4.838, NA, NA, 8.049, 6.641, 8.856, 7.592, NA, NA, 9.919, 11.019, 8.285), employees_pre2 = c(NA, NA, 384, 432, 624, 334, 356, NA, NA, 1122, 1110, 1492, 1317, NA, NA, 39588, 42053, 42289, 41840, NA, NA, 285, 372, 279, 367, NA, NA, 4614, 5511, 6700), RDexp_pre3 = c(NA, NA, NA, 8946.414554, 9977.75638, 43326.90616, 48870.14658, NA, NA, NA, 6303.95, 6812.46, 14993.39, NA, NA, NA, 259971.9513, 269457.2012, 227757.0765, NA, NA, NA, 7053.5, 1722.05, 2131.71, NA, NA, NA, 7347.538084, 8115.501556 ), profit_pre3 = c(NA, NA, NA, -0.14684, -0.85298, -0.58792, -0.38872, NA, NA, NA, -1.925, 0.567, 3.984, NA, NA, NA, 8.763, 6.572, 7.599, NA, NA, NA, 8.049, 6.641, 8.856, NA, NA, NA, 9.919, 11.019), employees_pre3 = c(NA, NA, NA, 384, 432, 624, 334, NA, NA, NA, 1122, 1110, 1492, NA, NA, NA, 39588, 42053, 42289, NA, NA, NA, 285, 372, 279, NA, NA, NA, 4614, 5511), RDint_pre2 = c(NA, NA, 7.10910850621956, 8.98811378416267, 15.6492601635234, 17.6773777378817, 13.1744528168514, NA, NA, 0.500071500320608, 0.559723756230354, 1.36999818636439, 1.06540748173542, NA, NA, 4.30676530109749, 4.28522877794115, 3.47179422075435, 3.86288780389073, NA, NA, 26.0144516222235, 5.8134774877067, 6.73586360736525, NA, NA, NA, 0.815337310084728, 0.771623630526508, 1.05566920737809), RDint_pre3 = c(NA, NA, NA, 384, 432, 624, 334, NA, NA, NA, 1122, 1110, 1492, NA, NA, NA, 39588, 42053, 42289, NA, NA, NA, 285, 372, 279, NA, NA, NA, 4614, 5511)), row.names = c(NA, -30L), class = c("data.table", "data.frame"), .internal.selfref = )
