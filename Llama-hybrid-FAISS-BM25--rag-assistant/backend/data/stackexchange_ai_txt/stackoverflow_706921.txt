[site]: stackoverflow
[post_id]: 706921
[parent_id]: 
[tags]: 
Problems with setting application icon

(I'm using Visual Studio 2008, though I remember having similar problems with older versions as well.) I've tried several different methods (many of them mentioned in this other question ), but I am still having some strange issues: When including an icon as a resource, it does show up as the executable file's icon immediately, but for the icon to show up on the taskbar, I have to restart the computer. Until then, it continues to show up as whatever the previous icon was. Cleaning the solution, restarting VS, doesn't have any effect. Not a really big issue, as it won't affect a released exe, but it would be nice to know where it's keeping the old icon cached and how to get rid of it. No matter what I do, the icon displayed when alt-tabbing is the default app icon (square and white and generic). This includes embedding the icon in the executable, as well as setting ICON_BIG with WM_SETICON . As for the second matter, my code looks something like: hIcon = (HICON)( LoadImage( NULL, szFilename, IMAGE_ICON, 32, 32, LR_LOADFROMFILE ) ); if( hIcon ) SendMessage( hWnd, WM_SETICON, ICON_BIG, (LPARAM)hIcon ); However, after sending WM_SETICON , GetLastError() returns 6, "The handle is invalid.". hWnd is a valid window handle, and hIcon appears to be a valid icon handle. I've tried searching for reasons why WM_SETICON could cause that error, and at the very least, to figure out WHICH handle it thinks is invalid, but no luck yet. I've cleared the error code immediately before calling SendMessage() , so it has to be set somewhere in the processing of the message. I tried an alternate method, loading the icon from the exe itself, where the ID of the resource is 101 (it's the first and only resource included): hIcon = (HICON)( LoadImage( GetModuleHandle( NULL ), MAKEINTRESOURCE( 101 ), IMAGE_ICON, 48, 48, 0 ) ); if( hIcon ) SendMessage( hWnd, WM_SETICON, ICON_BIG, (LPARAM)hIcon ); ... but the same thing happens; after calling SendMessage() , GetLastError() gives the same error status. I've tried different dimensions (such as 48x48, all of which are present in the icon file), but to no different effect. I know it's definitely finding and loading the images, because if I specify a size that doesn't exist or an invalid resource ID or the wrong filename (depending on how I am loading it), it fails out long before SendMessage() . Strangely, if I specify ICON_SMALL instead of ICON_BIG , the call succeeds with no error status, but from the docs , I need to use ICON_BIG to set the icon used while alt-tabbing. Also, if I use ICON_BIG but load the 16x16 icon, I get no error status, but nothing changes. Any ideas about what could be causing WM_SETICON to fail? Anything terribly wrong with any of the code I've posted (aside from formatting/style/casting issues, as it's simplified to just the basics)?
