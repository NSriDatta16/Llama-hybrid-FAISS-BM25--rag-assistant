[site]: stackoverflow
[post_id]: 5057640
[parent_id]: 
[tags]: 
Xalan extension element - can not select variable

I have written a simple Xalan extension which selects a node and returns it's text. The XPath processor works fine until I try to use variable reference. I.e.: produces correct result (node content), but generates an error: Variable not resolvable: var1 . What do I need is to resolve both variables (and template params) and other XPath expressions. There has been similar problem ( XALANJ-1136 ) but concerning extension functions, not elements. Am I doing something wrong, or it is another bug? The code is below: package org.bogus.xalan; import javax.xml.transform.TransformerException; import org.apache.xalan.extensions.XSLProcessorContext; import org.apache.xalan.templates.ElemExtensionCall; import org.apache.xpath.XPath; import org.apache.xpath.XPathContext; import org.apache.xpath.objects.XObject; public class Test { public String extract(XSLProcessorContext ctx, ElemExtensionCall extensionElement) throws TransformerException { final String select = extensionElement.getAttribute("select"); final XPathContext xctxt = ctx.getTransformer().getXPathContext(); final XPath xpath = new XPath( select, extensionElement, xctxt.getNamespaceContext(), XPath.SELECT); final XObject xobj = xpath.execute(xctxt, xctxt.getContextNode(), xctxt.getNamespaceContext()); if (xobj == null){ return "NONE FOUND"; } return (String)xobj.castToType(XObject.CLASS_STRING, xctxt); } } XSLT: And the generated result: Node 1 content node-2-content NONE FOUND NONE FOUND node-2-content Node 1 content node-2-content file:/E:/xslt/transform.xsl; Line #25; Column #55; Variable not resolvable: var1 file:/E:/xslt/transform.xsl; Line #26; Column #55; Variable not resolvable: var2 I'm using Xalan 2.7.1
