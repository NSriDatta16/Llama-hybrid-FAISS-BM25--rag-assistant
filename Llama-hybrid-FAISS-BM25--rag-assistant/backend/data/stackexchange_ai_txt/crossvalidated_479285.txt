[site]: crossvalidated
[post_id]: 479285
[parent_id]: 229781
[tags]: 
Searching for how to compute variance of a weighted sum I came across this question, and I don't see a satisfactory answer that applies to the situation state by @user08041991, namely "Let's say we have collected a series of heart rate measurements from a sample of people in a hospital. A weighting factor can then applied to each individual to scale the measurements to be reflective of national estimates." In abstract terms, let $\{x_1,\dots,x_L\}$ be an i.i.d. sample drawn from a random variable $X$ with distribution $dP$ (in the example, these are the observed values of heart rate of people in a hospital). We want to estimate the expected value of $X$ not under $dP$ , but under another probability distribution, $\omega\ dP$ , where $\omega > 0$ a.s. [ $dP$ ] is a known "weight" function, and the values ${\omega_1,\dots,\omega_L}$ at the randomly sampled observations are known. The setting bares resemblance to setting of importance sampling, where the weight is sought. We can use the observations of $X$ and $\omega$ to define an estimator of the expected value of $X$ with respect to $\omega\ dP$ , namely, the weighted average: $$ \bar{x} = \frac{\sum_{j=1}^L x_j\omega_j}{ \sum_{j=1}^L \omega_j} $$ The exact mean and variance of $\bar{x}$ cannot be given in closed form in general. However, one can compute the asymptotic distribution of $\bar{x}$ as $L \rightarrow \infty$ . Towards that goal, consider the random vector $$ V_L = \left(\begin{matrix} \frac{1}{L} \sum_j x_j \omega_j \\ \frac{1}{L} \sum_j \omega_j \end{matrix} \right) $$ which, under suitable assumptions. converges a.e.[ $dP$ ] to $$ \left(\begin{matrix} \int{X \omega\ dP} \\ 1 \end{matrix} \right) ; $$ moreover, under suitable assumptions, $$ \sqrt{L} \left( V_L - \left(\begin{matrix} \int{X \omega\ dP} \\ 1 \end{matrix} \right) \right) \overset{P}{\rightsquigarrow} Z $$ where $Z = \left(\begin{matrix} z_1 \\ z_2 \end{matrix} \right)$ is a normal vector with mean 0 and covariance $$ \Sigma = \left[\begin{matrix} Var_P(X \omega) & Cov_P(X \omega, \omega) \\ Cov_P(X \omega, \omega) & Var_P(\omega) \end{matrix} \right] $$ (here $Var_P$ is the variance under probability $dP$ , etc.) Therefore, $$ \bar{x} = \frac{ \frac{1}{L} \sum_j x_j \omega_j } {\frac{1}{L} \sum_j \omega_j} = \frac{ \int{X \omega\ dP} + \frac{1}{ \sqrt{L}} z_1}{ 1 + \frac{1}{\sqrt{L}} z_2} \\ \approx \int{X \omega\ dP} + \frac{1}{ \sqrt{L}} (z_1 -z_2) \\ = \int{X \omega\ dP} + \frac{1}{ \sqrt{L}} (1, -1)Z $$ Now $(1, -1)Z$ is normal, with mean $0$ and variance $$ E( (1,-1)Z Z^* (\begin{matrix} 1 \\-1 \end{matrix} )) = (1,-1) \Sigma (\begin{matrix} 1 \\-1 \end{matrix} ) \\ = Var_P(X \omega) - 2 Cov_P(X \omega, \omega) + Var_P(\omega) \\ = Var_P( X \omega - \omega) = Var_P( (X-1)\omega) $$ Thus, we get: $$ \sqrt{L} \Big( \bar{x} - \int{X \omega\ dP} \Big) ~ \overset{dP}{\rightsquigarrow } ~ u $$ where $u$ is normally distributed, with mean $0$ and variance $Var_P\left( (X-1)\omega \right) $ . The variance of $u$ can be estimated with the sample variance of $(X-1)\omega$ . A couple of notes on the original question: the unweighted mean would not be an estimator of $\int{X \omega\ dP}$ in general, so if the objective is to estimate a quantity in a general population by means of observations in a different population, the consideration of simple mean is irrelevant ( $\omega$ is the likelihood ratio of the general population likelihood, and the observed population likelihood) If one smooths $X$ by averaging over some other variable $A$ (e.g.: averaging over age group ) to get $E(X|A)$ , then the variance of the result is reduced: $Var( E(X|A) ) \le Var(X)$ , what might have been what the statistician you consulted had in mind. The case of your question is different. In general, for a given $X$ , $Var( (X-1)\omega)$ can be larger or smaller than $Var( (X-1) ) $ , depending on $\omega$ (example follows). ** Example ** Here is an example to show that when the weights are case specific, the (asymptotic) standard deviation of the weighted mean is not comparable to the sd. of the unweighted mean. We work on the real line. Let $\varphi(x) = \frac{1}{2}$ if $|x| , $0$ otherwise and let $$ dP = \frac{1}{2} \left[ \frac{1}{\epsilon} \varphi(\frac{x}{\epsilon} ) + \varphi(x-4) \right] dx ; $$ $dP$ is a probability measure on the real line. We will take $\epsilon > 0$ and small. Let $ \omega(x) = A$ if $-1 , $B$ if $1 \le x , where $A,B > 0$ . Then $\omega(x) > 0$ a.e. $[dP]$ . Moreover, $\int \omega dP = \frac{A+B}{2} = 1$ if we take $A,B$ so that $A+B=2$ . The choice $A=B=1$ gives $\omega(x) = 1$ , and using these values corresponds to using unweighted means. When $A=1 - \delta$ , $B=1+\delta$ , a staightfoward computation shows that $Var( (X-1)\omega )$ is a quadratic function of $\delta$ of the form: $$ Var( (X-1)\omega ) = Var(X) + 2\left[ \frac{7-\epsilon^2}{3} \right]\ \delta + O(\delta^2) $$ so for small $\delta$ , $Var( (X-1)\omega) > Var(X)$ if $\delta > 0$ and $Var( (X-1)\omega) if $\delta .
