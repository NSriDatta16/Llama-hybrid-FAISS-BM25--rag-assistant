[site]: stackoverflow
[post_id]: 4914393
[parent_id]: 4914064
[tags]: 
Indeed, the race condition is possible. I will say that it strikes me as odd in the removal script to delete the user before his photos. If something craps out after the user deletion but before the photo deletion, then the db still has his orphaned photos. Typically, transactions (using a storage engine that supports them, like InnoDB) mitigate this issue. As for the race condition itself, I believe that there are techniques that use row locking to prevent other processes from accessing them at the same time. [If I get the chance to do some research, I'll fill out with more details. My brief research so far on 'mysql row locking' suggests that some engines actually implicitly lock any rows that are being affected by a transaction. But I confess to having no direct experience there.]
