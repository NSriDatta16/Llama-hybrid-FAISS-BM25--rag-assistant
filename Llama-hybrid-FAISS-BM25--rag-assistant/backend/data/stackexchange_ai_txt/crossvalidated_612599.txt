[site]: crossvalidated
[post_id]: 612599
[parent_id]: 
[tags]: 
Conditionally conjugate prior for non-nested (i.e. crossed) normal model?

I am trying to write/understand a conditionally-conjugate Gibbs sampler for what is essentially a linear, mixed effects model. I more or less get the conditionally-conjugate posterior for the hierarchical parts of the model (nested/random effects), but I am having trouble understanding what the conjugate posterior looks like when conditioning on one of the crossed (not nested) effects . Borrowing Gelman's notation (equations 13.7 and 13.8), a random effects model without fixed or crossed effects looks like: $$ y_i \sim \mathbf{N}\left(X_iB_{j[i]},\ \sigma^2_y\right) \\ B_j \sim \mathbf{N}\left(U_jG,\ \Sigma_B\right) \\ G \sim \mathbf{N}\left(G_0, \Sigma_0\right) $$ Where $X_i$ are the individual level predictors, $B_j$ are the effects within group $j$ , $U_j$ are the group-level predictors, $G$ are the group-level regression coefficients, and the subscript $j[i]$ is "the group $j$ containing observation $i$ ." $G_0$ and $\Sigma_0$ are fixed hyperparameters. Building off the work of Sosa et al , I think the conditionally conjugate posterior for $B_j$ is: $$ B_j|... \sim \mathbf{N}\left[\left(\Sigma_B^{-1}+\sigma^{-2}_yX_j^\intercal X_j\right)^{-1}\left(\Sigma_B^{-1}U_jG+\sigma^{-2}_yX_j^\intercal y_j\right),\ \left(\Sigma_B^{-1}+\sigma^{-2}_yX_j^\intercal X_j\right)^{-1}\right] \\ G|... \sim \mathbf{N}\left[\left(\Sigma_0^{-1}+\Sigma_B^{-1}U^\intercal U\right)^{-1}\left(\Sigma_0^{-1}G_0 + \Sigma_B^{-1}U^\intercal B_j\right),\ \left(\Sigma_0^{-1}+\Sigma_B^{-1}U^\intercal U\right)^{-1}\right] $$ If we add fixed effects $\beta^0$ then: $$ y_i \sim \mathbf{N}\left(X_i^0\beta^0 + X_iB_{j[i]},\ \sigma^2_y\right) \\ B_j \sim \mathbf{N}\left(U_jG,\ \Sigma_B\right) $$ Gelman suggests we can express this in the form of the first model by "rolling" the fixed effects $X^0$ into $X$ , $\beta^0$ into $B_j$ , and setting appropriate terms in $\Sigma_B$ to zero. I can sort of see how to make this work through matrix algebra, although sampling from $\Sigma_B$ using an inverse-Wishart posterior becomes trickier. However, I'm really having trouble seeing how to sample from a conditionally conjugate posterior for non-nested, crossed effects $\gamma_k$ where the levels of $k$ do not nest within the levels of $j$ . Note that Gelman suggests giving the non-nested effects an intercept of zero since any non-zero means could be folded into an intercept term within $\beta^0$ . $$ y_i \sim \mathbf{N}\left(X_i^0\beta^0 + X_iB_{j[i]} + Z_i\gamma_{k[i]},\ \sigma^2_y\right) \\ \beta_j \sim \mathbf{N}\left(U_jG_B,\ \Sigma_B\right) \\ \gamma_j \sim \mathbf{N}\left(V_kG_\gamma,\ \Sigma_\gamma\right) $$ Is it possible to obtain a conjugate posterior for $B_j|\beta_0,\gamma_k,...$ and equivelanetly for $\gamma_k|\beta_0,B_j,...$ ? Can one simply subtract the expected values of the other parameters we are conditioning on from $y$ ? $$ B_j|... \sim \mathbf{N}\left[\left(\Sigma_B^{-1}+\sigma^{-2}_yX_j^\intercal X_j\right)^{-1}\left(\Sigma_B^{-1}U_jG+\sigma^{-2}_yX_j^\intercal \left(y_j-X^0\beta^0-Z_k\gamma_k\right)\right),\ \left(\Sigma_B^{-1}+\sigma^{-2}_yX_j^\intercal X_j\right)^{-1}\right] $$ EDIT To answer my own question, subtracting the conditioned-upon parameters from $y$ as above appears to be correct. See Zanella & Roberts , in particular the expressions for the posterior distributions in Section 7 of the supplementary material . I would still appreciate comments/confirmation from anyone with experience using these sorts of models!
