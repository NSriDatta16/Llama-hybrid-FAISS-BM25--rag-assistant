[site]: stackoverflow
[post_id]: 3129326
[parent_id]: 
[tags]: 
Getting process ID from a shell executed file?

I am making a program for handheld PDAs using .net 2.0 compact framework and I have this one part which I'm not proud of and I was hoping for a more elegant solution. Basically the problem is another process using my file in this case its Windows Media Player. I start the process by passing the file location to Process.Start but it seems the process returned is short lived and it is spawning another process? So I tried looking up how to get child process information but had some problems with that (i think no processes were being returned for some reason). So i currently do this dodgy fix string processName = item.Text; Process proc = Process.Start(processName, null); if (!proc.Start()) MessageBox.Show("Failed to start process", "Error", MessageBoxButtons.OK, MessageBoxIcon.Hand, MessageBoxDefaultButton.Button1); else { IntPtr newWindow = IntPtr.Zero; TimeSpan limit = TimeSpan.FromSeconds(3); DateTime start = DateTime.Now; DateTime now = start; // do while the following: // window is not null // window is not ourself // under 3 seconds do { newWindow = Win32.GetForegroundWindow(); now = DateTime.Now; // taking too long if (now - start > limit) break; } while (newWindow == IntPtr.Zero || newWindow == this.Handle); if (newWindow != IntPtr.Zero && newWindow != this.Handle) { uint processID = 0; if (Win32.GetWindowThreadProcessId(newWindow, out processID) != 0) { //const int stringSize = 1024; //StringBuilder sb = new StringBuilder(1024); //Win32.GetWindowText(newWindow, sb, stringSize); m_processes.Add(new ProcessIDWithName(processID, processName)); } } } As you can see I don't like it and it's unreliable however it does work for now (i needed a solution whether it was bad or not). Why do I need the process ID? Because windows media player is keeping the file open on me and I cannot move/delete the file and therefore I need to kill the process off before I do so. I could do a similar fix with FindWindow but I was thinking more generically as it might not be a media file opened in windows media player. So basically I would like a better solution if possible! Also if you wondering why I'm not using a Stopwatch its because it doesn't seem to exist in .net 2.0 cf, also I don't need accuracy to that extent.
