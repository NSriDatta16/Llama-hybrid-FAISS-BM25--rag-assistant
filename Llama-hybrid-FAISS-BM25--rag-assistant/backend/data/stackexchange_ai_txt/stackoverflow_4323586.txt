[site]: stackoverflow
[post_id]: 4323586
[parent_id]: 4323313
[tags]: 
I've created an example below in which I average the value for year 1994 to get you started. The SQL query should work in any RDBMS. That said, each database has a better approach if you can use the vendor specific features. For example, using Oracle analytics you can compute a rolling average and access the prev/next row pretty much like wanted. drop table t; create table t( item_code varchar(10) not null ,year int not null ,figure decimal(5,2) not null ,primary key(year, item_code) ); insert into t(item_code, year, figure) values('A', 1990, 5); insert into t(item_code, year, figure) values('A', 1991, 7.2); insert into t(item_code, year, figure) values('A', 1992, 9.2); insert into t(item_code, year, figure) values('A', 1993, 12.5); insert into t(item_code, year, figure) values('A', 1994, 10); insert into t(item_code, year, figure) values('A', 1995, 9); insert into t(item_code, year, figure) values('B', 1990, 16); insert into t(item_code, year, figure) values('B', 1991, 17); insert into t(item_code, year, figure) values('B', 1992, 10); insert into t(item_code, year, figure) values('B', 1993, 13); insert into t(item_code, year, figure) values('B', 1994, 15.5); insert into t(item_code, year, figure) values('B', 1995, 12); insert into t(item_code, year, figure) values('C', 1990, 4); insert into t(item_code, year, figure) values('C', 1991, 9); insert into t(item_code, year, figure) values('C', 1992, 15); insert into t(item_code, year, figure) values('C', 1993, 12); insert into t(item_code, year, figure) values('C', 1994, 10); insert into t(item_code, year, figure) values('C', 1995, 7.2); select item_code ,1994 as year ,sum(case when year = 1995 then figure else 0 end) as next_year ,sum(case when year = 1994 then figure else 0 end) as this_year ,sum(case when year = 1993 then figure else 0 end) as prev_year ,sum(figure) / count(*) as avg from t where year in(1993, 1994, 1995) group by item_code having count(*) = 3; The count(*) = 3 satisfies the constraint that an average will only be computed if there are three years available. Obviously, you have to replace the constants with some variable. Also, the query only computes the averages for 1 year.
