[site]: stackoverflow
[post_id]: 4005468
[parent_id]: 4004308
[tags]: 
Alright, I ended up with a little boring solution, but it works. If anyone hit the same problem: products = _productRepository.Session() .CreateSQLQuery( @"SELECT {p.*} FROM Products p WHERE (SELECT COUNT(TagId) FROM ProductTags WHERE ProductId = p.Id AND TagId IN (SELECT TagId FROM CollectionTags WHERE CollectionId = :collectionId)) > 0 AND (ShopId = :shopId)") .AddEntity("p", typeof(Product)) .SetInt32("collectionId", collection.Id) .SetInt32("shopId", collection.Shop.Id) .SetResultTransformer(NHibernate.Transform.Transformers.DistinctRootEntity) .List ().AsQueryable();
