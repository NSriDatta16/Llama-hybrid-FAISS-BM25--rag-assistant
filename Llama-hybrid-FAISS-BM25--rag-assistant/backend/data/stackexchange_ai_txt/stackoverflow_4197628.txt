[site]: stackoverflow
[post_id]: 4197628
[parent_id]: 
[tags]: 
using voice tokens to swap voices with SAPI 5.1 text to speech

I am writing an application that has two characters in it and each should use a different text-to-speech voice. We're still using Windows XP so we're restricted to SAPI 5.1. What I am trying to do is when a character is created, assign it a token that represents its voice: //female voices HRESULT hr; if (sceneObjects.at(characterLocation).gender == FEMALE){ if (sceneObjects.at(characterLocation).age == ADULT){ hr = SpFindBestToken(SPCAT_VOICES, L"Name=VW Kate", L"", &pToken); if (FAILED(hr)){ hr = SpFindBestToken(SPCAT_VOICES, L"Gender=Female",L"",&pToken); //if we fail load the default voice if(FAILED(hr)) pToken = NULL; } sceneObjects.at(characterLocation).voiceToken = pToken; } else{ hr = SpFindBestToken(SPCAT_VOICES, L"Gender=Female", L"Name=Microsoft Mary", &pToken); //if we fail load the default voice if(FAILED(hr)) pToken = NULL; //s = L" "+s+L" "; sceneObjects.at(characterLocation).voiceToken = pToken; } } and then when I actually want it to speak, I pass in the character as a parameter into the text to speech thread and assign the voice its token: DWORD WINAPI DIGuy::sayMessage(LPVOID lpParam){ HRESULT hres; try{ ThreadParam * param = (ThreadParam *)lpParam; wstring s = param->message; wstring characterName = param->sceneObject.name; ISpVoice * pVoice; pVoice->SetVoice(param->sceneObject.voiceToken); My problem is no matter what voice I assign to my character when I do the SetVoice call I get the default system voice. Running in debug mode shows that the voiceToken is not null (which would cause the default voice to load) and that the voiceToken returned does not change due to my switching the system default voice (so it's not automatically mapping to default there, either), and that the voiceToken doesn't change between where I assign it and where I access it (so there's nothing else interfering). Any ideas? Thanks so much for your time. I really appreciate it!
