[site]: stackoverflow
[post_id]: 5400282
[parent_id]: 
[tags]: 
Is the following code valid? I am getting errors.

CREATE OR REPLACE VIEW POINTS AS DECLARE avgDurationOurFault number(5); avgDurationCustomersFault number(5); avgDuration number(5); BEGIN (select ceil(avg(abs(total_time))) into avgDuration from inquiry); select ceil(avg(total_duration)) into avgDurationOurFault from ( select customer_no, sum(abs(total_time)) total_duration from inquiry where cat_id in ('C900', 'C901', 'C902', 'C905', 'C907', 'C908', 'C909') GROUP BY customer_no); select ceil(avg(total_duration)) into avgDurationCustomersFault from ( select customer_no, sum(abs(total_time)) total_duration from inquiry where cat_id in ('C903','C904', 'C906') group by customer_no); select t1.customer_no, t1.callPoints, t1.durationPoints, t2.catgPoints, t1.callPoints+t1.durationPoints+t2.catgPoints as totalPoints from ( select customer_no, count(inquiry_id)*avgDuration callPoints , sum(abs(total_time)) durationPoints from inquiry group by customer_no ) t1 inner join ( select customer_no, sum(points) catgPoints from ( select customer_no, case when cat_id in ('C903','C904', 'C906') then 0 when cat_id in ('C900', 'C901', 'C902', 'C905', 'C907', 'C908', 'C909') then 2*avgDuration + abs(avgDurationCustomersFault - avgDurationOurFault) else 0 end as points from inquiry ) group by customer_no ) t2 on t1.customer_no = t2.customer_no; END; / --------------------ERRORS BELOW--------------------------------------------------- Error starting at line 1 in command: CREATE OR REPLACE VIEW POINTS AS DECLARE avgDurationOurFault number(5) Error at Command Line:1 Column:32 Error report: SQL Error: ORA-00928: missing SELECT keyword 00928. 00000 - "missing SELECT keyword" *Cause: *Action: Error starting at line 4 in command: avgDurationCustomersFault number(5) Error report: Unknown Command Error starting at line 5 in command: avgDuration number(5) Error report: Unknown Command Error starting at line 7 in command: BEGIN (select ceil(avg(abs(total_time))) into avgDuration from inquiry); select ceil(avg(total_duration)) into avgDurationOurFault from ( select customer_no, sum(abs(total_time)) total_duration from inquiry where cat_id in ('C900', 'C901', 'C902', 'C905', 'C907', 'C908', 'C909') GROUP BY customer_no); select ceil(avg(total_duration)) into avgDurationCustomersFault from ( select customer_no, sum(abs(total_time)) total_duration from inquiry where cat_id in ('C903','C904', 'C906') group by customer_no); select t1.customer_no, t1.callPoints, t1.durationPoints, t2.catgPoints, t1.callPoints+t1.durationPoints+t2.catgPoints as totalPoints from ( select customer_no, count(inquiry_id)*avgDuration callPoints , sum(abs(total_time)) durationPoints from inquiry group by customer_no ) t1 inner join ( select customer_no, sum(points) catgPoints from ( select customer_no, case when cat_id in ('C903','C904', 'C906') then 0 when cat_id in ('C900', 'C901', 'C902', 'C905', 'C907', 'C908', 'C909') then 2*avgDuration + abs(avgDurationCustomersFault - avgDurationOurFault) else 0 end as points from inquiry ) group by customer_no ) t2 on t1.customer_no = t2.customer_no; END; Error report: ORA-06550: line 3, column 2: PLS-00103: Encountered the symbol "(" when expecting one of the following: begin case declare exit for goto if loop mod null pragma raise return select update while with . ( , * % & - + / at mod rem as from || The symbol ". was inserted before "I ORA-06550: line 3, column 67: PLS-00103: Encountered the symbol ";" when expecting one of the following: set ORA-06550: line 30, column 3: PLS-00103: Encountered the symbol "INNER" when expecting one of the following: , ; for group having intersect minus order start union where connect 06550. 00000 - "line %s, column %s:\n%s" *Cause: Usually a PL/SQL compilation error. *Action:
