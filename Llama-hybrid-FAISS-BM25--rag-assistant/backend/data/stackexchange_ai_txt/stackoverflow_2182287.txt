[site]: stackoverflow
[post_id]: 2182287
[parent_id]: 
[tags]: 
Team Foundation cannot retrieve the list of team projects from Team Foundation Server

When I'm trying to connect to tfs I got the following error: --------------------------- Microsoft Visual Studio --------------------------- Team Foundation Server TF31001: Team Foundation cannot retrieve the list of team projects from Team Foundation Server UGSERVER. The Team Foundation Server returned the following error: Team Foundation services are not available from the server. Technical information (for administrator): TF30059: Fatal error while initializing web service. Then, I checked the event viewer and it has the following details: Event Type: Error Event Source: TFS Services Event Category: None Event ID: 3017 Date: 2/2/2010 Time: 9:38:31 AM User: N/A Computer: UGSERVER Description: TF53010: The following error has occurred in a Team Foundation component or extension: Date (UTC): 2/2/2010 4:38:31 AM Machine: UGSERVER Application Domain: /LM/W3SVC/738167904/Root/Services-11-129095591107656250 Assembly: Microsoft.TeamFoundation.Server, Version=9.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a; v2.0.50727 Process Details: Process Name: w3wp Process Id: 408 Thread Id: 6020 Account name: NT AUTHORITY\LOCAL SERVICE Detailed Message: TF53013: A crash report is being prepared for Microsoft. The following information is included in that report: System Values OS Version Information=Microsoft Windows NT 5.2.3790 Service Pack 2, v.2845 CLR Version Information=2.0.50727.1433 Machine Name=UGSERVER Processor Count=2 Working Set=52858880 System Directory=C:\WINDOWS\system32 Process Values ExitCode=0 Interactive=False Has Shutdown Started=False Process Environment Variables Path = C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\Program Files\Microsoft SQL Server\80\Tools\Binn\;D:\Program Files\Microsoft SQL Server\90\DTS\Binn\;D:\Program Files\Microsoft SQL Server\90\Tools\binn\;D:\Program Files\Microsoft SQL Server\90\Tools\Binn\VSShell\Common7\IDE\;C:\Program Files\Microsoft Visual Studio 8\Common7\IDE\PrivateAssemblies\;C:\Program Files\Microsoft Team Foundation Server 2008 Power Tools\;C:\Program Files\Microsoft Team Foundation Server 2008 Power Tools\Best Practices Analyzer\ TEMP = C:\WINDOWS\TEMP PATHEXT = .COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH PROCESSOR_ARCHITECTURE = x86 SystemDrive = C: windir = C:\WINDOWS TMP = C:\WINDOWS\TEMP ALLUSERSPROFILE = C:\Documents and Settings\All Users TFSPowerToolDir = C:\Program Files\Microsoft Team Foundation Server 2008 Power Tools\ USERPROFILE = C:\Documents and Settings\Default User ProgramFiles = C:\Program Files FP_NO_HOST_CHECK = NO COMPUTERNAME = UGSERVER APP_POOL_ID = Microsoft Team Foundation Server Application Pool NUMBER_OF_PROCESSORS = 2 PROCESSOR_IDENTIFIER = x86 Family 15 Model 4 Stepping 1, GenuineIntel ClusterLog = C:\WINDOWS\Cluster\cluster.log SystemRoot = C:\WINDOWS ComSpec = C:\WINDOWS\system32\cmd.exe CommonProgramFiles = C:\Program Files\Common Files PROCESSOR_LEVEL = 15 PROCESSOR_REVISION = 0401 lib = C:\Program Files\SQLXML 4.0\bin\ BPADir = C:\Program Files\Microsoft Team Foundation Server 2008 Power Tools\Best Practices Analyzer\ VS90COMNTOOLS = d:\Program Files\Microsoft Visual Studio 9.0\Common7\Tools\ OS = Windows_NT Request Details Url=http://ugserver:8080/Services/v1.0/ServerStatus.asmx [method = POST] User Agent=Team Foundation (devenv.exe, 9.0.21022.8) Headers=Content-Length=354&Content-Type=text%2fxml%3b+charset%3dutf-8&Accept-Encoding=gzip%2cgzip%2cgzip&Accept-Language=en-US&Authorization=NTLM+TlRMTVNTUAADAAAAAAAAAEgAAAAAAAAASAAAAAAAAABIAAAAAAAAAEgAAAAAAAAASAAAAAAAAABIAAAANcKI4gUCzg4AAAAP&Expect=100-continue&Host=ugserver%3a8080&User-Agent=Team+Foundation+(devenv.exe%2c+9.0.21022.8)&X-TFS-Version=1.0.0.0&X-TFS-Session=8d9f4a30-16f3-4fc6-8daa-3aaefd2a8ea6&SOAPAction=%22http%3a%2f%2fschemas.microsoft.com%2fTeamFoundation%2f2005%2f06%2fServices%2fServerStatus%2f03%2fCheckAuthentication%22 Path=/Services/v1.0/ServerStatus.asmx Local Request=True User Host Address=192.168.1.186 User=UGSERVER\Administrator [auth = NTLM] Application Provided Information Team Foundation Application Information Event Log Source = TFS Services Configured Team Foundation Server = http://UGSERVER:8080 License Type = EnterpriseLicense Server Culture = en-US Activity Logging Name = Integration Component Name = CS Initialized = No Requests Processed = 0 Exception: SqlException Message: Cannot open database "TfsIntegration" requested by the login. The login failed. Login failed for user 'NT AUTHORITY\LOCAL SERVICE'. SQL Exception Class: 11 SQL Exception Number: 4060 SQL Exception Server: UGSERVER\UGSERVER SQL Exception Source: .Net SqlClient Data Provider SQL Exception State: 1 SQL Exception Procedure: SQL Exception Line Number: 65536 SQL Error: System.Data.SqlClient.SqlError: Login failed for user 'NT AUTHORITY\LOCAL SERVICE'. Class: 14 Number: 18456 Server: UGSERVER\UGSERVER Source: .Net SqlClient Data Provider State: 1 Procedure: Line Number: 65536 Exception Data Dictionary follows HelpLink.ProdName = Microsoft SQL Server HelpLink.EvtSrc = MSSQLServer HelpLink.EvtID = 4060 HelpLink.BaseHelpUrl = http://go.microsoft.com/fwlink HelpLink.LinkId = 20476 Stack Trace: at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) at System.Data.SqlClient.SqlInternalConnectionTds.CompleteLogin(Boolean enlistOK) at System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, Int64 timerExpire, SqlConnection owningObject) at System.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(String host, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, Int64 timerStart) at System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance) at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance) at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection) at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options) at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject) at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject) at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject) at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection) at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory) at System.Data.SqlClient.SqlConnection.Open() at Microsoft.TeamFoundation.RegistrationDataAccessor.GetRegisteredTools(String toolId, String connectionString) at Microsoft.TeamFoundation.RegistrationDataAccessor.GetRegistrationEntries(String toolId, String connectionString) at Microsoft.TeamFoundation.Server.RegistrationEventSchemaProvider..ctor(String applicationPath) at Microsoft.TeamFoundation.Server.CombinationEventSchemaProvider..ctor(String applicationPath) at Microsoft.TeamFoundation.Server.Global.Initialize() at Microsoft.TeamFoundation.Server.TeamFoundationApplication.Init() Application Domain Information Assembly Name=mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089 Assembly CLR Version=v2.0.50727 Assembly Version=2.0.0.0 Assembly Location=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorlib.dll Assembly File Version: File: C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorlib.dll InternalName: mscorlib.dll OriginalFilename: mscorlib.dll FileVersion: 2.0.50727.1433 (REDBITS.050727-1400) FileDescription: Microsoft Common Language Runtime Class Library Product: Microsoft® .NET Framework ProductVersion: 2.0.50727.1433 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: English (United States) Assembly Name=System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a Assembly CLR Version=v2.0.50727 Assembly Version=2.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_32\System.Web\2.0.0.0__b03f5f7f11d50a3a\System.Web.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_32\System.Web\2.0.0.0__b03f5f7f11d50a3a\System.Web.dll InternalName: System.Web.dll OriginalFilename: System.Web.dll FileVersion: 2.0.50727.1433 (REDBITS.050727-1400) FileDescription: System.Web.dll Product: Microsoft® .NET Framework ProductVersion: 2.0.50727.1433 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: English (United States) Assembly Name=System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089 Assembly CLR Version=v2.0.50727 Assembly Version=2.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_MSIL\System\2.0.0.0__b77a5c561934e089\System.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_MSIL\System\2.0.0.0__b77a5c561934e089\System.dll InternalName: System.dll OriginalFilename: System.dll FileVersion: 2.0.50727.1433 (REDBITS.050727-1400) FileDescription: .NET Framework Product: Microsoft® .NET Framework ProductVersion: 2.0.50727.1433 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: English (United States) Assembly Name=System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089 Assembly CLR Version=v2.0.50727 Assembly Version=2.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_MSIL\System.Xml\2.0.0.0__b77a5c561934e089\System.Xml.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_MSIL\System.Xml\2.0.0.0__b77a5c561934e089\System.Xml.dll InternalName: System.Xml.dll OriginalFilename: System.Xml.dll FileVersion: 2.0.50727.1433 (REDBITS.050727-1400) FileDescription: .NET Framework Product: Microsoft® .NET Framework ProductVersion: 2.0.50727.1433 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: English (United States) Assembly Name=System.Configuration, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a Assembly CLR Version=v2.0.50727 Assembly Version=2.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_MSIL\System.Configuration\2.0.0.0__b03f5f7f11d50a3a\System.Configuration.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_MSIL\System.Configuration\2.0.0.0__b03f5f7f11d50a3a\System.Configuration.dll InternalName: System.Configuration.dll OriginalFilename: System.Configuration.dll FileVersion: 2.0.50727.1433 (REDBITS.050727-1400) FileDescription: System.Configuration.dll Product: Microsoft® .NET Framework ProductVersion: 2.0.50727.1433 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: English (United States) Assembly Name=System.Web.RegularExpressions, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a Assembly CLR Version=v2.0.50727 Assembly Version=2.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_MSIL\System.Web.RegularExpressions\2.0.0.0__b03f5f7f11d50a3a\System.Web.RegularExpressions.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_MSIL\System.Web.RegularExpressions\2.0.0.0__b03f5f7f11d50a3a\System.Web.RegularExpressions.dll InternalName: System.Web.RegularExpressions.dll OriginalFilename: System.Web.RegularExpressions.dll FileVersion: 2.0.50727.1433 (REDBITS.050727-1400) FileDescription: System.Web.RegularExpressions.dll Product: Microsoft® .NET Framework ProductVersion: 2.0.50727.1433 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: English (United States) Assembly Name=Microsoft.JScript, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a Assembly CLR Version=v2.0.50727 Assembly Version=8.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_MSIL\Microsoft.JScript\8.0.0.0__b03f5f7f11d50a3a\Microsoft.JScript.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_MSIL\Microsoft.JScript\8.0.0.0__b03f5f7f11d50a3a\Microsoft.JScript.dll InternalName: Microsoft.JScript.dll OriginalFilename: Microsoft.JScript.dll FileVersion: 8.0.50727.1433 FileDescription: Microsoft.JScript.dll Product: Microsoft (R) Visual Studio (R) 2005 ProductVersion: 8.0.50727.1433 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: Language Neutral Assembly Name=CppCodeProvider, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a Assembly CLR Version=v2.0.50727 Assembly Version=8.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_MSIL\CppCodeProvider\8.0.0.0__b03f5f7f11d50a3a\CppCodeProvider.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_MSIL\CppCodeProvider\8.0.0.0__b03f5f7f11d50a3a\CppCodeProvider.dll InternalName: CppCodeProvider.dll OriginalFilename: CppCodeProvider.dll FileVersion: 8.0.50727.813 FileDescription: CppCodeProvider.dll Product: Microsoft (R) Visual Studio (R) 2005 ProductVersion: 8.0.50727.813 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: Language Neutral Assembly Name=App_global.asax.3iyvjmrk, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null Assembly CLR Version=v2.0.50727 Assembly Version=0.0.0.0 Assembly Location=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\services\a8a490c5\21badae0\App_global.asax.3iyvjmrk.dll Assembly File Version: File: C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\services\a8a490c5\21badae0\App_global.asax.3iyvjmrk.dll InternalName: App_global.asax.3iyvjmrk.dll OriginalFilename: App_global.asax.3iyvjmrk.dll FileVersion: 0.0.0.0 FileDescription: Product: ProductVersion: 0.0.0.0 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: Language Neutral Assembly Name=Microsoft.TeamFoundation.Server, Version=9.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a Assembly CLR Version=v2.0.50727 Assembly Version=9.0.0.0 Assembly Location=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\services\a8a490c5\21badae0\assembly\dl3\c371c214\00f59c0d_7422c801\Microsoft.TeamFoundation.Server.DLL Assembly File Version: File: C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\services\a8a490c5\21badae0\assembly\dl3\c371c214\00f59c0d_7422c801\Microsoft.TeamFoundation.Server.DLL InternalName: Microsoft.TeamFoundation.Server.dll OriginalFilename: Microsoft.TeamFoundation.Server.dll FileVersion: 9.0.21022.8 FileDescription: Microsoft.TeamFoundation.Server.dll Product: Microsoft (R) Visual Studio (R) 2008 ProductVersion: 9.0.21022.8 Debug: False Patched: False PreRelease: False PrivateBuild: False SpecialBuild: False Language: Language Neutral Assembly Name=Microsoft.TeamFoundation.Common, Version=9.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a Assembly CLR Version=v2.0.50727 Assembly Version=9.0.0.0 Assembly Location=C:\WINDOWS\assembly\GAC_32\Microsoft.TeamFoundation.Common\9.0.0.0__b03f5f7f11d50a3a\Microsoft.TeamFoundation.Common.dll Assembly File Version: File: C:\WINDOWS\assembly\GAC_32\Microsoft.TeamFoundation.Common\9.0.0.0__b03f5f7f11d50a3a\Microsoft.TeamFoundation.Common.dll InternalName: Microsoft.TeamFoundation.Common.dll OriginalFilename: Microsoft.TeamFoundation.Common.dll FileVersion: 9.0.21022.8 FileDescription: Microsoft.TeamFoundation.Common.dll Product: For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp. If you check the above details then you would have seen the following: Exception: SqlException Message: Cannot open database "TfsIntegration" requested by the login. The login failed. Login failed for user 'NT AUTHORITY\LOCAL SERVICE'. The database server has got the user. Then, why? I tried to repair it from Add/Remove and got the following error: --------------------------- Microsoft Visual Studio 2008 Team Foundation Server Setup --------------------------- Error 29002.The Team Foundation databases could not be repaired. For more information, see the Microsoft Windows Installer (MSI) log. --------------------------- Retry Cancel --------------------------- **I checked the event viewer it has:** Event Type: Error Event Source: MsiInstaller Event Category: None Event ID: 10005 Date: 2/2/2010 Time: 10:21:57 AM User: UGSERVER\Administrator Computer: UGSERVER Description: Product: Microsoft Visual Studio 2008 Team Foundation Server - ENU -- Error 29002.The Team Foundation databases could not be repaired. For more information, see the Microsoft Windows Installer (MSI) log. For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp. Data: 0000: 7b 33 35 45 44 37 38 38 {35ED788 0008: 42 2d 44 41 36 42 2d 33 B-DA6B-3 0010: 33 37 33 2d 42 42 32 42 373-BB2B 0018: 2d 41 36 38 43 31 34 39 -A68C149 0020: 45 41 38 31 41 7d EA81A}
