[site]: stackoverflow
[post_id]: 4357022
[parent_id]: 
[tags]: 
Writing and image attachment to datastore as an avatar: Is it possible?

Has anyone worked with attachments in received emails? I was thinking, instead of the user uploading an image they can send it as an attachment that I can use to upload to datastore. The documentation has sending attachments but I could not find any documentation about receiving attachments. This page says : attachments The file attachments for the message, as a list of two-value tuples, one tuple for each attachment. Each tuple contains a filename as the first element, and the file contents as the second element. An attachment file must be one of the allowed file types, and the filename must end with an extension that corresponds with the type. For a list of allowed types and filename extensions, see Overview: Attachments. I think this is also about sending email. I have this code to save the image to datastore: class AvatarSave(webapp.RequestHandler): def post(self): q = User.all() q.filter("userEmail =", emailAddress) qTable = q.fetch(10) if qTable: for row in qTable: avatar = images.resize(self.request.get("img"), 50, 50) row.avatar = db.Blob(avatar) db.put(qTable) else: self.response.out.write("user not found") self.redirect('/') Intuitively, it seems that message.attachment instead of "img" will do the trick. avatar = images.resize(self.request.get(message.attachment), 50, 50) What do you think? Thanks. Update2 (New code as response to Nick Johnson's comment) class Register(InboundMailHandler): def receive(self, message): senderEmail = message.sender emailTuple = parseaddr(senderEmail) emailUserName = emailTuple[0] emailAddress = emailTuple[1] newAvatar = db.Blob(images.resize(goodDecode(message.attachments[0][1]), 50, 50)) newUser = User(userEmail=emailAddress, userName=emailUserName, avatar=newAvatar) db.put(newUser) Update1 Problem solved: For the record, and for anyone who has the same question please note that the attribute of message is attachments not attachment : message.attachment gives the AttributeError AttributeError: 'InboundEmailMessage' object has no attribute 'attachment' And the object message.attachment looks like this: [('portrait.png', )] so the correct way to pull the part is avatar = images.resize(goodDecode(message.attachments[0][1]), 50, 50) The original code that I posted has avatar = images.resize(goodDecode(message.attachments[1]), 50, 50) which does not work, obviously. Thanks again to jesmith and Robert Kluin for answers. Update0 (regarding the answer by jesmith ) In my case, I am taking an image "img" from a form uploaded by a user and write it to datastore like this: for row in qTable: avatar = images.resize(self.request.get("img"), 50, 50) row.avatar = db.Blob(avatar) db.put(qTable) self.redirect('/') else: logging.info("else user not found") self.redirect('/user-not-found') In your code this corresponds to this section, I believe: try: if hasattr(message, "attachment"): for a in message.attachments: msg.attachmentNames.append(a[0]) msg.attachmentContents.append(append(db.Blob(goodDecode(a[1]))) msg.put() except: logging.exception("exception decoding attachments in email from %s" % message.sender) assuming that, in my case, there is only 1 attachment; how do I pick up the data part of the attachment? Is it message.attachment[1] ? avatar = images.resize(message.attachment[1], 50, 50) is message.attachment[1] data part of the attachment? Thanks!
