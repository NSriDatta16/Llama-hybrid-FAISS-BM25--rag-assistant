[site]: stackoverflow
[post_id]: 5488690
[parent_id]: 5487928
[tags]: 
How do you know the function is returning 1? The exception you're throwing isn't reporting the ret value. The call itself may be broken - try removing the trailing ; from the sql string. Although you ought to get a more helpful exception from eseguiSP(sql) if that's the case, but it might be hidden elsewhere in your code (maybe something further up is adding something that makes it looks like a 1 was returned?); and neither delete should take effect, unless it's trying to treat it as two commands and only complaining when it sees the second is null. That sounds unlikely but you never know, so I'd try removing the semi-colon anyway. Also, you should probably be using bind parameters for the call, not embedding the values in sql . You also said rollback would be called on exception, and you have utx.commit() , but that's redundant with a commit in the function too.
