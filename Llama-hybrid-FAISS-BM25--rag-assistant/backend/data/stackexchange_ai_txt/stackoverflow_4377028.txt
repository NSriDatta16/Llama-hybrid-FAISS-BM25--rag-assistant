[site]: stackoverflow
[post_id]: 4377028
[parent_id]: 
[tags]: 
SQL duration time calculation

I have a table of historic bus positions at a given time, recorded once per second. The schema looks like this: BusID int not null, BreadcrumbID int not null identity (1, 1), BusStopID int null, Timestamp datetime not null I want to generate a bus stop schedule based on historic trips. A bus is "at a stop" if its BusStopID corresponds to the stop, and is not "at a stop" if the BusStopID is null. I need to generate the average times the bus is at each stop. So basically, I need to do the following: Identify the times that a bus is at a stop -- a simple where clause does the trick Identify the average times the bus is at a stop. For my purposes, I'm defining a discrete "stop time" as a window of plus/minus 10 minutes; if a bus stops one day from 10:04 - 10:08, another day at 10:06 - 10:08, and a third day at 10:14 - 10:18, those would be the same stop, but if it stops at 10:45 - 10:48, that would be a different stop occurrence. Filter out "noise" -- i.e. stops times that only happened a few times but never again I'm completely at a loss as to how to accomplish the second and third bullet. Please help!
