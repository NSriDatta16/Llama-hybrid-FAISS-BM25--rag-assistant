[site]: stackoverflow
[post_id]: 4924600
[parent_id]: 
[tags]: 
Android MediaPlayer full path to file

I need to get the full path to a file somewhere on the phone (any location) and play it with MediaPlayer. ive heard of using a file chooser for Android (by launching an intent). In the test code, I just copied a resource to a another file, got the path and passed it to AudioVideoEntry (as i show later, a very simple and thin wrapper around MediaPlayer) Here's the test code I've written: private String ave_path; private String ave_file_name = "my_media_content"; private InputStream ave_fis; private OutputStream ave_fos; public void testAudioVideoEntry() { //get the Activity Module_JournalEntry journalentryactivity = getActivity(); //open an InputStream to a resource file (in this case strokes.mp3) ave_fis = journalentryactivity.getResources().openRawResource(module.jakway.JournalEntry.R.raw.strokes); //open an OutputStream to a new file try { ave_fos = journalentryactivity.openFileOutput(ave_file_name, Context.MODE_PRIVATE); } catch (FileNotFoundException e1) { // TODO Auto-generated catch block e1.printStackTrace(); assertTrue(false); } catch(Exception e) { assertTrue(false); } //copy the data from the resource into //the OutputStream int data; try { while((data = ave_fis.read()) != -1) { ave_fos.write(data); } assertTrue(true); } catch(Exception e) { assertTrue(false); } //get the full path of the file we wrote to ave_path = journalentryactivity.getFileStreamPath(ave_file_name).toString(); //and construct a new object of AudioVideoEntry with that path AudioVideoEntry ave = new AudioVideoEntry(ave_path); //register an error listener via MediaPlayer's setOnErrorListener ave.setOnErrorListener(new OnErrorListener() { @Override public boolean onError(MediaPlayer mp, int what, int extra) { Log.e("MEDIAPLAYER ERRORS", "what: " + what + " extra: " + extra); assertTrue(false); // TODO Auto-generated method stub return false; } }); ave.prepareMedia(); ave.playMedia(); try { ave_fis.close(); ave_fos.close(); } catch(Exception e) { assertTrue(false); e.printStackTrace(); } AudioVideoEntry is basically a thin wrapper around MediaPlayer that can hold its own path: public class AudioVideoEntry { private String path_to_audio_file; private MediaPlayer mediaplayer; /** * Initialize the internal MediaPlayer * from the String parameter * @param set_path_to_audio_file */ public AudioVideoEntry(String set_path_to_audio_file) { path_to_audio_file = set_path_to_audio_file; mediaplayer = new MediaPlayer(); try { mediaplayer.setDataSource(path_to_audio_file); mediaplayer.prepare(); } catch (IllegalArgumentException e) { // TODO Auto-generated catch block e.printStackTrace(); } catch (IllegalStateException e) { // TODO Auto-generated catch block e.printStackTrace(); } catch (IOException e) { // TODO Auto-generated catch block e.printStackTrace(); } } public AudioVideoEntry(FileDescriptor fd) { mediaplayer = new MediaPlayer(); try { mediaplayer.setDataSource(fd); mediaplayer.prepare(); } catch (IllegalArgumentException e) { // TODO Auto-generated catch block e.printStackTrace(); } catch (IllegalStateException e) { // TODO Auto-generated catch block e.printStackTrace(); } catch (IOException e) { // TODO Auto-generated catch block e.printStackTrace(); } } /** * Begin playing media */ public void prepareMedia() { try { mediaplayer.prepare(); } catch (IllegalStateException e) { // TODO Auto-generated catch block e.printStackTrace(); } catch (IOException e) { // TODO Auto-generated catch block e.printStackTrace(); } } /** * play media * don't forget to prepare() if necessary */ public void playMedia() { mediaplayer.start(); } /** * pause the media * can be played later */ public void pauseMedia() { mediaplayer.pause(); } /** * stop media */ public void stopMedia() { mediaplayer.stop(); } public void setOnErrorListener(OnErrorListener listener) { mediaplayer.setOnErrorListener(listener); } } here's the logcat output from the JUnit test (the tests were successful, the actual results - as the logat shows - were not) 02-07 09:40:23.129: ERROR/MediaPlayer(1209): error (1, -2147483648) 02-07 09:40:23.139: WARN/System.err(1209): java.io.IOException: Prepare failed.: status=0x1 02-07 09:40:23.149: WARN/System.err(1209): at android.media.MediaPlayer.prepare(Native Method) 02-07 09:40:23.149: WARN/System.err(1209): at module.jakway.JournalEntry.AudioVideoEntry. (AudioVideoEntry.java:39) 02-07 09:40:23.149: WARN/System.err(1209): at module.jakway.JournalEntry.test.Module_JournalEntryTest.testAudioVideoEntry(Module_JournalEntryTest.java:182) 02-07 09:40:23.149: WARN/System.err(1209): at java.lang.reflect.Method.invokeNative(Native Method) 02-07 09:40:23.149: WARN/System.err(1209): at java.lang.reflect.Method.invoke(Method.java:507) 02-07 09:40:23.159: WARN/System.err(1209): at android.test.InstrumentationTestCase.runMethod(InstrumentationTestCase.java:204) 02-07 09:40:23.159: WARN/System.err(1209): at android.test.InstrumentationTestCase.runTest(InstrumentationTestCase.java:194) 02-07 09:40:23.159: WARN/System.err(1209): at android.test.ActivityInstrumentationTestCase2.runTest(ActivityInstrumentationTestCase2.java:186) 02-07 09:40:23.159: WARN/System.err(1209): at junit.framework.TestCase.runBare(TestCase.java:127) 02-07 09:40:23.169: WARN/System.err(1209): at junit.framework.TestResult$1.protect(TestResult.java:106) 02-07 09:40:23.169: WARN/System.err(1209): at junit.framework.TestResult.runProtected(TestResult.java:124) 02-07 09:40:23.169: WARN/System.err(1209): at junit.framework.TestResult.run(TestResult.java:109) 02-07 09:40:23.179: WARN/System.err(1209): at junit.framework.TestCase.run(TestCase.java:118) 02-07 09:40:23.179: WARN/System.err(1209): at android.test.AndroidTestRunner.runTest(AndroidTestRunner.java:169) 02-07 09:40:23.179: WARN/System.err(1209): at android.test.AndroidTestRunner.runTest(AndroidTestRunner.java:154) 02-07 09:40:23.179: WARN/System.err(1209): at android.test.InstrumentationTestRunner.onStart(InstrumentationTestRunner.java:529) 02-07 09:40:23.189: WARN/System.err(1209): at android.app.Instrumentation$InstrumentationThread.run(Instrumentation.java:1447) 02-07 09:40:23.189: ERROR/MediaPlayer(1209): prepareAsync called in state 0 02-07 09:40:23.189: WARN/System.err(1209): java.lang.IllegalStateException 02-07 09:40:23.189: WARN/System.err(1209): at android.media.MediaPlayer.prepare(Native Method) 02-07 09:40:23.189: WARN/System.err(1209): at module.jakway.JournalEntry.AudioVideoEntry.prepareMedia(AudioVideoEntry.java:79) 02-07 09:40:23.199: WARN/System.err(1209): at module.jakway.JournalEntry.test.Module_JournalEntryTest.testAudioVideoEntry(Module_JournalEntryTest.java:197) 02-07 09:40:23.199: WARN/System.err(1209): at java.lang.reflect.Method.invokeNative(Native Method) 02-07 09:40:23.199: WARN/System.err(1209): at java.lang.reflect.Method.invoke(Method.java:507) 02-07 09:40:23.199: WARN/System.err(1209): at android.test.InstrumentationTestCase.runMethod(InstrumentationTestCase.java:204) 02-07 09:40:23.199: WARN/System.err(1209): at android.test.InstrumentationTestCase.runTest(InstrumentationTestCase.java:194) 02-07 09:40:23.199: WARN/System.err(1209): at android.test.ActivityInstrumentationTestCase2.runTest(ActivityInstrumentationTestCase2.java:186) 02-07 09:40:23.199: WARN/System.err(1209): at junit.framework.TestCase.runBare(TestCase.java:127) 02-07 09:40:23.199: WARN/System.err(1209): at junit.framework.TestResult$1.protect(TestResult.java:106) 02-07 09:40:23.199: WARN/System.err(1209): at junit.framework.TestResult.runProtected(TestResult.java:124) 02-07 09:40:23.199: WARN/System.err(1209): at junit.framework.TestResult.run(TestResult.java:109) 02-07 09:40:23.199: WARN/System.err(1209): at junit.framework.TestCase.run(TestCase.java:118) 02-07 09:40:23.199: WARN/System.err(1209): at android.test.AndroidTestRunner.runTest(AndroidTestRunner.java:169) 02-07 09:40:23.199: WARN/System.err(1209): at android.test.AndroidTestRunner.runTest(AndroidTestRunner.java:154) 02-07 09:40:23.199: WARN/System.err(1209): at android.test.InstrumentationTestRunner.onStart(InstrumentationTestRunner.java:529) 02-07 09:40:23.199: WARN/System.err(1209): at android.app.Instrumentation$InstrumentationThread.run(Instrumentation.java:1447) 02-07 09:40:23.199: ERROR/MediaPlayer(1209): start called in state 0 02-07 09:40:23.199: ERROR/MediaPlayer(1209): error (-38, 0) Edit: why is MediaPlayer failing? thanks! dragonwrenn
