[site]: stackoverflow
[post_id]: 5660249
[parent_id]: 5654221
[tags]: 
Why not shift the heavy lifting from reporting to the transaction booking You can add a new table called: TagTotal that stores the total amount per tag and updates with with every transaction via a BEFORE(AFTER)_UPDATE_EACH trigger. Extra fields/table If you have 2 extra fields in the product table: product.amount decimal(10,2) running total of sales to date product.last_sale date date of the last sale And the tag totals table looks like this. tag.id primary autoinc tag.tagstr varchar(25) tag.amount decimal(10,2) tag.date_from date #dates to keep the running totals per month/week/day. tag.date_to date pseudo code CREATE TRIGGER ai_sales_each AFTER INSERT ON sales FOR EACH ROW BEGIN UPDATE product SET product.amount = product.amount + new.amount, product.last_sale = sale.date END CREATE TRIGGER au_product_each AFTER UPDATE ON product FOR EACH ROW BEGIN DECLARE AllTags VARCHAR(255); DECLARE ThisTag VARCHAR(25); IF old.tags <> new.tags THEN BEGIN reorganize the running totals in the tagtotal table. END; END IF; SET AllTags = new.tags; WHILE AllTags has more tags BEGIN SET ThisTag = NextTag(AllTags); UPDATE TagTotals SET amount = amount + new.amount WHERE TagTotals.tagstr = ThisTag AND new.last_date BETWEEN TagTotals.date_from AND TagTotals.date_to; END; END WHILE; Now if you want the sales totals per tag, you can just select from the tagtotals table. Which will give instant results.
