[site]: crossvalidated
[post_id]: 608739
[parent_id]: 
[tags]: 
When does target encoding lead to overfitting

Let us say, we are tasked with setting (average/list) prices that are likely to convert for heterogeneous products (e.g. used cars of all shape and sizes - made up example!). Let us also say that we only use one feature: miles per gallon for target encoding with respect to the target prices achieved sales in the last 12 months. We simply bin the feature using quartiles and calculate the median prices per quartile. When we use a fancy model to price a new car to be sold, we feed the miles per gallon quartile's retrospective average to the model. As we use data from the last 12 months actual sales during scoring - would this be data leakage or acceptable? I guess for fitting the model you would only use the training data's quartile values (at least during optimisation - such as feature selection, interaction effect inclusion or hyper parameter optimisation if we deal with a machine learning model)?
