[site]: stackoverflow
[post_id]: 2962629
[parent_id]: 
[tags]: 
How to post non-latin1 data to non-UTF8 site using perl?

I want to post russian text on a CP1251 site using LWP::UserAgent and get following results: # $text="Русский текст"; obtained from command line FIELD_NAME => $text # result: Г?в г'В?г'В?г'В?г?вєг?вёг?в? Г'В'Г?вчг?вєг'В?г'В' $text=Encode::decode_utf8($text); FIELD_NAME => $text # result: Р с?с?с?рєрёр? С'Рчрєс?с' FIELD_NAME => Encode::encode("cp1251", $text) # result: Г?гіг+г+гЄгёгЏ ГІгҐгЄг+гІ FIELD_NAME => URI::Escape::uri_escape_utf8($text) # result: D0%a0%d1%83%d1%81%d1%81%d0%ba%d0%b8%d0%b9%20%d1%82%d0%b5%d0%ba%d1%81%d1%82 How can I do this? Content-Type must be x-www-form-urlencoded . You can find similar form here , but there you can just escape any non-latin character using &#...; form, trying to escape it in FIELD_NAME results in 10561091108910891 10901077108210891 (every & , # and ; stripped out of the string) or 1056;усский текст (punctuation characters at the beginning of the string are stripped out) depending on what the FIELD_NAME actually is. UPDATE : Anybody knows how to convert the following code so that it will use LWP::UserAgent::post function? my $url=shift; my $fields=shift; my $request=HTTP::Request->new(POST => absURL($url)); $request->content_type('application/x-www-form-urlencoded'); $request->content_encoding("UTF-8"); $ua->prepare_request($request); my $content=""; for my $k (keys %$fields) { $content.="&" if($content ne ""); my $c=$fields->{$k}; eval {$c=Encode::decode_utf8($c)}; $c=Encode::encode("cp1251", $c, Encode::FB_HTMLCREF); $content.="$k=".URI::Escape::uri_escape($c); } $request->content($content); my $response=$ua->simple_request($request); This code actually solves the problem, but I do not want to add the third request wrapper function (alongside with get and post ).
