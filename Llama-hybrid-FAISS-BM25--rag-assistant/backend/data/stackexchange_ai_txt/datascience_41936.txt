[site]: datascience
[post_id]: 41936
[parent_id]: 
[tags]: 
Input explanatory categorical variables along with time series into neural network

I want an advise on the ways to enter time series along with additional variables into convolutional neural network. Story first : I have a dataset of time series with daily energy consumption data (measurements every 30 min). Also, it's important to mention that often some days are skipped and sometimes there are two different measurements for one date - it means, that dates are not strictly consequential. Also there's a number of additional explanatory variables for each day, like is it a holiday (0-1), sunrise/sunset time (h), outside temperature (deg, not categorical), etc. So my dataset looks like the following: h1 h2 h3 h4 ... h48 v1 v2 v3 v4 v5 v6 .. vn h1 h2 h3 h4 ... h48 v1 v2 v3 v4 v5 v6 .. vn ... where h_i are 30-min measurements and v_i are explanatory variables. I am using some moving window with N rows. One another point of this setup is that I am trying to use convolutional network with sometimes 2D convolutions and I hope to look into the filters later to analyze patterns in energy consumption (including cross-day ones) which might refer to different devices. So no RNN at this stage. Here comes the problem. Parsing dates as one-hot is impossible in terms of RAM, as it creates a huge sparse table of floats (366 columns for day, 12 for month, 24 for sunrise, etc). So I ended up feeding hourly consumption table into CNN subnetwork separately, and feeding embeddings of explanatory variables into separate Dense network, and then concatenating results of these networks inside my flow. In pseudocode: variables_to_embed_input = Lambda( lambda z: z[:,:,48:,:])(inputs) hourly_consumption = Lambda( lambda z: z[:,:,:48,:])(inputs) x = my_CNN(hourly_consumption) embedding_outs = my_embeddings_NN(variables_to_embed_input) additional_vars = Concatenate()(embedding_outs) additional_vars = Dense(512, activation='linear')(additional_vars) merged = Concatenate()([x, additional_vars] ) ... The problem is that network where time series and additional variables are fed separately, performs poorly - just a little bit better than only CNN on consumption data without dates and close to simple regression built on daily consumption. I think that network must somehow "see" that specific row of explanatory variables corresponds to a specific row of energy consumption series, but now they are fed separately and joined only near the top of the network. Is there any better way to input those explanatory data along with time series? EDIT: I am currently working on feeding variables as channels, but I am uncertain that I will be able to extract meaningful information from filters afterwards, even if it will start working.
