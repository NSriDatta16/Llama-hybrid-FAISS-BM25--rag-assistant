[site]: stackoverflow
[post_id]: 4895586
[parent_id]: 
[tags]: 
Trouble using 'while' loop to evaluate multiple lines, Perl

Thank you in advance for indulging an amateur Perl question. I'm extracting some data from a large, unformatted text file, and am having trouble combining the use of a 'while' loop and regular expression matching over multiple lines. First, a sample of the data: 01-034575 18/12/2007 258,750.00 11,559.00 36 -2 0 6 -3 2 -2 0 2 1 -1 3 0 5 15 -13 -44 -74 -104 -134 -165 -196 -226 -257 -287 -318 -349 -377 -408 -438 -469 -510 -541 -572 -602 -633 -663 Atraso Promedio ---> 0.94 The first sequence, XX-XXXXXX is a loan ID number. The date and the following two numbers aren't important. '36' is the number of payments. The following sequence of positive and negative numbers represent how late/early this client was for this loan at each of the 36 payment periods. The '0.94' following 'Atraso Promedio' is the bank's calculation for average delay. The problem is it's wrong, since they substitute all negative (i.e. early) payments in the series with zeros, effectively over-stating how risky a client is. I need to write a program that extracts ID and number of payments, and then dynamically calculates a multi-line average delay. Here's what I have so far: #Create an output file open(OUT, ">out.csv"); print OUT "Loan_ID,Atraso_promedio,Atraso_alt,N_payments,\n"; open(MYINPUTFILE, " ){ chomp($_); if($ID_select != 1 && m/(\d{2}\-\d{6})/){$Loan_ID = $1, $ID_select = 1} if($ID_select == 1 && m/\d{1,2},\d{1,3}\.00\s+\d{1,2},\d{1,3}\.00\s+(\d{1,2})/) {$N_payments = $1, $Payment_find = 1}; if($Payment_find == 1 && $ID_select == 1){ while(m/\s{2,}(\-?\d{1,3})/g){ $N++; $SUM = $SUM + $1; print OUT "$Loan_ID,$1\n"; #THIS SHOWS ME WHAT NUMBERS THE CODE IS GRABBING. ACTUAL OUTPUT WILL BE WRITTEN BELOW print $Loan_ID,"\n"; } if(m/---> *(\d*.\d*)/){$Atraso = $1, $Atraso_select = 1} if($ID_select == 1 && $Payment_find == 1 && $Atraso_select == 1){ ... There's more, but the while loop is where the program is breaking down. The problem is with the pattern modifier, 'g,' which performs a global search of the string. This makes the program grab numbers that I don't want, such as the '1' in loan ID and the '36' for the number of payments. I need the while loop to start from wherever the previous line in the code left off, which should be right after it has identified the number of loans. I've tried every pattern modifier that I've been able to look up, and only 'g' keeps me out of an infinite loop. I need the while loop to go to the end of the line, then start on the next one without combing over the parts of the string already fed through the program. Thoughts? Does this make sense? Would be immensely grateful for any help you can offer. This work is pro-bono, unpaid: just trying to help out some friends in a micro-lending institution conduct a risk analysis. Cheers, Aaron
