[site]: stackoverflow
[post_id]: 5019403
[parent_id]: 
[tags]: 
Editing XML with PowerShell and "file format" error

I am using the HyperV Module from Codeplex to do a "config only" export from a 2008R2 Hyper-V server. In order to import the configuration on another HyperV server, I need to edit the value of CopyVMStorage in the EXP file. This file is an XML file. I wrote the following code in PowerShell to do the update for me. The variable $existing is the existing exp file. $xml = [xml](get-content $existing) $xpath = '//PROPERTY[@NAME ="CopyVmStorage"]' foreach ($node in $xml.SelectNodes($xpath)) {$node.Value = 'TRUE'} $xml.Save($existing) This code makes the correct changes to the XML. However, when I go to import the file on the Hyper-V server, I get an error that says "the file format is incorrect". I am wondering if the encoding of the file is incorrect or if there is something else going on. If I edit the file manually in wordpad, it imports without an issue. I have noticed that the file that is updated with PowerShell comes out formatted whereas the raw file is xml all bunched together with no whitespace. Any ideas on what "file format" could mean in this HyperV error message and how I might be able to use my code to automate this change in the XML and be able to use it to import the VM config? XML Before Virtual System Export Setting Data 0 FALSE FALSE TRUE Microsoft Virtual System Export Setting Data Microsoft Virtual System Export Setting Data Microsoft:A1F914F2-F38E-48A6-B1EE-58B84ECEAC0C XML After Virtual System Export Setting Data 0 FALSE TRUE TRUE Microsoft Virtual System Export Setting Data Microsoft Virtual System Export Setting Data Microsoft:A1F914F2-F38E-48A6-B1EE-58B84ECEAC0C NOTE: This is a cross post from https://serverfault.com/questions/231186/code-to-update-hyperv-export-file . I believe this is actually more of a coding/dev problem rather than an IT Pro question.
