[site]: crossvalidated
[post_id]: 443642
[parent_id]: 443614
[tags]: 
Here is a general analytic solution --- does not require simulation This is a variation on the classical occupancy problem, where you are sampling lots of thirty names at each sampling point, instead of sampling individual names. The simplest way to compute this result is by framing the problem as a Markov chain, and then computing the required probability using the appropriate power of the transition probability matrix. For the sake of broader interest to other users, I will generalise from your example by considering a list with $m$ names, with each sample selecting $1 \leqslant h \leqslant m$ names (using simple-random-sampling without replacement). The general problem and its solution: Let $0 \leqslant K_{n,h} \leqslant m$ denote the number of names that have been sampled after we sample $n$ times with each lot sampling $h$ names. For a fixed value $h$ the stochastic process $\{ K_{n,h} | n = 0,1,2,... \}$ satisfies the Markov assumption, so it is a Markov chain. Since each sampling lot is done using simple-random-sampling without replacement, the transition probabilities for the chain are given by the hypergeometric probabilities: $$P_{t,t+r} \equiv \mathbb{P}(K_{n,h} = t+r | K_{n-1,h} = t) = \frac{{m-t \choose r} {t \choose h-r}}{{m \choose h}}.$$ Let $\mathbf{P}_h$ denote the $(m+1) \times (m+1)$ transition probability matrix composed of these probabilities. If we start at the state $K_{0,h} = 0$ then we have: $$\mathbb{P}(K_{n,h} = k) = [ \mathbf{P}_h^n ]_{0,k}.$$ This probability can be computed by matrix multiplication, or by using the spectral decomposition of the transition probability matrix. It is relatively simple to compute the mass function of values over $k=0,1,...,m$ for any given values of $n$ and $h$ . This allows you to compute the marginal probabilities associated with the Markov chain, to solve the problem you have posed. The problem you have posed is a case of the following general problem. For a specified minimum proportion $0 and a specified minimum probability $0 , we seek the value: $$h_* \equiv h_* (\alpha, p) \equiv \min \{ h = 1,...,m | \mathbb{P}(K_{n,h} \geqslant \alpha m) \geqslant p \}.$$ In your problem you have $m=200$ names in your list and you are taking $n=30$ samples. You seek the value $h_*$ for the proportion $\alpha = 0.9$ and the probability cut-off $p = 0.9$ . This value can be computed by computing the relevant marginal probabilities of interest in the Markov chain. Implementation in R : We can implement the above Markov chain in R by creating the transition probability matrix and using this to compute the marginal probabilities of interest. We can compute the marginal probabilities of interest using standard analysis of Markov chains, and then use these to compute the required number of names $h_*$ in each sample. In the code below we compute the solution to your problem and show the relevant probabilities increasing over the number of samples (this code takes a while to run, owing to the computation of matrix-powers in log-space). #Create function to compute marginal distribution of Markov chain COMPUTE_DIST From the marginal probabilities for the Markov chain, we can now compute the required value $h_*$ for your particular problem. #Set parameters for problem alpha We can see here that we require $h_* = 17$ samples in order to obtain a minimum $p=0.9$ probability of sampling at least $\alpha \cdot m = 180$ of the names on the list. Below we show a plot of the probabilities for values $h=1,...,20$ with the required value highlighted in red. #Plot the probabilities and the solution library(ggplot2); THEME
