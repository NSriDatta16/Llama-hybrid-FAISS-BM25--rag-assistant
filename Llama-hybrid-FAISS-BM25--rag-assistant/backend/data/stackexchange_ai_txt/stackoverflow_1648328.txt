[site]: stackoverflow
[post_id]: 1648328
[parent_id]: 1643652
[tags]: 
I used to run a script that polled SHOW STATUS for thread count and I noticed that using mysql_pconnect always encouraged high numbers of threads. I found that very disconcerting because then I couldn't tell when my connection rate was actually dropping. So I made sure to centralize all the places where mysql_connect() was called and eliminate mysql_pconnect(). The next thing I did was look at the connection timeouts and adjust them to more like 30 seconds because. So I adjusted my my.cnf with connect-timeout=30 so I could actually see the number of connections drop off. To determine the number of connections you need open is dependent on how many apache workers you're running times the number of database connections they each will open. The other thing I started doing was adding a note to my queries in order to spot them in SHOW PROCESSLIST or mytop, I would add a note column to my results like: $q = "SELECT '".__FILE__.'.'.__LINE__."' as _info, * FROM table ..."; This would show me the file issuing the query when I looked at mytop, and it didn't foil the MySQL query cache like using /* __FILE__.'.'.__LINE__ */ at the start of my query would.
