[site]: crossvalidated
[post_id]: 591987
[parent_id]: 333695
[tags]: 
The discrepancy is due to the interpretation of $y_i^{t-1}$ . In your derivation, you're assuming it is the probability $h_i$ , whereas the code author has defined it as the log odds $logit(h_i) = log(\frac{h_i}{1-h_i})$ . Re-express the loss as a function of log odds instead of probability (define $O_i = logit(h_i)$ ): $$ L_i = -y_i O_i + log(1 + exp(O_i)) $$ And find the derivative with respect to the log odds: $$ g_i = \frac{d L_i}{d O_i} = h_i - y_i $$ (Side note: As stated by @Sycorax, you're overloading the term $h_i$ because the xgboost paper authors define it as the 2nd order gradient statistic)
