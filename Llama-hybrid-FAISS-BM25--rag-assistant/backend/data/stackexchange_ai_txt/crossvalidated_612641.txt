[site]: crossvalidated
[post_id]: 612641
[parent_id]: 525170
[tags]: 
In the script you write $X$ and $Z$ as jointly determined. This is equivalent to there being selection into instrument on endo2 in your script, confounding the estimates of the estimation. The LATE framework requires the instrument, $Z$ , be independently assigned to unit (or conditionally so). This is violated in your script by determining both $Z$ and $X$ by endo2 . To see this, note that the $\kappa$ -weight gets the average rate of compliance correct if you estimate $\Pr(Z_i = 1)$ without conditioning on $X_i$ : ### simulate the data generating process set.seed(2839) n 0) d median(d)) x Though, if you're interested in further practical details on the Abadie (2003) weights approach, new research in the area is fairly interesting. https://doi.org/10.2139/ssrn.4093467 https://doi.org/10.48550/arXiv.1909.05244
