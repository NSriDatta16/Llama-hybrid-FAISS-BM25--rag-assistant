[site]: stackoverflow
[post_id]: 3661882
[parent_id]: 
[tags]: 
How to get this ajax drop-down selector to work across all browsers?

I wrote this code that populates a box with the results of an ajax call... (function() { var cache = {}; var queue = {}; $('select.country').live('change', function() { var $countrySel = $(this); var $provSel = $countrySel.closest('tr,.label-and-input').next().find('select.province'); var $provInput = $provSel.siblings('input.province'); var country = $countrySel.val(); var province = $provInput.val(); $provSel.empty(); if(country == '' || country == null) { $provSel.trigger('change'); return; } if(country in cache) { addOptions($provSel, cache[country]); } else if(country in queue) { $provSel.addClass('loading'); queue[country].push($provSel); } else { $provSel.addClass('loading'); queue[country] = [$provSel] $.getJSON('/get-provinces.json', {country:country}, function(provinces) { cache[country] = provinces; while(queue[country].length > 0) { var $select = queue[country].pop(); $select.removeClass('loading'); addOptions($select, cache[country]); } }); } }).trigger('change'); })(); function addOptions($select, options) { $select.append(' - Select - '); for(var i in options) { $select.append(' {1} '.format(options[i][0], options[i][1])); } $select.val($select.siblings('input:first').val()).trigger('change'); } Works great on all the browsers I tested it on, but of course, not on my client's machine. I essentially empty() the list, and then append the new one by one. In some browsers when you switch back and forth between countries the state/province list doesn't get refreshed properly... it keeps the old values and just adds the new values, or doesn't add the new values at all. What's the most portable approach to do this? Should I build all the options as a big html string instead, and then set the whole thing at once with .html() ? Should I delete the altogether to ensure it gets emptied correctly? The HTML: Province/State - Select - Alberta British Columbia Manitoba New Brunswick Newfoundland and Labrador Northwest Territories Nova Scotia Nunavut Ontario Prince Edward Island Quebec Saskatchewan Yukon The province select is actually added dynamically, and it updates the hidden field when it's changed. Had to do this to get it to interface with Django correctly and to degrade nicely.
