[site]: stackoverflow
[post_id]: 873186
[parent_id]: 872907
[tags]: 
This is code using the DeviceIOControl() API function, works for me on Windows XP (compiled and tested using Delphi 5): function DeviceIOControlHelper(ADeviceHandle: THandle; ADeviceIOControlCode: DWORD): boolean; var BytesReturned: Cardinal; begin Result := DeviceIOControl(ADeviceHandle, ADeviceIOControlCode, nil, 0, nil, 0, BytesReturned, nil); end; function SetDriveDoorOpen(ADriveLetter: char; AValue: boolean): boolean; const FILE_DEVICE_FILE_SYSTEM = 9; FILE_ANY_ACCESS = 0; FILE_READ_ACCESS = 1; METHOD_BUFFERED = 0; IOCTL_STORAGE_BASE = $2D; (* #define CTL_CODE( DeviceType, Function, Method, Access ) ( \ ((DeviceType) INVALID_HANDLE_VALUE then begin if AValue then begin Result := DeviceIOControlHelper(DriveHandle, FSCTL_LOCK_VOLUME) and DeviceIOControlHelper(DriveHandle, FSCTL_DISMOUNT_VOLUME) and DeviceIOControlHelper(DriveHandle, IOCTL_STORAGE_EJECT_MEDIA); end else Result := DeviceIOControlHelper(DriveHandle, IOCTL_STORAGE_LOAD_MEDIA); CloseHandle(DriveHandle); end; end; Error handling omitted.
