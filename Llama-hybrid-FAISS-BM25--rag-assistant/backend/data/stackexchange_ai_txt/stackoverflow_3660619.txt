[site]: stackoverflow
[post_id]: 3660619
[parent_id]: 
[tags]: 
In PHP, why do I have to execute the removeChild method twice on a DOMNode from which I have just removed the style-attribute?

I have a script in PHP which removes empty paragraphs from an HTML file. The empty paragraphs are those elements without textContent. HTML File with Empty Paragraphs: This is a paragraph. This is another paragraph. First Attempt: $html = new DOMDocument("1.0", "UTF-8"); $html->loadHTMLFile("HTML File with Empty Paragraphs.html"); $pars = $html->getElementsByTagName("p"); /* removeChild foreach-loop */ foreach ($pars as $par) { if ($par->textContent == "") { $par->parentNode->removeChild($par); } } $html->saveHTMLFile("HTML File WithOut Empty Paragraphs.html"); This succeeds to: remove empty paragraphs without the style-attribute, but fails to: remove empty paragraphs with the style-attribute. So I insert the removeStyleAttribute foreach-loop before the removeChild foreach-loop. (I do not mind removing the style-attributes of nonempty paragraphs.) Second Attempt: $html = new DOMDocument("1.0", "UTF-8"); $html->loadHTMLFile("HTML File with Empty Paragraphs.html"); $pars = $html->getElementsByTagName("p"); /* removeStyleAttribute foreach-loop */ foreach ($pars as $par) { if ($par->hasAttribute("style")) { $par->removeAttribute("style"); } } /* removeChild foreach-loop */ foreach ($pars as $par) { if ($par->textContent == "") { $par->parentNode->removeChild($par); } } $html->saveHTMLFile("HTML File WithOut Empty Paragraphs.html"); This succeeds in: removing the style-attributes from empty paragraphs which have the style attribute. removing empty paragraphs that do not have the style-attributes. But fails! to: remove those empty paragraphs from which the style-attributes were removed. So I have to have two removeChild foreach-loops, one after the other. Third Attempt: $html = new DOMDocument("1.0", "UTF-8"); $html->loadHTMLFile("HTML File with Empty Paragraphs.html"); $pars = $html->getElementsByTagName("p"); /* removeStyleAttribute foreach-loop */ foreach ($pars as $par) { if ($par->hasAttribute("style")) { $par->removeAttribute("style"); } } /* First removeChild foreach-loop */ foreach ($pars as $par) { if ($par->textContent == "") { $par->parentNode->removeChild($par); } } /* Second removeChild foreach-loop, identical to the first removeChild foreach-loop */ foreach ($pars as $par) { if ($par->textContent == "") { $par->parentNode->removeChild($par); } } $html->saveHTMLFile("HTML File WithOut Empty Paragraphs.html"); This works perfectly! , but it is weird to have two identical loops, one right after the other. I also tried to use only one loop for everything. Fourth Attempt: $html = new DOMDocument("1.0", "UTF-8"); $html->loadHTMLFile("HTML File with Empty Paragraphs.html"); $pars = $html->getElementsByTagName("p"); foreach ($pars as $par) { if ($par->textContent == "") { if ($par->hasAttribute("style")){ $par->removeAttribute("style"); } $par->parentNode->removeChild($par); } } $html->saveHTMLFile("HTML File WithOut Empty Paragraphs.html"); This succeeds to: remove empty paragraphs without the style-attribute, but fails to: remove the style-attribute from empty paragraphs that have it. remove empty paragraphs with the style attribute.
