[site]: stackoverflow
[post_id]: 2314683
[parent_id]: 
[tags]: 
Sorting by ratings in a database - Where to put this SQL? (PHP/MySQL)

OK - I'll get straight to the point - here's the PHP code in question: Highest Rated: db->query("SELECT * FROM code ORDER BY rating DESC"); foreach($query->result() as $row) { ?> title." ID: ";echo $row->id; ?> db->query("SELECT email FROM users WHERE id = ".$row->author); echo $query2->row('email');?> bbcode->Parse($row->code)); ?> Sorry it's a bit messy, it's still a draft. Anyway, I researched ways to use a Ratings system - previously I had a single 'rating' field as you can see by SELECT * FROM code ORDER BY rating DESC. However I quickly realised calculating averages like that wasn't feasible, so I created five new columns - rating1, rating2, rating3, rating4, rating5. So when 5 users rating something 4 stars, rating4 says 5... does that make sense? Each ratingx column counts the number of times the rating was given. So anyway: I have this SQL statement: SELECT id, (ifnull(rating1,0) + ifnull(rating2,0) + ifnull(rating3,0) + ifnull(rating4,0) + ifnull(rating5,0)) / ((rating1 IS NOT NULL) + (rating2 IS NOT NULL) + (rating3 IS NOT NULL) + (rating4 IS NOT NULL) + (rating5 IS NOT NULL)) AS average FROM code Again messy, but hey. Now what I need to know is how can I incorporate that SQL statement into my script? Ideally you'd think the overall query would be 'SELECT * FROM code ORDER BY ( that really long query i just stated ) DESC' but I can't quite see that working... how do I do it? Query, store the result in a variable, something like that? If that makes no sense sorry! But I really appreciate the help :) Jack
