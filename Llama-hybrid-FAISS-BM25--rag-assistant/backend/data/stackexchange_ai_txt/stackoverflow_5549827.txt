[site]: stackoverflow
[post_id]: 5549827
[parent_id]: 
[tags]: 
How do I get a COM interface given a HWND of an ActiveX control?

I'm trying to write a little C (C++ is fine, too) utility for spying ActiveX controls. Given some HWND handle of a window I'd like to print which properties and which methods are exposed by the ActiveX control for this HWND optionally, what interfaces does the control implement For testing purposes, I'm embedding random ActiveX controls (like, the Microsoft Slider control) into the ActiveX Control Test Container so that I know that the HWND of the control is indeed the window of an ActiveX control. Furthermore, I know what properties/methods the control exposes, so I can test my tool. My current solution for (1) is to use the AccessibleObjectFromWindow function on the HWND to get an IDispatch . It works, but it seems you really always only get an accessible interface back (the IDispatch which is returned is just the IDispatch part of the IAccessible interface). I tried passing the actual CLSID of my sample control as the third argument to AccessibleObjectFromWindow but that didn't help either. Seems that function really lives up to it's name - you always only get the accessibility interface. :-) Does anybody know whether such an "ActiveX spy" is possible at all? If so, how?
