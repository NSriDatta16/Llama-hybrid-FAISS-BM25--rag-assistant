[site]: stackoverflow
[post_id]: 1884127
[parent_id]: 
[tags]: 
Loading an object from PHP session, does it call constructor?

If I save some object in a php session variable $_SESSION['geoip'] = new GeoIP(); and then on future page loads I use $geoip = $_SESSION['geoip'] , will it call the constructor? My constructor for that GeoIP class is making a call to an remote API (CURL), so I was hoping to save on API calls by only doing it the first time and then storing the results in my session variable. GeoIP.class.php: require_once('geoPlugin.class.php'); class GeoIP { public $currentIP; public $geoplugin; function __construct($forceIP = null){ if(!empty($forceIP)) $this->currentIP = $forceIP; else $this->currentIP = $_SERVER['REMOTE_ADDR']; $this->geoplugin = new geoPlugin(); $this->geoplugin->locate($forceIP); } function isValid(){ return !empty($this->geoplugin->countryName); } function getCountry(){ return $this->geoplugin->countryName; } function getRegion(){ return $this->geoplugin->region; } function getCity(){ return $this->geoplugin->city; } function getPostalCode(){ return $this->geoplugin->postalCode; } } geoPlugin.class.php: host ); $host = str_replace( '{CURRENCY}', $this->currency, $host ); $data = array(); $response = $this->fetch($host); $data = unserialize($response); //set the geoPlugin vars $this->ip = $ip; $this->city = $data['geoplugin_city']; $this->region = $data['geoplugin_region']; $this->areaCode = $data['geoplugin_areaCode']; $this->dmaCode = $data['geoplugin_dmaCode']; $this->countryCode = $data['geoplugin_countryCode']; $this->countryName = $data['geoplugin_countryName']; $this->continentCode = $data['geoplugin_continentCode']; $this->latitude = $data['geoplugin_latitude']; $this->longitude = $data['geoplugin_longitude']; $this->currencyCode = $data['geoplugin_currencyCode']; $this->currencySymbol = $data['geoplugin_currencySymbol']; $this->currencyConverter = $data['geoplugin_currencyConverter']; if(!empty($this->latitude) && !empty($this->longitude)){ $host = str_replace( '{LAT}', $this->latitude, $this->postalHost ); $host = str_replace( '{LONG}', $this->longitude, $host ); $data = array(); $response = $this->fetch($host); $data = unserialize($response); $this->postalCode = $data['geoplugin_postCode']; } } function fetch($host) { if ( function_exists('curl_init') ) { //use cURL to fetch data $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $host); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_USERAGENT, 'geoPlugin PHP Class v1.0'); $response = curl_exec($ch); curl_close ($ch); } else if ( ini_get('allow_url_fopen') ) { //fall back to fopen() $response = file_get_contents($host, 'r'); } else { trigger_error ('geoPlugin class Error: Cannot retrieve data. Either compile PHP with cURL support or enable allow_url_fopen in php.ini ', E_USER_ERROR); return; } return $response; } function convert($amount, $float=2, $symbol=true) { //easily convert amounts to geolocated currency. if ( !is_numeric($this->currencyConverter) || $this->currencyConverter == 0 ) { trigger_error('geoPlugin class Notice: currencyConverter has no value.', E_USER_NOTICE); return $amount; } if ( !is_numeric($amount) ) { trigger_error ('geoPlugin class Warning: The amount passed to geoPlugin::convert is not numeric.', E_USER_WARNING); return $amount; } if ( $symbol === true ) { return $this->currencySymbol . round( ($amount * $this->currencyConverter), $float ); } else { return round( ($amount * $this->currencyConverter), $float ); } } function nearby($radius=10, $limit=null) { if ( !is_numeric($this->latitude) || !is_numeric($this->longitude) ) { trigger_error ('geoPlugin class Warning: Incorrect latitude or longitude values.', E_USER_NOTICE); return array( array() ); } $host = "http://www.geoplugin.net/extras/nearby.gp?lat=" . $this->latitude . "&long=" . $this->longitude . "&radius={$radius}"; if ( is_numeric($limit) ) $host .= "&limit={$limit}"; return unserialize( $this->fetch($host) ); } } My caller: if(isset($_GET['forceIP'])){ //overwrite the IP address $myGeo = new GeoIP($_GET['forceIP']); } else{ if(empty($_SESSION['directory']['geoip'])){ $myGeo = new GeoIP(); $_SESSION['directory']['geoip'] = $myGeo; } else{ $myGeo = $_SESSION['directory']['geoip']; } }
