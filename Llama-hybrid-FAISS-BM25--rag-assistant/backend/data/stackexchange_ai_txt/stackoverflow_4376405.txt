[site]: stackoverflow
[post_id]: 4376405
[parent_id]: 
[tags]: 
HttpsURLConnection and POST

some time ago i wrote this program in python, that logged in a website using https, took some info and logged out. The program was quite simple: class Richiesta(object): def __init__(self,url,data): self.url = url self.data = "" self.content = "" for k, v in data.iteritems(): self.data += str(k)+"="+str(v)+"&" if(self.data == ""): self.req = urllib2.Request(self.url) else: self.req = urllib2.Request(self.url,self.data) self.req.add_header('User-Agent', 'Mozilla/5.0 (Windows NT 5.1; rv:2.0b6) Gecko/20100101 Firefox/4.0b6') self.req.add_header('Referer', baseurl+'/www/') self.req.add_header('Cookie', cookie ) def leggi(self): while(self.content == ""): try: r = urllib2.urlopen(self.req) except urllib2.HTTPError, e: print("Errore del server, nuovo tentativo tra 15 secondi") time.sleep(15) except urllib2.URLError, e: print("Problema di rete, prover√≤ a riconnettermi tra 20 secondi") time.sleep(20) else: self.content = r.read().decode('utf-8') def login(username,password): global cookie print("Inizio la procedura di login") url = "https://example.com/auth/Authenticate" data = {"login":"1","username":username,"password":password} f = Richiesta(url,data) f.leggi() Now, for some reason, I have to translate it in java. Untill now, this is what i've writte: import java.net.*; import java.security.Security.*; import java.io.*; import javax.net.ssl.*; public class SafeReq { String baseurl = "http://www.example.com"; String useragent = "Mozilla/5.0 (Windows NT 5.1; rv:2.0b6) Gecko/20100101 Firefox/4.0b6"; String content = ""; public SafeReq(String s, String sid, String data) throws MalformedURLException { try{ URL url = new URL(s); HttpsURLConnection request = ( HttpsURLConnection ) url.openConnection(); request.setUseCaches(false); request.setDoOutput(true); request.setDoInput(true); request.setFollowRedirects(true); request.setInstanceFollowRedirects(true); request.setRequestProperty("User-Agent",useragent); request.setRequestProperty("Referer","http://www.example.com/www/"); request.setRequestProperty("Cookie","sid="+sid); request.setRequestProperty("Origin","http://www.example.com"); request.setRequestProperty("Content-Type","application/x-www-form-urlencoded"); request.setRequestProperty("Content-length",String.valueOf(data.length())); request.setRequestMethod("POST"); OutputStreamWriter post = new OutputStreamWriter(request.getOutputStream()); post.write(data); post.flush(); BufferedReader in = new BufferedReader(new InputStreamReader(request.getInputStream())); String inputLine; while ((inputLine = in.readLine()) != null) { content += inputLine; } post.close(); in.close(); } catch (IOException e){ e.printStackTrace(); } } public String leggi(){ return content; } } The problem is, the login doesn't work, and when i try to get a page that require me to be logged, i get the "Login Again" message. The two classes seems quite the same, and i can't understand why i can't make the second one to work ... any idea?
