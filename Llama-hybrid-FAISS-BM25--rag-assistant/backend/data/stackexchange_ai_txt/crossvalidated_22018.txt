[site]: crossvalidated
[post_id]: 22018
[parent_id]: 21426
[tags]: 
Let $y_{ct}$ be the outcome in city c at time t, $x_{ct}$ be a city-specific variable at time t, $z_t$ be a non-city-specific variable at time t (e.g., day of the week), and $T_{ct}$ be the treatment indicator (e.g., boolean). For cities A and B, $$\begin{align*}y_{at} &= \alpha_a + \beta_a x_{ct} + \gamma_a z_t + \delta T_{at} + \epsilon_{at} \\ y_{bt} &= \alpha_b + \beta_a x_{bt} + \gamma_a z_t + \delta T_{bt} + \epsilon_{bt} \end{align*}$$ Assume that city A was treated, while city B was not. Let's take the difference: $$\begin{equation*} y_{at} - y_{bt} = (\alpha_a - \alpha_b) + \beta_a x_{at} + (- \beta_b) x_{bt} + (\gamma_a - \gamma_b) z_t + \delta T_{at} + (\epsilon_{at} - \epsilon_{bt}) \end{equation*}$$ What's the magic of difference-in-differences? Suppose that $x$ is unobservable. If $\beta_a x_{at} = \beta_b x_{bt}$, for example, if the cities have the same value of the covariate and the same impact of that covariate, then this unobserved factor cancels out. Suppose that $z$ is unobservable. If $\gamma_a = \gamma_b$, this term drops out. These features are why we are interested in finding comparable cities---unobservable components are assumed to be the same across cities and they cancel out. (Note: this is a single difference. Where's the other difference? We care about $\delta$, which is the difference between non-treatment and treatment periods.) Now, we are left to figure out what to do with the error terms. If we think that $y$ has a unit root, we should use $\Delta y_{ct}$ rather than $y_{ct}$ from the beginning. Do a Dickey-Fuller or KPSS test on each city's $y$ series to find out. Otherwise, we should refer to this paper: How Much Should We Trust Differences-in-Differences Estimates? by Bertrand, Duflo, and Mullainathan. Collapsing your data into a before-and-after way actually helps to alleviate the autocorrelation, the opposite of your intuition. Better ways involve the bootstrap or clustered standard errors.
