[site]: stackoverflow
[post_id]: 5674880
[parent_id]: 
[tags]: 
Rails delayed job not working

My delayed job is not working. I am trying to create an background task for a rake file using a delayed job that should run every 15 minute. I have copied my rake tasks in my rake file and set them in my controller as methods. I need an delayed job because heroku only makes a cron every 1 hour. Here is my Application controller: class ApplicationController "/Publisher/Stats").click form = agent.page.forms.first form.submit @stats = agent.page.search('//tr')[-2] @existing = Reklamer.find(:first, :conditions => {:dato => @stats[0]}) if @existing.nil? Reklamer.create!(:virksomhed => 'Iqmedier', :dato => @stats[0], :unik_klik => @stats[1], :klik => @stats[2], :unik_vis => @stats[3], :vis => @stats[4], :leads => @stats[5], :ordre => @stats[6], :cpc => @stats[7], :earn => @stats[8]) elsif @existing.dato != Date.today Reklamer.create!(:virksomhed => 'Iqmedier', :dato => Date.today, :unik_klik => 0, :klik => 0, :unik_vis => 0, :vis => 0, :leads => 0, :ordre => 0, :cpc => 0, :earn => 0) else @existing.update_attributes!(:unik_klik => @stats[1], :klik => @stats[2].to_i, :unik_vis => @stats[3], :vis => @stats[4], :leads => @stats[5], :ordre => @stats[6], :cpc => @stats[7], :earn => @stats[8]) end end def euroads agent = Mechanize.new { |agent| agent.user_agent_alias = 'Mac Safari'} agent.get("http://www.euroads.dk") form = agent.page.forms.first form.submit @month = Date.today.strftime("%m").to_s agent.get("http://www.euroads.dk/system/index.php?showpage=showstat&show=overview&month=#{@month}&year0=2011&day=1&month=#{@month}&year=2011&day1=31&month1=#{@month}&year1=2011&fk_campaign=&fk_survey=&fk_track=&fk_pool=&columns1=1&columns2=2&columns4=4&columns14=14&columns5=5&columns6=6&columns7=7&columns8=8&columns9=9") @stats = agent.page.search('table.ea').search('tr') @existing = Reklamer.find(:first, :conditions => {:dato => @stats[0]}) if @existing.nil? Reklamer.create!(:virksomhed => 'Euroads', :dato => @stats[0], :unik_klik => @stats[1], :klik => @stats[2].to_i, :unik_vis => @stats[3], :vis => @stats[4], :leads => @stats[5], :ordre => @stats[6], :cpc => @stats[7], :earn => @stats[8]) elsif @existing.dato != Date.today Reklamer.create!(:virksomhed => 'Euroads', :dato => Date.today, :unik_klik => 0, :klik => 0, :unik_vis => 0, :vis => 0, :leads => 0, :ordre => 0, :cpc => 0, :earn => 0) else @existing.update_attributes(:unik_klik => @stats[1], :klik => @stats[2].to_i, :unik_vis => @stats[3], :vis => @stats[4], :leads => @stats[5], :ordre => @stats[6], :cpc => @stats[7], :earn => @stats[8]) end end def mikkelsen agent = Mechanize.new agent.get("http://affilate.mikkelsenmedia.dk/partnersystem/mylogins.php") form = agent.page.forms.first @stats = agent.page.search('//tr') @existing = Reklamer.find(:first, :conditions => {:dato => @stats[0] }) if @existing.nil? Reklamer.create!(:virksomhed => 'Mikkelsen', :dato => @stats[0], :unik_klik => @stats[3], :klik => @stats[3].to_i, :unik_vis => @stats[1], :vis => @stats[1], :leads => @stats[4], :ordre => @stats[9], :cpc => @stats[3], :earn => @stats[5]) else @existing.update_attributes(:virksomhed => 'Mikkelsen', :dato => @stats[0], :unik_klik => @stats[3], :klik => @stats[3].to_i, :unik_vis => @stats[1], :vis => @stats[1], :leads => @stats[4], :ordre => @stats[9], :cpc => @stats[3], :earn => @stats[5]) end end def orville agent = WWW::Mechanize.new agent.get("https://dk.orvillemedia.com") form = agent.page.forms.first form.submit @dato = Date.today.strftime("%Y-%m-%d").to_s @month = Date.today.strftime("%m").to_s @day = Date.today.strftime("%d").to_s @stats = agent.page.search('//tr') @existing = Reklamer.find(:first, :conditions => {:dato => @dato}) if @existing.nil? Reklamer.create!(:virksomhed => 'Orville', :dato => @dato, :unik_klik => @stats[2], :klik => @stats[2].to_i, :unik_vis => @stats[1], :vis => @stats[1], :leads => @stats[3], :ordre => '0', :cpc => (@stats[5] == '-' ? 0 : @stats[3]), :earn => @stats[6]) else @existing.update_attributes(:virksomhed => 'Orville', :dato => Date.today, :unik_klik => @stats[2], :klik => @stats[2].to_i, :unik_vis => @stats[1], :vis => @stats[1], :leads => @stats[3], :ordre => '0', :cpc => (@stats[5] == '-' ? 0 : @stats[3]), :earn => @stats[6]) end end def runall [:iqmedier, :euroads, :mikkelsen, :orville].each{|a| send(a)} end handle_asynchronously :runall, :run_at => Proc.new { 5.minutes.from_now } When I run rake jobs:work it starts but is not working the runall job of
