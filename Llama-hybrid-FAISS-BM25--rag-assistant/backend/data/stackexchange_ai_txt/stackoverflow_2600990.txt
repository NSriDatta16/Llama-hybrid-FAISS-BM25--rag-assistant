[site]: stackoverflow
[post_id]: 2600990
[parent_id]: 
[tags]: 
PHP Global variable in class is reset

I have a web form that manipulates records in a MySQL database. I have a method for displaying an edit interface for both creating new records and editing them if ($_POST['new_page']) { print " Create new page \n"; $isNew=1; $this->EditForm(); } else if($_POST['edit']){ print " Edit page \n"; $isNew=0; $this->EditForm(); } I am trying to use the global variable $isNew to determine where a record is to be added or updated. However, whenever my SaveChanges() function is run, $isNew is always 0. $isNew is declared immediately after the class declaration, outside all of the functions. class Editor{ public $isNew; Full code sample (from http://pastebin.com/40TQFEd5 ): When the object is created in index.php, the method HTMLEditorHandler() is called db->getOne($sql); // If author not found, add to database if(!$author_id){ $sql="INSERT INTO authors(Name)"; $sql.="VALUES ('{$author}')"; $this->db->query($sql); $author_id=mysql_insert_id(); } print "isNew: ".$this->isNew; /*if($this->isNew==1){ $sql="INSERT INTO pages(CompanyID, AuthorID, Title, Content, DateCreated, DateUpdated)"; $sql.=" VALUES ('{$company}', '{$author_id}', '{$title}', '{$content}', NOW(), NOW())"; $this->db->query($sql); } else if($this->isNew==0){ print "Not new"; }*/ } function EditForm($isNew){ if(isset($_POST['pageID'])){ $sql="SELECT Name, Title, Content, CompanyID"; $sql.=" FROM pages, authors\n"; $sql.=" WHERE pages.AuthorID = authors.ID"; $sql.=" AND pages.ID = '".$_POST['pageID']."'"; $result=$this->db->query($sql); $row=$result->fetchRow(); $company=$row['CompanyID']; } print " \n"; print " "; print " \n"; print " Author: \n"; print " \n"; print " \n"; print " \n"; print " Company: \n"; print " \n"; $this->ShowCompanies($company); print " \n"; print " \n"; print " \n"; print " Title: \n"; print " \n"; print " \n"; print " \n"; print " Content: \n"; print " \n"; print $this->myToolBar->EditableArea("content", htmlspecialchars($row['Content']), "100%", 400, "NoSave"); print " \n"; print " \n"; print " \n"; print " \n"; print " \n"; print " \n"; } function DefaultForm(){ print " \n"; print " "; print " Edit an existing page \n"; print " \n"; print " Year "; print " \n"; for ($year=date('Y'), $max_year=date('Y')-10; $year > $max_year; $year--) { print " ".$year." \n"; } print " \n"; print " "; print " Company: "; $sql="SELECT organisations.OrgID, companynames.CompanyName"; $sql.=" FROM qsvision.organisations"; $sql.=" LEFT JOIN qsvision.companynames"; $sql.=" ON qsvision.organisations.CompanyID=qsvision.companynames.CompanyID"; $sql.=" WHERE CompanyName!=''"; $sql.=" GROUP BY companynames.CompanyID"; $sql.=" ORDER BY companynames.CompanyName ASC"; $organisations=$this->db->getAll($sql); print " \n"; print " [Select...] \n"; for($i=0, $max_i=count($organisations); $i ".htmlspecialchars($organisations[$i]['CompanyName'])." \n"; } print " \n"; print " \n"; print " "; print " "; print " "; } function HTMLEditorHandler(){ if ($_POST['new_page']) { print " Create new page \n"; $this->EditForm(true); } else if($_POST['edit']){ print " Edit page \n"; $this->EditForm(false); } else if($_POST['delete']){ $this->DeletePage(); $this->DefaultForm(); } else if($_POST['save']){ $this->SaveChanges($_POST['author'], $_POST['org_id'], $_POST['title'], $_POST['content'],$this->isNew); $this->DefaultForm(); } else { $this->DefaultForm(); } } } ?>
