[site]: stackoverflow
[post_id]: 4913812
[parent_id]: 4910411
[tags]: 
As David commented to the question, the alpha channel information is lost when you assign the graphic to the bitmap. As such there's no point in setting the pixel format to pf32bit after the assignment, apart from preventing AlphaBlend call to fail, there's no per-pixel alpha in the bitmap anyway. But the png object knows how to draw on a canvas taking into consideration the transparency information. So the solution would involve drawing on the bitmap canvas instead of assigning the graphic, and then, since there's no Alpha channel, remove the AC_SRC_ALPHA flag from the BLENDFUNCTION . Below is working code here on D2007: procedure TAlphaBlendForm.FormCreate(Sender: TObject); begin Image1.Picture.LoadFromFile( ExtractFilePath(Application.ExeName) + 'Icon_attention_s.png'); FBitmap := TBitmap.Create; FBitmap.Width := Image1.Picture.Graphic.Width; FBitmap.Height := Image1.Picture.Graphic.Height; FBitmap.Canvas.Brush.Color := Color; // background color for the image FBitmap.Canvas.FillRect(FBitmap.Canvas.ClipRect); FBitmap.Canvas.Draw(0, 0, Image1.Picture.Graphic); PaintBox1.Width := FBitmap.Width; PaintBox1.Height := FBitmap.Height; end; procedure TAlphaBlendForm.PaintBox1Paint(Sender: TObject); var fn: TBlendFunction; begin fn.BlendOp := AC_SRC_OVER; fn.BlendFlags := 0; fn.SourceConstantAlpha := FOpacity; fn.AlphaFormat := 0; Windows.AlphaBlend( PaintBox1.Canvas.Handle, 0, 0, PaintBox1.Width, PaintBox1.Height, FBitmap.Canvas.Handle, 0, 0, FBitmap.Width, FBitmap.Height, fn ); end; or without using a intermediate TImage : procedure TAlphaBlendForm.FormCreate(Sender: TObject); var PNG: TPNGObject; begin PNG := TPNGObject.Create; try PNG.LoadFromFile(ExtractFilePath(Application.ExeName) + 'Icon_attention_s.png'); FBitmap := TBitmap.Create; FBitmap.Width := PNG.Width; FBitmap.Height := PNG.Height; FBitmap.Canvas.Brush.Color := Color; FBitmap.Canvas.FillRect(FBitmap.Canvas.ClipRect); PNG.Draw(FBitmap.Canvas, FBitmap.Canvas.ClipRect); PaintBox1.Width := FBitmap.Width; PaintBox1.Height := FBitmap.Height; finally PNG.Free; end; end;
