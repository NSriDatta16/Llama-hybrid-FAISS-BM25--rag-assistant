[site]: stackoverflow
[post_id]: 4679336
[parent_id]: 
[tags]: 
Requests to Django web app are hanging; simple debugging tips?

Update - solved The issue turned out to be the servers had a mount pointing at a file server that was retired earlier this week; so not related to django / mod-python / etc after all. Updating the mount solved the problem. Many thanks for the comments & help, and apologies for a wild goose chase ... I'll look into upgrading off mod-python in any case:-) Summary I'm maintaining a Django webapp that was working fine until a few days ago, but now all web requests just hang for ages. I'm not aware that anything has changed, so the problem is probably something fairly simple. I've tried restarting the webserver, and restarting httpd. 'top' shows the server is doing fine for CPU and memory. Can anyone suggest other simple things that are liable to go wrong, or other things to check? More details I didn't create the web server, so unfortunately I'm not entirely sure of the full details, or where to look for all the logs etc. I know the web server is made of the following components: implemented using Django; runs on a Linux server; uses PostgreSQL database; lighttpd for static content; Apache to handle incoming HTTP requests and pass them through to Django via mod_python; uses memcached to cache rendered pages. I do have full access to the Linux server and the database, so can happily poke around in anything if I know where to look. /var/log/httpd/access_log and error_log show lines like the following whenever I make a new request. I don't know if the mod_python line indicates an error or not (nothing obvious when I googled this log). access_log: 127.0.0.1 - - [13/Jan/2011:10:56:11 +0000] "GET /testruns/testrun2176/ HTTP/1.0" 301 - "http://myapp/testruns/" "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13 ( .NET CLR 3.5.30729; .NET4.0E)" error_log: [Thu Jan 13 10:34:19 2011] [notice] mod_python: (Re)importing module 'django.core.handlers.modpython' Output from running development server # python manage.py runserver 0.0.0.0:8088 Validating models... 0 errors found Django version 1.0-final-SVN-unknown, using settings 'myapp.settings' Development server is running at http://0.0.0.0:8088/ Quit the server with CONTROL-C. [13/Jan/2011 14:23:31] "GET /testruns/testrun2176/ HTTP/1.1" 301 0 Then nothing happens. Webpage just stuck loading. I can load one of the pages that is slightly simpler. Via the dev version the pictures don't load but it's otherwise fine. The simple page is at /testruns/ - though for some reason I don't see that page in the runserver output: # python manage.py runserver 0.0.0.0:8088 Validating models... 0 errors found Django version 1.0-final-SVN-unknown, using settings 'myapp.settings' Development server is running at http://0.0.0.0:8088/ Quit the server with CONTROL-C. [13/Jan/2011 14:27:42] "GET /static/myapp.css HTTP/1.1" 404 1113 [13/Jan/2011 14:27:42] "GET /static/myapp_print.css HTTP/1.1" 404 1113 [13/Jan/2011 14:27:42] "GET /static/myapp_ticks_crosses.css HTTP/1.1" 404 1113 I should point out again, this was all working fine a few days ago. I haven't explicitly changed anything since then - I just suddenly found that the required pages won't load, and I'm trying to find out why. The /var/log/httpd/ log files don't seem to show anything particularly interesting, and I'm not sure what else I should look at. We're running a second server that works on a different set of test results. Running the development server on that shows that the 301 redirect is expected (.../testrunX/ redirects to .../testrunX/broken/page1/). // This trace, on a different server but with a similar setup, shows that the // 301 redirect is expected, and is not the source of the problem [server2]# python manage.py runserver 0.0.0.0:8088 Validating models... 0 errors found Django version 1.0-final-SVN-unknown, using settings 'myapp.settings' Development server is running at http://0.0.0.0:8088/ Quit the server with CONTROL-C. [13/Jan/2011 14:47:59] "GET /testruns HTTP/1.1" 301 0 [13/Jan/2011 14:47:59] "GET /testruns/ HTTP/1.1" 200 11568 [13/Jan/2011 14:47:59] "GET /static/myapp.css HTTP/1.1" 404 1131 [13/Jan/2011 14:47:59] "GET /static/myapp_print.css HTTP/1.1" 404 1131 [13/Jan/2011 14:47:59] "GET /static/star.png HTTP/1.1" 404 1131 [13/Jan/2011 14:47:59] "GET /static/myapp_ticks_crosses.css HTTP/1.1" 404 1131 [13/Jan/2011 14:47:59] "GET /static/star.png HTTP/1.1" 404 1131 [13/Jan/2011 14:48:02] "GET /static/star.png HTTP/1.1" 404 1131 [13/Jan/2011 14:48:12] "GET /testruns/testrun1879/ HTTP/1.1" 301 0 [13/Jan/2011 14:48:12] "GET /testruns/testrun1879/broken/page1/ HTTP/1.1" 200 309477 [13/Jan/2011 14:48:12] "GET /static/myapp.css HTTP/1.1" 404 1131 [13/Jan/2011 14:48:12] "GET /static/myapp_print.css HTTP/1.1" 404 1131 [13/Jan/2011 14:48:13] "GET /static/myapp_ticks_crosses.css HTTP/1.1" 404 1131 So I don't think there's an infinite loop. Just for some reason the request / database query / something else is taking far too long or is completely stuck. memcached info memcached on the bad server seems pretty empty. But that's probably expected if the web requests are failing, ie nothing's been returned to be stored in the cache (and the cache expiry time is 12 hours). Bad server: // Top - only using 6K memory (VIRT) PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 30743 nobody 15 0 6640 4972 476 S 0.0 1.9 0:00.01 memcached // memcache-top from http://code.google.com/p/memcache-top/ // only using 0.2% available space memcache-top v0.6 (default port: 11211, color: on, refresh: 3 seconds) INSTANCE USAGE HIT % CONN TIME EVICT/s READ/s WRITE/s 127.0.0.1:11211 0.2% 0.0% 5 0.8ms 0.0 2 161 AVERAGE: 0.2% 0.0% 5 0.8ms 0.0 2 161 TOTAL: 111.0KB/ 64.0MB 5 0.8ms 0.0 2 161 Good server: // Top - using ~68K memory (VIRT) PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 2503 nobody 15 0 67900 8256 396 S 0.0 3.2 0:01.68 memcached // memcache-top - using 63% space memcache-top v0.6 (default port: 11211, color: on, refresh: 3 seconds) INSTANCE USAGE HIT % CONN TIME EVICT/s READ/s WRITE/s 127.0.0.1:11211 63.2% 0.0% 3 1.2ms 0.0 0 0 AVERAGE: 63.2% 0.0% 3 1.2ms 0.0 0 0 TOTAL: 40.5MB/ 64.0MB 3 1.2ms 0.0 0 0
