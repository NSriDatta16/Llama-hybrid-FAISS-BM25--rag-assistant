[site]: stackoverflow
[post_id]: 4387316
[parent_id]: 
[tags]: 
How can I assign the current process to a newly created job object?

I can't seem to use the AssignProcessToJobObject function to assign the current process to a job object handle given by CreateJobObject . This has been asked a few times already on StackOverflow, but so far none of the solutions (which usually boil down to embedding an UAC manifest) seem to work for me. I'm using MSVC9 on Windows 7 for this. Here's the source code for my sample application and a small manifest I'm embedding (which supposedly fixes the problem - but not for me): My sample application ( main.cpp ): #include static void dumpLastError() { LPVOID lpMsgBuf; DWORD dw = GetLastError(); FormatMessage( FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM, NULL, dw, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR) &lpMsgBuf, 0, NULL ); OutputDebugStringA( (LPTSTR)lpMsgBuf ); LocalFree(lpMsgBuf); } int main() { HANDLE job = CreateJobObjectA( NULL, "demo job 123" ); if ( !job ) { OutputDebugStringA( "CreateJobObject failed" ); dumpLastError(); return 1; } if ( !AssignProcessToJobObject( job, GetCurrentProcess() ) ) { OutputDebugStringA( "AssignProcessToJobObject failed" ); dumpLastError(); return 1; } return 0; } The UAC manifest ( main.exe.manifest ): I build this sample by running cl main.cpp mt -manifest main.exe.manifest -outputresource:main.exe;1 Unfortunately, running my main.exe sample after these steps still yields an 'Access denied' error in debug output when attempting the AssignProcessToJobObject call. Does anybody know why that is?
