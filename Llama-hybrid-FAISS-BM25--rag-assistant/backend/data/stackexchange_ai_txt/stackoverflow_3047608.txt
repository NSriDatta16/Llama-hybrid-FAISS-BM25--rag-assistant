[site]: stackoverflow
[post_id]: 3047608
[parent_id]: 3047348
[tags]: 
It might well be that your user agent out-smarts you on that. Is it possible for you to rely on the file extension as well? I implemented a related solution for Microsoft Excel, generating a HTML table but exposing it as a .xls file. Excel then complains about the mismatch between expected data format and the one it found, but at least Excel was opened.
