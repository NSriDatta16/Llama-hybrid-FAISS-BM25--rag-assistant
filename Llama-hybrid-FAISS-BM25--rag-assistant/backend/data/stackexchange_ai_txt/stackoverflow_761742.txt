[site]: stackoverflow
[post_id]: 761742
[parent_id]: 761700
[tags]: 
If I understand you correctly, you want to get a count of all records for which the start time is less then t+60 seconds and the start time plus the duration is less than or equal to t, for each t in the interval of interest (e.g., t=7:00, 7:01, 7:02...etc.). Then it's just a matter of averaging these counts. But what is an average? It's just the sum divided by the number of items, right? In this case, the number of items will always be equal to the time range in minutes, and the sum will be equal to the sum of the durations-minutes that fall within the interval, which you can compute in one go off the data given. Sound less impossible now? In pseudo SQL: select sum( ((time+duration rounded up to next minute, capped at end of period) - (time rounded down, bottom-capped at start of period) - 1) /(1 minute) ) from Records where date is right Then just divide that by the number of minutes in the period of interest.
