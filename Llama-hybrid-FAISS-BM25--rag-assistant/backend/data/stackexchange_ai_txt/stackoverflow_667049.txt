[site]: stackoverflow
[post_id]: 667049
[parent_id]: 
[tags]: 
Marshalling an an unmanaged array of strings from a PInvoked OpenFileDialog (GetOpenFileName)

OpenFileDialog returns a pointer to memory containing a sequence of null-terminated strings, followed by final null to indicate the end of the array. This is how I'm getting C# strings back from the unmanaged pointer, but I'm sure there must be a safer, more elegant way. IntPtr unmanagedPtr = // start of the array ... int offset = 0; while (true) { IntPtr ptr = new IntPtr( unmanagedPtr.ToInt32() + offset ); string name = Marshal.PtrToStringAuto(ptr); if(string.IsNullOrEmpty(name)) break; // Hack! (assumes 2 bytes per string character + terminal null) offset += name.Length * 2 + 2; }
