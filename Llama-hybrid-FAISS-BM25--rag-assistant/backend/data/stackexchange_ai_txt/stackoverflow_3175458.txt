[site]: stackoverflow
[post_id]: 3175458
[parent_id]: 
[tags]: 
CDI with ejb 3.1 , weld-logger on glassfish v3.0.1

Scenario: 1) create maven ear project, create war project inside 2) add beans.xml to war project`s WEB-INF/ 3) creat simple @Steateless bean project - http://drp.ly/1j5C3t ejb bean : @Stateless @LocalBean public class TestEjb { @Inject Logger log; public TestEjb() { } @Schedule(hour = "*", minute = "*", second = "*/15") public void print1Partner() { log.info("Yrjaaaa"); System.out.println("This is test"); } } maven pom-xml of war project : Testo ua.co.testo 1.0 4.0.0 Testo-web war UTF-8 UTF-8 ua.eset.oasys utopia 1.0 provided ua.eset.oasys fenix 1.0 provided org.slf4j slf4j-api 1.6.0 provided org.slf4j slf4j-jdk14 1.6.0 provided org.jboss.weld weld-logger 1.0.0-CR2 provided javax.enterprise cdi-api provided 1.0-CR4 --> javax.faces jsf-api 2.0.2-FCS provided javax.faces jsf-impl 2.0.2-FCS provided javax javaee-api 6.0 provided org.glassfish javax.ejb 3.0 provided org.glassfish javax.servlet 3.0 jar provided testo-web org.apache.maven.plugins maven-compiler-plugin 2.0.2 utf8 1.6 1.6 maven pom.xml of ear project : Testo ua.co.testo 1.0 4.0.0 Testo-ear ear UTF-8 UTF-8 org.slf4j slf4j-api 1.6.0 org.slf4j slf4j-jdk14 1.6.0 org.jboss.weld weld-logger 1.0.0-CR2 javax.enterprise cdi-api 1.0-CR4 --> ua.co.testo Testo-web 1.0 war testo org.apache.maven.plugins --> maven-ear-plugin 2.4.1 testo-web.war ua.co.testo Testo-web org.slf4j slf4j-api lib org.slf4j slf4j-jdk14 lib org.jboss.weld weld-logger lib javax.enterprise cdi-api lib --> Test case 1 ( Problem ): deploying project with beans.xml give exception : [#|2010-07-04T19:36:50.003+0300|WARNING|oracle-glassfish3.0.1|javax.enterprise.system.container.ejb.com.sun.ejb.containers|_ThreadID=33;_ThreadName=Thread-1;|A system exception occurred during an invocation on EJB TestEjb method public void TestEjb.print1Partner() javax.ejb.EJBException: javax.ejb.EJBException: javax.ejb.CreateException: Could not create stateless EJB at com.sun.ejb.containers.StatelessSessionContainer._getContext(StatelessSessionContainer.java:448) at com.sun.ejb.containers.BaseContainer.getContext(BaseContainer.java:2467) at com.sun.ejb.containers.BaseContainer.preInvoke(BaseContainer.java:1860) at com.sun.ejb.containers.BaseContainer.callEJBTimeout(BaseContainer.java:3962) at com.sun.ejb.containers.EJBTimerService.deliverTimeout(EJBTimerService.java:1667) at com.sun.ejb.containers.EJBTimerService.access$100(EJBTimerService.java:98) at com.sun.ejb.containers.EJBTimerService$TaskExpiredWork.run(EJBTimerService.java:2485) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619) Caused by: javax.ejb.EJBException: javax.ejb.CreateException: Could not create stateless EJB at com.sun.ejb.containers.StatelessSessionContainer$SessionContextFactory.create(StatelessSessionContainer.java:720) at com.sun.ejb.containers.util.pool.NonBlockingPool.getObject(NonBlockingPool.java:200) at com.sun.ejb.containers.StatelessSessionContainer._getContext(StatelessSessionContainer.java:443) ... 12 more Caused by: javax.ejb.CreateException: Could not create stateless EJB at com.sun.ejb.containers.StatelessSessionContainer.createStatelessEJB(StatelessSessionContainer.java:528) at com.sun.ejb.containers.StatelessSessionContainer.access$000(StatelessSessionContainer.java:90) at com.sun.ejb.containers.StatelessSessionContainer$SessionContextFactory.create(StatelessSessionContainer.java:718) ... 14 more Caused by: java.lang.NullPointerException at java.util.concurrent.ConcurrentHashMap.get(ConcurrentHashMap.java:768) at org.jboss.weld.manager.BeanManagerImpl.getBean(BeanManagerImpl.java:1171) at org.jboss.weld.manager.BeanManagerImpl.getBean(BeanManagerImpl.java:132) at org.glassfish.weld.services.JCDIServiceImpl._createJCDIInjectionContext(JCDIServiceImpl.java:145) at org.glassfish.weld.services.JCDIServiceImpl.createJCDIInjectionContext(JCDIServiceImpl.java:122) at com.sun.ejb.containers.BaseContainer.createEjbInstanceAndContext(BaseContainer.java:1616) at com.sun.ejb.containers.StatelessSessionContainer.createStatelessEJB(StatelessSessionContainer.java:469) ... 16 more |#] [#|2010-07-04T19:36:50.004+0300|INFO|oracle-glassfish3.0.1|javax.enterprise.system.container.ejb.com.sun.ejb.containers|_ThreadID=33;_ThreadName=Thread-1;|EJB5119:Expunging timer ['13@@1278255602087@@server@@oasys' 'TimedObject = TestEjb' 'Application = testo' 'BEING_DELIVERED' 'PERIODIC' 'Container ID = 83771744647118848' 'Sun Jul 04 19:36:45 EEST 2010' '0' '*/15 # * # * # * # * # * # * # null # null # null # true # print1Partner # 0' ] after [2] failed deliveries|#] [#|2010-07-04T19:37:00.000+0300|INFO|oracle-glassfish3.0.1|javax.enterprise.system.std.com.sun.enterprise.v3.services.impl|_ThreadID=33;_ThreadName=Thread-1;|This is test|#] expecting results: Yrjaaaa This is test results : Exception This is test case 2: remove beans.xml expecting results : Yrjaaaa This is test results Yrjaaaa This is test Goal: I want to use ejb weld(CDI) in web project inside ear archive that include some other war & ejb projects, but i don`t wond to separate my web project (war + ejb ) tools & environment : maven & ejb 3.1 & weld & glassfish 3.0.1 Q1: is this could be some kind of specific glassfish bug ? Q2: what could be a cause of problem? Q3: is there is some design for such case ? Thank you.
