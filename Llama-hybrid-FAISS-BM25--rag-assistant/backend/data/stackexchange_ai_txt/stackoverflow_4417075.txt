[site]: stackoverflow
[post_id]: 4417075
[parent_id]: 
[tags]: 
Assistance in building a query fro calulate avg(), before a month, and after a month

I have to write a query where for every customer and every month of 2009, calculate the average purchase before each month, after each month, and show a list with the customers and months, where the average purchase after each month is > from the average purchase before the month. Example of what it should show : name month avgBefore avgAfter P.Anderson 3 13 35 My problem is, while it is rather easy to create the view v1 which contains (name, code, month, avgAmount) (a list to show name, avg purchases for each month), I do not know (or rather I can't imagine) how to do the rest (calculate avg before/after each month) . Ex: avereagebefore month 3 = sum(all avg from month 1 to 3), avereageAfter month 3 = sum(all avg from 3 to max(month) Can someone please help me ? The view V1 is like this (as shown when you edit the view in Management Studio) SELECT c.name, c.code, MONTH(t.DateTime) AS minas, AVG(t.charged_amount) AS total FROM dbo.customers AS c INNER JOIN dbo.accounts AS a ON c.code = a.customer_code INNER JOIN dbo.creditcard AS cc ON a.acc_number = cc.acc_number INNER JOIN dbo.transactions AS t ON cc.cc_number = t.cc_number INNER JOIN dbo.shop AS s ON t.shop_code = s.shop_code WHERE (YEAR(t.DateTime) = 2009) GROUP BY c.name, c.code, MONTH(t.DateTime) I tried to separate each month in a view ( like created 12 views :S ) Ex: create view [Dec](name, code, minas, averg) as select * from v1 where minas = 12 and then did this : select v1.name, v1.code, v1.minas, sum(total) from v1, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, [Dec] where v1.minas but it didn't work. Also for a test I tried : select v1.name, v1.code, v1.minas, sum(v1.total) from v1, Jan as v2, Feb as v3 where v1.code = v2.code and v1.code = v3.code group by v1.name, v1.code, v1.minas but the result was Nelson J. Arredondo 100606 1 75 Nelson J. Arredondo 100606 2 100 Nelson J. Arredondo 100606 5 250 in month 2, it should have been 175 and in month 5 250+175 Can you please help me figuring this out ?
