[site]: stackoverflow
[post_id]: 4313304
[parent_id]: 
[tags]: 
Delphi - OLE variant passing problem (RsLinx OPC, Group Adding working with only from constants)

We got OPC job. I cannot installed RsLinx to my Win7 (and XP mode too) because of errors, so I send my test app to the real place, and somebody testing it. Because I don't have DLL, I cannot make Delphi interface, so I need to do OLE Calls only. I got an interesting problem with Group Add. I demonstrate it: procedure TForm1.Button8Click(Sender: TObject); var r, g : variant; s : string; v : variant; ws : WideString; begin Log('Connect'); r := CreateOleObject('RSI.OPCAutomation'); r.Connect('RSLinx OPC Server'); Log('Add as constant'); g := r.OPCGroups.Add('MONKEY_C'); Log('Name ' + g.Name); Log('Add as string'); s := 'MONKEY_S'; g := r.OPCGroups.Add(s); Log('Name ' + g.Name); Log('Add as variant'); s := 'MONKEY_V'; v := s; g := r.OPCGroups.Add(v); Log('Name ' + g.Name); Log('Add as ole variant'); s := 'MONKEY_OV'; v := VarAsType(s, varOleStr); g := r.OPCGroups.Add(v); Log('Name ' + g.Name); Log('Add as widestring'); s := 'MONKEY_WS'; ws := WideString(s); g := r.OPCGroups.Add(ws); Log('Name ' + g.Name); Log('Add as widestring var'); s := 'MONKEY_WSV'; ws := WideString(s); v := ws; g := r.OPCGroups.Add(v); Log('Name ' + g.Name); r := 0; end; The result was: Connect Add as constant Name MONKEY_C Add as string Name _Group0 Add as variant Name _Group1 Add as ole variant Name _Group2 Add as widestring Name _Group3 Add as widestring var Name _Group4 So the problem that I cannot add any Group than constant defined... I need to know HOW Delphi compile this constant to I can convert my variant value to this format. Can anybody help me in this theme? Thanks: dd Hi! So the problem is mysterious. I found another errors in the pure OLE calls. function TDDRsOPCObject.IndexOfGroup(GroupName: string): integer; var ogs, g : variant; i : integer; s : string; begin CheckObject; Result := -1; ogs := FObj.OPCGroups; s := ''; for i := 1 to ogs.Count do begin g := ogs.Item(i); // This is working if AnsiCompareText(g.Name, GroupName) = 0 then begin Result := i; Exit; end; end; end; function TDDRsOPCObject.GetGroupByName(GroupName: string): variant; var idx : integer; ogs, g : variant; begin CheckObject; VarClear(Result); idx := IndexOfGroup(GroupName); ogs := FObj.OPCGroups; if idx <> -1 then begin g := ogs.Item(idx); // HERE I GOT: The parameter is incorrect Result := g; end; end; So it is interesting: the IndexOfGroup with same call is working, the GetGroupByName is not... :-( So I determined I do not continue my fighting with windmills (Don Q). I got TLB from a dear user that have Delphi7 (in Win7 the Delphi6 cannot produce OLE interface), and I found Kassl. May these interfaces can help me... Thanks: dd
