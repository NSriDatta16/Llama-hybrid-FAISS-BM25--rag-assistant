[site]: stackoverflow
[post_id]: 2778537
[parent_id]: 2778532
[tags]: 
This is not a task for a regular expression. What you're looking for is parser at that point. Which means a language grammar, LL(1), LALR, recursive-descent, the dragon book, and generally a splitting migraine.
