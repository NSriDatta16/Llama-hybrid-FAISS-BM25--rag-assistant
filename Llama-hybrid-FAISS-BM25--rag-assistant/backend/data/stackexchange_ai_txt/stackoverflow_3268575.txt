[site]: stackoverflow
[post_id]: 3268575
[parent_id]: 
[tags]: 
stored proc recursion in SQL Server

I have a situation where I want to have a stored proc returning a table that calls itself recursively as part of its calculation. Unfortunately SQL Server is having none of this and gives me an error along the lines of both being unable to declare a cursor that already exists and about not being able to nest and insert exec statement. Could I get around some of these issues by using a function? Is there another better way to do this? The calculation is inherently recursive in nature, so there isn't any getting around this using joins as far as I can tell. EDIT: to clarify the actual calculation since the code is complicated by other stuff and might complicate the matter- suppose table A has columns (containerID, objID, objType, weight) and table B has columns (itemID, value). objType in table A tells you whether objID in table A is a containerID (again in table A) or is and itemID from table B. (containerID, objID) is a primary key on table A as is itemID on table B. Generally a container will have tens to hundreds of items or other containers in it. Hopefully the recursion depth isn't more than a dozen levels. (guessing) The calculation is to get a weighted average.
