[site]: crossvalidated
[post_id]: 134387
[parent_id]: 
[tags]: 
How to do contrasts with weighted observations in R's linear model function lm()

As part of a simple simulation study, I have the following lines of code in R: >contrasts(mySample$Stratum) = contr.sum(13) >UnweightedLM WeightedLM where y is a random normal variate and Stratum is a factor. I indicate to R that I want deviation contrasts in the first line. temp1 and temp2 should give different results, I would have thought, if the rows are weighted differently. The standard errors do come out different, as it happens. (for the curious, this is part of a larger attempt on my part to understand the survey package). Here is code for a toy example illustrating the problem: library("survey") y Here is some output for UnweightedLM Coefficients: Estimate Std. Error t value Pr(>|t|) (Intercept) 2.0488 0.1409 14.540 Stratum2 -0.2614 0.2818 -0.928 0.356 Stratum3 0.2597 0.2818 0.922 0.359 Stratum4 -0.3881 0.2818 -1.377 0.172 And here is what I get from WeightedLM Coefficients: Estimate Std. Error t value Pr(>|t|) (Intercept) 2.0488 0.1570 13.049 Stratum2 -0.2614 0.2233 -1.171 0.245 Stratum3 0.2597 0.3031 0.857 0.394 Stratum4 -0.3881 0.2740 -1.416 0.160 The estimates are the same, although the standard errors are different. Note that the so-called Intercept estimate (actually an estimate of the mean), is the sample average. This would not be the case if the strata were of unequal size. The intercept from UsualContrast is different, which shows that my Contrast command is doing something. But why don't I get different results according as there are or are not weights? I was originally going to post this on Stackoverflow, but then it seemed that maybe my problem is not understanding how contrasts work, as distinct from not understanding how R works.
