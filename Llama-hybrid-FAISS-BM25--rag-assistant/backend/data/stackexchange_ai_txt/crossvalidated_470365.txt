[site]: crossvalidated
[post_id]: 470365
[parent_id]: 
[tags]: 
Creating a dataset for running a conditional logistic regression

I plan on running a conditional logistic regression and I have the following dataset where 90 individuals (1:90) choose stores A, B and C. I do not have an outside option, such as not going to the store. But I do have a variable of characteristics , which makes it possible to run the analysis under the following condition: individual i, with characteristics j, chooses some store (e.g. "A"). So I match every individual with the same characteristic and place it as an approximate "control", but I also maintain every individual choice in the dataset -- and every individual i, with characteristics j, is used as "control" for individuals k (where k=/=i) and the characteristics are the same as individual i. If were to run this in R, it would go as the following code: #creating a dataset for running a conditional logistic regression #matched version df=data.frame(characteristic_match=rep(1:5,18), selection=c(rep("A",45),rep("B",36), rep("C",9)), value=c(10*rnorm(45,10), 1000*rnorm(36,5), 2000*rnorm(9,5)), ID=1:90) df characteristic_match selection value ID 1 1 A 101.66264 1 2 2 A 99.62911 2 3 3 A 117.25677 3 4 4 A 107.06362 4 5 5 A 100.94380 5 6 1 A 95.32993 6 7 2 A 110.29087 7 8 3 A 95.10570 8 9 4 A 101.39081 9 10 5 A 93.10440 10 11 1 A 88.23902 11 12 2 A 72.08422 12 13 3 A 100.27449 13 14 4 A 121.69462 14 15 5 A 108.00957 15 16 1 A 96.21220 16 17 2 A 109.91149 17 18 3 A 98.92482 18 19 4 A 92.02296 19 20 5 A 103.92772 20 21 1 A 117.95852 21 22 2 A 89.68058 22 23 3 A 93.32911 23 24 4 A 114.51122 24 25 5 A 96.06580 25 26 1 A 102.84215 26 27 2 A 78.06707 27 28 3 A 115.77903 28 29 4 A 95.72032 29 30 5 A 92.91583 30 31 1 A 96.13472 31 32 2 A 106.38707 32 33 3 A 118.43684 33 34 4 A 109.48427 34 35 5 A 85.48377 35 36 1 A 104.43109 36 37 2 A 99.45702 37 38 3 A 80.42210 38 39 4 A 90.38894 39 40 5 A 103.85212 40 41 1 A 96.92661 41 42 2 A 92.65430 42 43 3 A 95.38558 43 44 4 A 100.68967 44 45 5 A 112.58333 45 46 1 B 4546.24869 46 47 2 B 4318.22014 47 48 3 B 2603.37593 48 49 4 B 4491.54766 49 50 5 B 5257.37517 50 51 1 B 5096.96571 51 52 2 B 3482.98104 52 53 3 B 5073.48220 53 54 4 B 4792.87771 54 55 5 B 2540.90822 55 56 1 B 4970.27492 56 57 2 B 4619.81257 57 58 3 B 4711.38638 58 59 4 B 4254.47726 59 60 5 B 6593.99583 60 61 1 B 5419.07639 61 62 2 B 4773.22751 62 63 3 B 6753.05219 63 64 4 B 4036.41123 64 65 5 B 8100.93076 65 66 1 B 3744.90732 66 67 2 B 4874.38897 67 68 3 B 3676.11969 68 69 4 B 4434.53983 69 70 5 B 5217.50811 70 71 1 B 5670.52903 71 72 2 B 4783.34079 72 73 3 B 5143.90207 73 74 4 B 5803.08883 74 75 5 B 6867.56761 75 76 1 B 3938.85208 76 77 2 B 4943.64178 77 78 3 B 3497.29088 78 79 4 B 4967.55828 79 80 5 B 5369.81543 80 81 1 B 5877.69901 81 82 2 C 8787.47615 82 83 3 C 10990.99857 83 84 4 C 8657.24290 84 85 5 C 8159.47450 85 86 1 C 10926.74186 86 87 2 C 8694.59774 87 88 3 C 11783.12132 88 89 4 C 9895.20475 89 90 5 C 8569.39552 90 And then, for every individual, a set of controls is "rowbinded" with following code: require(dplyr) df$dep_dum=0 for(i in 1:dim(df)[1]) { print(i) df_s = df[i,] df_s $dep_dum[1]=1 c=df_s$ characteristic_match[1] r=df_s $ID[1] s=df_s$ selection[1] df_match=df %>% filter(characteristic_match==c) %>% filter(ID!=r) %>% filter(selection!=s) df_s = rbind(df_s,df_match) df_s$new_id=i if(i==1){ df_m=df_s next } df_m = rbind(df_s, df_m) } df_m = df_m %>% select(-ID) head(df_m) characteristic_match selection value dep_dum new_id 90 5 C 8737.69734 1 90 1 5 A 101.64083 0 90 2 5 A 95.74073 0 90 3 5 A 123.26963 0 90 4 5 A 98.52406 0 90 5 5 A 111.93650 0 90 survival::clogit(dep_dum ~ value + strata(new_id), data = df_m) Call: survival::clogit(dep_dum ~ value + strata(new_id), data = df_m) coef exp(coef) se(coef) z p value -8.791e-05 9.999e-01 4.028e-05 -2.183 0.0291 Likelihood ratio test=5.24 on 1 df, p=0.02209 n= 1028, number of events= 90 I do not share all the new structure because it has 1028 observations. My question is: am I wrong to create the dataset as I did, what are the possible problems?
