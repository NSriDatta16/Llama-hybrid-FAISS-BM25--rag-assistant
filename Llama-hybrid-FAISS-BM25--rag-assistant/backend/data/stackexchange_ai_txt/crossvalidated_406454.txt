[site]: crossvalidated
[post_id]: 406454
[parent_id]: 
[tags]: 
Utilizing ipfraking to apply post-stratification weights for a Community Based Survey in Stata

I am a community data analyst for a small non-profit in South Florida. We are cleaning and preparing a local community survey for analysis and need to apply post-stratification weights to the survey to ensure it is representative. I want to utilize the Stata code ipfraking , but am having some difficulty understanding exactly what is needed and ensuring I have properly created the matrices needed for comparison. Here is some pertinent information: Description of Sampling Design : the survey was collected over 6-9 months with a target sample size of 2970 respondents (Power=95%). These target sample was to be collected in 13 geographic clusters representing neighborhoods throughout the county with 12 clusters needing 220 respondents and 1 cluster needing 330 as an over sample (generally underrepresented part of the county by race, ethnicity, and income). All surveys were collected via an online survey format. Description of Cluster Weights : The organization that collected the surveys did not pay particular attention to these by cluster sample sizes. Some were grossly over-sampled and others under-sampled. So, I am applying a corrective Cluster_Wt (desired survey proportion by cluster/actual survey proportion by cluster). The original design weight would be the 220 = 1 and 330 = 1.5 for those clusters, I suppose) EDITED MATERIAL: The "clusters" I describe are stratifications of the entire county, so not a sub-sample of the population (80 strata and chose 13 clusters), but a full stratification of the county into "neighborhoods". . summarize Cluster_Wt Variable | Obs Mean Std. Dev. Min Max -------------+--------------------------------------------------------- Cluster_Wt | 3,639 1.218532 .5038819 .3835682 2.560317 . codebook Cluster_Wt ---------------------------------------------------------------------------------------------------------------- type: numeric (double) range: [.38356816,2.5603175] units: 1.000e-08 unique values: 12 missing .: 0/3,639 mean: 1.21853 std. dev: .503882 percentiles: 10% 25% 50% 75% 90% .640651 1 1.10121 1.33499 1.94279 Calibration Variables : I would like to calibrate based upon 5 demographic variables: Gender, Age, Ethnicity, Education Level, and Annual Household Income.Gender is categorized as 1=Male, 2=Female; Age if Ordinal 1-5; Ethnicity is 1=Hispanic, 0=non-Hispanic; education level and annual hhi are ordinal from lowest education to highest, and lowest hhi to highest. All categories match US Census categories found in Table S0501 ( https://factfinder.census.gov/bkmk/table/1.0/en/ACS/17_5YR/S0501/0500000US12086 ) and DP05 ( https://factfinder.census.gov/bkmk/table/1.0/en/ACS/17_5YR/S0501/0500000US12086 ). EDITED: I will label weighting variables for clarity in my dataset. codebook ethnicity gender age edu hhi ethnicity (unlabeled) type: numeric (float) label: ethlbl range: [0,1] units: 1 unique values: 2 missing .: 0/3,573 tabulation: Freq. Numeric Label 1,660 0 Not Hispanic 1,913 1 Hispanic gender (unlabeled) type: numeric (float) label: genlbl range: [1,2] units: 1 unique values: 2 missing .: 0/3,573 tabulation: Freq. Numeric Label 920 1 Male 2,653 2 Female age (unlabeled) type: numeric (float) label: agelbl range: [1,5] units: 1 unique values: 5 missing .: 0/3,573 tabulation: Freq. Numeric Label 348 1 18-24 1,470 2 25-44 724 3 45-54 642 4 55-64 389 5 65+ edu (unlabeled) type: numeric (float) label: edulbl range: [1,5] units: 1 unique values: 5 missing .: 0/3,573 tabulation: Freq. Numeric Label 127 1 Less than High School 279 2 High School Graduate/GED 1,063 3 Some College/Vocational or Technical School/Associate's Degree 925 4 Bachelor's Degree 1,179 5 Graduate/Professional Degree hhi (unlabeled) type: numeric (float) label: hhilbl range: [1,10] units: 1 unique values: 10 missing .: 0/3,573 examples: 4 $25,000-$ 34,999 5 $35,000-$ 49,999 6 $50,000-$ 74,999 8 $100,000-$ 149,999 --> SO YOU CAN SEE THE FULL hhi VAR --> tab hhi hhi | Freq. Percent Cum. ------------------+----------------------------------- $10,000 | 297 8.31 8.31 $ 10,000- $14,999 | 144 4.03 12.34 $ 15,000- $24,999 | 224 6.27 18.61 $ 25,000- $34,999 | 363 10.16 28.77 $ 35,000- $49,999 | 525 14.69 43.46 $ 50,000- $74,999 | 590 16.51 59.98 $ 75,000- $99,999 | 439 12.29 72.26 $ 100,000- $149,999 | 498 13.94 86.20 $ 150,000- $199,999 | 244 6.83 93.03 $ 200,000+ | 249 6.97 100.00 ------------------+----------------------------------- Total | 3,573 100.00 Familiarity with Census Sources : I understand that I would need to use the Census data for weighting. I am very familiar with US Census sources and utilize them regularly. I have included in #3 the sources for the comparison data (DP05 and S0501). EDITED: I pulled the census data from FactFinder ( https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml ); as the comments point out, this doesn't represent the 18+ population but the entire population, whereas my survey is for 18+. This survey applies to Miami-Dade County, FL. So all comparison statistics are at the county-level. The only constraints on subpop data relates to Race: the organization who developed and administered this survey allowed for multiple answers to race without adding a multiracial option, and the Gender variable was originally categorized as Male, Female, Other, but I have not found "Other" comparison groups in census data. There were a total of 19 individuals who answered Other. I have attempted to utilize ipfraking on this project, but have come up with errors each time. Most recently, this is what I received. ipfraking [pw=Cluster_Wt], gen(rake_wt) ctotal(Census_2017_ethn Census_2017_gend Census_2017_edu Census_2017_age Census_2017_HHI) Warning: 47 missing values of ethnicity encountered; convergence will be impaired Warning: 66 missing values of gender encountered; convergence will be impaired variable education tabulating the control matrix Census_2017_edu not found r(111); Thank you for your help! Latest Attempt: . ipfraking [pw=Cluster_Wt], gen(rake_wt) ctotal(Census_2017_ethn Census_2017_gend Census_2017_edu Census_2017_age Census_2017_HHI) Warning: the totals of the control matrices are different: Target 1 (Census_2017_ethn) total = 2702602 Target 2 (Census_2017_gend) total = 2702602 Target 3 (Census_2017_edu) total = 1906299 Target 4 (Census_2017_age) total = 2148568 Target 5 (Census_2017_HHI) total = 856572 Iteration 1, max rel difference of raked weights = 2407.9914 Iteration 2, max rel difference of raked weights = .75951121 Iteration 3, max rel difference of raked weights = .2044673 Iteration 4, max rel difference of raked weights = .07387203 Iteration 5, max rel difference of raked weights = .02358131 Iteration 6, max rel difference of raked weights = .00708729 Iteration 7, max rel difference of raked weights = .00206681 Iteration 8, max rel difference of raked weights = .00059308 Iteration 9, max rel difference of raked weights = .00016863 Iteration 10, max rel difference of raked weights = .00004768 Iteration 11, max rel difference of raked weights = .00001344 Iteration 12, max rel difference of raked weights = 3.778e-06 Iteration 13, max rel difference of raked weights = 1.061e-06 Iteration 14, max rel difference of raked weights = 2.977e-07 Warning: the controls Census_2017_ethn did not match Warning: the controls Census_2017_gend did not match Warning: the controls Census_2017_edu did not match Warning: the controls Census_2017_age did not match The worst relative discrepancy of .68306 is observed for gender == 2 Target value = 1391840; achieved value = 441134.56 Summary of the weight changes | Mean Std. dev. Min Max CV --------------+-------------------------------------------------- Orig weights | 1.221 .5055 .3836 2.56 .4141 Raked weights | 239.7 414.1 3.7 4720 1.727 Adjust factor | 192.5576 5.0317 3732.3219
