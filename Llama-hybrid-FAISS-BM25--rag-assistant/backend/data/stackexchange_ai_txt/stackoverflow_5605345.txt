[site]: stackoverflow
[post_id]: 5605345
[parent_id]: 
[tags]: 
Memory Leak with UIImage Pixels?

I've been working on some code which gets the pixels of an image, modifies them and then returns an image. When I run it in Instruments it says there are leaks on the lines of code that are marked with a â˜…. The following code just returns the original pixels without any modification: CFDataRef CopyImagePixels(CGImageRef inImage) { return CGDataProviderCopyData(CGImageGetDataProvider(inImage)); } - (UIImage *) imagePixels:(UIImage*)imge { CGImageRef img=imge.CGImage; CFDataRef dataref=CopyImagePixels(img); UInt8 *data=(UInt8 *)CFDataGetBytePtr(dataref); int length=CFDataGetLength(dataref); for (int i = 0; i I don't know why this is showing up. I've tried looking for an answer but none of them work. Thanks UPDATE 1 The leak is coming from this method: -(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event { ImageView.image = [oimage imagePixels:ImageView.image]; } And oimage is set here: -(void)viewDidAppear:(BOOL)animated { mainDelegate = (PhotoAppDelegate *)[[UIApplication sharedApplication]delegate]; CGSize size = mainDelegate.CurrentImage.size; UIGraphicsBeginImageContext( size ); [mainDelegate.CurrentImage drawInRect:CGRectMake(0,0,size.width ,size.height )]; UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();//LEAK UIGraphicsEndImageContext(); int kMaxResolution = 300; CGImageRef imgRef = newImage.CGImage; CGFloat width = CGImageGetWidth(imgRef); CGFloat height = CGImageGetHeight(imgRef); CGRect bounds = CGRectMake(0, 0, width, height); if (width > kMaxResolution || height > kMaxResolution) { CGFloat ratio = width/height; if (ratio > 1) { bounds.size.width = kMaxResolution; bounds.size.height = bounds.size.width / ratio; } else { bounds.size.height = kMaxResolution; bounds.size.width = bounds.size.height * ratio; } } CGSize newsize = CGSizeMake(bounds.size.width, bounds.size.height); UIGraphicsBeginImageContext(newsize); [newImage drawInRect:CGRectMake(0, 0, newsize.width, newsize.height)]; newImage = UIGraphicsGetImageFromCurrentImageContext(); UIGraphicsEndImageContext(); oimage = [newImage retain]; ImageView.image = oimage; } Also, in the right side bar of Instruments, clicking on an object for a leak in the bottom central window will show you in the side bar where the link is coming from in your code. Thanks in advance
