[site]: crossvalidated
[post_id]: 22300
[parent_id]: 22211
[tags]: 
If env is the variable you are interested in then we need to test the "effect" of this variable in terms of the variance explained by env . To do the test using a permutation we need to think about what is and isn't exchangeable under the Null hypothesis we are testing. In this case, the Null is no effect of env so under this the sites are freely exchangeable. Within site , the samples could be permuted but we should use a cyclic shift permutation rather than free permutation to preserve the autocorrelations. If the three time points are the same across all sites we might also wish to restrict the permutation so that the same permutation is used within all sites, thus preserving those correlations across site . If time is a nuisance variable that you are not interested in, I would do a partial analysis, conditioning on time to remove it and look at the effect of env . To do this, include + Condition(time) in the model formula. > mod mod Call: capscale(formula = repdf[, -c(1, 11:12)] ~ env + Condition(time), data = repdf) Inertia Proportion Rank Total 38.1148 1.0000 Conditional 0.0000 0.0000 1 Constrained 16.5286 0.4337 1 Unconstrained 21.5862 0.5663 9 Inertia is mean squared Euclidean distance Eigenvalues for constrained axes: CAP1 16.53 Eigenvalues for unconstrained axes: MDS1 MDS2 MDS3 MDS4 MDS5 MDS6 8.890e+00 7.312e+00 4.611e+00 4.793e-01 1.560e-01 1.370e-01 MDS7 MDS8 MDS9 7.542e-06 5.719e-06 3.341e-06 To permute strata (here site ), you can use permute . To shuffle just the strata as blocks of three samples, a suitable control object would be: ctrl If you wanted to permute within site we would use this ctrl The constant = TRUE forces the same random cyclic shift to be applied across each site . Even controlling for time (by conditioning on it in partial analysis) this only removes a linear effect of time so there could be some remaining autocorrelation in the residuals that are then used as the response data in the model testing the effect of env , hence the reason for using cyclic permutations even though we controlled for time in the model. Something to be aware of is that when permuting strata, you have to have a balanced design, as here, with the same number of samples within each level of strata . The code that generates permutations from control objects does not enforce this as it is designed to be very general purpose. There is a function permCheck() that exists to check a given control object and balance is one of the checks performed. When we interface permute with vegan we will enforce balance using permCheck() but I don't think permCheck() works correctly in the current version of permute . Of course, as we (well, I) haven't yet interfaced permute and vegan yet, you'll need to hack the anova() method to generate the relevant permutations. [Apologies for not responding sooner despite being alerted to this by @chlalanne on Twitter - my reply has nothing to do with you awarding a bounty, I had a poorly 11-month-old asleep on my chest most of the past few days that curtailed my typing ;-)]
