[site]: crossvalidated
[post_id]: 620279
[parent_id]: 
[tags]: 
How Can I Propagate Uncertainty in Sample Weights?

Background An AB test is to be run on a webpage. Users are randomized to either treatment or control, and the main outcome, $y$ , is a binary outcome. The risk of the outcome depends on day of the week, as well as the device type the user is on when viewing the page (desktop or mobile phone). The main estimand of interest is the average treatment effect $$ E[Y^{(1)}] - E[Y^{(0)}] $$ The marginal mean $E[Y^{(i)}]$ can be written in terms of the conditional means $$ E[Y^{(i)}] = \sum_i \sum_j E[Y^{(i)} \vert D = d_j, W = w_i] \times P(D = d_j, W = w_i) $$ Here, $D$ is the device type and $W$ is the day of week. The marginal means are then just weighted averages of conditional means, where the weights are the probabilities $P(D = d_j, W = w_i)$ . A Bayesian model is to be used due to good prior information. Question The weights, $P(D = d_j, W = w_i)$ , in the calculation for the marginal mean are simply estimates and I'm wondering if I can incorporate the uncertainty in the estimate of the weight into my estimate of the marginal mean and hence ATE. How can this be done? I'll be using MCMC, and so one method I thought might work would be to essentially bootstrap the weights in each iteration of the markov chain. In essence Draw my estimate of $ E[Y^{(i)} \vert D = d_j, W = w_i]$ from the posterior Draw a bootstrap sample from my data Weight my estimate of $ E[Y^{(i)} \vert D = d_j, W = w_i]$ by the weight in the bootstrap sample Do this once per iteration per chain. Aside from an outright model for the joint density of day of week and device type, is there another way to incorporate the uncertainty in weights? Is the technique I've described an agreeable approach?
