[site]: stackoverflow
[post_id]: 2536122
[parent_id]: 2481720
[tags]: 
If you're looking make your site "safe" from vulnerabilities, a white list approach is the (only) way to go . I would recommend safely escaping all user generated content, and white listing only markup you know is safe and works on your site. This means not only tags, but also the flash embeddings. For example, if you want to allow any youtube to be embedded, write a validation RegEx that looks for the embed code they generate. Refuse to accept any others (or simply display it as escaped markup). This is testable. Forget all this parsing nonsense. If you also want to add vimeo videos, then look at the embed code they provide and accept that as well. Ugh? I know this seems like a pain, but in reality it's much easier to write than some algorithm that tries to detect "bad" content in some sort of generic fashion. After getting the simple version of the algorithm working, you could go back and make it nicer. You could "provisionally" accept content with URLs, scripts, etc. that don't pass your white list, and have an admin process to add approved regexes to your output escaping routine. This way legitimate users aren't left out in the cold, but you don't open your self up to attacks of this nature.
