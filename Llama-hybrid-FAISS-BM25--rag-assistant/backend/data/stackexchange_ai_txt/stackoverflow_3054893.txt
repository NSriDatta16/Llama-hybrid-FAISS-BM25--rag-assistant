[site]: stackoverflow
[post_id]: 3054893
[parent_id]: 3054843
[tags]: 
I believe that CTE results are retrieved every time. With a temp table the results are stored until it is dropped. This would seem to explain the performance gains you saw when you switched to a temp table. Another benefit is that you can create indexes on a temporary table which you can't do to a cte. Not sure if there would be a benefit in your situation but it's good to know. Related reading: Which are more performant, CTE or temporary tables? SQL 2005 CTE vs TEMP table Performance when used in joins of other tables http://msdn.microsoft.com/en-us/magazine/cc163346.aspx#S3 Quote from the last link: The CTE's underlying query will be called each time it is referenced in the immediately following query. I'd say go with the temp table. Unfortunately elegant isn't always the best solution. UPDATE: Hmmm that makes things more difficult. It's hard for me to say with out looking at your whole environment. Some thoughts: can you use a stored procedure instead of a UDF (instead, not from within)? This may not be possible but if you can remove the left join from you CTE you could move that into an indexed view. If you are able to do this you may see performance gains over even the temp table.
