[site]: stackoverflow
[post_id]: 4381724
[parent_id]: 
[tags]: 
@PersistenceUnit annotation won't create an EntityManageFactory emf=null

I'm try to use the Sun Java PetStore Demo. In the CatalogFacade class there is the following annotation: @PersistenceUnit(unitName="myPetStorePU") private EntityManagerFactory emf; In all the methods of the CatalogFacade Sun has: EntityManager em = emf.createEntityManager(); But I am getting a null pointer exception for emf when trying to createEntityManager. But... if I add the following line above that line as such EntityManagerFactory emf = javax.persistence.Persistence.createEntityManagerFactory("myPetStorePU"); EntityManager em = emf.createEntityManager(); then emf gets successfully created and the persistence unit myPetStorePU also successfully connects to the database. So it looks like persistence.xml syntax and its location is correct. I'd like to understand why the annotation doesn't work since I think there was a reason for just using the annotation as opposed to adding the createEntityManagerFactory line in every method. My src/META-INF/persistence.xml file looks like this: Petstore Persistence Unit oracle.toplink.essentials.ejb.cmp3.EntityManagerFactoryProvider com.sun.javaee.blueprints.petstore.model.Tag com.sun.javaee.blueprints.petstore.model.SellerContactInfo com.sun.javaee.blueprints.petstore.model.Product com.sun.javaee.blueprints.petstore.model.Item com.sun.javaee.blueprints.petstore.model.Category com.sun.javaee.blueprints.petstore.model.Address com.sun.javaee.blueprints.petstore.model.ZipLocation Edit: CatalogFacade is in the petstore.model package and implements the ServletContextListener com.sun.javaee.blueprints.petstore.model.CatalogFacade in the index.jsp Sun has the following: tags=cf.getTagsInChunk(0, 12); %> public List getTagsInChunk(int start, int chunkSize) { //The next line is required since the @PersistenceUnit annotation at the top of this class does not work EntityManagerFactory emf = javax.persistence.Persistence.createEntityManagerFactory("myPetStorePU"); EntityManager em = emf.createEntityManager(); System.out.println("Entity manager " + emf); Query query = em.createQuery("SELECT t FROM Tag t ORDER BY t.refCount DESC, t.tag"); List tags = query.setFirstResult(start).setMaxResults(chunkSize).getResultList(); em.close(); return tags; }
