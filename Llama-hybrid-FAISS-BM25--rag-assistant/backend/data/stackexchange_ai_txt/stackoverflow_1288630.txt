[site]: stackoverflow
[post_id]: 1288630
[parent_id]: 
[tags]: 
ASP.Net URL Encoding

I am implementing URL rewriting in ASP.net and my URLs are causing me a world of problems. The URL is generated from a database of departments & categories. I want employees to be able to add items to the database with whatever special characters are appropriate without it breaking the site. I am encoding the data before I construct the URLs. There are several problems... IIS decodes the URL before it reaches .net making it impossible to properly parse anything with a "/" in it. ASP.net gets confused by the url making "~" useless within certain pages I migrated from the built in test server to my local IIS server (XP machine) and any URL containing an encoded & (%26) gives me a "Bad Request" error. UrlEncode leaves some breaking characters untouched such as '.' I did have two other related posts on this subject, at the time I only saw the small problems not the big problem upstream. I've found some registry tricks to solve the "Bad Request" issue but I'm going to be deploying to a shared hosting environment making that useless. I also know that this is a fix for some security issue so I don't want to necessarily bypass it without knowing what can of worms I'm opening. Rather than trying to force .net to pass me the raw url, or override IIS settings i'd like to make truly safe URLs in the first place. I'll note i've tried AntiXss.URLEncode, HttpUtility.URLEncode, URI.EscapeDataString. I've even tried stupid things like double URLEncodng. Is there a utility that does what I need, or do i really need to roll my own. I'm even considering doing something Hacky like replacing the % with an unusual string of characters. The end result should be at least readable which was the point of using URL rewriting in the first place. Sorry for the long post- I just wanted to make sure that I've included all the necessary details. I can't seem to find any relevant information on this, and it seems like it would be a common problem - so maybe I'm missing something big. Thanks for your help, and patience with the long explanation! Edit for clarity: When I say the urls are being built from a database what I mean is that the directory structure is contstructed from the departments and categories in my database. Some Example URLS - Mystore/Refrigeration/Bar+Fridge.aspx Mystore/Cooking+Equipment.aspx Mystore/Kitchen/Cutting+Boards.asxpx The problems come in when I use a department like "Beverage & Bar" or "Pastry/Decorating" to construct my URL. Despite being encoded first these cause the aforementioned issues. My handlers are already implemented and working fine except for the special character encoding issues.
