[site]: stackoverflow
[post_id]: 3136711
[parent_id]: 3136586
[tags]: 
I would be you, I would heavily refactor this code. Most of the time when I get a problem like yours (and it's becoming very rare) I refactor the code until I see clearly the problem. Here, there is too much repetitions that can clearly be avoided. Use typedefs, references, consts to avoid repetitions. Refactoring allow you to reorganise your code and your thought, simplify, make problems obvious. Take time to do this and you'll find the source of the problem. That might be out of this code. (about refactoring, i recommend reading this : http://sourcemaking.com/refactoring )
