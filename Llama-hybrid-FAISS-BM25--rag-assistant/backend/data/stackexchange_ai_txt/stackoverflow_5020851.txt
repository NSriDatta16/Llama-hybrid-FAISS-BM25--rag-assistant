[site]: stackoverflow
[post_id]: 5020851
[parent_id]: 
[tags]: 
At certain points in the HTML, I need to close every open tag, insert a DIV, then open all tags again, in order

I am dealing with HTML that's been generated with FCKeditor . So it will look something like this: Paragraph List item No head tag, no body tag, just a snippet of HTML. I am trying to add support for certain variables that, when inserted into the HTML, will be replaced with dynamic content. So the HTML, variable inserted, might look like this: Here's a variable: {widget} I want to replace {widget} with this: Hi, I'm a widget. FCKeditor encapsulates content (rightly) into paragraphs when you insert a line break. So if I did a straight replace, the resulting HTML would be this: Here's a variable: Hi, I'm a widget. That's not going to work because the div tag is inside of the p tag. So what I want to do is close the paragraph and insert the DIV after it: Here's a variable: Hi, I'm a widget. Let's take this example: Here's a variable: {widget} more content after I would want this result: Here's a variable: Hi, I'm a widget. more content after At every instance of {widget} in HTML snippet, I need to make a "break" in the HTML. Which is to close every open tag, insert the widget code, then open them all again in order. Is this possible using a PHP HTML parser? If so, how would I go about it?
