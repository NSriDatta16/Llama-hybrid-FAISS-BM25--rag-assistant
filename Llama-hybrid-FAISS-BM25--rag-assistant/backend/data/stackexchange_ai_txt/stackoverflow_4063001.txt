[site]: stackoverflow
[post_id]: 4063001
[parent_id]: 4059173
[tags]: 
To capture the rows and re-use try this approach: Sort the data by Company & Generation. Make a unique list of Companies & generations (use Advanced Filter, Unique Only, Copy) For each Company generation pair in the list build 2 columns of formulae. First column gives the count of rows in the data for this pair (use COUNTIFS), second column gives the first row in the data for this pair (=first row for previous pair+count of rows for previous pair). Then you can use a function like OFFSET to return only the rows of data for the Company-Generation pair and embed this inside the final function/array formula (AVERAGEIFS etc) You could extend this sort and count approach to include dates if you wanted. There is a drawback that if the list of cities and generations change you have to change the list of uniques and associated formulas. There are examples of this approach on my website at http://www.decisionmodels.com/optspeedk.htm http://www.decisionmodels.com/optspeedj.htm
