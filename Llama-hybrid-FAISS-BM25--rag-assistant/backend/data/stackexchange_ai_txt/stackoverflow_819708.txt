[site]: stackoverflow
[post_id]: 819708
[parent_id]: 
[tags]: 
PID from socket number on Windows?

I need to count amount of bytes sent and received from the network by various applications. First I thought about using LSP , but there is a lot of applications that do not use LSP at all ( SMB for example). This is why I have written a small sniffer. This application works on the IP level and collects data using recvfrom . So I have the address of the remote host, local and remote ports. This is pretty cool, but I also need to have the PID of the local socket owner. So, is there a simple way to obtain such PID? The workaround is using GetTcpTable, GetUdpTable Or AllocateAndGetUdpExTableFromStack and AllocateAndGetTcpExTableFromStack (there are a lot of differences in those functions between Windows 2000 , Windows XP , Windows XP SP2 and Windows Vista ) and to lookup result tables, but it seems inelegant and inefficient... So is there a kind of A "GetPIDOfSocket" function? The resolution should be Win32 (no .NET ) only, as various languages can be used, e.g. C++ and Delphi .
