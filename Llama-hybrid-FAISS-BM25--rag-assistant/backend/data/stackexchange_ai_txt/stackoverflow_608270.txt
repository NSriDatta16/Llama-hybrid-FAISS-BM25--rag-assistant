[site]: stackoverflow
[post_id]: 608270
[parent_id]: 603323
[tags]: 
So I ended up redoing things and came up with the following solution which only queries the database twice and is MUCH faster: Dim locationsOnly = (From map In dc.MapBackgrounds Where map.MapID = 1 Let Locs = map.Schemes.SchemeLocations _ From SchemeLoc In Locs _ Where (options.Locations.Count = 0 Or options.Locations.Contains(SchemeLoc.LocID)) _ Select New With {.LocationID = SchemeLoc.LocID, .X = SchemeLoc.X, .Y = SchemeLoc.Y, _ .LocationName = SchemeLoc.Location.Location, _ .CountryID = SchemeLoc.Location.Countries.ID, .CountryName = SchemeLoc.Location.Countries.country, _ .StateID = SchemeLoc.Location.State, .StateName = SchemeLoc.Location.States.state, .StateAbbrev = SchemeLoc.Location.States.state}).ToList() Dim orgsOnly = (From curLoc In curLocs1 _ Join curName In curNames1 On curLoc.organization_id Equals curName.organization_id _ Join curStatus In curStatuses1 On curLoc.organization_id Equals curStatus.organization_id _ Join curCommand In curCommand1 On curLoc.organization_id Equals curCommand.organization_id _ Join curComponent In curComponent1 On curLoc.organization_id Equals curComponent.organization_id _ Join curTable In dc.organization_tables On curLoc.organization_id Equals curTable.organization_id _ Where (options.UnitSizes.Count = 0 Or options.UnitSizes.Contains(curName.UnitSize)) _ And (options.UnitTypes.Count = 0 Or options.UnitTypes.Contains(curName.UnitType)) _ And (options.Statuses.Count = 0 Or options.Statuses.Contains(curStatus.status)) _ And (options.Commands.Count = 0 Or options.Commands.Contains(curCommand.service_assigned)) _ And (options.Components.Count = 0 Or options.Components.Contains(curComponent.compo)) _ And (options.Tables.Count = 0 Or (options.Tables.Contains(curTable.table_id) Or curTable.Tables.Any(Function(a) (options.Tables.Contains(a.parent_id))))) _ Select New With {.OrgLocID = curLoc.location, _ .MilUnit = New MillitaryUnit With { _ .ID = curLoc.organization_id, _ .Name = curName.name, _ .IconPath = curName.icon, _ .ConversionStatus = curStatus.Status1.status, _ .ServiceCommand = curCommand.Service_Assigneds.service_assigned, _ .Component = curComponent.Components.compo}}).Distinct().ToList() ss.Locations = New System.Collections.ObjectModel.ObservableCollection(Of Location)((From loc In locationsOnly _ Group Join org In orgsOnly On loc.LocationID Equals org.OrgLocID Into Orgs = Group _ Select New Location With { _ .ID = loc.LocationID, _ .Name = loc.LocationName, _ .X = loc.X, _ .Y = loc.Y, _ .Country = New Country With {.ID = loc.CountryID, .Name = loc.CountryName}, _ .State = New USState With {.ID = loc.StateID, .Name = loc.StateName, .Abbreviation = loc.StateAbbrev}, _ .Units = New System.Collections.ObjectModel.ObservableCollection(Of MillitaryUnit)((From curOrg In Orgs _ Select curOrg.MilUnit).ToList())}).ToList()) Thanks for your help casperOne!
