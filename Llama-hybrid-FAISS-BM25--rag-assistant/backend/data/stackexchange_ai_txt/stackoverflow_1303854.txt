[site]: stackoverflow
[post_id]: 1303854
[parent_id]: 
[tags]: 
dojo - mouse(x, y) - drag and drop - frustration

I'm attempting to drag an object using dojo.dnd but want the avatar to be in the same position as the object was (relative to the mouse) i.e. if a person clicks in the middle of the object then the mouse cursor will be in the middle of the avatar. I've had all sorts of strange results. if i connect a function to body.onmousemove the drop part of the dnd fails. How can i get this working? DnD Events .target { border: 1px dotted gray; width: 300px; height: 300px; padding: 5px; -moz-border-radius: 8pt 8pt; radius: 8pt; } .source { border: 1px dotted skyblue; height: 200px; width: 300px; -moz-border-radius: 8pt 8pt; radius: 8pt; } .dojoDndItemOver { background: #feb; border: 1px dotted gray; } .target .dojoDndItemAnchor { background: #ededed; border: 1px solid gray; } .dojoDndAvatarHeader { display: none; } dojo.require("dojo.dnd.Source"); dojo.require("dojo.dnd.Container"); dojo.require("dojo.dnd.Moveable"); dojo.require("dojo.dnd.Manager"); dojo.require("dojo.dnd.Avatar"); var mouse = { x: 0, y: 0 , handle:undefined}; function mouseCoords(ev) { var px, py; ev = ev || window.event; if (ev.pageX || ev.pageY) { px = ev.pageX; py = ev.pageY; } else { px = ev.clientX + dojo.body().scrollLeft - dojo.body().clientLeft; py = ev.clientY + dojo.body().scrollTop - dojo.body().clientTop; } mouse = { x: px, y: py }; // dojo.byId("msg").innerHTML = dojo.toJson(mouse); } //dnd WORKS when following lines are commented out. (positioning fails) var mchandle = dojo.connect(document, "onmousemove", 'mouseCoords'); //dojo.query(".dojoDndItem").connect("onclick", 'mouseCoords'); //dojo.dnd.Source.onMouseDown('mouseCoords') var item_price; var total = 0; function AddItems(target, nodes) { for (var i = 0; i { total += parseFloat((target.getItem(nodes[i].id)).data); } dojo.byId("cost").innerHTML = total; } function SubstractItems(target, nodes) { for (var i = 0; i total -= parseInt((target.getItem(nodes[i].id)).data); } dojo.byId("cost").innerHTML = total; } function ShowPrice(target, nodes) { var sum = 0; for (var i = 0; i dojo.dnd.manager().OFFSET_X = 0 - (mouse.x - dojo._abs(nodes[i]).x); dojo.dnd.manager().OFFSET_Y = 0 - (mouse.y - dojo._abs(nodes[i]).y); dojo.dnd.manager().updateAvatar(); sum += parseInt((target.getItem(nodes[i].id)).data); } dojo.byId("msg").innerHTML = "Selected Item Price is $" + sum; } function ClearMsg() { dojo.byId("msg").innerHTML = ""; } function init() { dojo.subscribe("/dnd/drop", function(source, nodes, iscopy) { var t = dojo.dnd.manager().target; ClearMsg(); if (t == source) { return; } if (t == cart) { AddItems(t, nodes); } if (t == shelf) { SubstractItems(t, nodes); } }); dojo.subscribe("/dnd/start", function(source, nodes, iscopy) { ShowPrice(source, nodes); }); dojo.subscribe("/dnd/cancel", function() { ClearMsg(); }); } dojo.addOnLoad(init); SOURCE singular="false"> TARGET Total Price (USD): 0.00 Message:
