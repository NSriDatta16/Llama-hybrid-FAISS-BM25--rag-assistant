[site]: stackoverflow
[post_id]: 4427781
[parent_id]: 4418146
[tags]: 
Your problem might be that you are using subqueries. Since subqueries don't use nor set indexes, they use the slowest join-method possible (i.e. a full table scan). I am not experienced enough to offer an SQL-only solution so I would recommend you break the query down into two separate calls. Get average emotion for each customer and select top 6, save into hash or object. Get those 6 customers via WHERE custumerID IN (id1, id2, id3, etc) Although this probably isn't the prettiest of solutions, you avoid using an index-less subquery (and the very slow full table scan).
