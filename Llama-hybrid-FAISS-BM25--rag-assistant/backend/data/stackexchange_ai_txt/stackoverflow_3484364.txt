[site]: stackoverflow
[post_id]: 3484364
[parent_id]: 3483343
[tags]: 
How can I refactor this With unit tests. Seriously. There are two Boolean inputs, so you only need four unit tests to fully cover this method. Then, with full branch coverage already in place, you can just play around with the implementation. Try something that seems right (I find it very helpful to write a truth table in this case), and the tests will tell you if you got a detail wrong. And as a further benefit, you can keep the tests around forever, as documentation of what the method actually does. This is especially useful if you opt for a clever implementation, like fancy Boolean expressions -- if you're scratching your head trying to follow the flow, you can just look at the tests and see, "Oh, I see -- if I pass this and this, I get this."
