[site]: crossvalidated
[post_id]: 418607
[parent_id]: 364383
[tags]: 
Explanation : (1) is a Monte Carlo estimate of an expectation of the system we are approximating, with the help of incomplete observations. The weight of a particle represents how likely our observations of the system are, assuming that the state of the system is described by that particle. The estimate is then a weighted average of the particles (samples), where the more likely ones have higher weight. The effective sample size is used to keep track of how many particles contribute to the Monte Carlo estimate. When it falls below a certain threshold (e.g. 1/2 of the original sample size M), we resample to get fresh particles that all contribute evenly to the Monte Carlo estimate. Then the weights are uniform: all are 1/M. Answer : You always use the weighted average in (1) to approximate the expectation of a function f at time t. At the time step right after resampling, (1) reduces to (2) because the weights are uniform.
