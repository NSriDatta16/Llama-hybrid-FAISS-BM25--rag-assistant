[site]: stackoverflow
[post_id]: 5211087
[parent_id]: 5209671
[tags]: 
I have a simple example that might fits your needs class Dagho_Acl_Main extends Zend_Acl { public function __construct() { $anonymous = new Zend_Acl_Role("anonymous"); $customer = new Zend_Acl_Role("customer"); $admin = new Zend_Acl_Role("admin"); $anonymousResource = new Zend_Acl_Resource("acl"); $defaultResource = new Zend_Acl_Resource("default"); $customerResource = new Zend_Acl_Resource("user"); $adminResource = new Zend_Acl_Resource("manage"); $this->addRole($anonymous) ->addRole($customer) ->addRole($admin); $this->addResource($anonymousResource) ->addResource($defaultResource) ->addResource($customerResource) ->addResource($adminResource); $this->allow($anonymous, $anonymousResource); $this->allow($anonymous, $defaultResource); $this->deny($anonymous, $customerResource); $this->deny($anonymous, $adminResource); $this->allow($customer, $anonymousResource); $this->allow($customer, $defaultResource); $this->allow($customer, $customerResource); $this->deny($customer, $adminResource); $this->allow($admin, $defaultResource); $this->allow($admin, $anonymousResource); $this->allow($admin, $adminResource); $this->deny($admin, $customerResource); return $this ; } } and here is my plugin : getModuleName(); $controller = $request->getControllerName(); $action = $request->getActionName(); $doctrineAuth = new Dagho_Auth_Doctrine(); $logged = $doctrineAuth->checklogin(); $identity = $doctrineAuth->getIdentity(); Zend_Registry::set("identity", $identity); if ($logged && $identity["role"] !== "anonymous") { /// user had an identity let's check the ACL $acl = new Dagho_Acl_Main(); $isAllowed = $acl->isAllowed($identity["role"], $module); if (!$isAllowed) { return $request->setModuleName("acl")->setControllerName("index") ->setActionName("denied")->setDispatched(true); } else { /// user has identity and he is allowed to access it return; } } elseif ($logged === false || ($logged && $identity["role"] === "anonymous" )) { //// user not logged on > login.php or its his first visit $identity = $doctrineAuth->getStorage()->write(array('name' => 'anonymous', 'role' => "anonymous",)); Zend_Registry::set("identity", $identity); return $request->setModuleName("acl")->setControllerName("index") ->setActionName("login")->setDispatched(true); } else { return $request->setModuleName("acl")->setControllerName("index") ->setActionName("denied")->setDispatched(true); } parent::preDispatch($request); } }
