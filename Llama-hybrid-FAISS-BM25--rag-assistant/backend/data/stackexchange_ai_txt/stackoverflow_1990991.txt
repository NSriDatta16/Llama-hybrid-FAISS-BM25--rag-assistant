[site]: stackoverflow
[post_id]: 1990991
[parent_id]: 1990977
[tags]: 
You can either do it with row numbers as suggested by astander , or you can do it with dates. This solution will also take the last 15 days if you don't have rows for every day while the row number solution takes the last 15 rows. You have to decide which one works better for you. EDIT : Replaced AVG , use CASE to avoid division by 0 in case no records are found within the period. SELECT CASE WHEN SUM(c.is_5) > 0 THEN SUM( c.close * c.is_5 ) / SUM( c.is_5 ) ELSE 0 END AS close_5, CASE WHEN SUM(c.is_5) > 0 THEN SUM( c.trd_qty * c.is_5 ) / SUM( c.is_5 ) ELSE 0 END AS trd_qty_5, CASE WHEN SUM(c.is_15) > 0 THEN SUM( c.close * c.is_15 ) / SUM( c.is_15 ) ELSE 0 END AS close_15, CASE WHEN SUM(c.is_15) > 0 THEN SUM( c.trd_qty * c.is_15 ) / SUM( c.is_15 ) ELSE 0 END AS trd_qty_15 FROM ( SELECT cashmarket.*, IF( TO_DAYS(NOW()) - TO_DAYS(m_day) The query returns the averages of close and trd_qty for the last 5 and the last 15 days. Current date is included, so it's actually today plus the last 4 days (replace by to get current day plus 5 days).
