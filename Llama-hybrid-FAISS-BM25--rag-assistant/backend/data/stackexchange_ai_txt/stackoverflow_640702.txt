[site]: stackoverflow
[post_id]: 640702
[parent_id]: 640656
[tags]: 
After several misunderstandings I finally seem to get what you need :) SELECT cnt_range * 2 AS days_range, CASE WHEN SUM(trans_cnt) > 0 THEN SUM(trans_sum) / SUM(trans_cnt) ELSE 0 END AS average_amount FROM ( SELECT SUM(amount) AS trans_sum, COUNT(*) AS trans_cnt, FLOOR(COUNT(*) / 2) AS cnt_range FROM transactions GROUP BY TO_DATE(created) ) ao GROUP BY cnt_range
