[site]: stackoverflow
[post_id]: 5726867
[parent_id]: 
[tags]: 
Knowing the internal IP of an http request coming through NAT on a machine with multiple NICs?

Imagine a Windows box, which: hosts a WCF service has multiple NICs sits behind NAT When a user issues a request to the service (on top of the WCF infrastructure), he uses the external address assigned to the target machine by the NAT. I have to write some piece of code inside the WCF service, which must know which of the several NICs that the machine has was used to actually handle the network traffic. How does this code identify the NIC is less important - it could be its MAC address (the best) or it could be the (internal) IP address of the NIC. How can I do it? EDIT1 I will try to supply the question context. There are two agents. Both expose the same WCF service. In addition, one of the agents can be instructed to start probing the network towards the second agent in the following fashion: Agent A is asked to probe the network to agent B Agent A negotiates with agent B the UDP port to utilize for the sake of probing using the WCF service exposed by the agent B. Once negotiation is over, the agent A starts some custom protocol over UDP, where the agent B acts as the server - i.e. it binds to the UDP port negotiated in the previous item. Binding to a UDP port requires two pieces - the IP address and UDP port, where the IP address can either be a specific IP address or * (to bind to all the IP addresses associated with the machine). The latter option is not good for us - I will omit the reasons. This leaves us the former option - binding to the specific IP address. However, when the agent B is behind NAT, the IP address used to talk to the WCF service is the external IP address assigned to the agent by the NAT. Binding, on the other hand, requires the respective internal IP address - how to get it?
