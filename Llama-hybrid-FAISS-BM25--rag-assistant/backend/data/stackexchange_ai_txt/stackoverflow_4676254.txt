[site]: stackoverflow
[post_id]: 4676254
[parent_id]: 4676163
[tags]: 
To detect what type of data you are downloading you should replace the h = opener.open(ree).read() for h = opener.open(ree) . Now in h you have the response object. You can analyze the headers by using the h.headers (dict-like) object. Particularly you will be interested in the headers 'content-type' and 'content-encoding'. You can determine the content being sent analyzing it. def download(source_url, correct_url = True): try: socket.setdefaulttimeout(10) agents = ['Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 5.0)','Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.1)','Microsoft Internet Explorer/4.0b1 (Windows 95)','Opera/8.00 (Windows NT 5.1; U; en)'] ree = urllib2.Request(source_url) ree.add_header('User-Agent',random.choice(agents)) ree.add_header('Accept-encoding', 'gzip') opener = urllib2.build_opener() h = opener.open(ree) if 'gzip' in h.headers.get('content-type', '') or 'gzip' in h.headers.get('content-encoding', ''): compressedstream = StringIO(h.read()) gzipper = gzip.GzipFile(fileobj=compressedstream) data = gzipper.read() return data else: return h.read() except Exception, e: return ""
