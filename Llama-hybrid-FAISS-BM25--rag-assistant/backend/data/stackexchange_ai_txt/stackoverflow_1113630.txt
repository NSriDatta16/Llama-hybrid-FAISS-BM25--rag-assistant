[site]: stackoverflow
[post_id]: 1113630
[parent_id]: 1068535
[tags]: 
I think you can achieve all of your requirements by playing with the settings in system > configuration > web First thing I'd try is setting base url (secure and unsecure if needed) to / (forward slash), and then going system > cache management > rebuild catalog url rewrites. If that doesn't work, play around with the settings, bet you can get it to work. Be warned though, it will make magento put relative urls in google base feeds etc = bad! So don't do it in production. My dev copy is at work, inacessible from here, so can't try for you. Also, for your script above, you could try: $url = "/shop/" . $_category->getUrlKey() . '.html'; (you may not need the html bit at the end, depends on your config)
