[site]: stackoverflow
[post_id]: 1176411
[parent_id]: 1167043
[tags]: 
Well you need to attach an AVI Mux (CLSID_AviDest) to your capture card. You then need to attach a File Writer (CLSID_FileWriter) and it will write out everything for you. Admittedly Setting up the capture graph is not necessarily easy as DirectShow makes you jump through a million and one hoops. Its much easier using the ICaptureGraphBuilder2 interface. Thankfully Microsoft have given a really nice rundown of how to do this ... http://msdn.microsoft.com/en-us/library/dd318627.aspx Adding an encoder is not easy though and, conveniently, glossed over in that link. Here is an example of how to enumerate all the video compressors in a system that I wrote for an MFC app of mine. BOOL LiveInputDlg::EnumerateVideoCompression() { CComboBox* pVideoCompression = (CComboBox*)GetDlgItem( IDC_COMBO_VIDEOCOMPRESSION ); pVideoCompression->SetExtendedUI( TRUE ); pVideoCompression->SetCurSel( pVideoCompression->AddString( _T( " " ) ) ); ICreateDevEnum* pDevEnum = NULL; IEnumMoniker* pEnum = NULL; HRESULT hr = S_OK; hr = CoCreateInstance( CLSID_SystemDeviceEnum, NULL, CLSCTX_INPROC_SERVER, IID_ICreateDevEnum, (void**)&pDevEnum ); if ( FAILED( hr ) ) { return FALSE; } hr = pDevEnum->CreateClassEnumerator( CLSID_VideoCompressorCategory, &pEnum, 0 ); pDevEnum->Release(); if ( FAILED( hr ) ) { return FALSE; } if ( pEnum ) { IMoniker* pMoniker = NULL; hr = pEnum->Next( 1, &pMoniker, NULL ); while( hr == S_OK ) { IPropertyBag* pPropertyBag = NULL; hr = pMoniker->BindToStorage( NULL, NULL, IID_IPropertyBag, (void**)&pPropertyBag ); if ( FAILED( hr ) ) { pMoniker->Release(); pEnum->Release(); return FALSE; } VARIANT varName; VariantInit( &varName ); hr = pPropertyBag->Read( L"Description", &varName, NULL ); if ( FAILED( hr ) ) { hr = pPropertyBag->Read( L"FriendlyName", &varName, NULL ); if ( FAILED( hr ) ) { pPropertyBag->Release(); pMoniker->Release(); pEnum->Release(); return FALSE; } } IBaseFilter* pBaseFilter = NULL; pMoniker->BindToObject( NULL, NULL, IID_IBaseFilter, (void**)&pBaseFilter ); { USES_CONVERSION; TCHAR* pName = OLE2T( varName.bstrVal ); int index = pVideoCompression->AddString( pName ); pVideoCompression->SetItemDataPtr( index, pMoniker ); VariantClear( &varName ); pPropertyBag->Release(); } hr = pEnum->Next( 1, &pMoniker, NULL ); } pEnum->Release(); } return TRUE; } Good Luck! :)
