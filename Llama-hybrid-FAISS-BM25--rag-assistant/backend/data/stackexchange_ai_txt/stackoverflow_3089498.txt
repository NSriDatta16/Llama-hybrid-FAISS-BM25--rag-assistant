[site]: stackoverflow
[post_id]: 3089498
[parent_id]: 3089109
[tags]: 
Long story short - use another constructor for your InputStreamBody that lets you specify the mime type you wish to use . If you don't, the parts in your multipart request will not have a Content-Type specified (see below for details). Consequently, the server does not know what type the file is, and in your case might be refusing to accept it (mine accepted them anyway, but I assume this is driven by config). If this still doesn't work, you might have a server-side issue. Note: Changing the Content-Type of the request itself to anything but multipart/form-data; boundary=someBoundary renders the request invalid; the server will not correctly parse the multipart parts. Long story long - here's my findings. Given the following code: byte[] data = " ".getBytes(); multipartContent.addPart("uploadedFile", new InputStreamBody(new ByteArrayInputStream(data), "text/xml", "somefile.xml")); multipartContent.addPart("otherPart", new StringBody("bar", "text/plain", Charset.forName("UTF-8"))); multipartContent.addPart("foo", new FileBody(new File("c:\\foo.txt"), "text/plain")); The HttpClient posts the following payload (captured w/ Wireshark): POST /upload.php HTTP/1.1 Transfer-Encoding: chunked Content-Type: multipart/form-data; boundary=SeXc6P2_uEGZz9jJG95v2FnK5a8ozU8KfbFYw3 Host: thehost.com Connection: Keep-Alive User-Agent: Apache-HttpClient/4.1-alpha2 (java 1.5) --SeXc6P2_uEGZz9jJG95v2FnK5a8ozU8KfbFYw3 Content-Disposition: form-data; name="uploadedFile"; filename="someXml.xml" Content-Type: text/xml Content-Transfer-Encoding: binary --SeXc6P2_uEGZz9jJG95v2FnK5a8ozU8KfbFYw3 Content-Disposition: form-data; name="otherPart" Content-Type: text/plain; charset=UTF-8 Content-Transfer-Encoding: 8bit yo --SeXc6P2_uEGZz9jJG95v2FnK5a8ozU8KfbFYw3 Content-Disposition: form-data; name="foo"; filename="foo.txt" Content-Type: text/plain Content-Transfer-Encoding: binary Contents of foo.txt --SeXc6P2_uEGZz9jJG95v2FnK5a8ozU8KfbFYw3-- On the server, the following PHP script: spitted out the following: Array ( [uploadedFile] => Array ( [name] => someXml.xml [type] => text/xml [tmp_name] => /tmp/php_uploads/phphONLo3 [error] => 0 [size] => 11 ) [foo] => Array ( [name] => foo.txt [type] => text/plain [tmp_name] => /tmp/php_uploads/php58DEpA [error] => 0 [size] => 21 ) ) Array ( [otherPart] => yo )
