[site]: stackoverflow
[post_id]: 4655560
[parent_id]: 
[tags]: 
Apparent @"count:" issue on iPod's with iPhone OS 3.1.3

I have tracked down a crash users of my app on iPod Touches with iPhone OS 3.1.3 have been having: for some reason, using the "@count:" expression on the CoreData store is causing a crash. Here's the relevant code: NSExpression *avgExpression = [NSExpression expressionForFunction:@"average:" arguments:[NSArray arrayWithObject:keyPathExpression]]; NSExpressionDescription *ed = [[NSExpressionDescription alloc] init]; [ed setName:@"avgScalar"]; [ed setExpression:avgExpression]; [ed setExpressionResultType:NSFloatAttributeType]; NSExpression *countExpression = [NSExpression expressionForFunction:@"count:" arguments:[NSArray arrayWithObject:keyPathExpression]]; NSExpressionDescription *ed2 = [[NSExpressionDescription alloc] init]; [ed2 setName:@"countScalar"]; [ed2 setExpression:countExpression]; [ed2 setExpressionResultType:NSInteger16AttributeType]; [request setPropertiesToFetch:[NSArray arrayWithObjects:ed,ed2,nil]]; When the fetch is performed, I get the following error with the crash: * Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '* -constantValue only defined for abstract class. Define -[NSKeyPathExpression constantValue]!' If I restrict the fetch to the avgExpression (@"average:"), all works fine. There's something wonky about the @"count:" expression, so far as I can tell only on iPod Touches with iPhone OS 3.1.3. Any ideas? I could alternately perform a full fetch and use key path operators to get the averages and counts I need. However, I worry this approach would be much more expensive. Anyone know if it is?
