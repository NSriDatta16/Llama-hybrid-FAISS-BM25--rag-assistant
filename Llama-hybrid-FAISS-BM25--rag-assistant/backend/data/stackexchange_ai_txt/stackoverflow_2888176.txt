[site]: stackoverflow
[post_id]: 2888176
[parent_id]: 
[tags]: 
Cache images provided through script

I have a script, which by using several querystring variables provides an image. I am also using URL rewriting within IIS 7.5. So images have an URL like this: http://mydomain/pictures/ajfhajkfhal/44/thumb.jpg or http://mydomain/pictures/ajfhajkfhal/44.jpg This is rewritten to: http://mydomain/Picture.aspx?group=ajfhajkfhal&id=44&thumb=thumb.jpg or http://mydomain/Picture.aspx?group=ajfhajkfhal&id=44 I added caching rules to IIS to cache JPG images when they are requested. This works with my images that are REAL images on the disk. When images are provided through the script, they are somehow always requested through the script, without being cached. The images do not change that often, so if the cache at least is being kept for 30 minutes (or until file change) that would be best. I am using .NET/C# 4.0 for my website. I tried setting several cache options in C#, but I cant seem to find how to cache these images (client-side), while my static images are cached properly. EDIT I use the following options to cache the image on the client side, where 'fileName' is the physical filename of the image (on disk). context.Response.AddFileDependency(fileName); context.Response.Cache.SetETagFromFileDependencies(); context.Response.Cache.SetLastModifiedFromFileDependencies(); context.Response.Cache.SetCacheability(HttpCacheability.Public); context.Response.Cache.SetExpires(DateTime.Now.AddTicks(600)); context.Response.Cache.SetMaxAge(new TimeSpan(0, 5, 0)); context.Response.Cache.SetSlidingExpiration(true); context.Response.Cache.SetValidUntilExpires(true); context.Response.ContentType = "image/jpg"; EDIT 2 Thanks for pointing that out, that was indeed a very stupid mistake ;). I changed it to 30 minutes from now (DateTime.Now.AddMinutes(30)). But this doesnt solve the problem. I am really thinking the problem lies with Firefox. I use Firebug to track each request and somehow, I am thinking I am doing something fundamentally wrong. Normal images (which are cached and static) give back an response code "304 (Not Modified)", while my page always gives back a "200 (OK)". alt text http://images.depl0y.com/capture.jpg
