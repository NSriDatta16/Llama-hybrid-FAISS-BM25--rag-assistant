[site]: stackoverflow
[post_id]: 3959923
[parent_id]: 3959853
[tags]: 
;WITH organisations AS ( SELECT 'CEO' AS Organisation, cast(NULL as varchar(50)) AS Manager, cast(NULL as varchar(50)) AS Superior_Organisation UNION ALL SELECT 'Leadership Team', 'David', 'CEO' UNION ALL SELECT 'Production Management', 'Alex', 'Leadership Team' UNION ALL SELECT 'Production Site 1', 'Francoise', 'Production Management' UNION ALL SELECT 'Production Site 2', 'Steve', 'Production Management' UNION ALL SELECT 'Production Site 1 Maintenance', 'Alan', 'Production Site 1' ), cte As ( SELECT Organisation, Manager, Superior_Organisation FROM organisations WHERE organisations.Organisation = 'Production Site 1 Maintenance' UNION ALL SELECT o.Organisation, o.Manager, o.Superior_Organisation FROM organisations o JOIN cte ON cte.Superior_Organisation = o.Organisation ) SELECT Organisation, Manager, Superior_Organisation FROM cte WHERE Organisation <> 'Production Site 1 Maintenance'
