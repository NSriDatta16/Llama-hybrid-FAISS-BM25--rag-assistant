[site]: crossvalidated
[post_id]: 625199
[parent_id]: 
[tags]: 
Two different methods to plot residuals with rstan but two different distributions

The following is the first exercice of chapter 5 from the Book 'Bayesian Statistical Modeling with Stan, R and Python' of Kentaro Matsuura, 2023. I am fitting a bayesian linear model in rstan and I tried to plot the residuals with two different methods but I do not obtain the same result and I do not understand why. For some context, the model is the following: $$ Y = b_1 + b_2 \cdot Sex + b_3 \cdot Income + \epsilon, $$ where $Y$ is the proportion of purchase during a year, Sex is the sex of the person who bought something, and Income is the income of this same person. $b_1,b_2,b_3$ are the coefficients of the linear model and $\epsilon \sim \mathcal{N}(0,\sigma)$ . For the first method , I computed the residuals $\epsilon$ from the fitted mean values and $Y$ values of the data: $\epsilon_i = Y_i - \mu_i$ . The corresponding STAN code is: // The input data is a vector 'y' of length 'N'. data { int N; vector [N] Y; vector [N] Sex; vector [N] Income; } // The parameters accepted by the model. Our model // accepts two parameters 'mu' and 'sigma'. parameters { vector[3] b; real sigma; } transformed parameters { vector[N] mu = b[1] + b[2]*Sex[1:N] + b[3]*Income[1:N]; } model { Y[1:N] ~ normal(mu[1:N], sigma); } and the R-code d $Y, Sex = d$ Sex, Income = d$Income) model For the second method , I tried to generate $\epsilon$ directly with the STAN code. Here is my code snippets: // The input data is a vector 'y' of length 'N'. data { int N; vector [N] Y; vector [N] Sex; vector [N] Income; } // The parameters accepted by the model. Our model // accepts two parameters 'mu' and 'sigma'. parameters { vector[3] b; real sigma; } transformed parameters { vector[N] mu = b[1] + b[2]*Sex[1:N] + b[3]*Income[1:N]; } model { Y[1:N] ~ normal(mu[1:N], sigma); } generated quantities { vector[N] epsilon = Y[1:N] - mu[1:N]; } and the R-code model2 The resulting histogramm is shown below: If you want to have a look at the data, here is the link to the dataset : dataset .
