[site]: stackoverflow
[post_id]: 5118874
[parent_id]: 5118711
[tags]: 
Using transactions as you suggest with your pseudocode will solve this, but make sure to set you transaction isolation level to TRANSACTION_REPEATABLE_READ. See this tutorial for details. You also need to think abount: Never, never, never store plain text passwords in the database. You need to use a one-way hash. Also, make sure to pay attention to the hashing-algorithm and implementation. Search for "HBGary" and "Anonymous" to read about what might happen if you don't. Think about what will happen if the user logs in to one server, and the client crashes before he has a chance to log out.
