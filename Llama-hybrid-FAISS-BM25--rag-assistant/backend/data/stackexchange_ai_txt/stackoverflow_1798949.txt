[site]: stackoverflow
[post_id]: 1798949
[parent_id]: 1798538
[tags]: 
I don't know how the callers are going to be using this, but allocating buffers using new into a auto_ptr<> s might work. It may satisfy criterion 1 (I can't tell without seeing the using code), and could be a pretty fast fix. The big issue is that it uses dynamic memory a lot, and that will slow things down. There's things you can do, using placement new and the like, but that may not be quick to code. If you can't use dynamic storage, you're limited to non-dynamic storage, and there really isn't much you can do without using a rotating pool of buffers or thread-local buffers or something like that.
