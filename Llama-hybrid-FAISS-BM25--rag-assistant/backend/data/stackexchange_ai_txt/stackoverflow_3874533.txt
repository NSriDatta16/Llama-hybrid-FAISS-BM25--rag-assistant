[site]: stackoverflow
[post_id]: 3874533
[parent_id]: 
[tags]: 
What could cause a "color index out of range" error for imagecolorsforindex()?

When doing a patch resize to a big bunch of JPG, PNG and GIF files, PHP drops dead quite unexpectedly with the following error message: imagecolorsforindex() [function.imagecolorsforindex]: Color index 226 out of range The relevant code fragment is: protected function preserveTransparency($img, $resized, $ftype) { if (($ftype == IMAGETYPE_PNG) || ($ftype == IMAGETYPE_GIF)) { $tidx = imagecolortransparent($img); if ($tidx >= 0) { $transColor = imagecolorsforindex($img, $tidx); $tidx = imagecolorallocate($resized, $transColor['red'], $transColor['green'], $transColor['blue']); imagefill($resized, 0, 0, $tidx); imagecolortransparent($resized, $tidx); } elseif ($ftype == IMAGETYPE_PNG) { imagealphablending($resized, false); imagesavealpha($resized, true); $transparent = imagecolorallocatealpha($resized, 255, 255, 255, 127); imagefill($resized, 0, 0, $transparent); } } } How could a color index not exist if was already returned by imagecolortransparent ?
