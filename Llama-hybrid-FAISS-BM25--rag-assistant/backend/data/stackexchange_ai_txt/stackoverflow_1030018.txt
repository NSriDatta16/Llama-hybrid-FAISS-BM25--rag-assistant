[site]: stackoverflow
[post_id]: 1030018
[parent_id]: 
[tags]: 
location.hash oddness in Safari 4

location.hash seems to be utterly broken in Safari 4: It can be set initially, but cannot be set in any event as far as I can tell, whether that event is triggered by a user action or a timer. Here's an example (I use jQuery here for brevity, but I can't imagine that this problem is jQuery-specific): Click the link below to make this text bold. Bold it! $(document).ready(function() { location.hash = '#normal'; // this works in all browsers $('a').click(function() { $('#test').css({'font-weight': 'bold'}); location.hash = '#bold'; // this fails in Safari 4 return false; // prevents link href from affecting hash }); setInterval(function() { if (! location.hash.match('bold$')) { $('#test').css({'font-weight': 'normal'}); } $('#hashValue').html(location.hash); }, 100); }); In Firefox, the behavior is what you'd expect: When you load the page, the hash is set to #normal. When you click the link, the text becomes bold and the hash is set to #bold . Because the hash has been changed, the interval function has no effect. If you change the hash in the address bar to something else (that doesn't end in bold ), the text gets un-bolded. This lets the back button work intuitively: Click back to where the hash is #bold , and the text becomes bold. Click to anywhere else, and the text is un-bolded. But in Safari 4, the behavior is: When you load the page, the hash is set to #normal. And then it will stay that way forever, as far as the address bar is concerned. When you click the link, the text will become bold, and will stay that way, even though the hash in the address bar hasn't changed. So, location.hash is changed internally (as the hashValue paragraph reflects). This inconsistency with the address bar has dire consequences: If you click the back button, the text is un-bolded; but if you click the forward button after that, it doesn't get re-bolded! This totally breaks JavaScript history libraries, such as the jQuery history plugin . Any fixes? Any workarounds? I tested this in Safari 4.0.1 on a Mac.
