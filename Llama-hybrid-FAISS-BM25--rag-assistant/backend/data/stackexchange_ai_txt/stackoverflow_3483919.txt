[site]: stackoverflow
[post_id]: 3483919
[parent_id]: 
[tags]: 
script onload/onerror with IE(for lazy loading) problems

I'm rebuilding my lazy loader module to accept asyncronus request but i have a BIG problem: internet explorer don't support script.onload/onerror!!! The old script did globally eval the target script source read with an ajax sync call, it works very well,it's cross browser and i can make it async editing 1 variable but it's very tricky to debug(ALL the source code is executed in one single line and the browser gives not to much infos about the errors,dividing the code by line with a regexp is IMPOSSIBLE because js have blocks with infinite depth and regexp are simply not good at this). This is the code that i use to create the script(a classic): var script = document.createElement('script'); script.type = 'text/javascript'; script.src =name; script.name =name; script.async = true; script.onload= ; script.onerror= ; it won't work on IE because it doesen't support onload and onerror with the script; the code below is a fix but works only if the script isn't async if(script.onreadystatechange!==undefined)//only IE T_T script.onreadystatechange = function() { if (script.readyState == 'loaded')//ERROR LOADING ; else if(script.readyState == 'complete')//loaded ; }; i can test it every X milliseconds until the script is loaded but it's an ugly solution and i want to avoid it. EDIT: this is the code i tryed to check every X ms if the script is loaded, it's not that bad and it works better than ajax;the problem is that i can't know if the script is loaded with success or with error(onload or onerror). var script = document.createElement('script'); script.type = 'text/javascript'; script.src =name; script.name =name; script.async = true; script.onload=function(){Lazy_loader.onload(this);}; script.onerror=function(){Lazy_loader.onerror(this);}; if(script.onreadystatechange!==undefined){//ie fix T_T script.timer=setInterval(function(){ if (script.readyState == 'loaded' || script.readyState == 'complete')}//ERROR LOADING if(LOADED???)//loaded Lazy_loader.onload(script); else Lazy_loader.onerror(script); clearInterval(script.timer); } },100); } document.getElementsByTagName('head')[0].appendChild(script); i tryed to use addEventListener/attachEvent functions but it didn't seem to work(even using addEvent functions from the web) summarizing the options seems to be: Use AJAX and global eval to load the script(debugging hell) Use AJAX and global eval only with IE(may be a solution,i don't use IE) Use AJAX and global eval only if the script contains errors(i need to check timings problems because with my code i "simulate" syncronous code even if the call is async) Test script.onreadystatechange (only on IE) every X time until it's loaded(UGLY!!!) Use window.onload : AVOID,it need to charge ALL the page,i need to call it when ONLY one script is launched(see details on endpage) Add a code on the source of each script (AVOID like said on endpage) fix the script.onload for IE(using addEventListener/attachEvent?!?) PLEASE PAY ATTENTION: i don't want to use window.onload because it's fired only when ALL the page is loaded,i need to fire it when only the target script is loaded(my lazy loading script is a lot more complex so please don't ask why); i DO NOT WANT to use ANY third party library(like jquery,prototype,etc.) , i don't even want to edit the target script source(like when using JSPON or adding a script to alert that the script is loaded). Hope that's not too much! Thanks.
