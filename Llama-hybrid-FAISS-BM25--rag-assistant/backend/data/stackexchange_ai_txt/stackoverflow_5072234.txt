[site]: stackoverflow
[post_id]: 5072234
[parent_id]: 
[tags]: 
sorl-thumbnail won't delete thumbnails

Having issues with SORL Thumbnail and deleting thumbnails files or refreshing thumbnails when a file is overwritten. The scenario is that I have a file that for each entry is always the same but can be overwritten. Need the thumbnail to be recreated when a new file is uploaded and the old file is overwritten. This is at the model + form level so I'm using the low level API to generate thumbs. Have tried using: from sorl.thumbnail import delete delete(filename) But with no success, the thumbnail is never deleted or overwritten. I have even tried: from sorl.thumbnail.images import ImageFile from sorl.thumbnail import default image_file = ImageFile(filename) default.kvstore.delete_thumbnails(image_file) Again with no success. Please help! Update: I found a work around by creating an alternate ThumbnailBackend and a new _get_thumbnail_filename method. The new method uses a file's SHA-1 hash to always have a thumbnail specific to the current file. Here's the backend for anyone else that might encounter a similar scenario. class HashThumbnailBackend(ThumbnailBackend): def _get_thumbnail_filename(self, source, geometry_string, options): """ Computes the destination filename. """ import hashlib # hash object hash = hashlib.sha1() # open file and read it in as chunks to save memory f = source.storage.open(u'%s' % source, 'rb') while True: chunk = f.read(128) if not chunk: break hash.update(hashlib.sha1(chunk).hexdigest()) # close file f.close() hash.update(geometry_string) hash.update(serialize(options)) key = hash.hexdigest() # make some subdirs path = '%s/%s/%s' % (key[:2], key[2:4], key) return '%s%s.%s' % (settings.THUMBNAIL_PREFIX, path, self.extensions[options['format']])
