[site]: stackoverflow
[post_id]: 762222
[parent_id]: 761700
[tags]: 
I can see only one approach that extracts the data as specified from the call records: Create a list of events, where event is defined as the beginning of a call or the end of a call. (Thus each call record will generate two events.) Each event item should contain: system, datetime, and the boolean begin/end. Datetime should be rounded down to the nearest minute. Sort this list by (system, datetime) and scan it. For each call begin, increment CURCNT by one. For each call end, decrement CURCNT by one. If the datetime value is different from the previous record, add CURCNT to HOURSUM. If the datetime value indicates the start of a new hour, divide HOURSUM by 60, write a new result record (system, date, hour, average), and reset HOURSUM to zero. It should be obvious when to initialize CURCNT and HOURSUM, what to do when the system value is different from the previous record, etc. -Al.
