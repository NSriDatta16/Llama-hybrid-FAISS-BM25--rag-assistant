[site]: stackoverflow
[post_id]: 3080560
[parent_id]: 
[tags]: 
C++ TLS, somethings wrong

I'm learning about Thread Local Storage... (TLS) Here is my TLS Alloc code: //global variable DWORD g_dwTlsIndex; //inside DLLMain: int val= 5; switch (ul_reason_for_call) { case DLL_PROCESS_ATTACH: g_dwTlsIndex = TlsAlloc(); if ((g_dwTlsIndex = TlsAlloc()) == TLS_OUT_OF_INDEXES) { printf("No more indexes available"); } void *pint; memcpy(&pint, &val, sizeof val); TlsSetValue(g_dwTlsIndex, pint); break; Now I try to get the value from the TLS: (in another CPP file) // declare index value... extern DWORD g_dwTlsIndex; int data; LPVOID d; d = TlsGetValue(g_dwTlsIndex); memcpy(&data, &d, sizeof d); printf("Data: %d", data); But data contains 0, where I put 5 in it.... What have I done wrong?
