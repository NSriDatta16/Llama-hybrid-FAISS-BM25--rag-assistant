[site]: crossvalidated
[post_id]: 628207
[parent_id]: 628148
[tags]: 
IMO, there is quite a jump in the original paper from $Var(mr)$ to $\mathbb{E}_{\Theta, \Theta'}[\text{Cov}_{X, Y}[rmg(\Theta, X, Y)rmg(\Theta', X, Y)]]$ , and I think that is the most troublesome part of the proof. The remainder of the derivation uses fairly standard facts about correlation and covariance. Luckily, the intermediate steps are mostly algebra. From this point onward, I'll abbreviate variance to $\mathbb{V}$ and try to be as explicit as possible about what variables that expectations, variances, and the like are taken with respect to. Here are some starting assumptions/definitions that we will use: [A1] The generalization error $PE^*$ is at most $\mathbb{V}_{X, Y}(mr(X, Y)) / s^2$ . [A2] We have that $mr(X, Y) \triangleq \mathbb{E}_{\Theta}[rmg(\Theta,X,Y)]$ (the function $rmg(\Theta, \cdot, \cdot)$ is defined in this way). [A3] Similarly, we also know that $(mr(X,Y))^2 = \mathbb{E}_{\Theta, \Theta'}[rmg(\Theta,X,Y)rmg(\Theta', X,Y)]$ , where $\Theta, \Theta'$ are some parameters for each tree in the random forest. [A4] The correlation coefficient $\bar{\rho}$ is defined as the average correlation (over all $\Theta, \Theta'$ ) between $rmg(\Theta, X, Y)$ and $rmg(\Theta', X, Y)$ , or $\mathbb{E}_{\Theta, \Theta'}[\rho(rmg(\Theta, X, Y), rmg(\Theta', X, Y))]$ , as $X, Y$ vary. This is all based on definitions from the paper that you've stated in your question. To show the final result, it is sufficient to prove that $\mathbb{V}_{X, Y}(mr(X, Y)) \leq \bar{\rho}(1 - s^2)$ ( [A1] ). Recall that the variance of random variable can be written as $$\mathbb{V}_{X, Y}(mr(X, Y)) = \mathbb{E}_{X, Y}(mr(X, Y)^2) - \mathbb{E}_{X, Y}(mr(X, Y))^2.$$ Substituting using [A2] and [A3] : $$\mathbb{V}_{X, Y}(mr(X, Y)) = \mathbb{E}_{X, Y}(\mathbb{E}_{\Theta, \Theta'}[rmg(\Theta,X,Y)rmg(\Theta', X,Y)]) - \mathbb{E}_{X, Y}(\mathbb{E}_{\Theta}[rmg(\Theta,X,Y)])\mathbb{E}_{X, Y}(\mathbb{E}_{\Theta'}[rmg(\Theta',X,Y)]).$$ We can switch the ordering of expectations and combine terms of the form $\mathbb{E}_\Theta[(\cdot)] {\mathbb{E}_\Theta'}[(\cdot)]$ via independence (if this isn't straightforward, try to derive the following equation as an exercise), showing that the preceding is equal to $$\mathbb{E}_{\Theta, \Theta'}[\mathbb{E}_{X,Y}[rmg(\Theta,X,Y)rmg(\Theta', X,Y)] - \mathbb{E}_{X, Y}[rmg(\Theta,X,Y)]\mathbb{E}_{X, Y}[rmg(\Theta',X,Y)]] = \mathbb{E}_{\Theta, \Theta'}[Cov_{X, Y}(rmg(\Theta,X,Y), rmg(\Theta',X,Y))]. $$ where we simply applied the definition of covariance ( i.e. , $Cov(X,Y) = \mathbb{E}[XY] - \mathbb{E}[X]\mathbb{E}[Y]$ ) to the term inside the outer expectation (the one w.r.t. $\Theta, \Theta'$ ). An application of the correlation-covariance formula yields $$\mathbb{E}_{\Theta, \Theta'}[Cov_{X, Y}(rmg(\Theta,X,Y), rmg(\Theta',X,Y))] = \mathbb{E}_{\Theta, \Theta'}\left[\rho(rmg(\Theta,X,Y), rmg(\Theta',X,Y))\sqrt{\mathbb{V}_{X, Y}(rmg(\Theta,X,Y))\mathbb{V}_{X, Y}(rmg(\Theta',X,Y))}\right],$$ and since the $\rho(\cdot, \cdot)$ term doesn't depend on $\Theta, \Theta'$ (the correlation is evaluated over $X, Y$ for a fixed $\Theta, \Theta'$ pair), we can break apart the expectation and substitute [A4] , yielding $$\mathbb{V}_{X, Y}(mr(X, Y)) = \bar{\rho}\mathbb{E}_{\Theta, \Theta'}\left[\sqrt{\mathbb{V}_{X, Y}(rmg(\Theta,X,Y))}\right] \mathbb{E}_{\Theta, \Theta'}\left[\sqrt{\mathbb{V}_{X, Y}(rmg(\Theta',X,Y))}\right] \\= \bar{\rho}\mathbb{E}_{\Theta}\left[\sqrt{\mathbb{V}_{X, Y}(rmg(\Theta,X,Y))}\right]^2 \\\leq \bar{\rho}\mathbb{E}_{\Theta}\left[\mathbb{V}_{X, Y}(rmg(\Theta,X,Y))\right].$$ This is exactly the term you notate as $\hat{\rho}\mathbf{E}_\Theta[Var(\Theta)]$ . If the final inequality isn't clear, try to justify that to yourself as well ( Hint: recall the definition of variance. We know that $Var(X) \geq 0$ as well; what else does that imply?). We only have only last step -- to show that $\mathbb{E}_{\Theta}\left[\mathbb{V}_{X, Y}(rmg(\Theta,X,Y))\right] \leq 1 - s^2$ . We can rewrite the variance term as follows: $$\mathbb{E}_{\Theta}\left[\mathbb{V}_{X, Y}(rmg(\Theta,X,Y))\right] = \mathbb{E}_{\Theta}\left[\mathbb{E}_{X, Y}[rmg(\Theta,X,Y)^2]\right] - \mathbb{E}_{\Theta}\left[\mathbb{E}_{X, Y}[rmg(\Theta,X,Y)]^2\right].$$ First, since $\mathbb{E}_{X, Y}[mr(X, Y)]$ is defined as $s$ , we can use [A2] and replace the 2nd term with $s^2$ . For the first term, we know that $rmg(\Theta,X,Y)^2 \in [0, 1]$ for any choice of $\Theta, X, Y$ (since $rmg(\cdot)$ itself is either -1 or 1), so $\mathbb{E}_{\Theta}\left[\mathbb{E}_{X, Y}[rmg(\Theta,X,Y)^2]\right]$ is at most 1 (if this isn't clear, try substituting in the definitions for $mr(\cdot), rmg(\cdot)$ , and thinking about what the requisite indicators/probabilities could be). This yields $$\mathbb{E}_{\Theta}\left[\mathbb{V}_{X, Y}(rmg(\Theta,X,Y))\right] \leq 1 - s^2.$$ Hence, $\mathbb{V}_{X, Y}(mr(X, Y)) \leq \bar{\rho}(1 - s^2)$ , and one last substitution yields the conclusion that $$PE* \leq\frac{ \bar{\rho}(1-s^2)}{s^2}$$ as desired.
