[site]: crossvalidated
[post_id]: 471257
[parent_id]: 
[tags]: 
NLS analysis in R with timeseries data to remove known effect

I have a timeseries dataset collected by sensors. The data is crack displacement ( disp ) and temperature ( temp ). Thermal expansion is linear with temperature, so it causes a diurnal signature in my displacement data. I would like to remove the effect from temperature. I'm an engineer, not a statistician, so I am uncertain that I am doing it correctly. I've used R's nls function to remove the known effect of temperature. I used a sin wave with 24-hour period. I also used a shift parameter (phi) in the function to shift the wave (because the temp sensor responds faster than the disp sensor which is mounted on concrete that takes awhile to heat and cool). My questions are: Am I doing this correctly? Is there a better way? Note that I do not want to predict crack displacement, I want to remove effects of temperature and see the underlying 'unexplained' displacement. I've developed a pseudo time series that somewhat mimics my data. Here is my code (requires package lubridate ): # create 1 hour timeseries 1 week long dat $disp TIMESTAMP)) + runif(n = nrow(dat), min = -0.2, max = 0.2) dat $temp TIMESTAMP)) * runif(n = nrow(dat), min = 0, max = 5) + 20 plot(dat $TIMESTAMP, dat$ disp) plot(dat $TIMESTAMP, dat$ temp) # Add a trend to displacement - this is the unexplained displacement that I am looking for dat $disp disp + seq(from = 0, to = 1, length.out = nrow(dat))*rnorm(1) # Equation for nls: # D = b0 + b1*T + b2*sin(omega*t + phi) # D = predicted displacement # T = temperature # omega = angular frequency = 2*pi / 24 # t = time of day (1...24) # phi = time shift between temperature and displacement # b0, b1, b2 are fitting parameters # Provide starting parameters for nls() b0 $tod TIMESTAMP) # model fit $res fit $res ~ dat$ TIMESTAMP) # plot original data plot(dat $TIMESTAMP, dat$ disp) # plot residuals (the 'unexplained' part of displacement) points(dat $TIMESTAMP, dat$ res, col = 'red') # plot the fitted values (the 'thermally explained' part of displacement) points(dat $TIMESTAMP, dat$ fit, col = 'green') # add slope line through the residuals (movement not caused by thermal effects) abline(a = fit2 $coefficients[1], b = fit2$ coefficients[2]) ```
