[site]: crossvalidated
[post_id]: 213374
[parent_id]: 
[tags]: 
R: estimate joint density and sample from conditional densities

I'm trying to implement an algorithm that estimates time-homogeneous Markov chain with continuous state space. The probability of transition from state $i$ to state $i+1$ has continuous conditional PDF $\mu(x_{i+1}|x_i)$. Suppose I have $N$ observations of transitions between states, i.e. $(x_i,x_{i+1}), i=1..N$. I need to obtain continuous PDFs $\mu(x_{i+1}|x_i)$(forward) and $\mu(x_i|x_{i+1})$(backward) to sample from. What I did: To obtain forward density I have generated joint density $\mu(x_i,x_{i+1})$ from these $N$ observations, and expect to generate marginal densities $f(x_i)$, $g(x_{i+1})$ using first and second values from these pairs. Then my conditional densities should be $$\mu(x_{i+1}|x_i) = \frac{\mu(x_i,x_{i+1})}{f(x_i)}, \ \ \mu(x_i|x_{i+1}) = \frac{\mu(x_i,x_{i+1})}{g(x_{i+1})}. $$ So the first question is whether it is a correct approach or not? I've made a test implementation on R using library(ks) that Google gives as the most relevant for joint densities. It works strange, R session crashes if I try to set interval bigger than $(-6,6)$ for $x$. Thus in my second question I'm asking for some efficient way to do this in $R$, because I suppose to re-evaluate the densities many times during estimation and then somehow sample from them. # Generating 2-D density sample (from ks tutorial) library(ks) set.seed(8192) samp UPD: So i tried two ways to sample from it: Metropolis - Hastings algorithm and Samplepdf algorithm The results are the following: Here is the actual conditional density (no crash for -7..5) # creating function for conditional density with one fixed coordinate conditional_density_y Trying to sample using Metropolis - Hastings algorithm library(mcmc) myL The right histogram indicates the interesting bug I observed presence of the initial value 0.5 in the sample, that should be filtered (see below). Also I found that number of transitions of the chain nbatch should not me less than 100. The best thing is to pick 100th observation on each try: # Taking another sample --------------------------------------------------------- # creating function for conditional density with one fixed coordinate conditional_density_y Trying to sample using Samplepdf algorithm Works much longer, only possible for sample size = 10, because it's stopping from roundoff errors. Setting subdivisions and accuracy doesn't help. The question about the initial correctness and optimality of the approach is still actual.
