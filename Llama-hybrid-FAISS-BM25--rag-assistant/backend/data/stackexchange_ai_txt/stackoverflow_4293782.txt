[site]: stackoverflow
[post_id]: 4293782
[parent_id]: 
[tags]: 
Why does local storage save last after javascript

Im currently trying to save the tab.url into html5 local storage when the programme loads then update a css file into the header based on a rule, which are all easy to do. But for some reason the popup.html loads the previous local storage variable and not the recent one. I was wondering if anyone can help me on this, the code that im using is this; var rule; var links; var search; function loadcssfile(filename, filetype) { if (filetype == "css") { var fileref=document.createElement("link"); fileref.setAttribute("rel", "stylesheet"); fileref.setAttribute("type", "text/css"); fileref.setAttribute("href", filename); } if (typeof fileref != "undefined") { document.getElementsByTagName("head")[0].appendChild(fileref); } } function loaded() { chrome.tabs.getSelected(null,function(tab) { var temp; temp = tab.url; localStorage['tab'] = temp; console.log(temp); }); links = localStorage['tab']; rule = localStorage['ok0']; search = links.indexOf(rule); if(search != -1) { loadcssfile("./css/styles.css","css"); loadcssfile("./button/styles2.css","css"); } else { // or load other css file } } document.getElementById('datacontent').innerHTML = rule + " " + links + " " + search; function createXMLHttpRequest() { if (window.ActiveXObject) { xmlHttp = new ActiveXObject("Microsoft.XMLHTTP"); } else if (window.XMLHttpRequest) { xmlHttp = new XMLHttpRequest(); } } function createXMLHttpRequest2() { if (window.ActiveXObject) { xmlHttp2 = new ActiveXObject("Microsoft.XMLHTTP"); } else if (window.XMLHttpRequest) { xmlHttp2 = new XMLHttpRequest(); } } function handleStateChange1() { if(xmlHttp.readyState == 4 && xmlHttp.status == 200 ) { var data; data = xmlHttp.responseText; document.getElementById('container').innerHTML = data; } } function senddata(id) { createXMLHttpRequest(); xmlHttp.onreadystatechange = handleStateChange1; xmlHttp.open("GET", "http://weblinkchecker.forum-source.tk/crawler.php?link=" + links.replace('&','0123456789abcdef'), true); xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); xmlHttp.send("&type=anythinghere&anothervar=datahere"); document.getElementById(id).innerHTML = "Successful !"; } function handleStateChange2() { if(xmlHttp2.readyState == 4 && xmlHttp2.status == 200 ) { var data; data = xmlHttp2.responseText; document.getElementById('container2').innerHTML = data; } } function sendForLinks() { createXMLHttpRequest2(); xmlHttp2.onreadystatechange = handleStateChange2; xmlHttp2.open("GET", "http://weblinkchecker.forum-source.tk/links.php?link=" + links.replace('&','0123456789abcdef'), true); xmlHttp2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); xmlHttp2.send("type=anythinghere&anothervar=datahere"); } window.onload = function() { loaded(); } As you can see its a web link checker, there is a bit css that I didn't upload, also there a lot of php using ajax but none of that is having an affect on the code and I also removed any innerHTML functions. Sorry for having such a large piece of code. if any one could tell me why html5 local storage is saving last it would be a huge help. I tried echoing out data and it just gives out the old data and not the recent. I feel like I hit a brick wall with this one.
