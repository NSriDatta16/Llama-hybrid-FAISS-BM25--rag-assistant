[site]: stackoverflow
[post_id]: 5148623
[parent_id]: 5147803
[tags]: 
EDIT : Small refactor and extended explanation. This stylesheet: Output: Here is some text about some guy who made fascinating comment I want to quote So I went to this place and met this guy.... It seemed more interesting at the time. Note : Identity rule for overwriting (just for style, but it's a good pattern). Four direct transformation rules matching footnote , emphasis , @role attribute of emphasis and blockquote . Grouping key matching "inline" para 's children: the generate id of first preceding "block" element or para parent. Grouping rule for para applying templates to self and "block" elements in "group" mode. Rule matching para in "group" mode (also named makePara ): output a paragraph if there is a group with context node generate id as key value. Rule matching any element in "group" mode (it'll be any "block" element): apply templates to self ("reset" mode) and call makePara named template.
