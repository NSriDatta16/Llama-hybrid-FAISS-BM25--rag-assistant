[site]: stackoverflow
[post_id]: 2372638
[parent_id]: 2372468
[tags]: 
It seems that your pattern is not correct. Consider the case when thread #1 executes till after the first #pragma flush . Then the control switches to the thread #2, which goes on and creates a c , the control is taken back just before second #pragma flush . Now the first thread wakes up, and creates the child anew. Edit: sorry, wrong: it will be unable to take the lock. Edit 2: no, still correct, because the value will be not flushed in thread #1
