[site]: stackoverflow
[post_id]: 4698469
[parent_id]: 
[tags]: 
how to detect that Windows finished adding/removing storage devices (not as drive letters, only as devices)

I have some computers with a simplified Windows in which storage devices that are added/removed don't get automatically drive letters. So I have to find a way to detect that are added/removed. One way (that I know) is with WM_DEVICECHANGE message. On those computers the message is sent to windows only with WParam 7 and LParam 0. So I could run my detection code when this message is received by my application. The problem is that it takes some time for the device to be completely recognized; meantime my application is "bombarded" with a "salvo" of WM_DEVICECHANGE messages and the detection code is started even 6..7 times. To solve I could add a timer who is reinitialized by a new message; if, after some time (1..2 sec), the application is not receiving the message, the detection code is started. But I don't like this approach 100% because it doesn't take into consideration other factors as: the speed of the computer, other programs that slow down Windows, different storage device types etc. And the fact that the detection code finishes after a delay it's a little annoying. Does anybody know a more professional solution...? Thank you for any help.
