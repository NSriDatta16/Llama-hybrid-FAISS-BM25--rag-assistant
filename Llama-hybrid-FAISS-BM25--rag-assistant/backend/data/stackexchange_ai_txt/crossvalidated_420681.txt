[site]: crossvalidated
[post_id]: 420681
[parent_id]: 420350
[tags]: 
The problem is not so much to determine a sample size--that is specified as $30$ --as it is to allocate the sampling budget to the strata. Let's solve this problem from first principles--the same ones used to develop the standard sample size formulas. This answer, although developed for wide application, focuses throughout on the situation of sampling a small stratified population, where potentially the sample may include appreciable subsets of some strata; the usual asymptotic formulae might not be adequate; and we should expect to apply "finite population correction factors" to those formulae. These factors will show up in the form $n_i-k_i$ at places where we might otherwise expect to see $n_i$ alone. The fundamental ideas that we need to employ come down to these: Because the objective is to estimate the total industry cleanup expenditure (presumably during a well-defined period), it would be good to find a sampling procedure--among all the possible sample designs--that comes close to minimizing the variance of that estimate. The variance depends both on the sample design and on the distributions of total expenditures within each sampling stratum. To analyze and understand the implications, let's begin with some notation. The population is the disjoint union of strata $\mathcal{S}_i,$ $i=1, 2, \ldots, m=9.$ Stratum $i$ includes $n_i \ge 1$ companies--and you know, with no uncertainties, what stratum each company is in. This enables us to designate companies by a pair of indices: $i$ for its stratum and a second index $j$ running from $1$ to $n_i$ for the company itself. The cleanup expenditure for company $(i,j)$ is $z_{ij}$ (and the company will assess and report this value accurately, with no error). Let $T$ be the total expenditure. A stratified (simple random) sampling plan will independently sample $k_i$ (a number between $1$ and $n_i$ inclusive) of the companies in stratum $\mathcal{S}_i$ without replacement. Let $X_{ij}$ be the binary random variable indicating whether company $(i,j)$ is in the sample. The best (least-variance) estimator of the total expenditure in each stratum is the average expenditure observed in the sample, multiplied by the stratum size $n_i:$ $$\widehat T = \sum_{i=1}^m n_i\left( \frac{1}{k_i} \sum_{j=1}^{n_i} X_{ij} z_{ij} \right) = \sum_{i=1}^m\sum_{j=1}^{n_i} \frac{n_i z_{ij}}{k_i} X_{ij}.$$ Idea $(1)$ above requires us to develop an expression for the variance of this estimator. The independent choices of samples without replacement in each stratum determine this variance because (a) independence allows us to compute the variance as a sum of contributions within each stratum and (b) sampling without replacement implies $$E[X_{ij}] =\frac{k_i}{n_i}$$ (each company has a $k_i/n_i$ chance of being in the sample) and when $k\ne j,$ $$\eqalign{ E[X_{ij} X_{ik}] &= \Pr(j\text{ in the sample and } k\text{ in the sample})\\ &= \Pr(j\text{ in the sample} \mid k\text{ in the sample})\Pr(k\text{ in the sample})\\ &= \frac{k_i-1}{n_i-1}\frac{k_i}{n_i}. }$$ Consequently for $k\ne j$ $$\operatorname{Cov}(X_{ij}, X_{ik}) = E[X_{ij} X_{ik}] - E[X_{ij}]E[X_{ik}] = -\frac{k_i(n_i-k_i)}{n_i^2(n_i-1)}.$$ When $k=j,$ $$\operatorname{Cov}(X_{ij}, X_{ik}) = \operatorname{Var}(X_{ij}) = E[X_{ij}^2] - E[X_{ij}]^2 = \frac{k_i(n_i-k_i)}{n_i^2}.$$ A useful way to express all covariances at once employs the Kronecker delta $\delta_{jk}$ which is equal to $1$ when $j=k$ and otherwise is zero. This enables the two different expressions $-1/(n_i-1)$ and $1$ to be written $$\frac{\delta_{jk} n_i - 1}{n_i-1} = \left\{\matrix{-\frac{1}{n_i-1} & j\ne k \\ 1 & j=k.}\right.$$ The covariance of any two terms that form the expression for $\hat T$ is zero when they come from different strata; and in a common stratum $\mathcal{S}_i,$ the foregoing immediately gives $$\eqalign{ \operatorname{Cov}\left(\frac{n_i z_{ij}}{k_i} X_{ij}, \frac{n_i z_{ik}}{k_i} X_{ik}\right) &= \frac{n_i z_{ij}}{k_i} \frac{n_i z_{ik}}{k_i} \frac{k_i(n_i-k_i)}{n_i^2} \frac{\delta_{jk} n_i - 1}{n_i-1} \\ &= \frac{n_i-k_i}{k_i(n_i-1)} z_{ij}z_{ik}(\delta_{jk} n_i - 1) . } $$ These enable the variance of $\widehat T$ (a linear combination of the $X_{ij}$ ) to be computed as $$\operatorname{Var}(\widehat T) = \sum_{i=1}^{m} \frac{n_i-k_i}{k_i(n_i-1)} \left(\sum_{j=1}^{n_i} n_iz_{ij}^2 - \sum_{j,k}^{n_i}z_{ij}z_{ik} \right)= \sum_{i=1}^{m} \frac{n_i-k_i}{k_i}\frac{n_i^2}{n_i-1}\sigma_i^2,\tag{*}$$ where $$\sigma_i^2 = \frac{1}{n_i}\sum_{j=1}^{n_i} z_{ij}^2 - \left(\frac{1}{n_i}\sum_{j=1}^{n_i} z_{ij}\right)^2$$ refers to the variance of that stratum. (In any stratum with $n_i=1,$ necessarily $k_i=1$ which assures that stratum contributes zero to the variance. In effect, a stratum of size $1$ designates a company that will be in the sample no matter what. We may as well ignore all such strata in our analyses and thereby assume $n_i\ge 2$ from now on.) Since the strata are determined, their sizes $n_i$ and their variances are determined, too (although the latter is not known!), leaving the sample sizes $k_i$ as the only quantities left to be determined: you will choose them to minimize $(*)$ so that their total is no greater than your sampling budget $K=30.$ It seems we're at an impasse: the optimal sample sizes depend on properties of the strata, but the purpose of sampling is precisely to estimate properties of the population! The key to progress lies in recognizing that these are different properties: given assumptions you make about the strata variances, you can design a conditionally optimal sampling program for estimating the population total. Let's put off the discussion of those assumptions and suppose you have a sense of the strata variances. In that case, ignoring momentarily the requirement that $k_i\ge 1$ and $k_i$ is integral, a simple application of Lagrange Multipliers shows that when no optimal $k_i$ is less than $1,$ the variance of $\widehat T$ is minimized when sample sizes are nearly proportional to the stratum sizes and standard deviations. Specifically, the squared sample sizes are $$k_i^2\ \propto\ \frac{n_i}{n_i-1} n_i^2\sigma_i^2 = \omega_i^2\tag{1}$$ (this defines the weights $\omega_i^2$ ). Thus, you can meet your sampling budget of no more than $K$ samples by setting $$k_i = \frac{\omega_i}{\sum_{i=1}^m \omega_i} K.\tag{2}$$ If it turns out some of these are less than $1,$ set them to $1$ and re-apply $(1)$ and $(2)$ to the remaining $k_i.$ Iterate (less than $m-1$ times) to a solution. Observations: $(2)$ only depends on the ratios of the stratum variances rather than the variances themselves. Thus, you don't need to know the actual stratum variances--you only need to have a reasonable guess about their relative values. The solution given in $(1)$ and $(2)$ is unlikely to be entirely integral. We need the best integral solution, not the best solution in real numbers. People usually just round the real optimum, but there's no guarantee this will be best. Strictly speaking you need special techniques to find the integral optimum efficiently, but as a practical matter rounding may be good enough. (The code example below goes a little further by exploring all nearby integral solutions, but that still provides no guarantee of finding the very best integral solution.) Provided you don't round down to zero, you can assure every stratum is sampled. (When the solution suggests several $k_i$ ought to be close to zero and less than $1,$ you might consider combining their strata if there's hope those strata have similar average values of $z_{ij}$ and then re-solving the problem with the smaller number of strata.) If you err in estimating the stratum variances, you will wind up with a suboptimal sample-- but it will still be useful. It merely won't achieve the best possible expected variance in the estimate of the total. The example below illustrates this point by comparing solutions based on very different stratum variance estimates. For strata that are not small, $(1)$ says to pick the sample sizes $k_i$ in proportion to $n_i \sigma_i.$ This provides rules of thumb for such special cases. In particular, When you believe the strata variances $\sigma_i^2$ are all roughly the same, the optimum solution is proportional allocation where $k_i \propto n_i.$ When the strata are all roughly the same size, the optimal solution is to devote samples to strata in proportion to their standard deviations, $k_i \propto \sigma_i.$ The initial term $n_i/(n_i-1)$ in $(1)$ indicates that very small strata deserve slightly more samples than otherwise indicated by these rules of thumb. This is due to the rapidly decreasing uncertainty in the stratum total as the sample comes close to exhausting a stratum. To illustrate this analysis and the observations, consider an instance of the original problem in which The stratum sizes are $(n_i) = (4, 10, 19, 29, 40, 53, 67, 87, 96).$ They sum to $N=400.$ The stratum variances are $(\sigma_i^2) = (140,100,74,53,38,27,19,14,10).$ This models a typical situation in which a few small strata exhibit relatively high variances. These strata might be comprised of, say, the largest companies, or of similar companies with the most uncertain liabilities based on some other study. The best non-integral solution to the constrained minimization of the variance of $\widehat T$ is $$k^{*} = (1, 1.59, 2.53, 3.24, 3.76, 4.19, 4.44, 4.65, 4.6).$$ Its first component was set by the constraint $k_1 \ge 1$ and, as intended, the values sum to $K=30.$ Among the $256$ nearby integral values, the best solution among those that sum to $30$ is $$k = (1,2,3,3,4,4,4,5,4).$$ Notice how $k^{*}_9 = 4.6$ was rounded down to $4$ (for otherwise the rounded values would sum to $31,$ which is too large.) As a basis for comparison, suppose you cannot estimate the variances and so you just take them all to be equal (which obviously is a gross error). The best integral solution is $$k_e = (1,1,1,2,3,4,5,6,7).$$ Compared to $k,$ this solution oversamples the high-variance strata and undersamples the low-variance ones. To compare these solutions, consider the variance of $\widehat T$ in each case: for $k$ is is $120857$ while for $k_e$ it is $140618,$ about $16\%$ greater. That means the incorrect estimation of the stratum variances has made its $30$ samples about as effective as $25$ optimally-deployed samples. Considering how wrong the stratum variance estimates were, that's not much of a loss: it indicates both that (1) there is something to be gained from this sample design process but (2) the gains are relatively insensitive to the variance assumptions you need to make to carry it out. Reference Thompson, Steven K. (1992), "Sampling" (Part 1), Wiley. Code This R code created the example. It includes functions that are generally useful for finding optimal stratified samples of small populations. It is practical for up to about $m\approx 20$ strata; beyond that, the brute-force search for integral solutions is too expensive and would have to be replaced by a more sophisticated (branch-and-bound) algorithm or by sampling. # # Find k*, the optimal (non-integral) solution. # ss = 1 repeat { K0 = 1) if (all(j==i)) break i 1])) X 1]
