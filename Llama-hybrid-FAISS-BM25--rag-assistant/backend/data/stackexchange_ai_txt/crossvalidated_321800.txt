[site]: crossvalidated
[post_id]: 321800
[parent_id]: 
[tags]: 
How can I compute a confidence interval for a sample expectation given an unnormalized distribution?

Suppose I have a weight function $w(x)$ defining a probability distribution $P(x)$ for $x \in D$ as $P(x) = \frac{1}{Z}w(x)$, where $Z = \sum_{x'} w(x')$. However, I do not know $Z$ because it is expensive to compute ($D$ is large). I only know how to compute $w(x)$ for any given $x$. In other words, $w(x)$ represents an unnormalized version of $P(x)$. I would like to use sampling to compute $E[f(x)] = \sum_{x\in D} f(x)P(x)$, and to obtain a confidence interval. My question is: how can I compute an estimate and confidence interval for $E[f(x)]$ using only $w(x)$ and not computing $Z$? Here's what I have come up with so far: Let $g(x)$ be the statistic $f(x)w(x)$, and let $\mu_g$ and $\sigma_g$ be its mean and standard deviation. By definition, $\mu_g = \frac{\sum_{x \in D} f(x)w(x)}{|D|}$. I can compute an estimator $\hat{\mu}_g = \frac{\sum_{i=1}^n f(x_i)w(x_i)} {n}$, for $x_i \sim Uniform[D]$. By the Central Limit Theorem, $\hat{\mu}_g$ is normally distributed with mean $\mu_g$ and standard error $\sigma_g/\sqrt{n}$. Update : a comment pointed out that this will work poorly with just sampling from the uniform distribution if the density is concentrated in some small region. This is true. I could instead exploit structure in $w$ and use importance sampling, or even MCMC. The issues presented here would remain, though. I believe this is a completely orthogonal topic. End of update. I can define an estimator $\hat{E}[f(x)]= \frac{|D|}{Z} \hat{\mu}_g$. Because $\hat{\mu}_g$ is normally distributed with mean $\mu_g$ and standard error $\sigma_g/\sqrt{n}$, we have that $\hat{E}[f(x)]$ is normally distributed with mean $\frac{|D|}{Z}\mu_g$ and standard error $\frac{|D|}{Z}\sigma_g/\sqrt{n}$. Note that, because $\mu_g = \frac{\sum_{x \in D} f(x)w(x)}{|D|}$, $$\frac{|D|}{Z}\mu_g = \frac{|D|}{Z}\frac{\sum_{x \in D} f(x)w(x)}{|D|}$$ $$ = \sum_{x \in D} f(x)\frac{w(x)}{Z}$$ $$ = \sum_{x \in D} f(x)P(x)$$ $$ = E[f(x)],$$ so $\hat{E}[f(x)]$ is normally distributed with mean $E[f(x)]$ and standard error $\frac{|D|}{Z} \sigma_g/\sqrt{n}$. This almost fulfills my goals; I now have an estimator $\hat{E}[f(x)]$ for $E[f(x)]$, and its standard error, so I can compute a confidence interval. However, the standard error of $\hat{E}[f(x)]$ depends on $Z$, which I cannot compute. To deal with this, we can define an estimator $\hat{\mu}_w = \frac{\sum_i w(x_i)}{n}$ for $\mu_w$, which by definition is $\frac{\sum_{x \in D} w(x)}{|D|} = \frac{Z}{|D|}$. This means that $\hat{\mu}_w$ is normally distributed with mean $\frac{Z}{|D|}$ and standard error $\sigma_w/\sqrt{n}$. We can use $\hat{\mu}_w$ to define an estimator $\hat{Z} = |D|\hat{\mu}_w$. Because $\hat{\mu}_w$ is normally distributed with mean $\frac{Z}{|D|}$ and standard error $\sigma_w/\sqrt{n}$, $\hat{Z}$ is normally distributed with mean $|D|\frac{Z}{|D|}=Z$, and standard error $|D|\sigma_w/\sqrt{n}$. Now, I would like to estimate the standard error of $\hat{E}[f(x)]$ by $\frac{|D|}{\hat{Z}} \sigma_g/\sqrt{n}$ (note the substitution of $\hat{Z}$ for $Z$), so I can compute its confidence interval. However, it seems that simply plugging $\hat{Z}$ in place of $Z$, and ignoring $\hat{Z}$'s own standard error, seems incorrect. I think I have to take $\hat{Z}$'s own standard error into account and find a confidence interval for $\hat{E}[f(x)]$ that reflects the uncertainty about $Z$. It's at this point that I'm stuck. What do people usually do in situations like this? (Perhaps simply pretending $\hat{Z}$ is $Z$ makes sense; it is similar to using a sample standard deviation instead of the true standard deviation when computing the standard error, after all).
