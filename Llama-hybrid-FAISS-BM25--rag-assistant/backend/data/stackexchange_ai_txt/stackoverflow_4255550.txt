[site]: stackoverflow
[post_id]: 4255550
[parent_id]: 
[tags]: 
Low FPS when accesing iPhone video output image buffer

I'm trying to do some image processing on iPhone. I'm using http://developer.apple.com/library/ios/#qa/qa2010/qa1702.html to capture the camera frames. My problem is that when I'm trying to access the captured buffer, the camera FPS drops from 30 to about 20. Does anybody knows how I can fix it? I use the lowest capture quality I could find (AVCaptureSessionPresetLow = 192x144) in kCVPixelFormatType_32BGRA format. If anybody knows a lower quality I could use, I'm willing to try it. When I do the same image access on other platforms, like Symbian, it works OK. Here is my code: #pragma mark - #pragma mark AVCaptureSession delegate - (void)captureOutput:(AVCaptureOutput *)captureOutput didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection *)connection { /*We create an autorelease pool because as we are not in the main_queue our code is not executed in the main thread. So we have to create an autorelease pool for the thread we are in*/ NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init]; CVImageBufferRef imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer); //Lock the image buffer if (CVPixelBufferLockBaseAddress(imageBuffer, 0) == kCVReturnSuccess) { // calculate FPS and display it using main thread [self performSelectorOnMainThread:@selector(updateFps:) withObject: (id) nil waitUntilDone:NO]; UInt8 *base = (UInt8 *)CVPixelBufferGetBaseAddress(imageBuffer); //image buffer start address size_t width = CVPixelBufferGetWidth(imageBuffer); size_t height = CVPixelBufferGetHeight(imageBuffer); int size = (height*width); UInt8* pRGBtmp = m_pRGBimage; /* Here is the problem; m_pRGBimage is RGB image I want to process. In the 'for' loop I convert the image from BGRA to RGB. As a resault, the FPS drops to 20. */ for (int i=0;i As a follow-on to the answers, I need to process the image in realtime, it is being displayed. I noticed that when I use AVCaptureSessionPresetHigh, the most simple thing I do, like: for (int i=0;i causes the framerate to drop to 4-5 FPS. I guess its because an image in that size is not cached. Basically I need 96x48 image. is there a simple way to downscale the camera output image, a way that uses hardware acceleration, so I could work with the small one?
