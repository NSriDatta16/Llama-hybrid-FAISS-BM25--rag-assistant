[site]: crossvalidated
[post_id]: 398640
[parent_id]: 398436
[tags]: 
What is described is a classical case of an A/B experiment where we have dependence between users and items (purchases here); we need to account for this because otherwise we will have a biased estimate of the associated variance. To counter that, we either bootstrap by taking account user/item clusters or we go fully parametric using a mixed model. The paper by Bakshy & Eckles (2013) Uncertainty in Online Experiments with Dependent Data: An Evaluation of Bootstrap Methods is an invaluable reference on that matter that focuses on online A/B tests. Looking into the things in more detail, in some ways the B&E paper is a extended use-case of the Owen's (2007) paper The pigeonhole bootstrap . Similarly the mixed effect approach is based on the uber-classic paper by Bayeen et al. (2009) Mixed-effects modeling with crossed random effects for subjects and items . To briefly comment in the methods you mention: as you correctly identify the $z$ -test on proportion is oversimplifying; it will assume IID and as the B&E paper presents, that assumption can be seriously misleading. The same limitation extends to bootstrap, if we ignore the structure of the data. Regarding the Delta method: deviations from normality and/or noisy data usually make the Delta method suboptimal in comparison to bootstrap approaches (e.g. Hole 2007 A comparison of approaches to estimating confidence intervals for willingness to pay measures ) but I have seen some recent papers (e.g. Deng et al. 2017 Trustworthy analysis of online A/B tests: Pitfalls, challenges and solutions and Deng et al. 2018 Applying the Delta Method in Metric Analytics: A Practical Guide with Novel Ideas ) that seem promising; notice that there is the implicit assumption that the average treatment effect will be normal. Finally, the change of metric is also an excellent idea when reasonable. We should not be afraid to push for changes that are more mathematically coherent just because a metric is already in place. In conclusion: If there is an over-arching scheme on all the papers I cited above is that we need to ensure that our unit of analysis and our unit of randomisation are aligned with our research questions.
