[site]: stackoverflow
[post_id]: 4768009
[parent_id]: 4767673
[tags]: 
The whole idea of a Lock_create function is broken; the act of creating it would require synchronization, which you can't guarantee because you don't have a lock yet! Don't use pointers for locks. Instead create a struct and pass the address of that struct to your locking and unlocking functions. Or better yet, use the ones provided by your OS, since there's no way to implement locking yourself in plain C. Also everyone who's said you need to make the lock "global" is wrong. Function level scope is fine as long as it's static storage duration, which you have. You just need to eliminate the allocation function Lock_create and use an appropriate type for the lock.
