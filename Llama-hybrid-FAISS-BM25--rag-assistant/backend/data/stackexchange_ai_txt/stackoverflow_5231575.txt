[site]: stackoverflow
[post_id]: 5231575
[parent_id]: 
[tags]: 
Android HttpPost not working with python CGI server

I'm buliding an android app and need to submit data to my python CGI server. I'm usually pulling data off the server with HttpGet and all those calls work correctly and quickly. When I try to push data with HttpPost, the program hangs indefinitely until I long press the return button on the emulator and force quit the program. The CGI server seems to start the script but doesn't return until I force quit the android app. When the CGI script returns, it says CGI script exited OK but it hasn't done anything. At the moment I'm executing the request in the UI thread. I know it should be done in an AsyncTask but I want a solution before a try a good solution. I've spent 3 days trying different things and looking at forums with no luck. I'd really appreciate suggestions. Here's the relevant part of my Android code: private final String serverIP = "10.0.2.2"; HttpClient httpclient = new DefaultHttpClient(); HttpParams params = httpclient.getParams(); HttpConnectionParams.setConnectionTimeout(params, 5000); HttpConnectionParams.setSoTimeout(params, 5000); String URI = "http://"+serverIP+":8000/cgi-bin/test.py?order_submit=0"; HttpPost post = new HttpPost(URI); List kvPairs = new ArrayList (2); kvPairs.add(new BasicNameValuePair("name", "bob")); kvPairs.add(new BasicNameValuePair("surname", "the builder")); try { Log.i(TAG, "Trying to set Entity"); post.setEntity(new UrlEncodedFormEntity(kvPairs, HTTP.UTF_8)); Log.i(TAG, "Trying to Post"); HttpResponse response = httpclient.execute(post); Log.i(TAG, "execute done"); httpclient.getConnectionManager().closeExpiredConnections(); } catch (ClientProtocolException e) { Log.e(TAG,e.toString()); } catch (UnsupportedEncodingException e) { Log.e(TAG,e.toString()); } catch (IOException e) { Log.e(TAG,e.toString()); } which outputs the following in LogCat: INFO/App:(534): Trying to set Entity INFO/App:(534): Trying to Post ERROR/App:(534): java.net.SocketTimeoutException: The operation timed out My Python CGI server script is as follows: import os, sys, cgi, csv import cgitb #CGI error backtracer cgitb.enable() form = cgi.FieldStorage() if "order_submit" in form: ofile = open(os.getcwd() + "/Forms/Output/foo.csv", "wb") writer = csv.writer(ofile, delimiter=',', quotechar='"',quoting=csv.QUOTE_ALL) writer.writerow(["Name", form["name"].value]) writer.writerow(["Surname", form["surname"].value]) ofile.close() After the Android app request has timed out, foo.csv still does not exist. The same is true even if the if part of the script contains the following, and doesn't use the CGI form at all: if "order_submit" in form: ofile = open(os.getcwd() + "/Forms/Output/foo.csv", "wb") writer = csv.writer(ofile, delimiter=',', quotechar='"',quoting=csv.QUOTE_ALL) writer.writerow(["Name", "harry"]) ofile.close() After the httpclient.execute(post); , this is the order of events: App: httpclient.execute(post); CGI server: POST /cgi-bin/test.py?order_submit=0 HTTP/1.1" 200 CGI server: starts the 2nd python script a few second's waiting... App: java.net.SocketTimeoutException: The operation timed out Python Script: creates the correct dummy file CGI server: CGI script exited OK
