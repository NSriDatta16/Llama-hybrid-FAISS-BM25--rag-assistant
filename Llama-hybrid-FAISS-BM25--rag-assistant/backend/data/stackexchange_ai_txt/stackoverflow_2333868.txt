[site]: stackoverflow
[post_id]: 2333868
[parent_id]: 
[tags]: 
cvUndistort2 () and cvRemap () crash

I was doing example 11-1 of "Learning OpenCV" by Bradski. Unfortunately the given example doesn't work on my computer. The program is supposed to calibrate camera using chessboard and then output undistorted video output from the camera. The calibration part works fine, the problem arises when the program tries to undistort the image. I tried both cvUndistort2() and cvRemap(), in both cases the output windows freeze and the the program crashes, so that I have to force close it. Here is the code: #include #include #include #include #include int n_boards = 0; int board_dt = 15; int board_w; int board_h; int main(int argc, char* argv[]) { CvCapture* capture; /* if(argc != 5){ printf("\nERROR: Wrong number of input parameters"); help(); return -1; } */ board_w = 7;//atoi(argv[1]); board_h = 7;//atoi(argv[2]); n_boards = 8;//atoi(argv[3]); CvSize board_sz = cvSize( board_w, board_h ); capture = cvCreateCameraCapture( 0 ); if(!capture) { printf("\nCouldn't open the camera\n"); return -1;} cvNamedWindow( "Calibration" ); IplImage *image = cvQueryFrame( capture ); int board_n = board_w * board_h; //ALLOCATE STORAGE CvMat* image_points = cvCreateMat(n_boards*board_n,2,CV_32FC1); CvMat* object_points = cvCreateMat(n_boards*board_n,3,CV_32FC1); CvMat* point_counts = cvCreateMat(n_boards,1,CV_32SC1); CvMat* intrinsic_matrix = cvCreateMat(3,3,CV_32FC1); CvMat* distortion_coeffs = cvCreateMat(5,1,CV_32FC1); CvPoint2D32f* corners = new CvPoint2D32f[ board_n ]; int corner_count; int successes = 0; int step, frame = 0; IplImage *gray_image = cvCreateImage(cvGetSize(image),8,1);//subpixel // CAPTURE CORNER VIEWS LOOP UNTIL WE'VE GOT n_boards // SUCCESSFUL CAPTURES (ALL CORNERS ON THE BOARD ARE FOUND) while (successes Here are the calibration results saved in Intrinsics.xml and Distortion.xml: Intrinsics.xml: 3 3 f 649.64843750 0. 288.47882080 0. 647.89129639 271.92953491 0. 0. 1. Distortion.xml: 5 1 f -0.37764871 22.05950546 0.06449836 -0.03288389 -209.10910034 I use OpenCV2.0, Eclipse, Windows Vista. Camera is a webcam of the laptop.
