[site]: crossvalidated
[post_id]: 586656
[parent_id]: 
[tags]: 
Best way to check that categorical data have not been shuffled

Someone has done a survey, asking a list of $N$ people if they were married ( $M$ ) or single ( $S$ ). You get the result as a table with two columns, 'Name' (text, all unique values) and 'Status' (categorical label, $M$ or $S$ ). However, there is a doubt that the 'Status' column may have been randomly shuffled. You have the phone numbers of all the people in the 'Name' column, so you can call them to check if their Status is correct. What would be the 'most efficient' way to do this check, say with the objective of reducing to [where 'most efficient' = the method that requires the fewest phone calls]. When I was first confronted with this problem, I thought it would be a rather standard application of the hypergeometric distribution, but actually, on further consideration, I could not fit it, and found a different route. Here is my approach (please let me know if you think any of it is wrong). Preliminary consideration: if any of your calls results in a mismatch, you can immediately conclude that the data have been shuffled, and you can stop calling. Thus we are only looking at cases where all the calls you make result in a match, and we are asking: what is the probability of that happening, if the list is shuffled? We want that probability to be less than 5%. Suppose you make $n$ phone calls. How should you choose which people to call? Randomly? Only from a specific class? In specific proportions? And how large does $n$ need to be at the very least? After trying some unnecessarily complicated calculations, I went for the simpler approach below. In the 'true' complete list (of size $N$ ), these people will have a specific sequence of $M$ 's and $S$ 's, in proportions equal to $\frac {N_M} N : \frac {N-N_M} N$ , if $N_M$ is the number of married people. Let $p_M = \frac {N_M} N$ . If you randomly shuffle this list: each 'true' $M$ will end up still being $M$ with a probability $p_M$ , and will end up becoming $S$ with a probability $1-p_M$ ; each 'true' $S$ will end up becoming $M$ with a probability $p_M$ , and will end up still being $S$ with a probability $1-p_M$ . Given that there are a fraction $p_M$ of $M$ 's and a fraction $1-p_M$ of $S$ 's to start with, in the shuffled list there will be a fraction $p_M^2$ of $M$ 's that still match their true value, and a fraction $(1-p_M)^2$ of $S$ 's that still match their true value. The rest of the cases ( $2 p_M (1-p_M)$ ) are mismatched between before and after the shuffle. We will find $n$ matches for the $n$ people that we call, even when our list has been shuffled, if by chance we only pick the cases that did not change Status. The probability of this happening by chance can be estimated by the binomial or hypergeometric distribution, depending on how large $N$ is compared to $n$ . As an example, suppose $N=1000, p_M = 0.3$ . So there are $N_M=300$ married people and $N-N_M=700$ single people. On shuffling, on average $1000\cdot (0.3)^2 = 1000 \cdot 0.09 = 90$ married people will remain correctly labelled, and $1000\cdot (0.7)^2 = 1000 \cdot 0.49 = 490$ single people will remain correctly labelled. Given that the married category is the one with fewer random post-shuffle matches, it would seem best to phone people that belong to that category in our list, as the probability of picking them at random is smaller. In this example, with $n=1$ phone calls from the $M$ category, we would get a probability of $0.09 = 9\%$ ; with $n=2$ , $\frac {90}{1000} \cdot \frac {89}{999} \approx 0.8\%$ . So we fall below our threshold very quickly, with just 2 phone calls. By comparison, if we phoned people from the $S$ category: $n=1, P = 0.49 = 49\%$ $n=2, P =\frac {490}{1000} \cdot \frac {489}{999} \approx 24\%$ $n=3, P =\frac {490}{1000} \cdot \frac {489}{999} \cdot \frac {488}{998} \approx 12\%$ $n=4, P =\frac {490}{1000} \cdot \frac {489}{999} \cdot \frac {488}{998} \cdot \frac {487}{997} \approx 5.7\%$ $n=5, P =\frac {490}{1000} \cdot \frac {489}{999} \cdot \frac {488}{998} \cdot \frac {487}{997} \cdot \frac {486}{996} \approx 2.8\%$ It would take at least 5 calls to presumed single people. So my conclusion would be: phone people from the smaller category (the one with overall probability $p \le 1-p$ ), and conclude that the list has not been shuffled when you have reached $n$ matches (with no mismatches), $n$ being as large as needed to reduce the hypergeometric probability $p \cdot \frac {pN-1}{N-1} \cdot \frac {pN-2}{N-2} \cdot ...$ to a value below your threshold . Do you think this makes sense? Another consideration: I would normally want to use a Bayesian approach, and ask: what is the probability that my list is not shuffled, given that I observed $n$ matches? That would be perhaps: $P(\text{not shuffled} | n \text{ matches}) = P(n \text{ matches} | \text{not shuffled}) \cdot \frac {P(\text{not shuffled})} {P(n \text{ matches})}$ Assuming equal prior of shuffling vs not shuffling: $P(\text{not shuffled} | n \text{ matches}) = 1 \cdot \frac {1} {1 + P(n \text{ matches} | \text{shuffled})}$ The probability term at the denominator is the hypergeometric probability we calculated. When our threshold for that is close to $0$ , by Taylor one can show that: $P(\text{not shuffled} | n \text{ matches}) \approx 1 - P(n \text{ matches} | \text{shuffled})$ i.e.: $P(\text{shuffled} | n \text{ matches}) \approx P(n \text{ matches} | \text{shuffled})$ Again, I am hoping that any of this makes sense. Would like to hear your views/suggestions.
