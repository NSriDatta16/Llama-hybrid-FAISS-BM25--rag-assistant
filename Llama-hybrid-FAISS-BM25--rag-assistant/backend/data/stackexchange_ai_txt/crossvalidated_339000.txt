[site]: crossvalidated
[post_id]: 339000
[parent_id]: 
[tags]: 
Help with Monte Carlo Policy Gradient

I'm trying to show: $\sum_s\mu_\pi(s)\sum_aq_{\pi}(s,a)\nabla_{\theta}\pi(a|s,\theta) = \mathbb{E}\Big[\gamma^t\sum_aq_{\pi}(S_t,a)\nabla_{\theta}\pi(a|S_t,\theta)\Big]$ where: $\Pr(s_0\rightarrow s, k, \pi)$ is a probability of transitioning from state $s_0$ to state $s$ in $k$ steps under policy $\pi$. The initial state $s_0$ is fixed. $\mu_{\pi}(s) \doteq \dfrac{\eta(s)}{\sum_{s'}\eta(s')}$ $\eta(s) \doteq \sum_{k=1}^\infty\gamma^k\Pr(s_0 \rightarrow s, k, \pi)$ $0 My attempt was: $\sum_s\dfrac{\sum_k\Big[\gamma^k \Pr(s_0\rightarrow s, k, \pi)\Big]}{\sum_{s'}\sum_{k'}\Big[\gamma^{k'}\Pr(s_0\rightarrow s', k', \pi)\Big]}\sum_aq_{\pi}(s,a)\nabla_{\theta}\pi(a|s,\theta)$ Simplifying the fraction since the $\sum_a\left[\cdots\right]$ part doesn't change: $= \sum_s\dfrac{\sum_k\Big[\gamma^k \Pr(s_0\rightarrow s, k, \pi)\Big]}{\sum_{k'}\gamma^{k'}\sum_{s'}\Big[\Pr(s_0\rightarrow s', k', \pi)\Big]}$ $= \sum_s\dfrac{\sum_k\Big[\gamma^k \Pr(s_0\rightarrow s, k, \pi)\Big]}{\sum_{k'}\gamma^{k'}}$ $= \sum_s\dfrac{\sum_k\Big[\gamma^k \Pr(s_0\rightarrow s, k, \pi)\Big]}{-\dfrac{\gamma}{\gamma - 1}}$ $=(-1)\sum_s\dfrac{\sum_k\Big[\gamma^k\Pr(s_0\rightarrow s, k, \pi)\Big](\gamma-1)}{\gamma}$ $=(-1)\sum_s\dfrac{\gamma(\gamma-1)\sum_k\Big[\gamma^{k-1}\Pr(s_0\rightarrow s, k, \pi)\Big]}{\gamma}$ $=(-1)(\gamma-1)\sum_s\sum_k\Big[\gamma^{k-1}\Pr(s_0\rightarrow s, k, \pi)\Big]$ $=(-1)(\gamma-1)\sum_k\gamma^{k-1}\sum_s\Big[\Pr(s_0\rightarrow s, k, \pi)\Big]$ $=(-1)(\gamma-1)\sum_k\gamma^{k-1}$ $=(\gamma-1)\dfrac{1}{\gamma-1}$ $=1$ This is as far as I got and does not lead to the result I'd want. Since I only have basic knowledge of probability I suspect I've made a mistake along the way. I'm guessing that $\sum_s\Pr(s_0\rightarrow s, k, \pi) \neq 1$ since it was more of a guess: Probability of transitioning from initial state $s_0$ in $k$ steps under policy $\pi$ Please do not post full solution, I'd like to get to the result myself. I just need to be pointed to the right direction.
