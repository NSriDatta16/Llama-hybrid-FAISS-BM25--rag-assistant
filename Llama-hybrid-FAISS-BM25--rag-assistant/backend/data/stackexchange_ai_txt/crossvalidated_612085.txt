[site]: crossvalidated
[post_id]: 612085
[parent_id]: 611808
[tags]: 
The hierarchical structure is mainly for the "fixed" effects, but you do need to consider it when it comes to an autocorrelation structure. With both correlation in gamm() and rho in bam() , unless told otherwise, the model will assume a single long time series. This behaviour may be what you want, but you may, for example in your case, want to nest the correlation structure within day rather than just the temporal ordering of the samples. Such a nesting would say that the autocorrelation structure operates at the lowest grouping level (within day) â€” you can't opt to nest it within year when you have sub-daily level data unless you create a variable that orders the samples at the sub-daily level within year. With correlation you would use corAR1(form = ~ t | year) to indicate you want an AR(1) nested within year, where t orders the observations within year . To get this nested within site you just need to augment the right-hand side of the formula. One way to do this is to create a variable year_site = interaction(year, site, drop = TRUE) in your data and then modify the formula to be corAR1(form = ~ t | year_site) . There may be more direct ways to do this within the formula but all the examples I have seen use a single grouping factor. With rho you need to create a logical vector that is FALSE everywhere, except at the first observation of each "series" that you want the correlation structure to be nested within. Importantly, you are estimating the same single parameter $\rho$ regardless of how you specify the AR(1), that operates within each level of the grouping variable (or equivalently for other ARMA terms). In that sense, the parameters are global in the way they describe a common autocorrelation structure within each level of the hierarchy. brms works essentially the same way. See https://paul-buerkner.github.io/brms/reference/autocor-terms.html and then the individual correlation functions linked from that page which document arguments such as time (for ordering the observations) and gr for the grouping factor.
