[site]: stackoverflow
[post_id]: 4087907
[parent_id]: 
[tags]: 
Authentication/Impersonation issue with ASP.NET call to WCF Service

I have a web page that calls a WCF service that makes a sql database call using Integrated Security. I get an error saying, "Login failed for user 'CorpDomain\ServerName01$'". I want it so that it all layers will execute under the user's AD credetials (working in an intranet), ie: "CorpDomain\Albert". On the server (Win 2008/IIS 7), I have Windows Authentication turned on and everything else off (including Anonymous) under Authentication for both the web client and the WCF service. Here's my client web.config: --> Here's my WCF service web.config: --> --> on the client side : Request.ServerVariables["AUTH_USER"].ToString() = "CorpDomain\Albert" Page.User.Identity.Name = "CorpDomain\Albert" System.Threading.Thread.CurrentPrincipal.Identity.Name = "CorpDomain\Albert" System.Security.Principal.WindowsIdentity.GetCurrent().Name = "NT AUTHORITY\NETWORK SERVICE" My client code is basically: MySvc.MyServiceClient svc = new MySvc.MyServiceClient(); svc.ClientCredentials.Windows.AllowedImpersonationLevel = TokenImpersonationLevel.Impersonation; Response.Write(svc.GetServiceHtml()); and on the WCF side : ServiceSecurityContext.Current.WindowsIdentity.Name = "NT AUTHORITY\NETWORK SERVICE" server side code is: [OperationBehavior(Impersonation = ImpersonationOption.Required)] public string GetServcieHtml() { string name, link; StringBuilder html = new StringBuilder(); html.Append(ServiceSecurityContext.Current.WindowsIdentity.Name); try { using (SqlConnection conn = GetDataConnection()) { conn.Open(); SqlCommand sqlcom = new SqlCommand("dbo.runsomeproc", conn); sqlcom.CommandType = CommandType.StoredProcedure; SqlDataReader sqlDataReader = sqlcom.ExecuteReader(); while (sqlDataReader.Read()) { // ** SOME CODE HERE ** } conn.Close(); } } catch (Exception ex) { html.AppendLine(" ERROR:" + ex.Message + " " + ex.InnerException); return html.ToString(); } return html.ToString(); } Note: The error I get is: ERROR:Login failed for user 'CorpDomain\ServerName01$'. Any idea what I'm doing wrong?
