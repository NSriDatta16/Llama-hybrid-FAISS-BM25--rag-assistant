[site]: stackoverflow
[post_id]: 3817843
[parent_id]: 
[tags]: 
Using XPath with HTML or XML fragment?

I am new to Nokogiri and XPath, and I am trying to access all comments in a HTML or XML fragment. The XPaths .//comment() and //comment() work when I am not using the fragment function, but they do not find anything with a fragment. With a tag instead of a comment, it works with the first XPath. By trial and error, I realized that in this case comment() finds only top level comments and .//comment() and some others find only inner comments. Am I doing something wrong? What am I missing? Can anyone explain what is happening? What XPath should I use to get all comments in a HTML fragment parsed by Nokogiri? This example can help to understand the problem: str = " " # this works: Nokogiri::HTML(str).xpath("//comment()") => [# , # ] Nokogiri::HTML(str).xpath(".//comment()") => [# , # ] # with fragment, it does not work: Nokogiri::HTML.fragment(str).xpath("//comment()") => [] Nokogiri::HTML.fragment(str).xpath("comment()") => [# ] Nokogiri::HTML.fragment(str).xpath(".//comment()") => [# ] Nokogiri::HTML.fragment(str).xpath("*//comment()") => [# ] Nokogiri::HTML.fragment(str).xpath("*/comment()") => [# ] # however it does if it is a tag instead of a comment: str = " two " Nokogiri::HTML.fragment(str).xpath(".//a") => [# ]>, # ]>, # ]>] PS: Without fragment it does what I want, but it also adds some stuff like "DOCTYPE" and I really have only a fragment of a HTML file that I am editing (removing some tags, replacing others).
