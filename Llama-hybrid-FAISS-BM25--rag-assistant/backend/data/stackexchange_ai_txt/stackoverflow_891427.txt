[site]: stackoverflow
[post_id]: 891427
[parent_id]: 
[tags]: 
How to make a POST request to a page that may redirect to a login page

I am using a macro in Outlook VBA to submit a file via POST to a URL: Set http = New WinHttp.WinHttpRequest http.Open "POST", UrlToPostTo, False 'True ' http.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" http.setRequestHeader "Content-Type", "multipart/form-data; " http.Send data My problem is the page that will accept the request (a file upload page, in this case) is protected by authentication - the initial request for it above will return a login page instead of the page itself. I have tried to detect if the login page appears and if so, post the username and password as form variables (I'm hoping this is equivalent to a human typing said username and password into a page in the web browser). So the steps are: * request URL (include file with post). * Check if the reponse is the login page. * If so, then in the same http session, submit the username and password to the URL. * If the server now processes the original post, good, otherwise I can post it again. The code looks like: ' if the login page comes back, send credentials ' If (InStr(http.ResponseText, "j_password") > 0) Then Dim loginData As String loginData = "j_username=theusername&j_password=thepassword" http.Open "POST", UrlToPostTo, False http.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" http.setRequestHeader "Content-Type", "multipart/form-data; " http.Send loginData End If But when I do this, The http.Responsetext is just the login page still (or again?). Any idea what I'm doing wrong? Is my plan even valid? (This is related to trying to solve this problem )
