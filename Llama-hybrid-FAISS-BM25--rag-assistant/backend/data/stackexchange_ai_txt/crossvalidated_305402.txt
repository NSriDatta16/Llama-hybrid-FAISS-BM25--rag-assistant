[site]: crossvalidated
[post_id]: 305402
[parent_id]: 305119
[tags]: 
The mistake you made was in using the wrong form of the chain rule. In univariate calculus, it does not matter if you write $\frac{d}{dx} f(g(x)) = f'(g(x)) g'(x)$ or if you write $\frac{d}{dx} f(g(x)) = g'(x) f'(g(x))$. However, since matrix multiplcation is not commutative, you do need to be careful about the order when dealing with matrix calculus. When treating the gradient as a column vector (denominator layout), which is the case in this problem, the chain rule is: $$\frac{d}{dx} f(g(x)) = g'(x) f'(g(x))$$ When treating the gradient as a row vector (numerator layout), the chain rule is: $$\frac{d}{dx} f(g(x)) = f'(g(x)) g'(x)$$ For this case we want the first version, so $\frac{\partial q}{\partial x}$ goes in front of $\frac{\partial f}{\partial q}$ which gives you the answer: $2W^T q$. The slide you posted got the right answer without paying attention to the order of the two terms was because they did the derivative element-wise, without matrices, which means this issue doesn't appear. Source: last row of this table
