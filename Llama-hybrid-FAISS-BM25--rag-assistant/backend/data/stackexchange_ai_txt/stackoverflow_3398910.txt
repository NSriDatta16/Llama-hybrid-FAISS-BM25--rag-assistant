[site]: stackoverflow
[post_id]: 3398910
[parent_id]: 
[tags]: 
Filter a product collection by two categories in Magento

I'm trying to find products that are in two categories. I've found an example to get products that are in category1 OR category2. http://www.alphadigital.cl/blog/lang/en-us/magento-filter-by-multiple-categories.html I need products that are in category1 AND category2. The example in the blog is: class ModuleName_Catalog_Model_Resource_Eav_Mysql4_Product_Collection extends Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Collection{ public function addCategoriesFilter($categories){ $alias = 'cat_index'; $categoryCondition = $this->getConnection()->quoteInto( $alias.'.product_id=e.entity_id AND '.$alias.'.store_id=? AND ', $this->getStoreId() ); $categoryCondition.= $alias.'.category_id IN ('.$categories.')'; $this->getSelect()->joinInner( array($alias => $this->getTable('catalog/category_product_index')), $categoryCondition, array('position'=>'position') ); $this->_categoryIndexJoined = true; $this->_joinFields['position'] = array('table'=>$alias, 'field'=>'position' ); return $this; } } When I'm using this filter alone it perform OR query on several categories. When I combine this filter with prepareProductCollection of Mage_Catalog_Model_Layer it somehow remove the filter effect. How can I change the filter to AND and combine it with prepareProductCollection? Thanks Thanks
