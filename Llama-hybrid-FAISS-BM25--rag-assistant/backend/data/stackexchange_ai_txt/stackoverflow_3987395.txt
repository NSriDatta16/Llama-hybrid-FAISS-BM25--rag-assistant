[site]: stackoverflow
[post_id]: 3987395
[parent_id]: 3973342
[tags]: 
This gets rid of the second foreach and (hopefully - I haven't tested) gets the agent's email address in the one select: ... $sql = $db->query("SELECT tablename.AGENT AGENT, agent.EMAIL EMAIL, FROM tablename, agent WHERE enroll_date > DATE_SUB(CURDATE(),INTERVAL 1 MONTH) AND tablename.AGENT = agent.AGENT GROUP BY tablename.AGENT HAVING COUNT(tablename.AGENT) > 1 ORDER BY enroll_date ASC"); $result = $sql->fetchALL(PDO::FETCH_ASSOC); foreach($result as $row) { $sql2 = "UPDATE agent_prizes SET prize=?, method=? WHERE AGENT = '{$row["AGENT"]}'"; ...
