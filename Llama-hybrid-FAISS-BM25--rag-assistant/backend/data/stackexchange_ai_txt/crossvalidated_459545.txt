[site]: crossvalidated
[post_id]: 459545
[parent_id]: 
[tags]: 
How to calculate the ccf (cross-correlation) function mannually when one time series contains NA in R?

I have two time series, for example: a = c(2, 1, 2, 1, 2, 1, 2) b = c(NA, NA, 1, 2, 1, 2, 1) ccf(a, b, na.action=na.omit, plot=FALSE) The results of ccf shows the following: Autocorrelations of series ‘X’, by lag -3 -2 -1 0 1 2 3 0.400 -0.567 0.800 -1.000 0.800 -0.567 0.400 When lag equals 0, the ccf values is -1. However, I can't figure out why the value is 0.8 (lag = -1) and -0.567 (lag = -2). I've read the link from Why do I get different results using ccf() and cor() in R? . But it is based on acf and doesn't contains NAs. How to calculate it when it contains NA? Specifically, what is the formula when calculate when lag = -2 in this toy example ?
