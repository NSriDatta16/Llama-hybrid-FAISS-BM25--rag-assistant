[site]: stackoverflow
[post_id]: 5209934
[parent_id]: 
[tags]: 
Weird Characters on Webpage after HTML Tidy

I'm getting content via Amazon Web Services (e.g. product descriptions). Since the content from Amazon is often marked up very poorly, it ends up messing up the layout of my web pages. So, I have come up with a function to "sanitize" the content using HTML Tidy. The weird thing is that when I test it separate from my application, everything seems to work fine. But in my application (running on CodeIgniter), the function seems to return odd characters. The code below is my test script. It's outputting what I think I need. In my application, I grab the description from my database, sanitize it, then display it on my webpage. After sanitization, for example, document’s (you can see this word in the example below) becomes document&acirc;&euro;&trade;s (again, only in the actual application; not in the test code. Both functions are identical). Any ideas why? Here's my test function: $amazon_content = Today’s application-like Web experiences (such as Salesforce.com and Google Maps) and Web 2.0 sites (such as Flickr.com and Twitter) are powered by JavaScript and Ajax. Using the techniques shown in this book, you will be able to start creating similar experiences in the sites you design. Scriptin' with JavaScript and Ajax will teach you how to: Start developing with JavaScript fast! Write lightweight but powerful object-oriented code Modify the Document Object Model “Progressively enhance” your pages with JavaScript to provide the highest levels of accessibility to all users Learn sophisticated techniques for making your pages respond to user actions Use the downloadable Scriptin’ library of helper functions to speed development and ensure cross-browser compatibility Use Ajax scripting techniques to update specific areas of the page with data from the server Create powerful interface interactions, such as sliding panels and tree menus Evaluate frameworks such as jQuery and Prototype to find the best one for your needs Build an online application that looks and responds like a regular desktop application Easily adapt the Scriptin’ code examples for use in your own projects—download them at www.scriptinwithajax.com AMAZON; echo ' ' . $amazon_content . ' '; echo ' ' . get_sanitized_amazon_content($amazon_content) . ' '; echo get_sanitized_amazon_content($amazon_content); function get_sanitized_amazon_content($amazon_content) { $tidy_config = array( 'bare' => TRUE, 'clean' => TRUE, 'drop-empty-paras' => TRUE, 'drop-font-tags' => TRUE, 'drop-proprietary-attributes' => TRUE, 'enclose-text' => TRUE, 'fix-backslash' => TRUE, 'fix-bad-comments' => TRUE, 'fix-uri' => TRUE, 'hide-comments' => TRUE, 'hide-endtags' => TRUE, 'logical-emphasis' => TRUE, 'lower-literals' => TRUE, 'merge-divs' => TRUE, 'output-xhtml' => TRUE, 'quote-ampersand' => TRUE, 'quote-marks' => TRUE, 'show-body-only' => TRUE, 'word-2000' => TRUE ); $tidy = new tidy(); $sanitized_amazon_markup = $tidy->repairString($amazon_content, $tidy_config); // Replace carriage returns, line feeds, tabs with single space $sanitized_amazon_markup = preg_replace('/\r|\n|\t/', ' ', $sanitized_amazon_markup); // Removes unnecessary tags // TODO: get complete list; put in an array $sanitized_amazon_markup = strip_tag($sanitized_amazon_markup, 'div'); $sanitized_amazon_markup = strip_tag($sanitized_amazon_markup, 'span'); // Replace double spaces with single space $sanitized_amazon_markup = preg_replace('/ {2,}/i', ' ', $sanitized_amazon_markup); // Remove leading and trailing space $sanitized_amazon_markup = trim($sanitized_amazon_markup); return $sanitized_amazon_markup; } function strip_tag($tagged_content, $tag_name) { return preg_replace('% %i', '', $tagged_content); } UPDATE: This is what I get in my application: JavaScript is the brains of your Web page&acirc;&euro;&quot;it enables you to modify a document&acirc;&euro;&trade;s structure, styling, and content in response to user actions without requesting new pages from the server. Scriptin&#39; with JavaScript and Ajax teaches you how to master this powerful and elegant language so you can develop intuitive user interactions that take the user experience to new levels of sophistication and responsiveness. Today&acirc;&euro;&trade;s application-like Web experiences (such as Salesforce.com and Google Maps) and Web 2.0 sites (such as Flickr.com and Twitter) are powered by JavaScript and Ajax. Using the techniques shown in this book, you will be able to start creating similar experiences in the sites you design. Scriptin&#39; with JavaScript and Ajax will teach you how to: Start developing with JavaScript fast! Write lightweight but powerful object-oriented code Modify the Document Object Model &acirc;&euro;&oelig;Progressively enhance&acirc;&euro; your pages with JavaScript to provide the highest levels of accessibility to all users Learn sophisticated techniques for making your pages respond to user actions Use the downloadable Scriptin&acirc;&euro;&trade; library of helper functions to speed development and ensure cross-browser compatibility Use Ajax scripting techniques to update specific areas of the page with data from the server Create powerful interface interactions, such as sliding panels and tree menus Evaluate frameworks such as jQuery and Prototype to find the best one for your needs Build an online application that looks and responds like a regular desktop application Easily adapt the Scriptin&acirc;&euro;&trade; code examples for use in your own projects&acirc;&euro;&quot;download them at www.scriptinwithajax.com This is what I get when outside of my application: JavaScript is the brains of your Web page-it enables you to modify a document's structure, styling, and content in response to user actions without requesting new pages from the server. Scriptin' with JavaScript and Ajax teaches you how to master this powerful and elegant language so you can develop intuitive user interactions that take the user experience to new levels of sophistication and responsiveness. Today's application-like Web experiences (such as Salesforce.com and Google Maps) and Web 2.0 sites (such as Flickr.com and Twitter) are powered by JavaScript and Ajax. Using the techniques shown in this book, you will be able to start creating similar experiences in the sites you design. Scriptin' with JavaScript and Ajax will teach you how to: Start developing with JavaScript fast! Write lightweight but powerful object-oriented code Modify the Document Object Model "Progressively enhance" your pages with JavaScript to provide the highest levels of accessibility to all users Learn sophisticated techniques for making your pages respond to user actions Use the downloadable Scriptin' library of helper functions to speed development and ensure cross-browser compatibility Use Ajax scripting techniques to update specific areas of the page with data from the server Create powerful interface interactions, such as sliding panels and tree menus Evaluate frameworks such as jQuery and Prototype to find the best one for your needs Build an online application that looks and responds like a regular desktop application Easily adapt the Scriptin' code examples for use in your own projects-download them at www.scriptinwithajax.com
