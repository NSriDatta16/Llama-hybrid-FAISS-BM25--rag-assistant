[site]: stackoverflow
[post_id]: 5192408
[parent_id]: 
[tags]: 
Advanced friendship model and queries in Rails 3

I have friendship model, and for every new friendship, I create two new records: User1 and Friend1 Friend1 and User1 I can retrieve all standard staffs like: friends, friendships, pending_friends... The situation becomes complicated when I try to get common friends, friends of friends... For now to get common friendships, I use something like: has_many :common_friendships, :class_name => 'Friendship', :conditions=>'friendships.user_id = #{self.id}' do def common_with(friend) joins("inner join friendships fl2 on friendships.friend_id = fl2.user_id").where("fl2.friend_id = #{friend.id}") end end Also I can use full query with finder_sql like: select distinct * from friendships fl1 inner join friendships fl2 on fl1.friend_id = fl2.user_id where fl1.user_id = 1 and fl2.friend_id = 2 How can I do that in an elegant way in Rails 3?
