[site]: crossvalidated
[post_id]: 522208
[parent_id]: 
[tags]: 
Is self-selection for a treatment a problem after all?

I have devised the following R code. In this simulated dataset, we know that a certain treatment (e.g. a degree, an education) increases income by $ 1,000. Income is also caused by age. In the first part, units are randomly assigned into treatment. Each unit has a 50% probability to receive the treatment, regardless of his/her age. In the second part, subjects self-select into treatment: younger units have a higher probability to receive treatment than older ones. We can check that the units that receive treatment are younger: we do a boxplot, and a t-test rejects the null hypothesis that the average age is the same across the treated and non treated groups. By running an OLS, I am able to estimate the effect of treatment on income in both cases, so also in the second case where people self-select themselves into treatment. In the second part, can I infer from the OLS that the treatment causes an increase in income by $ 1,000? Is self-selection a problem for that inference? N = 100000 age_coeff = 100 treated_coeff = 1000 # PART 1: RANDOM SELECTION INTO TREATMENT df = data.frame(id=seq(from=1, to=N, by=1)) df $age = runif(N, min=0, max=100) # size -> number of trials (zero or more) df$ treated = rbinom(N, size=1, prob=0.5) df $treated = df$ treated==1 e = rnorm(N, mean=0, sd=50) # Check age is the same across the two groups r $age, list(df$ treated), FUN=mean) colnames(r) $age[df$ treated], df $age[!df$ treated]) df $income = 0 + age_coeff*df$ age + treated_coeff*df$treated + e income.lm = lm(income~age+treated, data=df) summary(income.lm) # PART 2: SELF-SELECTION INTO TREATMENT library(sigmoid) df $ptreated = logistic(50-df$ age) df $treated = rbinom(N, size=1, prob=df$ ptreated) df $treated = df$ treated==1 # Check if selection into treatment is effective boxplot(df $ptreated~df$ treated) r $ptreated, list(df$ treated), FUN=mean) colnames(r) $age, list(df$ treated), FUN=mean) colnames(r) $age~df$ treated) t.test(df $age[df$ treated], df $age[!df$ treated]) df $income = 0 + age_coeff*df$ age + treated_coeff*df$treated + e income.lm = lm(income~age+treated, data=df) summary(income.lm) # Check df $age50 age >= 50 table(df $age50, df$ treated, dnn=c("Age50", "treated")) ```
