[site]: stackoverflow
[post_id]: 4075885
[parent_id]: 4074997
[tags]: 
Once you had enough pain with the Regex fiddling, try DOM for an alternative: $dom = new DOMDocument; $dom->loadHTMLFile('http://example.com/foo.htm'); $xPath = new DOMXPath($dom); foreach ($xPath->query('/html/body//p[not(descendant::img)][3]') as $p) { $h3 = $dom->createElement('h3', "Regex can't parse HTML"); if ($p->nextSibling !== NULL) { $p->parentNode->insertBefore($h3, $p->nextSibling); } else { $p->parentNode->appendChild($h3); } } echo $dom->saveHtml(); Fetching the 3rd paragraph from anywhere in the HTML body that does not contain an img element somewhere below that paragraph is easily done with XPath /html/body//p[not(descendant::img)][3] Also see Best methods to parse HTML and more on DOM by me
