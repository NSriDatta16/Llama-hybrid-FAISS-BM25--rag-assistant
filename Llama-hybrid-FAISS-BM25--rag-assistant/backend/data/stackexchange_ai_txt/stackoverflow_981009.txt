[site]: stackoverflow
[post_id]: 981009
[parent_id]: 
[tags]: 
Why don't my variables interpolate correctly into my Perl substitution pattern?

I'm writing a complex script that takes the XML backup of a Blogger blog and converts it to InDesign Tagged Text to be laid out in a book. I'm using a whole bunch of regular expressions to clean out the HTML tags of each blog post and convert them to InDesign tags. For example: A really long paragraph. -> A really long paragraph. Whatever -> Whatever For the most part the script is working great. However, InDesign can't handle nested tags. This is small italic text will not work and needs to end up as This is small italic text I'm trying to use variables in regex search patterns to find anywhere where character style tags are doubled up, but when I use the variables, nothing is found. If I hard code the InDesign tags into the regex, though, it works. What is making the variables unfindable? Here's a working excerpt from my code (in real life $input isn't a string variable, but a LibXML object that the script parses...this is just for illustration) #!/usr/bin/perl -w use strict; my $IDitalic = " "; my $IDsmall = " "; my $IDsmallitalic = " "; my $IDcharend = " "; sub cleanText { my $text = $_[0]; # Replace any span with a font size attribute with "small" character style $text =~ s/ ]*?font-size[^>]*>(.*?) /$IDsmall$1$IDcharend/gis; # Replace tags with "italic" character style $text =~ s/ (.*?) /$IDitalic$1$IDcharend/gis; #-------------------------------------------------------- # Problem section # # The following works since everything is hard coded # $text =~ s/ /$IDsmallitalic/gi; # $text =~ s/ /$IDcharend/gi; # When I use variables, though, it doesn't work... $text =~ s/{$IDsmall}{$IDitalic}/$IDsmallitalic/gi; $text =~ s/({$IDcharend})\1+/$1/gi; #-------------------------------------------------------- # Clear out all tags that aren't the InDesign tags, take out the dummy ~~ and rebuild the actual tag $text =~ s/ '"]*|(['"]).*?\1)*>//gs; $text =~ s/ In sodales malesuada nisi quis varius. Proin a ligula mauris. Proin ac justo est, vitae sollicitudin tortor. Proin auctor, augue eu fringilla imperdiet, nisi sapien tempus libero, sed aliquet quam metus vel risus. Curabitur feugiat tristique porttitor. Integer malesuada volutpat accumsan. metus ut erat placerat tempus. Nam vestibulum , est quis scelerisque tincidunt, enim est lacinia ligula, vel accumsan ante nisl consectetur massa. Nullam velit nisi, viverra quis viverra ac, dictum ac enim. Sed nisl magna, fringilla at placerat quis, facilisis id nibh. Mauris eget sapien mauris, nec sollicitudin urna. Curabitur ac nunc a arcu vulputate tincidunt.\n **This is really small text \n Andrew\n Friday, May 29, 2009â€” 8:15 PM"; print cleanText($input); So, what's going wrong? Also, is there a better way to maintain the InDesign tags without having the dummy tildes in the variable name? Thanks! Author apparently decided to parse the HTML, for more information go to the parsing follow-up question .
