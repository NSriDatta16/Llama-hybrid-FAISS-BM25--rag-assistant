[site]: stackoverflow
[post_id]: 1966845
[parent_id]: 1966793
[tags]: 
SQL Server 2005+, using CTEs: WITH grade_average AS ( SELECT r.id, AVG(r.mark) 'avg_mark' FROM RESULTS r GROUP BY r.id), highest_average AS ( SELECT MAX(ga.avg_mark) 'highest_avg_mark' FROM grade_average ga) SELECT DISTINCT s.name, ga.avg_mark FROM STUDENTS s JOIN grade_average ga ON ha.id = s.id JOIN highest_average ha ON ha.highest_avg_mark = ga.avg_mark Non-CTE equivalent: SELECT DISTINCT s.name, ga.avg_mark FROM STUDENTS s JOIN (SELECT r.id, AVG(r.mark) 'avg_mark' FROM RESULTS r GROUP BY r.id) ga ON ha.id = s.id JOIN SELECT MAX(ga.avg_mark) 'highest_avg_mark' FROM (SELECT r.id, AVG(r.mark) 'avg_mark' FROM RESULTS r GROUP BY r.id) ga) ha ON ha.highest_avg_mark = ga.avg_mark
