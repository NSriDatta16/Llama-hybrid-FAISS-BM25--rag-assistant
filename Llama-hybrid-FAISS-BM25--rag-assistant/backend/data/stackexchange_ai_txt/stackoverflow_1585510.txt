[site]: stackoverflow
[post_id]: 1585510
[parent_id]: 1583834
[tags]: 
As Jean-Lou Dupont pointed out, your current code is quite prone to deadlocks. When I've done this, I've used three locks: two counted semaphores and one mutex. The counted semaphores signal when: there's space available to insert an object There at least one object to retrieve from the queue The mutex is used only while actually putting an item in the queue or retrieving an item from the queue -- but no attempt is ever made at locking the mutex until we know that the insertion or retrieval will be able to succeed immediately.
