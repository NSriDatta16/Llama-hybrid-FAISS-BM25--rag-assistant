[site]: datascience
[post_id]: 76634
[parent_id]: 
[tags]: 
How to fix the error in the following code in Python and Keras?

I am unable to figure out the problem with the code (see below). I am also providing error trace after the code. Goal of the code is to use a dataset (with numerical and categorical variables) to predict some variables via neural network (Multi-node output). For the categorical variables, I am using Embedding (entity-embedding) technique. # Integer encoding for categories so that it can be fed into a Keras Embedding layer # Keras Embedding layer only accepts interger arrays and NOT STRINGS # Create a label (category) encoder object LE = {} # Fit the encoder to the pandas column for cat in cat_model_vars: LE[cat] = preprocessing.LabelEncoder() LE[cat].fit(modelDF[cat]) modelDF[f"{cat}_enc"] = LE[cat].transform(modelDF[cat]) # imports the required modules from keras and other packages from keras.models import Model from keras.layers import Input, Dense, Concatenate, Reshape, Dropout from keras.layers.embeddings import Embedding inputs = [] embeddings = [] # for categorical variables for cat in cat_model_vars: inp = Input(shape=(1,)) inputs.append(inp) emb = Embedding(cat_sizes[cat]+1,cat_embedding_size[cat], input_length=1,name=f"{cat}_embedding")(inp) emb = Reshape(target_shape=(cat_embedding_size[cat],))(emb) embeddings.append(emb) # for continuous/numerical variables inp_num = Input(shape=(len(num_model_vars),),name='cont_vars') #emb_num = Dense(10)(inp_num) inputs.append(inp_num) embeddings.append(inp_num) # concatenate the embeddings, this is going to be input to our model output = Concatenate()(embeddings) # Model is plain regression for the numerical vars # regression model x = Dense(50, activation = 'relu')(output) x = Dense(6, activation = 'linear')(x) regModel = Model(inputs,x) regModel.compile(loss='mse',optimizer='adam', metrics=['mse','mae']) regModel.fit([modelDF.A_enc, modelDF.B_enc, modelDF.C_enc, modelDF.D_enc, modelDF[num_model_vars]],modelDF[num_model_vars],batch_size=50,epochs=50) I am getting the following error which I couldn't decipher. Epoch 1/50 2020-06-24 17:09:23.223086: W tensorflow/core/common_runtime/base_collective_executor.cc:216] BaseCollectiveExecutor::StartAbort Invalid argument: indices[5,0] = 5 is not in [0, 3) [[{{node if_type_embedding_3/embedding_lookup}}]] Traceback (most recent call last): File " ", line 1, in regModel.fit([modelDF.A_enc, modelDF.B_enc, modelDF.C_enc, modelDF.D_enc, modelDF[num_model_vars]],modelDF[num_model_vars],batch_size=50,epochs=50) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/keras/engine/training.py", line 1239, in fit validation_freq=validation_freq) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/keras/engine/training_arrays.py", line 196, in fit_loop outs = fit_function(ins_batch) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/keras/backend.py", line 3740, in __call__ outputs = self._graph_fn(*converted_inputs) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/eager/function.py", line 1081, in __call__ return self._call_impl(args, kwargs) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/eager/function.py", line 1121, in _call_impl return self._call_flat(args, self.captured_inputs, cancellation_manager) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/eager/function.py", line 1224, in _call_flat ctx, args, cancellation_manager=cancellation_manager) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/eager/function.py", line 511, in call ctx=ctx) File "/opt/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/eager/execute.py", line 67, in quick_execute six.raise_from(core._status_to_exception(e.code, message), None) File " ", line 3, in raise_from InvalidArgumentError: indices[5,0] = 5 is not in [0, 3) [[node if_type_embedding_3/embedding_lookup (defined at /opt/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow_core/python/framework/ops.py:1751) ]] [Op:__inference_keras_scratch_graph_6257] Function call stack: keras_scratch_graph Any idea what is wrong with this code? Your help is greatly appreciated. Thank you.
