[site]: stackoverflow
[post_id]: 4912798
[parent_id]: 4912275
[tags]: 
Here’s an example using DOMDocument : $doc = new DOMDocument(); $doc->loadHTML($code); // create document fragment $frag = $doc->createDocumentFragment(); // create initial list $frag->appendChild($doc->createElement('ol')); $head = &$frag->firstChild; $xpath = new DOMXPath($doc); $last = 1; // get all H1, H2, …, H6 elements foreach ($xpath->query('//*[self::h1 or self::h2 or self::h3 or self::h4 or self::h5 or self::h6]') as $headline) { // get level of current headline sscanf($headline->tagName, 'h%u', $curr); // move head reference if necessary if ($curr parentNode->parentNode; } } else if ($curr > $last && $head->lastChild) { // move downwards and create new lists for ($i=$last; $i lastChild->appendChild($doc->createElement('ol')); $head = &$head->lastChild->lastChild; } } $last = $curr; // add list item $li = $doc->createElement('li'); $head->appendChild($li); $a = $doc->createElement('a', $headline->textContent); $head->lastChild->appendChild($a); // build ID $levels = array(); $tmp = &$head; // walk subtree up to fragment root node of this subtree while (!is_null($tmp) && $tmp != $frag) { $levels[] = $tmp->childNodes->length; $tmp = &$tmp->parentNode->parentNode; } $id = 'sect'.implode('.', array_reverse($levels)); // set destination $a->setAttribute('href', '#'.$id); // add anchor to headline $a = $doc->createElement('a'); $a->setAttribute('name', $id); $a->setAttribute('id', $id); $headline->insertBefore($a, $headline->firstChild); } // append fragment to document $doc->getElementsByTagName('body')->item(0)->appendChild($frag); // echo markup echo $doc->saveHTML();
