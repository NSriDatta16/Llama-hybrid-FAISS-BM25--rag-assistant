[site]: stackoverflow
[post_id]: 3849969
[parent_id]: 3849825
[tags]: 
use Data::Dumper; my $aoa= [ {NAME=>'Dave', AGE=>12, SEX=>'M', ID=>123456, NATIONALITY=>'Swedish'}, {NAME=>'Susan', AGE=>36, SEX=>'F', ID=>543210, NATIONALITY=>'Swedish'}, {NAME=>'Bart', AGE=>120, SEX=>'M', ID=>987654, NATIONALITY=>'British'}, ]; sub aoh_to_hoh { my ($aoa, $key_hierarchy_a) = @_; my $result = {}; my $last_key = $key_hierarchy_a->[-1]; foreach my $orig_element (@$aoa) { my $cur = $result; # song and dance to clone an element my %element = %$orig_element; foreach my $key (@$key_hierarchy_a) { my $value = delete $element{$key}; if ($key eq $last_key) { $cur->{$value} ||= []; push @{$cur->{$value}}, \%element; } else { $cur->{$value} ||= {}; $cur = $cur->{$value}; } } } return $result; } my $key_hierarchy_a = ['SEX', 'NATIONALITY']; print Dumper(aoh_to_hoh($aoa, $key_hierarchy_a)); As per @FM's comment, you really want an extra array level in there. The output: $VAR1 = { 'F' => { 'Swedish' => [ { 'ID' => 543210, 'NAME' => 'Susan', 'AGE' => 36 } ] }, 'M' => { 'British' => [ { 'ID' => 987654, 'NAME' => 'Bart', 'AGE' => 120 } ], 'Swedish' => [ { 'ID' => 123456, 'NAME' => 'Dave', 'AGE' => 12 } ] } }; EDIT: Oh, BTW - if anyone knows how to elegantly clone contents of a reference, please teach. Thanks! EDIT EDIT: @FM helped. All better now :D
