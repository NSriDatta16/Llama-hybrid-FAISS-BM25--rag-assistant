[site]: stackoverflow
[post_id]: 5567437
[parent_id]: 
[tags]: 
selection and site search in chrome extension

I'm trying to write google chrome extension that accepts user-selected word and user-defined web site and searches this word on that site (via Google and contextmenu).There's a form in options page. User enters sites in form fields (there's a variable number of fields/sites- user specifies which sites and therefore how many).All sites are saved to array. array is saved to localStorage["arr"]. all of this was in options.html. On bg.html (Background page) first of all, i get array from localStorage (all is fine by now).then i create contextmenu items in a loop. I have ONLY ONE onclick event handler for all contextmenu items. Inside of event handler, i'm trying to get the right array element (on which site to search) and selectontext(what to search), and then open a new tab with google search results. My BIGGEST problems: 1)i can't get array element (in event handler) at all!!(on which site to search is undefined). 2)onclick event works only for one of context menu items. 3)sometimes, contextmenu items are created but clicking doesn't work at all!! My code: manifest.json { "name": "Context Site Search", "version" : "0.0.0.1", "background_page" : "bg.html", "options_page": "options.html", "permissions" : [ "tabs", "contextMenus", "http://www.google.com" ] } bg.html: var ar = localStorage.getItem("arr").split(",");//getting array from localStorage for (var i=0;i Please, help! what am i doing wrong?? how to fix this?? Any help is appreciated. Thanks in advance!! UPDATE: Thanks to serg, i'm finally getting something.. but there are new issues: 1) number of contextmenu items mysteriously doubles (and even quintuples!! )sites entered at options page. 2)clicking save button doesn't immediately replace old menuitems with new ones.(Reloading extension is obviously needed). i suspect, i incorrectly wrote save function which runs upon save button click... here's code: var arr = []; function save() { localStorage.clear(); var nodes = document.querySelectorAll("input[type=text]"); for (var i=0; i UPDATE2: i figured out doubling/quintupling thing. it depends on how many times user clicks save button.. 1)Is there a chance to prevent this?? e.g. multiple clicks add ONLY ONE set of values to array?? 2)Contextmenu items still don't change. they change ONLY AFTER reloading extension.. :(( What is the difference between reloading extension and changing localStorage??
