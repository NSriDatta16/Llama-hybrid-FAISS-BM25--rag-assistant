[site]: stackoverflow
[post_id]: 3147613
[parent_id]: 
[tags]: 
Flicker-free drawable ScrolledWindow

I'm trying to build a ScrolledWindow that you can draw on using the mouse, and it's working too, but I'm getting a nasty flicker when the user is drawing on the window while the scrollbars aren't in the "home" position.. To reproduce, run the attached program, scroll a bit down (or to the right) and "doodle" a bit by keeping the left mouse button pressed. You should see a flickering now and then.. import wx class MainFrame(wx.Frame): """ Just a frame with a DrawPane """ def __init__(self, *args, **kw): wx.Frame.__init__(self, *args, **kw) s = wx.BoxSizer(wx.VERTICAL) s.Add(DrawPane(self), 1, wx.EXPAND) self.SetSizer(s) ######################################################################## class DrawPane(wx.PyScrolledWindow): """ A PyScrolledWindow with a 1000x1000 drawable area """ VSIZE = (1000, 1000) def __init__(self, *args, **kw): wx.PyScrolledWindow.__init__(self, *args, **kw) self.SetScrollbars(10, 10, 100, 100) self.prepare_buffer() self.Bind(wx.EVT_PAINT, self.on_paint) self.Bind(wx.EVT_LEFT_DOWN, self.on_mouse_down) self.Bind(wx.EVT_MOTION, self.on_motion) def prepare_buffer(self): self.buffer = wx.EmptyBitmap(*DrawPane.VSIZE) dc = wx.BufferedDC(None, self.buffer) dc.Clear() dc.DrawLine(0, 0, 999, 999) # Draw something to better show the flicker problem def on_paint(self, evt): dc = wx.BufferedPaintDC(self, self.buffer, wx.BUFFER_VIRTUAL_AREA) def on_mouse_down(self, evt): self.mouse_pos = self.CalcUnscrolledPosition(evt.GetPosition()).Get() def on_motion(self, evt): if evt.Dragging() and evt.LeftIsDown(): dc = wx.BufferedDC(wx.ClientDC(self), self.buffer) newpos = self.CalcUnscrolledPosition(evt.GetPosition()).Get() coords = self.mouse_pos + newpos dc.DrawLine(*coords) self.mouse_pos = newpos self.Refresh() if __name__ == "__main__": app = wx.PySimpleApp() wx.InitAllImageHandlers() MainFrame(None).Show() app.MainLoop() I tried using SetBackgroundStyle(wx.BG_STYLE_CUSTOM) , or binding EVT_ERASE_BACKGROUND , or using RefreshRect instead of Refresh , but the flicker is still there.. Any idea on what I might try next? My environment: Xubuntu 9.04, wxPython 2.8.9.1 (but tested on Ubuntu 10.04 too) Many thanks for your time!
