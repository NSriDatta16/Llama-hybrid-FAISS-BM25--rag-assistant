[site]: stackoverflow
[post_id]: 2158741
[parent_id]: 
[tags]: 
MVC Unable to save data

My application is modelled after NerdDinner presented in http://www.asp.net/mvc/learn/ . I am having problem saving my posted edit and create pages even none of the business rules in the following Helper class is violated. The only place that I can think of is the database table foreign keys are violated. Could someone help me to catch the database exception? Thanks. [Bind(Include = "TransfersID,AdmitDate,AdmitTime,MedDate,MedTime,Hospital,Ward,WardPhone," + "CaseMgrName,CaseMgrPhone,MDName,MDPhone,MDPager,AdmitDX,BedType,CallerName,CallerNumber," + "AcceptBy,ListStatus,StatusReport,FeePay,TXFRPriority,InfectionType,OffListReason,OffListDate," + "OffList,EnteredBy,VID,WardExtension,MDExtension,CaseMgrExtension,AddedToListDate," + "OffListTime,TxSource,TxReason,InpatientUnit,CBOC,CLC_ASIH,CNH,OtherServicesNA,BackToHomeFacility")] public partial class Transfer { public bool IsValid { get { return (GetRuleViolations().Count() == 0); } } public IEnumerable GetRuleViolations() { if (AdmitDate == null) yield return new RuleViolation("Admit date is required", "AdmitDate"); if (Hospital == 0) yield return new RuleViolation("Hospital is required", "Hospital"); if (String.IsNullOrEmpty(AdmitDX)) yield return new RuleViolation("Admit DX is required", "AdmitDX"); if (BedType == 0) yield return new RuleViolation("Bed Type is required", "BedType"); if (ListStatus == 0) yield return new RuleViolation("List Status is required", "ListStatus"); yield break; } partial void OnValidate(ChangeAction action) { if (!IsValid) throw new ApplicationException("Rule violations prevent saving"); } } The controller has the following method. [AcceptVerbs(HttpVerbs.Post)] public ActionResult Edit(int id, Transfer collection) { Transfer transfer = vRepository.GetTransfer(id); if (transfer == null) return View("NotFound"); else { try { UpdateModel (transfer); if (transfer.FeePay == 0) transfer.FeePay = null; if (transfer.InfectionType == 0) transfer.InfectionType = null; if (transfer.OffListReason == 0) transfer.OffListReason = null; if (transfer.TxSource == 0) transfer.TxSource = null; if (transfer.TxReason == 0) transfer.TxReason = null; if (transfer.OffListDate.HasValue) transfer.OffList = true; if (!transfer.OffListDate.HasValue) transfer.OffList = false; transfer.EnteredBy = HttpUtility.HtmlEncode(transfer.EnteredBy); transfer.AdmitDX = HttpUtility.HtmlEncode(transfer.AdmitDX); transfer.Ward = HttpUtility.HtmlEncode(transfer.Ward); transfer.WardPhone = HttpUtility.HtmlEncode(transfer.WardPhone); transfer.MDName = HttpUtility.HtmlEncode(transfer.MDName); transfer.MDPhone = HttpUtility.HtmlEncode(transfer.MDPhone); transfer.MDPager = HttpUtility.HtmlEncode(transfer.MDPager); transfer.CallerName = HttpUtility.HtmlEncode(transfer.CallerName); transfer.CallerNumber = HttpUtility.HtmlEncode(transfer.CallerNumber); transfer.CaseMgrName = HttpUtility.HtmlEncode(transfer.CaseMgrName); transfer.CaseMgrPhone = HttpUtility.HtmlEncode(transfer.CaseMgrPhone); transfer.TXFRPriority = HttpUtility.HtmlEncode(transfer.TXFRPriority); transfer.AcceptBy = HttpUtility.HtmlEncode(transfer.AcceptBy); transfer.StatusReport = HttpUtility.HtmlEncode(transfer.StatusReport); transfer.CBOC = HttpUtility.HtmlEncode(transfer.CBOC); transfer.CLC_ASIH = HttpUtility.HtmlEncode(transfer.CLC_ASIH); transfer.CNH = HttpUtility.HtmlEncode(transfer.CNH); transfer.OtherServicesNA = HttpUtility.HtmlEncode(transfer.OtherServicesNA); transfer.EnteredBy = HttpContext.User.Identity.Name; vRepository.Save(); return RedirectToAction("Details", new { id = transfer.TransfersID }); } catch { ModelState.AddModelErrors(transfer.GetRuleViolations()); return View(new TransferFormViewModel(transfer)); } } } } ****Both pages use shared form in a user controll.**** " %> Transfer for Transfer ID: VID: SSN: DOB: %SC: PCP: Insurance: COJ: Eligibility: Transfer Record ID: Hospital: Admit DX: Bed Type: Admit Date: List Status Ward: Ward Phone Referred MD: MD Phone: MD Pager: Admit Time: Caller Name: Caller Number: Case Mgr: Mgr Phone: Med Date: Med Time: TXFR Priority: Accepted By: Off List Reason: Off List Date: Infection Type: Fee Pay: Status Report: Trnasfer Out Source: ED EdPsych Inpatient Unit CBOC CLC CNH Treansfer Out Reason: EDdivert Trauma OBGYN Bed Type Not Available Non V Not Eligible Other Services Not Available Transfer Back to Home Facility Added to List Date:
