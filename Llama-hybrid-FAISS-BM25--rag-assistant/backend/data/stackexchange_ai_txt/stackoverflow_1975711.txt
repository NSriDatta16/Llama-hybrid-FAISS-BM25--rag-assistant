[site]: stackoverflow
[post_id]: 1975711
[parent_id]: 1975613
[tags]: 
I would run the submitted code through tidy to normalize it first, and then use xpath or apply xslt to only select allowed elements. This way, nothing can leak. Do bear in mind, too, that in any given website situation you would probably have thousands if not hundreds of thousands of read requests for every write request [that uses tidy and xpath/xslt] so on average the performance impact is negligible. If you are doing batch processing on the other hand.. Edit: oh and: DON'T do this with regular expressions. It is mathematically impossible to do it correctly.
