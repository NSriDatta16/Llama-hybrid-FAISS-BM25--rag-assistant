[site]: crossvalidated
[post_id]: 413101
[parent_id]: 
[tags]: 
Bayesian hierarchical coin flip model

My question is: what is the marginal probability $P(x_1, x_2, \dots, x_n | y_1, y_2, \dots, y_n, \alpha, \beta)$ or $P(X|Y, \alpha, \beta)$ ? in the following model: $\phi \sim \text{Beta}(\alpha, \beta)\\ z_i \sim \text{Bern}(\phi)\\ x_i \sim \text{Bern}(z_i y_i)$ I feel like this may be a trivial question, but I've been banging my head against the desk for hours. Hopefully someone can put me out of my misery, or at least point me in the right direction. $x_i$ and $y_i$ are known for all $n$ individuals, and $\alpha$ and $\beta$ are known. In words, for every individual $i$ , they receive a coin flip from the same coin with unknown success probability $\phi$ . If the result is a success (1), then that individual receives a flip from a different coin with known success probability $y_i$ ie. a different coin for each individual. I can write down: $P(X, Z, \phi | Y, \alpha, \beta) = P(X|Z, Y)P(Z|\phi)P(\phi|\alpha, \beta)$ . and it's easy to marginalise out $\phi$ as: $P(X, Z | Y, \alpha, \beta)\\ = P(X|Z, Y)P(Z) \\ =P(X|Z, Y, \alpha, \beta) \int_0^1 P(Z|\phi)P(\phi|\alpha, \beta) d\phi\\ = P(X|Z, Y)\frac{\text{Beta}(\sum z + \alpha, n - \sum z + \beta)}{\text{Beta}(\alpha, \beta)}$ I'm also pretty sure that: $P(X | Y, \alpha, \beta)\\ = \sum_{z} P(X | Z=z, Y, \alpha, \beta) P(Z=z|Y, \alpha, \beta)\\ = \sum_{z} P(X | Z=z, Y, \alpha, \beta) \frac{\text{Beta}(\sum z + \alpha, n - \sum z + \beta)}{\text{Beta}(\alpha, \beta)}$ But that's as far as I get before my knowledge runs out! I feel like there should be a further simplification that I'm missing, possibly using expectations $E(Z|X)$ or something which would make the last term manageable when $n$ is large. Any advice would be appreciated, thanks!
