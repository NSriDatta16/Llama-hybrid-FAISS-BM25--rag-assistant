[site]: stackoverflow
[post_id]: 3621961
[parent_id]: 
[tags]: 
ASP.NET MVC - Unit testing RenderPartialViewToString() with Moq framework?

I'm using this helper method to turn my PartialViewResult into string and returning it as Json - http://www.atlanticbt.com/blog/asp-net-mvc-using-ajax-json-and-partialviews/ My problem is that I'm using Moq to mock the controller, and whenever I run unit test that uses this RenderPartialViewToString() method, I got the "Object reference not set to an instance of an object." error on ControllerContext. private ProgramsController GetController() { var mockHttpContext = new Mock (); mockHttpContext.SetupGet(p => p.HttpContext.User.Identity.Name).Returns("test"); mockHttpContext.SetupGet(p => p.HttpContext.Request.IsAuthenticated).Returns(true); // Mock Repositories var mockOrganizationRepository = new MockOrganizationRepository(MockData.MockOrganizationsData()); var mockIRenderPartial = new BaseController(); var controller = new ProgramsController(mockOrganizationRepository, mockIRenderPartial); controller.ControllerContext = mockHttpContext.Object; return controller; } This returns a proxy controller, and maybe it's the reason why I got that error. Any idea how to unit testing this? Thank you very much.
