[site]: stackoverflow
[post_id]: 4668050
[parent_id]: 
[tags]: 
Bringing in value of Coupon Code into "tax" calculation.php in magento

Im trying to pull in the name of the discount code currently applied to the cart into the calculation.php file. The name of the discount code is optionalTax but Im having trouble passing it through or retrieving it directly. Its appears to be referenced as $quote->getCouponCode() in mage/sales/model/quote.php and I want to use it in mage/tax/model/calculation.php Anyone have any idea on how to call it in as I've tried using the model as per (which I think is correct) public function calcTaxAmount($price, $taxRate, $priceIncludeTax=false, $round=true) { $taxRate = $taxRate/100; if ($priceIncludeTax) { $amount = $price*(1-1/(1+$taxRate)); } else { $cModel = Mage::getModel('catalog/sales'); $thisDiscountCode = $cModel->$quote->getCouponCode(); die($thisDiscountCode); $amount = $price*$taxRate; } if ($round) { return $this->round($amount); } else { return $amount; } } Chris
