[site]: crossvalidated
[post_id]: 493326
[parent_id]: 18563
[tags]: 
Your title says "with lme4 or nlme package", but your text says How can I achieve this using R packages, perhaps with nlme or lme4? I know that ASREML can do it but I do not have hold and I love R for being robust as well as free. This approach is not based on these two packages, but it is open source and very flexible. GBLUP with arbitrary covariance structure is a special case of RKHS regression aka Kernel Ridge Regression . The package BGLR estimates the variance components in a Bayesian Framework. An alternative is the package KRMM that seems to solve the same model but using Expectation Maximization instead of a Bayesian approach (Gibbs sampling). But I didn't test that. This excerpt from the BGLR extended documentation computes y ~ a + g + e where a is a random effect with a pedigree-derived covariance structure, g is a random effect using a marker-derived covariance structure (you can use another genetic distance instead of the definition shown here) and e is the residual. For your problem, you can of course just omit a (= list(K=A, ... ). The genomic relationship matrices ( G and A in this example) must relate 1-to-1 to the genotype order in y , so if a genotype occurs multiple times in y , it must do so in the matrices as well. Box 4a: Fitting a Pedigree + Markers regression using Gaussian Processes #1# Loading and preparing the input data library(BGLR); data(wheat);Y See also these examples of different ways to compute GBLUP . This documentation page shows an example including fixed effects (and other methods, such as BayesB, just use those models you need): pheno=mice.pheno fm=BGLR(y=pheno$Obesity.BMI, ETA=list( fixed=list(~factor(GENDER)+factor(Litter),data=pheno,model='FIXED'), cage=list(~factor(cage),data=pheno,model='BRR'), ped=list(K=A,model='RKHS'), mrk=list(X=X,model='BayesB') ) )
