[site]: stackoverflow
[post_id]: 3941985
[parent_id]: 3941908
[tags]: 
I use this function from wordpress, wraps p's around paragraphs nicely as well as line breaks whilst preserving HTML: function wpautop($pee, $br = 1) { $pee = $pee . "\n"; // just to make things a little easier, pad the end $pee = preg_replace('| \s* |', "\n\n", $pee); // Space things out a little $allblocks = '(?:table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|map|area|blockquote|address|math|style|input|p|h[1-6]|hr)'; $pee = preg_replace('!( ]*>)!', "\n$1", $pee); $pee = preg_replace('!( )!', "$1\n\n", $pee); $pee = str_replace(array("\r\n", "\r"), "\n", $pee); // cross-platform newlines $pee = preg_replace("/\n\n+/", "\n\n", $pee); // take care of duplicates $pee = preg_replace('/\n?(.+?)(?:\n\s*\n|\z)/s', " $1 \n", $pee); // make paragraphs, including one at the end $pee = preg_replace('| \s*? |', '', $pee); // under certain strange conditions it could create a P of entirely whitespace $pee = preg_replace('! ([^ ]*>)!', " $1 $2", $pee); $pee = preg_replace( '| |', "$1 ", $pee ); $pee = preg_replace('! \s*( ]*>)\s* !', "$1", $pee); // don't pee all over a tag $pee = preg_replace("| ( |", "$1", $pee); // problem with nested lists $pee = preg_replace('| ]*)>|i', " ", $pee); $pee = str_replace(' ', ' ', $pee); $pee = preg_replace('! \s*( ]*>)!', "$1", $pee); $pee = preg_replace('!( ]*>)\s* !', "$1", $pee); if ($br) { $pee = preg_replace('|(? )\s*\n|', " \n", $pee); // optionally make line breaks } $pee = preg_replace('!( ]*>)\s* !', "$1", $pee); $pee = preg_replace('! (\s* ]*>)!', '$1', $pee); $pee = preg_replace( "|\n $|", ' ', $pee ); return $pee; }
