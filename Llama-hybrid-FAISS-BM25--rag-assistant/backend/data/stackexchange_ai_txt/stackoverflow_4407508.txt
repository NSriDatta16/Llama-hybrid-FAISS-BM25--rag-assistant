[site]: stackoverflow
[post_id]: 4407508
[parent_id]: 
[tags]: 
How to remove an email message in Maildir from PHP?

I'm going crazy with a little problem with Maildir and PHP. I need to check the APACHE_RUN_USER 's Maildir and parse delivery-status messages. The problem removing message after reading; i noticed that Zend_Mail_Storage_Maildir->removeMessage() is still a stub. try { $mailbox = new Zend_Mail_Storage_Maildir( array('dirname' => '/home/' . $_ENV['APACHE_RUN_USER'] . '/Maildir/') ); foreach ($mailbox as $id => $message) { // seen flag if ($message->hasFlag(Zend_Mail_Storage::FLAG_SEEN)) { continue; } //get the unique id $uniqueid = $mailbox->getUniqueId($id); //obtain message headers $headers = $message->getHeaders(); //check if the original message was sent from this app and is a delivery-status $result = strpos($message, $id_header); if($result === false) { echo '1 mail skipped: ' . $uniqueid . '. '; continue; } $result = strpos($headers['content-type'], 'delivery-status'); //if no skip to the next mail if($result === false) { echo '1 mail skipped: ' . $uniqueid . '. '; continue; } // if everything it's ok process it. // clear results $data = array(); // foreach line of message foreach( preg_split('/(\r?\n)/', $message) as $line ){ //clear results $matches = array(); //perform matches on textlines if( preg_match('/^(.+)\:\s{0,1}(.+)$/', $line, $matches) ) { //grab intrested headers foreach( array('Action', 'Status', 'Remote-MTA', 'Diagnostic-Code', $id_header) as $header) { if($matches[1] == $header) $data[$header] = $matches[2]; } } } // *** I NEED TO DROP THE MESSAGE HERE *** // not working code *** $currentmessageid = $mailbox->getNumberByUniqueId($uniqueid); $mailbox->removeMessage($currentmessageid); // *** I NEED TO DROP THE MESSAGE HERE *** // print out results echo ' '; print_r( $data ); echo ' '; } } catch (Exception $e) { echo $e; } How can I remove it by hand? Some workarounds? Thanks.
