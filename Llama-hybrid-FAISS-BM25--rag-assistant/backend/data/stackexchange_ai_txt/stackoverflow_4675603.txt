[site]: stackoverflow
[post_id]: 4675603
[parent_id]: 
[tags]: 
System.InvalidOperationException when trying to iteratively add objects using EF 4

This question is very similiar to this one . However, the resolution to that question: Does not seem to apply, or Are somewhat suspect, and don't seem like a good approach to resolving the problem. Basically, I'm iterating over a generic list of objects, and inserting them. Using MVC 2, EF 4 with the default code generation. foreach(Requirement r in requirements) { var car = new CustomerAgreementRequirement(); car.CustomerAgreementId = viewModel.Agreement.CustomerAgreementId; car.RequirementId = r.RequirementId; _carRepo.Add(car); //Save new record } And the Repository.Add() method: public class BaseRepository : IRepository where TEntity : class { private TxRPEntities txDB; private ObjectSet _objectSet; public void Add(TEntity entity) { SetUpdateParams(entity); _objectSet.AddObject(entity); txDB.SaveChanges(); } I should note that I've been successfully using the Add() method throughout my code for single inserts; this is the first time I've tried to use it to iteratively insert a group of objects. The error: System.InvalidOperationException: The changes to the database were committed successfully, but an error occurred while updating the object context. The ObjectContext might be in an inconsistent state. Inner exception message: AcceptChanges cannot continue because the object's key values conflict with another object in the ObjectStateManager. Make sure that the key values are unique before calling AcceptChanges. As stated in the prior question, the EntityKey is set to True, StoreGeneratedPattern = Identity. The actual table that is being inserted into is a relationship table, in that it is comprised of an identity field and two foreign key fields. The error always occurs on the second insert, regardless of whether that specific entity has been inserted before or not, and I can confirm that the values are always different, no key conflicts as far as the database is concerned. My suspicion is that it has something to do with the temporary entitykey that gets set prior to the actual insert, but I don't know how to confirm that, nor do I know how to resolve it. My gut feeling is that the solution in the prior question, to set the SaveOptions to None, would not be the best solution. (See prior discussion here )
