[site]: crossvalidated
[post_id]: 552606
[parent_id]: 
[tags]: 
Correct model formula to account for crossed and nested simultaneously?

I set some models to test some specific contrasts. But I'm not sure which will correctly address the repeated measurements over my individuals. The dataset has: id = subject id, factor with 83 levels tissue = factor with 2 levels (within-subj) time = factor with 2 levels (within-subj) group = factor with 2 levels (between-subj) batch = factor with 2 levels This is not completely balanced (crossed) neither for time, tissue, nor batch. I'm interested in testing only the following contrasts: disease_tuberculosis - disease_other in tissue_lung and time_before_treat disease_tuberculosis - disease_other in tissue_blood and time_before_treat tissue_lung - tissue_blood in disease_tuberculosis and time_before_treat tissue_lung - tissue_blood in disease_other and time_before_treat Time_after_treat - time_before_treat in tissue_lung and disease_tuberculosis I tried some models that could give me coefficients that I could specify contrasts to estimate these differences above. My problem is, I'm not sure which one addresses the repeated measures on subjects and results in correct degrees of freedom and, consequently, P-values. I'm referring to the df reported in emmeans after setting up my contrasts. I'm inclined to use the most simple model, the one with a random intercept for id, but I'm afraid that the df might be inflated. Alternatively, I thought about throwing out the batch variable by taking the average by batch per id. I also appreciate if you have any suggestions of books that help learn this subject further. Here's my code: set.seed(10) library("nlme") library("emmeans") # download dataset into df1 object source("https://pastebin.com/raw/inQJ2kXy") fit1
