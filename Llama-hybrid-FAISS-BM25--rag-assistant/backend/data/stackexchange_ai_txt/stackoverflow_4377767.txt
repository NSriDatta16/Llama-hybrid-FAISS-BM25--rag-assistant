[site]: stackoverflow
[post_id]: 4377767
[parent_id]: 
[tags]: 
Complex MySQL-Query: Get Name of object, and count and average-value of all grandchildren

I have ratings, which represent a rating of a product. These ratings have a value (Integer between 1 and 5), a product_id and a rating_type_id. Ratings have a many-to-one relationship to rating_types. rating_types have a many_to_one relationship to rating_categories. Meaning: one rating_category has several rating_types and one rating_types has several ratings . In addition every product has a many-to-many relationship to rating_categories. Meaning, that given product can only be rated by ratings, whose rating_type belongs to these rating_categories. For a given product_id, I would like to retrieve for every rating_category, the category-Name, the count of all ratings and the average of all ratings. These ratings have the product_id as a foreign key, and have to have a rating_type as a foreignkey, whose rating_type has a rating_category as a foreignKey. This is my Query so far, but it is wrong: SELECT rc.name, rc.rating_category_id, (SELECT COUNT(*) as count, AVG(value) as average FROM rating WHERE rating_id IN ( SELECT r.rating_id FROM rc // I want to reference the same rating_category rc as above LEFT JOIN rating_type rt ON rating_category_id LEFT JOIN rating r ON rating_type_id ) ) FROM rating_category_4_product rc4p LEFT JOIN rating_category rc ON rating_category_id WHERE rc4p.product_id = {$productId}
