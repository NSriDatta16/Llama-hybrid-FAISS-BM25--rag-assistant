[site]: stackoverflow
[post_id]: 3596881
[parent_id]: 
[tags]: 
Mysql query - invalid use of group function

mysql_query(" SELECT b.id as b_id FROM banner b INNER JOIN bannerhits bl ON b.id = bl.bannerid AND bl.userid = '".$this->userid."' INNER JOIN bannerhits blog ON b.id = blog.bannerid INNER JOIN bannerklik bk ON b.id = bk.bannerid WHERE ( b.placement = '".$place."' AND ( b.usertype = '".$usertype."' OR b.usertype = '' ) AND b.userpostalcode LIKE ',".$postcode.",' AND ( b.userage LIKE ',".$ageYears.",' OR b.userage IS NULL ) AND ( b.maxviewsprday > count(bl.id) OR b.maxviewsprday IS NULL ) AND b.maxhits > count(blog.id) AND b.maxklik > count(bk.id) ".$ubid." ) OR remainingshow = '1' GROUP BY bl.id, bk.id, blog.id ORDER BY remainingshow ASC LIMIT 1 "); Hello.. This tells me, that it is "invalid use of group function" .. what I want to do is to make sure, that when I count my log for clicks and shows of the banner, there has to be fewer rows with the bannerid=b.id in the log, than the fields b.maxklik and b.maxhits says (so I can set e.g. 6000 clicks or 50000 shows for a banner).. Can you help with a mysql query that should work?? EDIT 2: Same error SELECT bl.id as bl_id, bk.id as bk_id, blog.id as blog_id FROM banner b INNER JOIN bannerhits bl ON b.id = bl.bannerid AND bl.userid = '".$this->userid."' INNER JOIN bannerhits blog ON b.id = blog.bannerid INNER JOIN bannerklik bk ON b.id = bk.bannerid WHERE ( b.placement = '".$place."' AND ( b.usertype = '".$usertype."' OR b.usertype = '' ) AND b.userpostalcode LIKE ',".$postcode.",' AND ( b.userage LIKE ',".$ageYears.",' OR b.userage IS NULL ) AND ( b.maxviewsprday > count(bl.id) OR b.maxviewsprday IS NULL ) AND b.maxhits > count(blog.id) AND b.maxklik > count(bk.id) ".$ubid." ) OR remainingshow = '1' GROUP BY b.id, bl.id, bk.id, blog.id ORDER BY remainingshow ASC LIMIT 1 EDIT 3: SELECT b.id as b_id, b.maxhits as b_maxhits, b.maxklik as b_maxkli, b.maxviewsprday as b_maxviewsprday FROM banner b JOIN bannerhits bl ON b.id = bl.bannerid AND bl.userid = '".$this->userid."' JOIN bannerhits blog ON b.id = blog.bannerid JOIN bannerklik bk ON b.id = bk.bannerid WHERE ( b.placement = '".$place."' AND b.usertype IN ('".$usertype."', '') AND b.userpostalcode LIKE ',".$postcode.",' AND ( b.userage LIKE ',".$ageYears.",' OR b.userage IS NULL ) AND b.maxviewsprday IS NULL ) OR b.remainingshow = '1' GROUP BY bl.id, bk.id, blog.id HAVING (b.maxhits > count(blog.id) OR b.maxhits = '0') AND (b.maxklik > count(bk.id) OR b.maxklik = '0') AND (b.maxviewsprday > count(bl.id) OR b.maxviewsprday = '0') ORDER BY b.remainingshow ASC LIMIT 1
