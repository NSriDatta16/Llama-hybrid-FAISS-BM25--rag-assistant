[site]: crossvalidated
[post_id]: 39129
[parent_id]: 
[tags]: 
How to sample transactions to estimate customer-level effects

Let's say I am trying to estimate the treatment effect of rude waiters on how often customers frequent a restaurant. To simplify, let's assume that rudeness is binary, observable, and random. I consider the population of all transactions in October, and I see that some customers have eaten multiple meals and others only once. My outcome will be number of meals in November-Dec period. I would like to construct a customer-level cross section out of my panel data since the estimation method I am using gets complicated with non-independent observations. I have three options available to me: Grab a random transaction for each customer. Use the waiter from that transaction to determine if a diner was treated or not. Aggregate the October data by calculating the # of rude waiters/# of meals for each customer For each person, grab a random rude transactions if there was a rude one at any time in October. Otherwise, grab a random transaction. Unfortunately (2) is off the table since there are other attributes of the meal that are hard to aggregate. Method (1) has the problem that 2 people who both dined twice and had rude transactions half of the time might wind up in separate groups, which seems strange since they have the exact same history. Method (3) seems the most sensible, but it is giving me an estimate that have the wrong sign, and seem fragile. I have three related questions: Is there anything wrong with (3) from a theoretical sampling perspective? Can I rationalize using (1), since on average the mis-assignment bias might cancel out? Can I get my cross section in some other way, perhaps by adding weights of some sort?
