[site]: stackoverflow
[post_id]: 5288115
[parent_id]: 5287723
[tags]: 
I have done a fairly standard refactor to reduce the number of nested if statements (this is a common breeding ground for logic errors and confusion). I would encourage you to post a bit of test data ( a fixture if you will ) of the data you would expect to get this actually working. A segment of valid dom and a sample of cell data should be enough. function drawPreview() { var $preview = $('#preview'), x, y, area, i, j; function repeat( text, count ){ var i=0, out = ''; for( ; i++ ' + repeat(' ' + repeat(' ', 4) + ' ', 3) + ' ')); i = y-1; j = x-1; function loadCell() { var exp = new RegExp("x"+i+"_"+j+"x","g"), sel_area; if (! area.match(exp)){ if (i==y+1&&j==x+1) { return; } else if (j==x+1) { ++i; j = x-1; loadCell(); } else { ++j; loadCell(); } return; } if (i==y&&j==x) { $('#active_cell').clone() .children() .unwrap() .appendTo($preview.children() .eq(1) .children() .eq(1) ); ++j; loadCell(); return; } var sel_area = $('#select_area').val(); var jqxhr = $.getJSON('data/areas/'+ sel_area +'/'+x+"_"+y+'.json', function(data) { var tmp = data, l = 0, m = 0; for ( l=0; l '); } for ( l=0; l '); } for ( l = 0; l
