[site]: stackoverflow
[post_id]: 954756
[parent_id]: 
[tags]: 
PHP function to check domain availability not working

I am unable to get this script to function correctly. When i try to pass a domain to it, it always returns AVAILABLE, even for cnn.com! $message is the name of the domain that i am checking the availability of. This is the function call; include("domain.class.php"); // Initializing class $domain=new domain("$message"); // Checking if domain is available if($domain->is_available()){ $status = "$message is available"; }else{ $status = "$message is unavailable"; echo = $status; } And this is domain.class.php; domain=$str_domainname; } function info(){ if($this->is_valid()){ $tldname=$this->get_tld(); $domainname=$this->get_domain(); $whois_server=$this->get_whois_server(); if($whois_server!=""){ $fp = fsockopen($whois_server,43); $dom=$domainname.".".$tldname; // fputs($fp, "$dom\r\n"); // New IDN if($tldname=="de") { fputs($fp, "-C ISO-8859-1 -T dn $dom\r\n"); } else { fputs($fp, "$dom\r\n"); } // Getting string $string=""; // Checking whois server for .com and .net if($tldname=="com" || $tldname=="net" || $tldname=="edu"){ while(!feof($fp)){ $line=trim(fgets($fp,128)); $string.=$line; $lineArr=split(":",$line); if(strtolower($lineArr[0])=="whois server"){ $whois_server=trim($lineArr[1]); } } // Getting whois information $fp = fsockopen($whois_server,43); $dom=$domainname.".".$tldname; fputs($fp, "$dom\r\n"); // Getting string $string=""; while(!feof($fp)){ $string.=fgets($fp,128); } // Checking for other tld's }else{ while(!feof($fp)){ $string.=fgets($fp,128); } } fclose($fp); return $string; }else{ return "No whois server for this tld in list!"; } }else{ return "Domainname isn't valid!"; } } /** * Returns the whois data of the domain in HTML format * @return string $whoisdata Whois data as string in HTML * @desc Returns the whois data of the domain in HTML format */ function html_info(){ return nl2br($this->info()); } /** * Returns name of the whois server of the tld * @return string $server the whois servers hostname * @desc Returns name of the whois server of the tld */ function get_whois_server(){ $found=false; $tldname=$this->get_tld(); for($i=0;$i servers);$i++){ if($this->servers[$i][0]==$tldname){ $server=$this->servers[$i][1]; $full_dom=$this->servers[$i][3]; $found=true; } } return $server; } /** * Returns the tld of the domain without domain name * @return string $tldname the tlds name without domain name * @desc Returns the tld of the domain without domain name */ function get_tld(){ // Splitting domainname $domain=split("\.",$this->domain); if(count($domain)>2){ $domainname=$domain[0]; for($i=1;$i servers);$i++){ $tlds[$i]=$this->servers[$i][0]; } return $tlds; } /** * Returns the name of the domain without tld * @return string $domain the domains name without tld name * @desc Returns the name of the domain without tld */ function get_domain(){ // Splitting domainname $domain=split("\.",$this->domain); return $domain[0]; } /** * Returns the full domain * @return string $fulldomain * @desc Returns the full domain */ function get_fulldomain(){ return $this->domain; } /** * Returns the string which will be returned by the whois server of the tld if a domain is avalable * @return string $notfound the string which will be returned by the whois server of the tld if a domain is avalable * @desc Returns the string which will be returned by the whois server of the tld if a domain is avalable */ function get_notfound_string(){ $found=false; $tldname=$this->get_tld(); for($i=0;$i servers);$i++){ if($this->servers[$i][0]==$tldname){ $notfound=$this->servers[$i][2]; } } return $notfound; } /** * Returns if the domain is available for registering * @return boolean $is_available Returns 1 if domain is available and 0 if domain isn't available * @desc Returns if the domain is available for registering */ function is_available(){ $whois_string=$this->info(); // Gets the entire WHOIS query from registrar $not_found_string=$this->get_notfound_string(); // Gets 3rd item from array $domain=$this->domain; // Gets current domain being queried $whois_string2=@ereg_replace("$domain","",$whois_string); $whois_string =@preg_replace("/\s+/"," ",$whois_string); //Replace whitespace with single space $array=split(":",$not_found_string); if($array[0]=="MAXCHARS"){ if(strlen($whois_string2) domain); // If it's a tld with two Strings (like co.uk) if(count($domainArr)==3){ $tld=$domainArr[1].".".$domainArr[2]; $found=false; for($i=0;$i servers) && $found==false;$i++){ if($this->servers[$i][0]==$tld){ $found=true; } } if(!$found){ return false; } }else if(count($domainArr)>3){ return false; } // Creating regular expression for if($this->get_tld()=="de"){ for($i=0;$i idn);$i++){ $idn.=chr($this->idn[$i]); // $idn.="\x".$this->idn[$i].""; } $pattern="^[a-z".$idn."0-9\-]{3,}$"; }else{ $pattern="^[a-z0-9\-]{3,}$"; } if(ereg($pattern,strtolower($this->get_domain())) && !ereg("^-|-$",strtolower($this->get_domain())) && !preg_match("/--/",strtolower($this->get_domain()))){ return true; }else{ return false; } } } ?> Ive been studying over this and trying different things for a while. Could someone point me in the right direction? Id love to learn what im missing here.
