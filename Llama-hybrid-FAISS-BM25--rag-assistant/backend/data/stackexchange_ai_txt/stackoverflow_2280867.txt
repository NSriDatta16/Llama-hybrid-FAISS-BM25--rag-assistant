[site]: stackoverflow
[post_id]: 2280867
[parent_id]: 2280158
[tags]: 
Here is the solution. There may be some more elegant options (lock...) but this one works. /** * Will remove the persistent store */ - (NSPersistentStoreCoordinator *)resetPersistentStore { NSError *error = nil; if ([persistentStoreCoordinator persistentStores] == nil) return [self persistentStoreCoordinator]; [managedObjectContext reset]; [managedObjectContext lock]; // FIXME: dirty. If there are many stores... NSPersistentStore *store = [[persistentStoreCoordinator persistentStores] lastObject]; if (![persistentStoreCoordinator removePersistentStore:store error:&error]) { NSLog(@"Unresolved error %@, %@", error, [error userInfo]); abort(); } // Delete file if ([[NSFileManager defaultManager] fileExistsAtPath:store.URL.path]) { if (![[NSFileManager defaultManager] removeItemAtPath:store.URL.path error:&error]) { NSLog(@"Unresolved error %@, %@", error, [error userInfo]); abort(); } } // Delete the reference to non-existing store [persistentStoreCoordinator release]; persistentStoreCoordinator = nil; NSPersistentStoreCoordinator *r = [self persistentStoreCoordinator]; [managedObjectContext unlock]; return r; }
