[site]: stackoverflow
[post_id]: 1935385
[parent_id]: 
[tags]: 
How to extract the first hit elements from an XML NCBI BLAST file?

Im trying to extract only the first hit from an NCBI xml BLAST file. next I would like to get only the first HSP. at the final stage I would like to get these based on best score. to make things clear here a sample of the xml file: blastx blastx 2.2.22 [Sep-27-2009] ~Reference: Altschul, Stephen F., Thomas L. Madden, Alejandro A. Schaffer, ~Jinghui Zhang, Zheng Zhang, Webb Miller, and David J. Lipman (1997), ~&quot;Gapped BLAST and PSI-BLAST: a new generation of protein database search~programs&quot;, Nucleic Acids Res. 25:3389-3402. /Applications/blast/db/viral1.protein.faa lcl|1_0 DSAD-090629_plate11A01a.g1 CHROMAT_FILE: DSAD-090629_plate11A01a.g1 PHD_FILE: DSAD-090629_plate11A01a.g1.phd.1 CHEM: term DYE: big TIME: Thu Sep 17 15:33:59 2009 TEMPLATE: DSAD-090629_plate11A01a DIRECTION: rev 1024 BLOSUM62 1e-05 11 1 F 1 lcl|1_0 DSAD-090629_plate11A01a.g1 CHROMAT_FILE: DSAD-090629_plate11A01a.g1 PHD_FILE: DSAD-090629_plate11A01a.g1.phd.1 CHEM: term DYE: big TIME: Thu Sep 17 15:33:59 2009 TEMPLATE: DSAD-090629_plate11A01a DIRECTION: rev 1024 68007 19518578 0 0 0.041 0.267 0.14 No hits found 6 lcl|6_0 DSAD-090629_plate11A05a.g1 CHROMAT_FILE: DSAD-090629_plate11A05a.g1 PHD_FILE: DSAD-090629_plate11A05a.g1.phd.1 CHEM: term DYE: big TIME: Thu Sep 17 15:33:59 2009 TEMPLATE: DSAD-090629_plate11A05a DIRECTION: rev 1068 1 gnl|BL_ORD_ID|23609 gi|38707884|ref|NP_945016.1| Putative ribose-phosphate pyrophosphokinase [Enterobacteria phage Felix 01] 23609 293 1 49.2914 116 5.15408e-06 580 792 202 273 -1 26 45 2 73 MHIIGDVE--GRTCILVDDMVDTAGTLCHAAKALKERGAAKVYAYCTHPVLSGRAIENIENSVLDELVVTNTI MRILDDVDLTDKTVMILDDICDGGRTFVEAAKHLREAGAKRVELYVTHGIFS-KDVENLLDNGIDHIYTTNSL M I+ DV+ +T +++DD+ D T AAK L+E GA +V Y TH + S + +EN+ ++ +D + TN++ 2 gnl|BL_ORD_ID|2466 gi|51557505|ref|YP_068339.1| large tegument protein [Suid herpesvirus 1] 2466 3084 1 48.9062 115 6.70494e-06 369 875 2312 2465 -2 52 70 4 173 APESQEPGASTWRSSTSVVKKGQPSQK*CTSSVTSKAVPASWSTTWSTLPAPCATPPKR*KSAAPPRSTPTAPTRCCPAAPSRTSRIPSWTSWWSPTPSRCPLRRSPARVFASSTSPR-SSPKRSAASATKNRSAP---CSAKRNWPDHTAPPRAGLFALPPEAGRKPQGGLV APPAQKPPAQPATAAATTAPKATPQTQPPTRAQTQTAPPPPSAAT-----AAAQVPPQ------PPSSQPAAKPRGAPPAPPAPP--PPSAQTTLPRPAAPPAPPPPS---AQTTLPRPAPPPPSAPAATPTPPAPGPAPSAKKSDGDRIVEPKAG---APPDVRDAKFGGKV AP +Q+P A ++ + K P + T + T A P + T A PP+ PP S P A R P AP P P P+ P P+ A +T PR + P SA +AT AP SAK++ D P+AG PP+ GG V 68007 19518578 0 0 0.041 0.267 0.14 basically each query search creates an Iteration element. each iteration can have multiple hit which in turn can have multiple HSPs. I would like to get only the first hit and it's first HSP from each iteration. if the BLAST found no hits I would like to ignore the iteration. I worked up this simple code: #!/usr/bin/env python from elementtree.ElementTree import parse from elementtree import ElementTree as ET file = open("/Applications/blast/blanes_viral_nr_results.xml", "r") save_file = open("/Applications/blast/Blast_parse_ET.txt", 'w') tree = parse(file) elem = tree.getroot() print elem Per_ID = () save_file.write('>%s\t%s\t%s\t%s\t%s\t%s\t\n\n\n\n' % ("It_Num\t", "It_ID\t", "Hit_Def\t", "Num\t", "ID\t", "ACC\t")) iteration = tree.findall('BlastOutput_iterations/Iteration') for iteration in iteration: for hit in iteration.findall('Iteration_hits/Hit'): It_Num = iteration.findtext('Iteration_iter-num') It_ID = iteration.findtext('Iteration_query-def') Hit_Def = hit.findtext('Hit_def') Num = hit.findtext('Hit_num') ID = hit.findtext('Hit_id') DEF = hit.findtext('Hit_def') ACC = hit.findtext('Hit_accession') save_file.write('>%s\t%s\t%s\t%s\t%s\t%s\t' % (It_Num, It_ID[12:26], Hit_Def[1:10], Num, ID, ACC,)) for hsp in hit.findall('Hit_hsps'): HSPN = hsp.findtext('Hsp/Hsp_num') identities = hsp.findtext('Hsp/Hsp_identity') #print 'id: ', identities.rjust(4), length = hsp.findtext('Hsp/Hsp_align-len') #print 'len:', length.rjust(4), Per_ID = int(identities) * 100.0 / int(length) #print hsp.findtext('Hsp/Hsp_qseq')[:50] #print hsp.findtext('Hsp/Hsp_midline')[:50] #print hsp.findtext('Hsp/Hsp_hseq')[:50] save_file.write('%s\t%s\t%s\%st\n' % ('***', '%', HSPN, Per_ID)) save_file.write('n\n' % ()) any help would be greatly appriciated!
