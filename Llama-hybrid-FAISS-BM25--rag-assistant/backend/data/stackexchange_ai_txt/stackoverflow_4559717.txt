[site]: stackoverflow
[post_id]: 4559717
[parent_id]: 
[tags]: 
Wrong PIDL got from CIDA when dragging a Control Panel item

I'm working on a drag and drop problem now and trying to get the PIDLs of the items being dragged from windows shell to my application. The code below can get correct PIDLs if the dragged item is 'My Computer' or 'Control Panel' itself, but it doesn't work when the dragged item is an item in the 'Control Panel'. What's wrong with my code? #define GetPIDLFolder(pida) (LPCITEMIDLIST)(((LPBYTE)pida)+(pida)->aoffset[0]) #define GetPIDLItem(pida, i) (LPCITEMIDLIST)(((LPBYTE)pida)+(pida)->aoffset[i+1]) STGMEDIUM medium; UINT fmt = RegisterClipboardFormat(CFSTR_SHELLIDLIST); FORMATETC fe= {fmt, NULL, DVASPECT_CONTENT, -1, TYMED_HGLOBAL}; HRESULT GETDATA_RESULT = pDataObject->GetData(&fe, &medium); if (SUCCEEDED(GETDATA_RESULT)) { LPIDA pida = (LPIDA)GlobalLock(medium.hGlobal); LPCITEMIDLIST pidlFolder = GetPIDLFolder(pida); int n = pida->cidl; // the n is always correct if( n > 0 ) { LPCITEMIDLIST pidlItem = GetPIDLItem(pida, 0); // the pidlItem is wrong when the dragged object is an item in 'Control Panel' } GlobalUnlock(medium.hGlobal); } ReleaseStgMedium(&medium); Any idea? Thanks Zach@Shine
