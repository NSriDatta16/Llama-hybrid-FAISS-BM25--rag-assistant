[site]: stackoverflow
[post_id]: 4240012
[parent_id]: 4239388
[tags]: 
It's safer to parse HTML with DOMDocument instead of regex. Try this code: loadHtml(mb_convert_encoding($html, 'HTML-ENTITIES', "UTF-8")); $xpath = new DOMXPath($dom); foreach($xpath->query('//text()[(ancestor::a)]') as $node) { $replaced = str_ireplace('_', ' ', $node->wholeText); $newNode = $dom->createDocumentFragment(); $newNode->appendXML($replaced); $node->parentNode->replaceChild($newNode, $node); } // get only the body tag with its contents, then trim the body tag itself to get only the original content return mb_substr($dom->saveXML($xpath->query('//body')->item(0)), 6, -7, "UTF-8"); } $html = ' I_have_underscores '; echo replaceInAnchors($html);
