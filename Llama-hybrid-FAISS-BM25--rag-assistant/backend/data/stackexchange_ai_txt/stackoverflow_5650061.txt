[site]: stackoverflow
[post_id]: 5650061
[parent_id]: 
[tags]: 
Magento - UnitTests - Mock Objects

I am writing some tests for a Magento module, using Ivan Chepurnyi's extension , and I'm having trouble using the mock objects. Here is the class: _salesCollection = Mage::getModel('module/classA')->getCollection() ->addFieldToFilter('id', $this->_getId()); } public function _getId() { return Mage::getModel('module/classB')->getId();//session params } public function getSalesTotalNumber() { return $this->_salesCollection->count(); } } The method I'm trying to test is getSalesTotalNumber() . And here is the test: _mock = $this->getMock('Namespace_Module_Block_Class', array('_getId') ); $this->_mock->expects($this->any()) ->method('_getId') ->will($this->returnValue(1024)); parent::setUp(); } /** * @test * @loadFixture * @loadExpectation */ public function testSalesTotalNumber() { $actual = $this->_mock->getSalesTotalValue(); $expected = $this->_getExpectations()->getSalesTotalNumber(); $this->assertEquals($expected, $actual); } } As you can see, what I want to do is overwrite the _getId() method so that it returns an id which match the id in the fixture and so load the collection. But it doesn't work :-(. In my test, if I echo $this->_mock->_getId() it returns the correct Id (1024). But in the __construct() of my class $this->_getId() returns null, which is the expected value during testing (I mean, during testing there is no session, so it can't get the object's Id as I store it in a session variable). So the _getId() method isn't mocked by my test case. Any help will be highly appreciated.
