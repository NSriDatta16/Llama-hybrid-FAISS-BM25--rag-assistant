[site]: datascience
[post_id]: 74508
[parent_id]: 
[tags]: 
Removing outliers with orders of magnitude differences

I have a dataset of virtual currency earn and spend events from a mobile game app. Unfortunately, people cheat in the game to get more currencies. These cheaters use different techniques so its quite hard to detect them all in game. The dataset is also about 50 TB so the only option I have is to use SQL (on Google Bigquery). It tried to make a standard outlier detection system in which I find the average and standard deviation of the currency earn and spend in each level. This works for the biggest outliers. However, some people cheat to earn, for example, 1e15 gold, while other "only" cheat to get 10000 gold. The normal gold earn rate should not be higher than about 1000. The standard outlier detection system works for the 1e15 gold earn person, but as the avg and std are so high due to that person, the 10000 gold is not found to be an outlier. Does anyone have an idea how to find these outliers successfully? My dataset looks something like this. (It should be noted that cheaters don't show up this often and that the dataset has in the order of billions of these rows): user_id, currency, earn_or_spend, source_or_sink, amount 'user_1', 'gold', 'earn', 'quest', 3 'user_1', 'cash', 'earn', 'building_collect', 10000 'user_3', 'gold', 'spend', 'quest', 1 'user_2', 'gold', 'earn', 'quest', 4 'user_1', 'cash', 'earn', 'building_collect', 50000 'user_1', 'gold', 'earn', 'quest', 5 'user_4', 'gold', 'earn', 'quest', 99999 # cheater 'user_3', 'gold', 'spend', 'quest', 3 'user_5', 'gold', 'earn', 'quest', 1E15 # cheater 'user_3', 'cash', 'earn', 'level_up', 100000 'user_1', 'gold', 'earn', 'quest', 3 'user_1', 'cash', 'spend', 'build_building', 50000 It can be generated in Google BigQuery with this code: WITH data as ( SELECT * FROM UNNEST ( ARRAY > [ ('user_1', 'gold', 'earn', 'quest', 3), ('user_1', 'cash', 'earn', 'building_collect', 10000), ('user_3', 'gold', 'spend', 'quest', 1), ('user_2', 'gold', 'earn', 'quest', 4), ('user_1', 'cash', 'earn', 'building_collect', 50000), ('user_1', 'gold', 'earn', 'quest', 5), ('user_4', 'gold', 'earn', 'quest', 99999), # cheater ('user_3', 'gold', 'spend', 'quest', 3), ('user_5', 'gold', 'earn', 'quest', 1E15), # cheater ('user_3', 'cash', 'earn', 'level_up', 100000), ('user_1', 'gold', 'earn', 'quest', 3), ('user_1', 'cash', 'spend', 'build_building', 50000) ] ) ) SELECT * FROM data
