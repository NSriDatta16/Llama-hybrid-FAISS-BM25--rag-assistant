[site]: stackoverflow
[post_id]: 877048
[parent_id]: 876922
[tags]: 
See the article in my blog for detailed explanations: Finding loops in a tree If your users may be found more than once in the needs column of the table, it's an NP complex task. If not, issue this query on your view: SELECT COUNT(*) FROM v_needs CONNECT BY NOCYCLE need = PRIOR have WHERE CONNECT_BY_ISCYCLE = 1 CONNECT BY NOCYCLE allows loops within hierarchical queries ( NOCYCLE just stops a branch when it finds a loops, no NOCYCLE returns an error). CONNECT_BY_ISCYCLE returns true whenever it finds a loop (it returns 1 for the record which would yield the root of the current branch on the next iteration). Note that this query will yield you all users within the loops without grouping them. To group the users, issue this query: SELECT n.*, CONNECT_BY_ROOT(have), level FROM v_needs n START WITH have IN ( SELECT MIN(have) FROM ( SELECT have, CONNECT_BY_ROOT(have) AS root FROM t_needs START WITH have IN ( SELECT have FROM t_needs n WHERE CONNECT_BY_ISCYCLE = 1 CONNECT BY NOCYCLE needs = PRIOR have ) CONNECT BY NOCYCLE have = PRIOR needs ) GROUP BY root ) CONNECT BY NOCYCLE have = PRIOR needs Update: From your post I can see that you have a limitation on the maximum loop length. This makes this problem much easier to solve. Just add the loop limiting condition into each of the the queries: SELECT n.*, CONNECT_BY_ROOT(have), level FROM v_needs n START WITH have IN ( SELECT MIN(have) FROM ( SELECT have, CONNECT_BY_ROOT(have) AS root FROM t_needs START WITH have IN ( SELECT have FROM t_needs n WHERE CONNECT_BY_ISCYCLE = 1 CONNECT BY NOCYCLE needs = PRIOR have AND level This will stop traversing the hierarchy tree on the 5th level. If you have 1,000,000 users in your database and 5 matches per user in average, the query will need to examine 1,000,000 * 5^5 = 3,125,000,000 rows, which is an observable number of rows. The query will be greatly improved if you MATERIALIZE your view and create indexes on 'need' and 'have'. In this case the query completion will be a matter of minutes.
