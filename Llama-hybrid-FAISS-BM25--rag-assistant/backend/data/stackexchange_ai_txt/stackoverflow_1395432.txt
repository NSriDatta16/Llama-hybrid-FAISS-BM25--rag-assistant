[site]: stackoverflow
[post_id]: 1395432
[parent_id]: 1395395
[tags]: 
This is a fairly common C idiom for variably sized structures. In order to make this work, you need to ensure you allocate enough memory for the array size you want, usually something like pFlashInfoEx = malloc(offsetof(PFlashInfoEx, region) + g_pStorageDesc->dwNumRegions * sizeof(FlashRegion)); this interacts badly with trying to use 'new' in C++; you have to allocate the memory manually: void *mem = ::operator new(offsetof(PFlashInfoEx, region) + g_pStorageDesc->dwNumRegions * sizeof(FlashRegion)); pFlashInfoEx = new(mem) PFlashInfoEx; for (int i = 1; i dwNumRegions; i++) new (&pFlashInfoEx->region[i]) FlashRegion;
