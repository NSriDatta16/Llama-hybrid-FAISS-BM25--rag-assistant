[site]: crossvalidated
[post_id]: 622171
[parent_id]: 622165
[tags]: 
The problem is with the moving average function (that I copied without much thinking from stackverflow). It takes values in the future into the average. The correct moving average would be: def moving_average(x, w): kernel = np.zeros((1, 2*w+1), dtype=int) kernel[0, :w+1] = 1 count = np.sum(kernel) return scipy.signal.convolve2d(x, kernel, 'same') / count This leads to nearly identical prices (with different compare results) for the cumsum model and a very slight biased values for the cumprod (which could be caused by the multiplication).
