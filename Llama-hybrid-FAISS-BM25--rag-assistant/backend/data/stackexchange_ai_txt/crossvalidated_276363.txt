[site]: crossvalidated
[post_id]: 276363
[parent_id]: 262469
[tags]: 
It is not well-documented, but I have examined the source code for xgboost and I have determined the following for the count:poisson objective: It uses the Poisson likelihood with a log link. The base_margin parameter is on the linear scale, not the response scale. As the boosting rounds proceed, new trees are also added on the linear scale. The xgboost Poisson negative log likelihood formula is correct, but it's a little different from the Poisson deviance. However the negative log likelihood and deviance are very close and asymptotically equivalent up to a factor of 2. Setting base_margin to log(exposure) is equivalent to including a log(exposure) offset term. A bit more detail on these points: LogGamma is the logarithm of the gamma function, which is a continuous extension of the factorial. Specifically, $\Gamma(n) = (n-1)!$ for integer $n$. Thus, LogGamma(y + 1) = factorial(y) . The LogGamma term represents the $\log(y!)$ term in the full Poisson log-likelihood. (This term is normally omitted from the log-likelihood expression, since it does not affect the optimization.) According to Stirling's approximation, $\log(y!) \approx y\log(y) - y$. Replacing LogGamma with this approximation, and substituting py=exp(p) (i.e. replacing the linear predictor with the mean via log link) yields y * log(y / py) - (y - py) . This is almost the standard Poisson deviance, except it is missing the factor of 2. The formula you found for GBM is not the standard Poisson deviance, although it is the same up to an additive (y-dependent) constant. Confusingly, the py in your GBM formula is actually the linear scale prediction, not the response scale, whereas in the other formulas py is the response, the predicted mean of y. You do not need to add log(exposure) to the objective formula. All you need to do is set base_margin=log(exposure) . This ensures that the first sum term in the boosting series is log(exposure) . Subsequent boosting rounds add more terms but the initial offset is never removed or changed.
