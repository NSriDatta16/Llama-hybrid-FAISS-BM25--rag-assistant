[site]: crossvalidated
[post_id]: 643094
[parent_id]: 643063
[tags]: 
An estimate of autocovariance of order $j$ is $$ \widehat{\text{Cov}}(j)=\frac{1}{T}\sum_{t=j+1}^T(x_t-\bar x)(x_{t-j}-\bar x) $$ where $\bar x:=\frac{1}{T}\sum_{t=1}^T x_t$ is an estimate of $\mathbb{E}(X)$ . (The can be some variation in the denominator of $\widehat{\text{Cov}}(j)$ ; $T$ is not the only choice.) An estimate of autocorrelation of order $j$ is $$ \hat\rho(j)=\frac{\widehat{\text{Cov}}(j)}{\widehat{\text{Cov}}(0)}. $$ You seem to be interested in replacing $\widehat{\text{Cov}}(j)$ with $$ \widehat{\widetilde{\text{Cov}}}(j)=\frac{1}{T-\ell}\sum_{t\in I(j)}(x_t-\bar x)(x_{t-j}-\bar x) $$ where $I(j)$ is the set of pairs $(x_t,x_{t-j})$ where both $x_t$ and $x_{t-j}$ belong to the same day. Thus, the sum in $\widehat{\widetilde{\text{Cov}}}(j)$ is based on that in $\widehat{\text{Cov}}(j)$ but omits the elements where $x_t$ and $x_{t-j}$ belong to different days. $\ell$ accounts for the omitted elements, and I am not sure what exactly it should be... Maybe just the number of elements excluded from $\widehat{\widetilde{\text{Cov}}}(j)$ relative to $\widehat{\text{Cov}}(j)$ ? $\widehat{\widetilde{\text{Cov}}}(j)$ can be calculated manually; it should not be too difficult to code. It may be possible to come up with a trick that would allow using the usual function of estimating covariance with minimal changes, but I do not have any concrete idea for it now. You have suggested an option of averaging $\widehat{\text{Cov}}(j)$ from every day. This would use a different $\bar x_\tau$ every day (where $\tau$ indicates the day) and would be less efficient than using $\bar x$ defined above, unless you think $\mathbb{E}(X)$ varies from day to day. E.g. in the case of $j$ close to 18, I suspect $\widehat{\text{Cov}}(j)$ would be poorly behaved.
