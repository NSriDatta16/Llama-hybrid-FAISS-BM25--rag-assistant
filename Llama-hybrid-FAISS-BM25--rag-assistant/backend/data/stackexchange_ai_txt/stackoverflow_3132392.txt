[site]: stackoverflow
[post_id]: 3132392
[parent_id]: 
[tags]: 
ReadEventLog() API fails with error code 87 on Windows Server 2008 R2 while reading Application/System/Security event logs from system

I have an MFC application which reads system (i.e. Application/System/Security ) event logs on Windows Server 2008 R2 in WOW64 environment. I am facing a problem with std SDK ::ReadEventLog() function in Windows Server 2008 R2 . Below I have provided the code snippet, but the same code/API works perfectly in Windows XP WOW64 & x64 environment. Error code '87' refers to "The parameter is incorrect" but according me the parameters which I passed to ::ReadEventLog() function seems to be correct. [Code] //BufferSize. const int BUFFER_SIZE = 1024*10 BYTE l_bBufferSize[BUFFER_SIZE]; EVENTLOGRECORD* l_pEvntLogRecord = NULL; l_pEvntLogRecord = (EVENTLOGRECORD *) &l_bBufferSize; ::SetLastError(0); /* Adjust the 'counter' to read logs. 'l_nReadRecordIndex' is mapped with the list control, e.g. on key down, 'l_nReadRecordIndex' is set as "GetCountPerPage() + 1" this is one case as their are many case. */ DWORD l_dwLogCounter = (GetTotalNumberOfRecords() - l_nReadRecordIndex) + 1; //Read logs as per "nCntToReadRecords". for(l_dwLogCounter;l_nNoOfRecTobeRead //Get Actual position to read. if(0 != ::ReadEventLog( m_hEventLogHandle, EVENTLOG_SEEK_READ|EVENTLOG_FORWARDS_READ, l_dwLogCounter, l_pEvntLogRecord, BUFFER_SIZE, &l_dwReadBytes, &l_dwNeedBytes)) { DWORD l_dwErrCode = 0; l_dwErrCode = ::GetLastError(); //87 is returned return FALSE } } //Data population code If any one is aware of similar problem or worked on the similar issue please let me know the solution. Please refer the above code snippet and let me know the following things, a) What are the incorrect parameters. b) Is their any another way to read event logs. Thanks in advance. -- Ganesh
