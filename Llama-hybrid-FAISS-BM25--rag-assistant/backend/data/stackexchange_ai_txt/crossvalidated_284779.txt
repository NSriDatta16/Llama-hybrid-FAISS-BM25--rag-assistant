[site]: crossvalidated
[post_id]: 284779
[parent_id]: 284629
[tags]: 
I'd suggest a mixed-effects/multilevel model. Essentially you combine two levels: treatment vs. non-treatment, and within the treatment group. So the model would be something like: \begin{align} \mathbb{E}(Y_i) = \beta_0 + X_i\beta + \gamma_i Z_i \end{align} but we additionally assume that $\gamma_i$ depends on the extent of treatment (which I'll call the dose) -- each individual who was treated now has their own parameter for the treatment effect, which we expect will depend on the dose. So we have an additional linear model for the $\gamma_i$: \begin{align} \gamma_i = \varphi_{0} + (G_i-\bar{G_i})\varphi_i + \xi_i. \end{align} with $\xi_i$ some error (probably zero-mean Gaussian). Now, $\varphi_0$ is the average treatment effect -- i.e. the average benefit you get from the treatment when you're given an average dose. This is probably the most sensible way to compare the treatment vs. non-treatment groups. If you're happy to assume that $\xi_i = 0$, i.e. there's no variability in the treatment effect at a given dose for a given patient, then you can just sub back in to get: \begin{align} \mathbb{E}(Y_i) = \beta_0 + X_i\beta + (\varphi_0 + (G_i-\bar{G_i})\varphi_i) Z_i \end{align} which you can fit with any old linear regression routine. If you want to do the full mixed-effects model, there are lots of packages in R that will do it for you, the most common is lme4 . Little advert for going Bayesian (ignore if you want): I tend to do Bayesian stats personally and Bayesian methods are quite well suited to multilevel/hierarchical models -- the R package brms is absolutely brilliant, intuitive, very well documented and has very fast support from the developer in a Google group if you're struggling. One of the benefits of the Bayesian approach is that it's very easy to 'pool' your estimates -- you encourage the $\varphi_i$ towards zero if there's not sufficient data to estimate them, i.e. you encourage the individual effects towards their mean values.
