[site]: stackoverflow
[post_id]: 420976
[parent_id]: 
[tags]: 
LINQ to SQL Query Syntax

I have several tables that center around an organization table that simply holds a unique ID value. Each Organization can then be at a particular location and have a particular name. The tricky part is that the organizations support location and name changes with a specified effective date of each change. For this example I have 4 relevant tables: Organization: ID (PK, int, identity) Location: ID (PK, int, identity), Name (varchar), AltLat (float), AltLong (float) organization_locations: organization_id(FK, int), location (FK, int), eff_date (datetime) organization_names: organization_id (FK, int), name (ntext), eff_date (datetime), icon (nvarchar(100)) What I need to retrieve is the list of all locations along with all organizations at a given location as of a specific date and project them into my business entities. In other words, I will have a date provided and need to return for each location, the organization related to the organization_location entry with the most recent eff_date that is less than the date provided. Same thing goes for each organization, I'd need the name as of the date. Here's what I started with but it doesn't seem to work: Dim query = From loc In dc.Locations _ Where loc.AltLong IsNot Nothing And loc.AltLat IsNot Nothing _ Select New AnnexA.Entities.AnnexALocation With {.ID = loc.ID, .Name = loc.Location, .Y = loc.AltLat, .X = loc.AltLong, _ .Units = From ol In loc.organization_locations Let o = ol.Organization.organization_names.Where(Function(ed) (ol.eff_date I'd prefer VB syntax but if you can only give me a C# query I can work with that. I've tried a few other variations but I end up getting syntax errors about an expected "}" or members not being a part of an entity set no matter what combination of parenthesis I try.
