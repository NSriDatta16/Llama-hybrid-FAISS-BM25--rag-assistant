[site]: stackoverflow
[post_id]: 5434900
[parent_id]: 5381339
[tags]: 
I think this will work for you: WITH OrganizationTree (RootOrganizationID, OrganizationID) AS ( --Anchor SELECT O.OrganizationID, O.OrganizationID FROM Organization O UNION ALL --Recurse SELECT T.RootOrganizationID, O.OrganizationID FROM OrganizationTree T JOIN Organization O ON O.ParentOrganizationId = T.OrganizationID ) --execute SELECT P.OrganizationName, SUM(ISNULL(PPL.NumberInOrganization, 0)) AS TotalNumberInOrganization, SUM(ISNULL(EVT.NumberParticipatingInEvent, 0)) AS TotalNumberParticipatingInEvent FROM OrganizationTree T JOIN Organization P ON T.RootOrganizationID = P.OrganizationID LEFT JOIN ( SELECT P.OrganizationID, COUNT(*) AS NumberInOrganization FROM Personnel P GROUP BY P.OrganizationID ) PPL ON PPL.OrganizationID = T.OrganizationID LEFT JOIN ( SELECT P.OrganizationID, COUNT(*) AS NumberParticipatingInEvent FROM EventLog EL JOIN Personnel P ON EL.PersonnelID = P.PersonnelID GROUP BY P.OrganizationID ) EVT ON EVT.OrganizationID = T.OrganizationID GROUP BY T.RootOrganizationID, P.OrganizationName If you need to have the indentation like in your example output, then this should work: WITH OrganizationTree (RootOrganizationID, OrganizationID) AS ( --Anchor SELECT O.OrganizationID, O.OrganizationID FROM Organization O UNION ALL --Recurse SELECT T.RootOrganizationID, O.OrganizationID FROM OrganizationTree T JOIN Organization O ON O.ParentOrganizationId = T.OrganizationID ) --execute SELECT SPACE(L.OrganizationLevel) + P.OrganizationName AS FormattedOrganizationName, P.OrganizationName, SUM(ISNULL(PPL.NumberInOrganization, 0)) AS TotalNumberInOrganization, SUM(ISNULL(EVT.NumberParticipatingInEvent, 0)) AS TotalNumberParticipatingInEvent FROM OrganizationTree T JOIN ( SELECT L.OrganizationID, (COUNT(*) - 1) AS OrganizationLevel FROM OrganizationTree L GROUP BY L.OrganizationID ) L ON T.RootOrganizationID = L.OrganizationID JOIN Organization P ON T.RootOrganizationID = P.OrganizationID LEFT JOIN ( SELECT P.OrganizationID, COUNT(*) AS NumberInOrganization FROM Personnel P GROUP BY P.OrganizationID ) PPL ON PPL.OrganizationID = T.OrganizationID LEFT JOIN ( SELECT P.OrganizationID, COUNT(*) AS NumberParticipatingInEvent FROM EventLog EL JOIN Personnel P ON EL.PersonnelID = P.PersonnelID GROUP BY P.OrganizationID ) EVT ON EVT.OrganizationID = T.OrganizationID GROUP BY T.RootOrganizationID, L.OrganizationLevel, P.OrganizationName
