[site]: stackoverflow
[post_id]: 5035684
[parent_id]: 5019995
[tags]: 
Couldn't you do it the other way? Get all Agents matching the desired conditions do a Set::combine to get the agency_ids (and have it uniquified) do query with IN agency_ids that way there would be only 2 sql calls
