[site]: crossvalidated
[post_id]: 346226
[parent_id]: 
[tags]: 
Edge detection in time series

I have a time series (data here ) which contains several square-wave jumps, as well as some physical signals of interest. An example is shown in the top panel of the figure below. There are square wave jumps around samples 600, 3900, and 4500. There is also an interesting physical signal between samples 1000 and 2000. I would like a reliable method to detect the square wave jumps, so I can remove them. I am following the methodology described in this paper: Fried, Roland. "On the robust detection of edges in time series filtering." Computational Statistics & Data Analysis 52.2 (2007): 1063-1074. Eq. 4 of that paper defines the following test statistic (similar to a t-test), based on a sliding window along the time series: $$ \tau_i = \frac{|m_{i+} - m_{i-}|}{\sigma_i} $$ Here, $m_{i+}$ is the median value of the next $h$ samples, starting from sample $i+1$, and $m_{i-}$ is the median of the previous $h$ samples, starting from sample $i$. $\sigma_i$ is an estimate of the standard deviation of the window centered on sample $i$. I am using a robust estimate of scale, namely the $Q_n$ statistic due to Croux and Rousseeuw. Also, I set $h = 15$. The idea is that in a region with no jump/edge, the two median values will be close together, and $\tau_i$ will be small. If sample $i$ happens to be on an edge, then the two median values will be quite different, leading to a large value of $\tau_i$. Dividing by the standard deviation helps to detect edges even when noise is present. In the second panel of the figure above, I show the test statistic $\tau_i$ in green. You can see it gives nice peaks near the 3 square wave features. However, unfortunately it also gives a false positive peak in the region where there is an interesting physical signal (around sample 1200). The third row of the figure shows a zoomed in view of samples 1000 to 2000. We can see that the false positive occurs because there is a sharp gradient on the left side of the signal, and so the two median values will be far from each other. Unfortunately dividing by $\sigma_i$ doesn't lower the value of $\tau_i$ sufficiently to avoid a false positive. I am wondering if anyone has any ideas on how to reduce the chance of these false positives? I am considering to change the statistic test to use trimmed means instead of medians, as perhaps this would help to bring the two location estimates closer together in the case of sample 1200 above, while keeping a larger separation for true edges. I haven't yet tried this. I would appreciate any further advice on this! EDIT: as requested, here is a plot of first differences of the data. You can see that the false positive is still present near sample 1200, and also the third square wave peak near sample 4500 has a lower SNR than the test statistic above.
