[site]: stackoverflow
[post_id]: 2865136
[parent_id]: 2864425
[tags]: 
Give this a try: sed 'h;s/[^=]*=*=#\(.*\)/\1/;s/\([^=]\)#/\1/g;x;s/\([^=]*=\+#\).*/\1/;G;s/\n//g' inputfile It splits the line in two at the first "=#", then deletes all "#" that aren't preceded by an "=", then recombines the lines. Let me know if there are specific cases where it fails. Edit: This version, which is increasingly fragile, works for your new example as well as the original: sed 'h;s/[^=]*=[^=]*=*=#\(.*\)$/\1/;s/\([^=]\)#/\1/g;x;s/\([^=]*=[^=]*=\+#\).*/\1/;G;s/\n//g' inputfile
