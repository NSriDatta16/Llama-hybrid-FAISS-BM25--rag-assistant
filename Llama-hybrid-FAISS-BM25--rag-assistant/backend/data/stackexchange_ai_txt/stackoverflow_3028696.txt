[site]: stackoverflow
[post_id]: 3028696
[parent_id]: 
[tags]: 
GD PHP Base64 Picture (png) error

This is part of my code: $con = mysql_connect("localhost","username","passs"); if (!$con) { die('Could not connect: ' . mysql_error()); } mysql_select_db("database", $con); if(mysql_num_rows(mysql_query("SELECT name FROM xbox_user WHERE name = '$user'"))){ // Code inside if block if userid is already there $result = mysql_query("SELECT name FROM xbox_user WHERE name = '$user'"); while($row = mysql_fetch_array($result)) { if ($row['date'] > $row['date']+100){ $src = imagecreatefrompng($result['XboxInfo']['TileUrl']); $base64= base64_encode(file_get_contents($result['XboxInfo']['TileUrl'])); $date = date("Ymd"); mysql_query("UPDATE xbox_user SET date = '$date' SET avatar = '$base64' WHERE name = '$user'"); }else{ $encode = $row['avatar']; //echo $encode; $rand = rand(1, 1337); file_put_contents('/tmp/'.$rand.'.png', base64_decode($row['avatar'])); //ERROR LINE $src = imagecreatefrompng('/tmp/'.$rand.'.png'); unlink('/tmp/'.$rand.'.png'); } } }else{ $src = imagecreatefrompng($result['XboxInfo']['TileUrl']); $base64= base64_encode(file_get_contents($result['XboxInfo']['TileUrl'])); $date = date("Ymd"); mysql_query("INSERT INTO xbox_user (name, avatar, date) VALUES ('$user', '$base64', '$date')"); } It comes up with multiple errors but I feel this one should be addressed first as the other could just be caused by the first error: Warning: imagecreatefrompng() [function.imagecreatefrompng]: '/tmp/628.png' is not a valid PNG file in /home/nah/public_html/experiment/xbox/draw3.php on line 60 It also does create an entry in my mysql DB This is the base64 it puts in the mysql under avatar and is trying to decode: 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 It works fine when there is no DB entry but when there is a DB entry it refuses to read. The temporary images it creates are blank
