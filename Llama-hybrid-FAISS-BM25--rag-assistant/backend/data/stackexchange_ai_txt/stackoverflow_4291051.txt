[site]: stackoverflow
[post_id]: 4291051
[parent_id]: 
[tags]: 
Php curl: problem setting HTTP_HOST

I have setup an internal proxy using php and curl. Most of it is done, however, I am having trouble setting HTTP_HOST header field. This is the code I am using: Code on the proxy server:: $data_server_url = "http://IP_ADDRESS_OF_MY_CONTENT_SERVER/"; $request_uri=""; if(isset($_SERVER['REQUEST_URI'])) { $request_uri = $_SERVER['REQUEST_URI']; }; $curl_url="${data_server_url}${request_uri}"; //Pass all these fields as-they-are-got from the client to the content server. $field_array=array("HTTP_ACCEPT", "HTTP_ACCEPT_CHARSET", "HTTP_ACCEPT_ENCODING", "HTTP_ACCEPT_LANGUAGE", "HTTP_CONNECTION", "HTTP_HOST", "HTTP_REFERER", "HTTP_USER_AGENT"); $curl_request_headers=array(); foreach ($field_array as &$field) { if(isset($_SERVER["$field"])) { $curl_request_headers["$field"]=$_SERVER["$field"]; } else { $curl_request_headers["$field"]=""; }; }; //Open connection $curl_handle = curl_init(); //Set the url, number of POST vars, POST data curl_setopt($curl_handle, CURLOPT_URL, $curl_url); curl_setopt($curl_handle, CURLOPT_POST, count($_POST)); curl_setopt($curl_handle, CURLOPT_POSTFIELDS, $_POST); curl_setopt($curl_handle, CURLOPT_RETURNTRANSFER, 1); curl_setopt($curl_handle, CURLOPT_AUTOREFERER, TRUE); curl_setopt($curl_handle, CURLOPT_HTTPHEADER, $curl_request_headers); //Execute post $result = curl_exec($curl_handle); //Close connection curl_close($curl_handle); However, on my content server, $_SERVER['HTTP_HOST'] is set to the its own IP address (it should be null or the HTTP_HOST variable through which the the proxy server is accessed). Can anyone suggest what is the fix?
