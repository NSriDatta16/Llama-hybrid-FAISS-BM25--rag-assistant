[site]: stackoverflow
[post_id]: 4373923
[parent_id]: 
[tags]: 
Visual Studio Addin - Cant Create Child Menu Items

i am trying to create a basic menu structure for a visual studio 2008 addin. So far i can create the first top-level menu which in my example below i have called TOPMENU. I am struggling to figure out how to add child items to TOPMENU. I have tried a variety of ways and cant figure it out. Can someone help me finish off the code below? I am currently getting an invalid cast exception when i try to create object "a2" below. void IDTExtensibility2.OnConnection(object application, ext_ConnectMode connectMode, object addInInst, ref Array custom) { _ApplicationObject = (DTE2)application; _AddInInstance = (AddIn)addInInst; if (connectMode == ext_ConnectMode.ext_cm_UISetup) { object[] contextGUIDS = new object[] { }; Commands2 commands = (Commands2)_ApplicationObject.Commands; CommandBar cbMainMenu = ((CommandBars)_ApplicationObject.CommandBars)["MenuBar"]; try { // ROOT MENU Command cmdProjectManagement = commands.AddNamedCommand2(_AddInInstance, "TOPMENU", "TOPMENU", "", true, null, ref contextGUIDS, (int)vsCommandStatus.vsCommandStatusSupported + (int)vsCommandStatus.vsCommandStatusEnabled, (int)vsCommandStyle.vsCommandStyleText, vsCommandControlType.vsCommandControlTypeButton); if (cmdProjectManagement != null) cmdProjectManagement.AddControl(cbMainMenu, cbMainMenu.Controls.Count); // SUB ITEM Command cmdCompiledAssemblies = commands.AddNamedCommand2(_AddInInstance, "TOPMENU_CompiledAssemblies", "Compiled Assemblies", String.Empty, true, null, ref contextGUIDS, (int)vsCommandStatus.vsCommandStatusSupported + (int)vsCommandStatus.vsCommandStatusEnabled, (int)vsCommandStyle.vsCommandStyleText, vsCommandControlType.vsCommandControlTypeButton); CommandBarControl a1 = cbMainMenu.Controls["TOPMENU"]; CommandBarPopup a2 = (CommandBarPopup)a1; if (cmdCompiledAssemblies != null) cmdCompiledAssemblies.AddControl(a2.CommandBar, 1); } catch (Exception ex) { } } }
