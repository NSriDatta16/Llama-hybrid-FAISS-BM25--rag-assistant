[site]: crossvalidated
[post_id]: 525042
[parent_id]: 
[tags]: 
Derivation of Hessian for multinomial logistic regression in Böhning (1992)

This question is basically about row/column notation of derivatives and some basic rules. However, I couldn't figure out where I'm wrong. For multinomial logistic regression, I'm trying to get the following observed information given in Böhning's paper [1]: $$ -\nabla^2L=\begin{pmatrix} p_1(1-p_1)\mathbf{xx}^T & -p_1p_2\mathbf{xx}^T & \dots & -p_1p_k\mathbf{xx}^T \\ \vdots & p_2(1-p_2)\mathbf{xx}^T & & \vdots \\ -p_kp_1\mathbf{xx}^T & \dots & & p_k(1-p_k)\mathbf{xx}^T \end{pmatrix} $$ where $p_i=p(y_i=1|\mathbf{x})=\frac{\exp(w_i^T\mathbf{x})}{\sum_{j=1}^K\exp{w_j^T\mathbf{x}}}$ for $i=1,...,K$ , $\mathbf{x}$ is a single observation (a column vector of size $d$ ), $\omega_i$ is the parameter vector of $i$ th class (a column vector of size $d$ ). $y_i \in \lbrace 0, 1 \rbrace$ , which is the class label. I can write the log-likelihood (for a single observation) of as follows: $$ \mathcal{L}=\sum_{k=1}^K y_{k}\omega_k^T\mathbf{x}-\ln\sum_{j=1}^K\exp{(\omega_j^T\mathbf{x})} $$ According to Matrix Cookbook , $\frac{\partial \omega_k^T \mathbf{x}}{\partial \omega_k}=\mathbf{x}$ . By using this, I wrote the following first and second derivatives: $$ \frac{\partial \mathcal{L}}{\partial \omega_k}=\left( y_{k} -\frac{\exp(\omega_k^T\mathbf{x})}{\sum_{j=1}^K\exp{(\omega_j^T\mathbf{x})}} \right)\mathbf{x} \\ \frac{\partial \mathcal{L}}{\partial \omega_k \partial \omega_k}=-\left( \frac{\exp(\omega_k^T\mathbf{x})}{\sum_{j=1}^K\exp{(\omega_j^T\mathbf{x})}}-\frac{(\exp(\omega_k^T\mathbf{x}))^2}{(\sum_{j=1}^K\exp{(\omega_j^T\mathbf{x})})^2} \right)\mathbf{x} \mathbf{x} $$ So instead of $\mathbf{xx}^T$ , I get $\mathbf{xx}$ . How can I correct this? In some sources like this one the second derivative is defined as $\frac{\partial^2\mathcal{L}}{\partial\omega_k\partial\omega_k^T}$ . Is this the correct notation? (Even if it is, I still can't correct my derivatives.) [1] D. Böhning, "Multinomial Logistic Regression Algorithm", Ann. Inst. Statist. Math, vol. 44, No. 1, 197-200, 1992.
