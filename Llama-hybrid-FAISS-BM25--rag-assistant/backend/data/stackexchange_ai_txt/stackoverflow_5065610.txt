[site]: stackoverflow
[post_id]: 5065610
[parent_id]: 
[tags]: 
NHibernate - Sytem.OutOfMemoryException thrown

I'm getting a System.OutOfMemoryException when trying to fetch 185 records from DB using ASP.NET MVC and NHibernate. Here is the code snippet of the method from the Repository class: public IList GetForFullExport(RequestFormSearchCriteria searchCriteria, string[] restrictRoles) { ... DetachedCriteria criteria = DetachedCriteria.For () .CreateAlias("RequestMember", "RequestMember") .CreateAlias("RequestFormStatu", "RequestFormStatu") .SetFetchMode("RequestMember", FetchMode.Eager) .SetFetchMode("RequestFormStatu", FetchMode.Eager); DetachedCriteria criteriaLang = DetachedCriteria.For ("af") .SetFetchMode("RequestFormsLanguages", FetchMode.Eager) .SetFetchMode("RequestFormsLanguages.LanguageMember", FetchMode.Eager); DetachedCriteria criteriaDoc = DetachedCriteria.For ("af") .SetFetchMode("RequestFormsDocuments", FetchMode.Eager) .SetFetchMode("RequestFormsDocuments.DocumentMember", FetchMode.Eager); criteriaLang.Add(Subqueries.PropertyIn("Id", NHibernate.CriteriaTransformer.Clone(criteria).SetProjection(NHibernate.Criterion.Projections.Id()))); criteriaDoc.Add(Subqueries.PropertyIn("Id", NHibernate.CriteriaTransformer.Clone(criteria).SetProjection(NHibernate.Criterion.Projections.Id()))); //Add sort if (!string.IsNullOrEmpty(searchCriteria.SIdx)) { criteria.AddOrder(new Order(searchCriteria.SIdx, searchCriteria.SOrd == "asc")); } var multiResult = Session.CreateMultiCriteria() .Add(criteria) .Add(criteriaLang) .Add(criteriaDoc) .List(); ... } And here is where the code breaks with System.OutOfMemory exception - at Session.CreateMultiCriteria(). I've extracted the SQL query that NHibernate is generating and executed it directly in SQL Server 2005 Management Studio and I got the results very fast (185 rows). The application is actually trying to export the jQuery grid rows to CSV file and above mentioned method is called in this process. The crash is happening only when I try to export all rows. When I export several rows - everything works fine. Thanks in advance for the help.
