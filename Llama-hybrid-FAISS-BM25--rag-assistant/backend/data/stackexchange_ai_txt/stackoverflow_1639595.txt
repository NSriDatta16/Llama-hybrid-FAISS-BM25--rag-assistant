[site]: stackoverflow
[post_id]: 1639595
[parent_id]: 1635757
[tags]: 
My first answer was that you could use a loop as above but check the job history tables in msdb to wait for the preceding job to finish: select sj.name as job_name from msdb.dbo.sysjobhistory sjh inner join msdb.dbo.sysjobs_view sj on sj.job_id = sjh.job_id where sjh.step_id = 0 --Job outcome and sjh.run_status = 4 --In progress Thanks, Andomar, for questioning this. It turns out that sysjobhistory is only updated once the first step has completed. Only an idiot would imagine that, if one value of run_status is 'In progress', the table must be updated when a step starts! I've searched around and this seems to be a tough issue. Somewhere SQL knows what's going on but it doesn't expose the information very well. It seems you have to choose between miles of complicated code or using an undocumented stored proc. You can easily find the miles of code answers - there are several - by Googling for sysjobhistory. Personally I prefer the xp approach: create table #xp_results( job_id uniqueidentifier not null, last_run_date int not null, last_run_time int not null, next_run_date int not null, next_run_time int not null, next_run_schedule_id int not null, requested_to_run int not null, -- bool request_source int not null, request_source_id sysname collate database_default null, running int not null, -- bool current_step int not null, current_retry_attempt int not null, job_state int not null ) insert #xp_results exec master.dbo.xp_sqlagent_enum_jobs @is_sysadmin = 1, @job_owner = '' select sj.name from #xp_results xpr inner join msdb.dbo.sysjobs_view sj on sj.job_id = xpr.job_id where running = 1 drop table #xp_results I've tested this and it really does seem to work. Perhaps it's risky using this xp but that's what the Job Activity Monitor uses - I ran it with the Profiler on - so if it changes they'll probably provide some other way to find this info. As long as you wrap this code up in a function or proc and document that you have a dependency on it, it seems like the least of many evils to me.
