[site]: stackoverflow
[post_id]: 608191
[parent_id]: 608112
[tags]: 
What's the best way to "sandbox" a user, in order to only allow him to manage his own data? Allow any filenames/directory names the user wants, but simply don't use them on the server side filesystem. Instead, write the path names into a database with a primary key, and use the primary key as a filename like ‘34256.dat’ in a flat storage directory (or even as a BLOB in the database if you prefer). Then serve up via a download script or URL rewrite to make the desired filename appear in the URL. Sanitising incoming filenames is hard . Detecting ‘..’ is only the beginning. Too-long filenames; too-short filenames; combinations of leading and trailing dots; combinations of leading and trailing whitespace; the different directory separators of different platforms; characters that are invalid on some platforms; control characters; Unicode characters and the environment-specific ways of addressing them; ADSs; filenames (‘.htaccess’) or extensions (‘.php’, ‘.cgi’) that might be ‘special’ to your web server; Windows's reserved filenames... You can spend a lifetime tracking down funny little quirks of filepath rules on various platforms, or you can just forget it and use the database.
