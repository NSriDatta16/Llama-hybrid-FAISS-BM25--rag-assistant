[site]: stackoverflow
[post_id]: 2317568
[parent_id]: 2317521
[tags]: 
There's a lot to be said for a stored proc and temp tables here - as you yourself suggest. For example your SQL above is getting quite hard to read even now: I look at it and immediately think "too long, really don't want to read" :-) Procs and working tables may make life much easier for future developers to read and extend - yourself included in 6 months time! You may also get performance benefits from procs and working tables: you can put indexes on the working tables, debug your proc one bit at a time to see where bottlenecks are, etc. I guess I'm recommending: favour readability and extensibility over "elegance" of using a single query, if performance can be considered more or less equivalent in either approach.
