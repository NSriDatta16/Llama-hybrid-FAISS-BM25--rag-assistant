Magic formula investing is an investment technique outlined by Joel Greenblatt that uses the principles of value investing.

Methodology
Greenblatt (b. 1957), an American professional asset manager since the 1980s, suggests purchasing 30 "good companies": cheap stocks with a high earnings yield and a high return on capital. He describes this as a simplified version of the strategy employed by Warren Buffett and Charlie Munger of Berkshire Hathaway.

He touts the success of his magic formula in his book 'The Little Book that Beats the Market' ( published 2005, revised 2010), stating it averaged a 17-year annual return of 30.8%.

He wrote the book for a non-technical reader (his teenaged children were the target audience), but an appendix includes more advanced explanations and data for readers with relevant experience or education. Greenblatt's system analyzed the largest companies trading on the American stock market, ranked by the largest 1,000, 2,500 or 3,000, for a 17 year period before the book's 2005 publication. Smaller companies, $50 million or under, were avoided because they tend to have fewer shares in circulation and large purchases can cause sharp changes in share prices. Greenblatt did not test this hypothesis on international stock markets due to difficulties comparing international and American data, but believed it would apply globally. He also stressed the formula will not necessarily be successful with any specific stock, but will be successful for a group of stocks as a unit or block. 

He goes on to assigning numerical rankings, based on each company's earnings yield and return on capital: 

"...a company that ranked 232nd best in return on capital and 153rd best in earnings yield would receive combined ranking of 385 (232 + 153). [...] Getting excellent rankings in both categories, (though not the top ranked in either) would be better under this ranking system than being the top-ranked in one category with only a pretty good ranking in the other." 

From here, Greenblatt recommends selecting 20 to 30 of the better-ranked companies, selling them at predetermined intervals and replacing with new stocks that fit the formula.

Greenblatt's analysis found when applied to the largest 1,000 stocks the formula underperformed the market (defined as the S&P 500) for an average of five months out of each year. On an annual basis, the formula outperformed the market three out of four years but underperformed about 16% of two-year periods and 5% of three-year periods. Greenblatt asserts the formula out-performed market averages 100% of the time for any period longer than three years and worked best over three to five years or more. Results were even better and with lower risk when the formula was applied to larger pools of stocks like the largest 3,000 companies. The formula can thus be a contrarian investing strategy, focused sometimes on staying committed to stocks that might be temporarily unattractive or with sub-par performance. 

In an afterword to the 2010 edition, Greenblatt admitted three possible flaws to the formula. (1) The formula can underperform for up to several years which many investors will find discouraging. (2) Some amateurs found it cumbersome to track buying and selling times for stocks. (3) Beating the market does not necessarily imply making money (e.g. if the market loses 40% one year, following the formula might result in a 38% loss, which Greenblatt describes as "small consolation".)

Formula
Establish a minimum market capitalization (usually greater than $50 million).
Exclude utility and financial stocks. 
Exclude foreign companies (American Depositary Receipts).
Determine company's earnings yield = EBIT / enterprise value.
Determine company's return on capital = EBIT / (net fixed assets + working capital).
Rank all companies above chosen market capitalization by highest earnings yield and highest return on capital (ranked as percentages).
Invest in 20–30 highest ranked companies, accumulating 2–3 positions per month over a 12-month period.
Re-balance portfolio once per year, selling losers one week before the year-mark and winners one week after the year mark.
Continue over a long-term (5–10+ year) period.

Analysis
A number of studies have found merit in Greenblatt's "magic investing formula" in various markets around the world. 

A 2009 study of stock markets in the Nordic countries from 1998 to 2008 found Greenblatt's formula led to outperformance of market averages. However, the authors advised the formula was best used as a screening tool and should not be applied dogmatically, as the outperformance associated with Greenblatt's formula might be accounted for by data outlined in the capital asset pricing model and the Fama–French three-factor model. 

A 2016 study from the stock market in Finland found the magic formula "yields higher risk-adjusted returns on average". The authors also proposed that a modified form of Greenblatt's strategy, additionally emphasizing companies with better than average free cash flow, was best suited to bull markets.

A 2016 study found possible confirmation of Greenblat's formula in Brazil's  stock market, but cautioned "we could not assure with a high level of certainty that the strategy is alpha generator, and that our results were not due to randomness."

A 2017 study from the  markets in Sweden found application of the Greenblatt formula resulted in long-term outperformance of market averages in the periods 2005 to 2015, and 2007 to 2017. The authors also found the "magic formula" was also associated with short-term underperformance in some periods, and significantly increased volatility.

An analysis of the Hong Kong stock market from 2001 to 2014 found Greenblatt's formula was associated with long-term outperformance of market averages by 6-15% depending on company size and other variables.

In 2018, a paper presented at a professional conference found validation for the Greenblat formula in the Chinese stock market.  

Independent scholar Robert Andrew Martin published a backtest analysis of Greenblat's magic investing formula for the US market in June 2020. He found that from 2003 to 2015 application of Greenblat's formula to U.S. stocks returned an annualized average 11.4%. This outperformed by a significant margin the S&P 500's annualized return of 8.7%. However, Martin also found Greenblat's formula under-performed the S&P 500 slightly during the 2007-2011 period and actually went negative for a time, and over the entire 2003-2015 period was more volatile overall than the S&P 500. In conclusion, Martin found that the almost 3% outperformance was "surprising", but not as great as the 30% returns Greenblat's book claimed (though their respective analyses used different years). Martin also noted the strategy had "significant psychological risk" associated with under-performance during the aftermath of the 2007-2008 financial crisis. 

Thibault Le Flanchec PhD carried out an empirical study of the french stock market for the period 1999-2019. The results support the superiority of Joel Greenblatt's formula. In addition to this academic study, the investment formula is notably used in the investment company Financière de La Clarté.

 Conservative Formula Investing
Piotroski F-score

References

External links
Official website

Market trends
Personal finance
Stock market
Valuation (finance)