ShāngMì 4 (SM4, 商密4) (formerly SMS4) is a block cipher used in the Chinese National Standard for Wireless LAN WAPI (WLAN Authentication and Privacy Infrastructure) and also used with Transport Layer Security.

SM4 was a cipher proposed to for the IEEE 802.11i standard, but has so far been rejected. One of the reasons for the rejection has been opposition to the WAPI fast-track proposal by the IEEE.

SM4 was published as  in 2021.

The SM4 algorithm was drafted by Data Assurance & Communication Security Center, CAS, and Commercial Cryptography Testing Center, National Cryptography Administration. It is mainly developed by Lü Shuwang (). The algorithm was declassified in January, 2006, and it became a national standard (GB/T 32907-2016) in August 2016.

Cipher detail
The SM4 cipher has a key size and a block size of 128 bits each. Encryption or decryption of one block of data is composed of 32 rounds. A non-linear key schedule is used to produce the round keys and the decryption uses the same round keys as for encryption, except that they are in reversed order.

Keys and key parameters
The length of encryption keys is 128 bits, represented as , in which  is a 32-bit word. The round keys are represented by , where each  is a word. It is generated by the encryption key and the following parameters:

 
 

 and  are words, used to generate the round keys.

Round
Each round are computed from the four previous round outputs  such that:

Where  is a substitution function composed of  a non-linear transform, the S-box and linear transform

S-box
S-box is fixed for 8-bit input and 8-bit output, noted as Sbox(). As with AES, the S-box is based on the multiplicative inverse over . The affine transforms and polynomial bases are different from that of AES, but due to affine isomorphism it can be calculated efficiently given an AES Rijndael S-box.

Remark
On March 21, 2012, the Chinese government published the industrial standard "GM/T 0002-2012 SM4 Block Cipher Algorithm", officially renaming SMS4 to SM4.

A description of SM4 in English is available as an Internet Draft. It contains a reference implementation in ANSI C.

SM4 is part of the ARMv8.4-A expansion to the ARM architecture.

SM4 support for the RISC-V architecture was ratified in 2021 as the Zksed extension.

References

External links
 Linear and Differential Cryptanalysis of Reduced SMS4 Block Cipher
 Example of SMS4 implemented as a Spreadsheet
 Page of Lu Shu-wang (吕述望) (in Chinese)
 The GmSSL Project  (OpenSSL fork with GuoMi algorithms)
  (ISO/IEC 18033-3:2010/Amd 1:2021 Information technology — Security techniques — Encryption algorithms — Part 3: Block ciphers — Amendment 1: SM4 )

Block ciphers
Standards of the People's Republic of China